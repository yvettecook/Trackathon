/*!
 * jQuery JavaScript Library v1.11.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-05-01T17:42Z
 */
!function(global,factory){"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);return"function"===type||jQuery.isWindow(obj)?!1:1===obj.nodeType&&length?!0:"array"===type||0===length||"number"==typeof length&&length>0&&length-1 in obj}function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not});if(qualifier.nodeType)return jQuery.grep(elements,function(elem){return elem===qualifier!==not});if("string"==typeof qualifier){if(risSimple.test(qualifier))return jQuery.filter(qualifier,elements,not);qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return jQuery.inArray(elem,qualifier)>=0!==not})}function sibling(cur,dir){do cur=cur[dir];while(cur&&1!==cur.nodeType);return cur}function createOptions(options){var object=optionsCache[options]={};return jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=!0}),object}function detach(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1)):(document.detachEvent("onreadystatechange",completed),window.detachEvent("onload",completed))}function completed(){(document.addEventListener||"load"===event.type||"complete"===document.readyState)&&(detach(),jQuery.ready())}function dataAttr(elem,key,data){if(void 0===data&&1===elem.nodeType){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();if(data=elem.getAttribute(name),"string"==typeof data){try{data="true"===data?!0:"false"===data?!1:"null"===data?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else data=void 0}return data}function isEmptyDataObject(obj){var name;for(name in obj)if(("data"!==name||!jQuery.isEmptyObject(obj[name]))&&"toJSON"!==name)return!1;return!0}function internalData(elem,name,data,pvt){if(jQuery.acceptData(elem)){var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if(id&&cache[id]&&(pvt||cache[id].data)||void 0!==data||"string"!=typeof name)return id||(id=isNode?elem[internalKey]=deletedIds.pop()||jQuery.guid++:internalKey),cache[id]||(cache[id]=isNode?{}:{toJSON:jQuery.noop}),("object"==typeof name||"function"==typeof name)&&(pvt?cache[id]=jQuery.extend(cache[id],name):cache[id].data=jQuery.extend(cache[id].data,name)),thisCache=cache[id],pvt||(thisCache.data||(thisCache.data={}),thisCache=thisCache.data),void 0!==data&&(thisCache[jQuery.camelCase(name)]=data),"string"==typeof name?(ret=thisCache[name],null==ret&&(ret=thisCache[jQuery.camelCase(name)])):ret=thisCache,ret}}function internalRemoveData(elem,name,pvt){if(jQuery.acceptData(elem)){var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(cache[id]){if(name&&(thisCache=pvt?cache[id]:cache[id].data)){jQuery.isArray(name)?name=name.concat(jQuery.map(name,jQuery.camelCase)):name in thisCache?name=[name]:(name=jQuery.camelCase(name),name=name in thisCache?[name]:name.split(" ")),i=name.length;for(;i--;)delete thisCache[name[i]];if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache))return}(pvt||(delete cache[id].data,isEmptyDataObject(cache[id])))&&(isNode?jQuery.cleanData([elem],!0):support.deleteExpando||cache!=cache.window?delete cache[id]:cache[id]=null)}}}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement)for(;list.length;)safeFrag.createElement(list.pop());return safeFrag}function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!==strundefined?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!==strundefined?context.querySelectorAll(tag||"*"):void 0;if(!found)for(found=[],elems=context.childNodes||context;null!=(elem=elems[i]);i++)!tag||jQuery.nodeName(elem,tag)?found.push(elem):jQuery.merge(found,getAll(elem,tag));return void 0===tag||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found}function fixDefaultChecked(elem){rcheckableType.test(elem.type)&&(elem.defaultChecked=elem.checked)}function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(11!==content.nodeType?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){return elem.type=(null!==jQuery.find.attr(elem,"type"))+"/"+elem.type,elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);return match?elem.type=match[1]:elem.removeAttribute("type"),elem}function setGlobalEval(elems,refElements){for(var elem,i=0;null!=(elem=elems[i]);i++)jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"))}function cloneCopyEvent(src,dest){if(1===dest.nodeType&&jQuery.hasData(src)){var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle,curData.events={};for(type in events)for(i=0,l=events[type].length;l>i;i++)jQuery.event.add(dest,type,events[type][i])}curData.data&&(curData.data=jQuery.extend({},curData.data))}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(1===dest.nodeType){if(nodeName=dest.nodeName.toLowerCase(),!support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events)jQuery.removeEvent(dest,e,data.handle);dest.removeAttribute(jQuery.expando)}"script"===nodeName&&dest.text!==src.text?(disableScript(dest).text=src.text,restoreScript(dest)):"object"===nodeName?(dest.parentNode&&(dest.outerHTML=src.outerHTML),support.html5Clone&&src.innerHTML&&!jQuery.trim(dest.innerHTML)&&(dest.innerHTML=src.innerHTML)):"input"===nodeName&&rcheckableType.test(src.type)?(dest.defaultChecked=dest.checked=src.checked,dest.value!==src.value&&(dest.value=src.value)):"option"===nodeName?dest.defaultSelected=dest.selected=src.defaultSelected:("input"===nodeName||"textarea"===nodeName)&&(dest.defaultValue=src.defaultValue)}}function actualDisplay(name,doc){var style,elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle&&(style=window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0],"display");return elem.detach(),display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];return display||(display=actualDisplay(nodeName,doc),"none"!==display&&display||(iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement),doc=(iframe[0].contentWindow||iframe[0].contentDocument).document,doc.write(),doc.close(),display=actualDisplay(nodeName,doc),iframe.detach()),elemdisplay[nodeName]=display),display}function addGetHookIf(conditionFn,hookFn){return{get:function(){var condition=conditionFn();if(null!=condition)return condition?void delete this.get:(this.get=hookFn).apply(this,arguments)}}}function vendorPropName(style,name){if(name in style)return name;for(var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;i--;)if(name=cssPrefixes[i]+capName,name in style)return name;return origName}function showHide(elements,show){for(var display,elem,hidden,values=[],index=0,length=elements.length;length>index;index++)elem=elements[index],elem.style&&(values[index]=jQuery._data(elem,"olddisplay"),display=elem.style.display,show?(values[index]||"none"!==display||(elem.style.display=""),""===elem.style.display&&isHidden(elem)&&(values[index]=jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName)))):(hidden=isHidden(elem),(display&&"none"!==display||!hidden)&&jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))));for(index=0;length>index;index++)elem=elements[index],elem.style&&(show&&"none"!==elem.style.display&&""!==elem.style.display||(elem.style.display=show?values[index]||"":"none"));return elements}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){for(var i=extra===(isBorderBox?"border":"content")?4:"width"===name?1:0,val=0;4>i;i+=2)"margin"===extra&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles)),isBorderBox?("content"===extra&&(val-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==extra&&(val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(val+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==extra&&(val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles)));return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=!0,val="width"===name?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles);if(0>=val||null==val){if(val=curCSS(elem,name,styles),(0>val||null==val)&&(val=elem.style[name]),rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]),val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}function createFxNow(){return setTimeout(function(){fxNow=void 0}),fxNow=jQuery.now()}function genFx(type,includeWidth){var which,attrs={height:type},i=0;for(includeWidth=includeWidth?1:0;4>i;i+=2-includeWidth)which=cssExpand[i],attrs["margin"+which]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;length>index;index++)if(tween=collection[index].call(animation,prop,value))return tween}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");opts.queue||(hooks=jQuery._queueHooks(elem,"fx"),null==hooks.unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),1===elem.nodeType&&("height"in props||"width"in props)&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],display=jQuery.css(elem,"display"),checkDisplay="none"===display?jQuery._data(elem,"olddisplay")||defaultDisplay(elem.nodeName):display,"inline"===checkDisplay&&"none"===jQuery.css(elem,"float")&&(support.inlineBlockNeedsLayout&&"inline"!==defaultDisplay(elem.nodeName)?style.zoom=1:style.display="inline-block")),opts.overflow&&(style.overflow="hidden",support.shrinkWrapBlocks()||anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}));for(prop in props)if(value=props[prop],rfxtypes.exec(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else display=void 0;if(jQuery.isEmptyObject(orig))"inline"===("none"===display?defaultDisplay(elem.nodeName):display)&&(style.display=display);else{dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=jQuery._data(elem,"fxshow",{}),toggle&&(dataShow.hidden=!hidden),hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()}),anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig)jQuery.style(elem,prop,orig[prop])});for(prop in orig)tween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=tween.start,hidden&&(tween.end=tween.start,tween.start="width"===prop||"height"===prop?1:0))}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(name=jQuery.camelCase(index),easing=specialEasing[name],value=props[index],jQuery.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),hooks=jQuery.cssHooks[name],hooks&&"expand"in hooks){value=hooks.expand(value),delete props[name];for(index in value)index in props||(props[index]=value[index],specialEasing[index]=easing)}else specialEasing[name]=easing}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;length>index;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),1>percent&&length?remaining:(deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;length>index;index++)animation.tweens[index].run(1);return gotoEnd?deferred.resolveWith(elem,[animation,gotoEnd]):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(propFilter(props,animation.opts.specialEasing);length>index;index++)if(result=animationPrefilters[index].call(animation,elem,props,animation.opts))return result;return jQuery.map(props,createTween,animation),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType.charAt(0)?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}var inspected={},seekingTransport=structure===transports;return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}function ajaxHandleResponses(s,jqXHR,responses){for(var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}return finalDataType?(finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]):void 0}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(conv=converters[prev+" "+current]||converters["* "+current],!conv)for(conv2 in converters)if(tmp=conv2.split(" "),tmp[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){conv===!0?conv=converters[conv2]:converters[conv2]!==!0&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(conv!==!0)if(conv&&s["throws"])response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==jQuery.type(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function getWindow(elem){return jQuery.isWindow(elem)?elem:9===elem.nodeType?elem.defaultView||elem.parentWindow:!1}var deletedIds=[],slice=deletedIds.slice,concat=deletedIds.concat,push=deletedIds.push,indexOf=deletedIds.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,support={},version="1.11.1",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return null!=num?0>num?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret.context=this.context,ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(0>i?len:0);return this.pushStack(j>=0&&len>j?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:deletedIds.sort,splice:deletedIds.splice},jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[i]||{},i++),"object"==typeof target||jQuery.isFunction(target)||(target={}),i===length&&(target=this,i--);length>i;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray||function(obj){return"array"===jQuery.type(obj)},isWindow:function(obj){return null!=obj&&obj==obj.window},isNumeric:function(obj){return!jQuery.isArray(obj)&&obj-parseFloat(obj)>=0},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},isPlainObject:function(obj){var key;if(!obj||"object"!==jQuery.type(obj)||obj.nodeType||jQuery.isWindow(obj))return!1;try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(support.ownLast)for(key in obj)return hasOwn.call(obj,key);for(key in obj);return void 0===key||hasOwn.call(obj,key)},type:function(obj){return null==obj?obj+"":"object"==typeof obj||"function"==typeof obj?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(data){data&&jQuery.trim(data)&&(window.execScript||function(data){window.eval.call(window,data)})(data)},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray)for(;length>i&&(value=callback.apply(obj[i],args),value!==!1);i++);else for(i in obj)if(value=callback.apply(obj[i],args),value===!1)break}else if(isArray)for(;length>i&&(value=callback.call(obj[i],i,obj[i]),value!==!1);i++);else for(i in obj)if(value=callback.call(obj[i],i,obj[i]),value===!1)break;return obj},trim:function(text){return null==text?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArraylike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){var len;if(arr){if(indexOf)return indexOf.call(arr,elem,i);for(len=arr.length,i=i?0>i?Math.max(0,len+i):i:0;len>i;i++)if(i in arr&&arr[i]===elem)return i}return-1},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;len>j;)first[i++]=second[j++];if(len!==len)for(;void 0!==second[j];)first[i++]=second[j++];return first.length=i,first},grep:function(elems,callback,invert){for(var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;length>i;i++)callbackInverse=!callback(elems[i],i),callbackInverse!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray)for(;length>i;i++)value=callback(elems[i],i,arg),null!=value&&ret.push(value);else for(i in elems)value=callback(elems[i],i,arg),null!=value&&ret.push(value);return concat.apply([],ret)},guid:1,proxy:function(fn,context){var args,proxy,tmp;return"string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn)?(args=slice.call(arguments,2),proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))},proxy.guid=fn.guid=fn.guid||jQuery.guid++,proxy):void 0},now:function(){return+new Date},support:support}),jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});var Sizzle=/*!
 * Sizzle CSS Selector Engine v1.10.19
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-04-18
 */
function(window){function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=context.nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){if(elem=context.getElementById(m),!elem||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}var keys=[];return cache}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=attrs.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";len>i;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if(outerCache=elem[expando]||(elem[expando]={}),(oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(outerCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;len>i;i++)Sizzle(selector,contexts[i],results);return results}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;len>i;i++)(elem=unmatched[i])&&(!filter||filter(elem,context,xml))&&(newUnmatched.push(elem),mapped&&map.push(i));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];len>i;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if(matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches),matcher[expando]){for(j=++i;len>j&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,j>i&&matcherFromTokens(tokens.slice(i,j)),len>j&&matcherFromTokens(tokens=tokens.slice(j)),len>j&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},strundefined="undefined",MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;len>i;i++)if(this[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:0>high?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?"HTML"!==documentElement.nodeName:!1},setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document&&9===doc.nodeType&&doc.documentElement?(document=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent!==parent.top&&(parent.addEventListener?parent.addEventListener("unload",function(){setDocument()},!1):parent.attachEvent&&parent.attachEvent("onunload",function(){setDocument()})),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(doc.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(doc.getElementsByClassName)&&assert(function(div){return div.innerHTML="<div class='a'></div><div class='a i'></div>",div.firstChild.className="i",2===div.getElementsByClassName("i").length}),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!doc.getElementsByName||!doc.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return typeof context.getElementsByTagName!==strundefined?context.getElementsByTagName(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){return typeof context.getElementsByClassName!==strundefined&&documentIsHTML?context.getElementsByClassName(className):void 0},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(doc.querySelectorAll))&&(assert(function(div){div.innerHTML="<select msallowclip=''><option selected=''></option></select>",div.querySelectorAll("[msallowclip^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked")}),assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("name","D"),div.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare?compare:(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&compare||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),!(!support.matchesSelector||!documentIsHTML||rbuggyMatches&&rbuggyMatches.test(expr)||rbuggyQSA&&rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:operator?(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator?result===check||result.slice(0,check.length+1)===check+"-":!1):!0}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(outerCache=parent[expando]||(parent[expando]={}),cache=outerCache[type]||[],nodeIndex=cache[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return diff-=last,diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)idx=indexOf.call(seed,matched[i]),seed[idx]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return elemLang=elemLang.toLowerCase(),elemLang===lang||0===elemLang.indexOf(lang+"-");while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[0>argument?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}},Expr.pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){(!matched||(match=rcomma.exec(soFar)))&&(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length));for(type in Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)cached=matcherFromTokens(match[i]),cached[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers)),cached.selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(tokens=match[0]=match[0].slice(0),tokens.length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0],!context)return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),selector=seed.length&&toSelector(tokens),!selector)return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){return isXML?void 0:elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){return isXML||"input"!==elem.nodeName.toLowerCase()?void 0:elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;return isXML?void 0:elem[name]===!0?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,risSimple=/^.[^:#\[\.,]*$/;jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;len>i;i++)if(jQuery.contains(self[i],this))return!0}));for(i=0;len>i;i++)jQuery.find(selector,self[i],ret);return ret=this.pushStack(len>1?jQuery.unique(ret):ret),ret.selector=this.selector?this.selector+" "+selector:selector,ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,document=window.document,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector)return this;if("string"==typeof selector){if(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector),!match||!match[1]&&context)return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}if(elem=document.getElementById(match[2]),elem&&elem.parentNode){if(elem.id!==match[2])return rootjQuery.find(selector);this.length=1,this[0]=elem}return this.context=document,this.selector=selector,this}return selector.nodeType?(this.context=this[0]=selector,this.length=1,this):jQuery.isFunction(selector)?"undefined"!=typeof rootjQuery.ready?rootjQuery.ready(selector):selector(jQuery):(void 0!==selector.selector&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))};init.prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.extend({dir:function(elem,dir,until){for(var matched=[],cur=elem[dir];cur&&9!==cur.nodeType&&(void 0===until||1!==cur.nodeType||!jQuery(cur).is(until));)1===cur.nodeType&&matched.push(cur),cur=cur[dir];return matched},sibling:function(n,elem){for(var r=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&r.push(n);return r}}),jQuery.fn.extend({has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;len>i;i++)if(jQuery.contains(this,targets[i]))return!0})},closest:function(selectors,context){for(var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||"string"!=typeof selectors?jQuery(selectors,context||this.context):0;l>i;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(pos?pos.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);
break}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){return elem?"string"==typeof elem?jQuery.inArray(this[0],jQuery(elem)):jQuery.inArray(elem.jquery?elem[0]:elem,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(ret=jQuery.filter(selector,ret)),this.length>1&&(guaranteedUnique[name]||(ret=jQuery.unique(ret)),rparentsprev.test(name)&&(ret=ret.reverse())),this.pushStack(ret)}});var rnotwhite=/\S+/g,optionsCache={};jQuery.Callbacks=function(options){options="string"==typeof options?optionsCache[options]||createOptions(options):jQuery.extend({},options);var firing,memory,fired,firingLength,firingIndex,firingStart,list=[],stack=!options.once&&[],fire=function(data){for(memory=options.memory&&data,fired=!0,firingIndex=firingStart||0,firingStart=0,firingLength=list.length,firing=!0;list&&firingLength>firingIndex;firingIndex++)if(list[firingIndex].apply(data[0],data[1])===!1&&options.stopOnFalse){memory=!1;break}firing=!1,list&&(stack?stack.length&&fire(stack.shift()):memory?list=[]:self.disable())},self={add:function(){if(list){var start=list.length;!function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);"function"===type?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==type&&add(arg)})}(arguments),firing?firingLength=list.length:memory&&(firingStart=start,fire(memory))}return this},remove:function(){return list&&jQuery.each(arguments,function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),firing&&(firingLength>=index&&firingLength--,firingIndex>=index&&firingIndex--)}),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!(!list||!list.length)},empty:function(){return list=[],firingLength=0,this},disable:function(){return list=stack=memory=void 0,this},disabled:function(){return!list},lock:function(){return stack=void 0,memory||self.disable(),this},locked:function(){return!stack},fireWith:function(context,args){return!list||fired&&!stack||(args=args||[],args=[context,args.slice?args.slice():args],firing?stack.push(args):fire(args)),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify):newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)})}),fns=null}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return promise.pipe=promise.then,jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[1^i][2].disable,tuples[2][2].lock),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?promise:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(subordinate){var progressValues,progressContexts,resolveContexts,i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=1!==length||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=1===remaining?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this,values[i]=arguments.length>1?slice.call(arguments):value,values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}};if(length>1)for(progressValues=new Array(length),progressContexts=new Array(length),resolveContexts=new Array(length);length>i;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues)):--remaining;return remaining||deferred.resolveWith(resolveContexts,resolveValues),deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){return jQuery.ready.promise().done(fn),this},jQuery.extend({isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){if(wait===!0?!--jQuery.readyWait:!jQuery.isReady){if(!document.body)return setTimeout(jQuery.ready);jQuery.isReady=!0,wait!==!0&&--jQuery.readyWait>0||(readyList.resolveWith(document,[jQuery]),jQuery.fn.triggerHandler&&(jQuery(document).triggerHandler("ready"),jQuery(document).off("ready")))}}}),jQuery.ready.promise=function(obj){if(!readyList)if(readyList=jQuery.Deferred(),"complete"===document.readyState)setTimeout(jQuery.ready);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1);else{document.attachEvent("onreadystatechange",completed),window.attachEvent("onload",completed);var top=!1;try{top=null==window.frameElement&&document.documentElement}catch(e){}top&&top.doScroll&&!function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}detach(),jQuery.ready()}}()}return readyList.promise(obj)};var i,strundefined="undefined";for(i in jQuery(support))break;support.ownLast="0"!==i,support.inlineBlockNeedsLayout=!1,jQuery(function(){var val,div,body,container;body=document.getElementsByTagName("body")[0],body&&body.style&&(div=document.createElement("div"),container=document.createElement("div"),container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",body.appendChild(container).appendChild(div),typeof div.style.zoom!==strundefined&&(div.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",support.inlineBlockNeedsLayout=val=3===div.offsetWidth,val&&(body.style.zoom=1)),body.removeChild(container))}),function(){var div=document.createElement("div");if(null==support.deleteExpando){support.deleteExpando=!0;try{delete div.test}catch(e){support.deleteExpando=!1}}div=null}(),jQuery.acceptData=function(elem){var noData=jQuery.noData[(elem.nodeName+" ").toLowerCase()],nodeType=+elem.nodeType||1;return 1!==nodeType&&9!==nodeType?!1:!noData||noData!==!0&&elem.getAttribute("classid")===noData};var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){return elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando],!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data){return internalData(elem,name,data)},removeData:function(elem,name){return internalRemoveData(elem,name)},_data:function(elem,name,data){return internalData(elem,name,data,!0)},_removeData:function(elem,name){return internalRemoveData(elem,name,!0)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0===key){if(this.length&&(data=jQuery.data(elem),1===elem.nodeType&&!jQuery._data(elem,"parsedAttrs"))){for(i=attrs.length;i--;)attrs[i]&&(name=attrs[i].name,0===name.indexOf("data-")&&(name=jQuery.camelCase(name.slice(5)),dataAttr(elem,name,data[name])));jQuery._data(elem,"parsedAttrs",!0)}return data}return"object"==typeof key?this.each(function(){jQuery.data(this,key)}):arguments.length>1?this.each(function(){jQuery.data(this,key,value)}):elem?dataAttr(elem,key,jQuery.data(elem,key)):void 0},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;return elem?(type=(type||"fx")+"queue",queue=jQuery._data(elem,type),data&&(!queue||jQuery.isArray(data)?queue=jQuery._data(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]):void 0},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,next,hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue"),jQuery._removeData(elem,key)})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=void 0),type=type||"fx";i--;)tmp=jQuery._data(elements[i],type+"queueHooks"),tmp&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,cssExpand=["Top","Right","Bottom","Left"],isHidden=function(elem,el){return elem=el||elem,"none"===jQuery.css(elem,"display")||!jQuery.contains(elem.ownerDocument,elem)},access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=null==key;if("object"===jQuery.type(key)){chainable=!0;for(i in key)jQuery.access(elems,fn,i,key[i],!0,emptyGet,raw)}else if(void 0!==value&&(chainable=!0,jQuery.isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,key,value){return bulk.call(jQuery(elem),value)})),fn))for(;length>i;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},rcheckableType=/^(?:checkbox|radio)$/i;!function(){var input=document.createElement("input"),div=document.createElement("div"),fragment=document.createDocumentFragment();if(div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",support.leadingWhitespace=3===div.firstChild.nodeType,support.tbody=!div.getElementsByTagName("tbody").length,support.htmlSerialize=!!div.getElementsByTagName("link").length,support.html5Clone="<:nav></:nav>"!==document.createElement("nav").cloneNode(!0).outerHTML,input.type="checkbox",input.checked=!0,fragment.appendChild(input),support.appendChecked=input.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue,fragment.appendChild(div),div.innerHTML="<input type='radio' checked='checked' name='t'/>",support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,support.noCloneEvent=!0,div.attachEvent&&(div.attachEvent("onclick",function(){support.noCloneEvent=!1}),div.cloneNode(!0).click()),null==support.deleteExpando){support.deleteExpando=!0;try{delete div.test}catch(e){support.deleteExpando=!1}}}(),function(){var i,eventName,div=document.createElement("div");for(i in{submit:!0,change:!0,focusin:!0})eventName="on"+i,(support[i+"Bubbles"]=eventName in window)||(div.setAttribute(eventName,"t"),support[i+"Bubbles"]=div.attributes[eventName].expando===!1);div=null}();var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);if(elemData){for(handler.handler&&(handleObjIn=handler,handler=handleObjIn.handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return typeof jQuery===strundefined||e&&jQuery.event.triggered===e.type?void 0:jQuery.event.dispatch.apply(eventHandle.elem,arguments)},eventHandle.elem=elem),types=(types||"").match(rnotwhite)||[""],t=types.length;t--;)tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||(handlers=events[type]=[],handlers.delegateCount=0,special.setup&&special.setup.call(elem,data,namespaces,eventHandle)!==!1||(elem.addEventListener?elem.addEventListener(type,eventHandle,!1):elem.attachEvent&&elem.attachEvent("on"+type,eventHandle))),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0);elem=null}},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(elemData&&(events=elemData.events)){for(types=(types||"").match(rnotwhite)||[""],t=types.length;t--;)if(tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,handlers=events[type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&special.teardown.call(elem,namespaces,elemData.handle)!==!1||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&(delete elemData.handle,jQuery._removeData(elem,"events"))}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(".")>=0&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event),event.isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||special.trigger.apply(elem,data)!==!1)){if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)event.type=i>1?bubbleType:special.bindType||type,handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle"),handle&&handle.apply(cur,data),handle=ontype&&cur[ontype],handle&&handle.apply&&jQuery.acceptData(cur)&&(event.result=handle.apply(cur,data),event.result===!1&&event.preventDefault());if(event.type=type,!onlyHandlers&&!event.isDefaultPrevented()&&(!special._default||special._default.apply(eventPath.pop(),data)===!1)&&jQuery.acceptData(elem)&&ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype],tmp&&(elem[ontype]=null),jQuery.event.triggered=type;try{elem[type]()}catch(e){}jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)}return event.result}},dispatch:function(event){event=jQuery.event.fix(event);var i,ret,handleObj,matched,j,handlerQueue=[],args=slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};if(args[0]=event,event.delegateTarget=this,!special.preDispatch||special.preDispatch.call(this,event)!==!1){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)(!event.namespace_re||event.namespace_re.test(handleObj.namespace))&&(event.handleObj=handleObj,event.data=handleObj.data,ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args),void 0!==ret&&(event.result=ret)===!1&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var sel,handleObj,matches,i,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||"click"!==event.type))for(;cur!=this;cur=cur.parentNode||this)if(1===cur.nodeType&&(cur.disabled!==!0||"click"!==event.type)){for(matches=[],i=0;delegateCount>i;i++)handleObj=handlers[i],sel=handleObj.selector+" ",void 0===matches[sel]&&(matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length),matches[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,handlers:matches})}return delegateCount<handlers.length&&handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)}),handlerQueue},fix:function(event){if(event[jQuery.expando])return event;var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];for(fixHook||(this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}),copy=fixHook.props?this.props.concat(fixHook.props):this.props,event=new jQuery.Event(originalEvent),i=copy.length;i--;)prop=copy[i],event[prop]=originalEvent[prop];return event.target||(event.target=originalEvent.srcElement||document),3===event.target.nodeType&&(event.target=event.target.parentNode),event.metaKey=!!event.metaKey,fixHook.filter?fixHook.filter(event,originalEvent):event},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return null==event.which&&(event.which=null!=original.charCode?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;return null==event.pageX&&null!=original.clientX&&(eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),!event.relatedTarget&&fromElement&&(event.relatedTarget=fromElement===event.target?original.toElement:fromElement),event.which||void 0===button||(event.which=1&button?1:2&button?3:4&button?2:0),event}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===safeActiveElement()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return jQuery.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0,originalEvent:{}});bubble?jQuery.event.trigger(e,null,elem):jQuery.event.dispatch.call(elem,e),e.isDefaultPrevented()&&event.preventDefault()}},jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)}:function(elem,type,handle){var name="on"+type;elem.detachEvent&&(typeof elem[name]===strundefined&&(elem[name]=null),elem.detachEvent(name,handle))},jQuery.Event=function(src,props){return this instanceof jQuery.Event?(src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&src.returnValue===!1?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),void(this[jQuery.expando]=!0)):new jQuery.Event(src,props)},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;return(!related||related!==target&&!jQuery.contains(target,related))&&(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),support.submitBubbles||(jQuery.event.special.submit={setup:function(){return jQuery.nodeName(this,"form")?!1:void jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:void 0;form&&!jQuery._data(form,"submitBubbles")&&(jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=!0}),jQuery._data(form,"submitBubbles",!0))})},postDispatch:function(event){event._submit_bubble&&(delete event._submit_bubble,this.parentNode&&!event.isTrigger&&jQuery.event.simulate("submit",this.parentNode,event,!0))},teardown:function(){return jQuery.nodeName(this,"form")?!1:void jQuery.event.remove(this,"._submit")}}),support.changeBubbles||(jQuery.event.special.change={setup:function(){return rformElems.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(jQuery.event.add(this,"propertychange._change",function(event){"checked"===event.originalEvent.propertyName&&(this._just_changed=!0)}),jQuery.event.add(this,"click._change",function(event){this._just_changed&&!event.isTrigger&&(this._just_changed=!1),jQuery.event.simulate("change",this,event,!0)})),!1):void jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;rformElems.test(elem.nodeName)&&!jQuery._data(elem,"changeBubbles")&&(jQuery.event.add(elem,"change._change",function(event){!this.parentNode||event.isSimulated||event.isTrigger||jQuery.event.simulate("change",this.parentNode,event,!0)}),jQuery._data(elem,"changeBubbles",!0))})},handle:function(event){var elem=event.target;return this!==elem||event.isSimulated||event.isTrigger||"radio"!==elem.type&&"checkbox"!==elem.type?event.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return jQuery.event.remove(this,"._change"),!rformElems.test(this.nodeName)}}),support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),!0)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix);attaches||doc.addEventListener(orig,handler,!0),jQuery._data(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix)-1;attaches?jQuery._data(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),jQuery._removeData(doc,fix))}}}),jQuery.fn.extend({on:function(types,selector,data,fn,one){var type,origFn;if("object"==typeof types){"string"!=typeof selector&&(data=data||selector,selector=void 0);for(type in types)this.on(type,selector,data,types[type],one);return this}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&("string"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),fn===!1)fn=returnFalse;else if(!fn)return this;return 1===one&&(origFn=fn,fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)},fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}return(selector===!1||"function"==typeof selector)&&(fn=selector,selector=void 0),fn===!1&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];return elem?jQuery.event.trigger(type,data,elem,!0):void 0}});var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")?clone=elem.cloneNode(!0):(fragmentDiv.innerHTML=elem.outerHTML,fragmentDiv.removeChild(clone=fragmentDiv.firstChild)),!(support.noCloneEvent&&support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),srcElements=getAll(elem),i=0;null!=(node=srcElements[i]);++i)destElements[i]&&fixCloneNodeIssues(node,destElements[i]);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0;null!=(node=srcElements[i]);i++)cloneCopyEvent(node,destElements[i]);else cloneCopyEvent(elem,clone);return destElements=getAll(clone,"script"),destElements.length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),destElements=srcElements=node=null,clone},buildFragment:function(elems,context,scripts,selection){for(var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;l>i;i++)if(elem=elems[i],elem||0===elem)if("object"===jQuery.type(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||safe.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;if(!support.leadingWhitespace&&rleadingWhitespace.test(elem)&&nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0])),!support.tbody)for(elem="table"!==tag||rtbody.test(elem)?"<table>"!==wrap[1]||rtbody.test(elem)?0:tmp:tmp.firstChild,j=elem&&elem.childNodes.length;j--;)jQuery.nodeName(tbody=elem.childNodes[j],"tbody")&&!tbody.childNodes.length&&elem.removeChild(tbody);for(jQuery.merge(nodes,tmp.childNodes),tmp.textContent="";tmp.firstChild;)tmp.removeChild(tmp.firstChild);tmp=safe.lastChild}else nodes.push(context.createTextNode(elem));for(tmp&&safe.removeChild(tmp),support.appendChecked||jQuery.grep(getAll(nodes,"input"),fixDefaultChecked),i=0;elem=nodes[i++];)if((!selection||-1===jQuery.inArray(elem,selection))&&(contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(safe.appendChild(elem),"script"),contains&&setGlobalEval(tmp),scripts))for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return tmp=null,safe},cleanData:function(elems,acceptData){for(var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=support.deleteExpando,special=jQuery.event.special;null!=(elem=elems[i]);i++)if((acceptData||jQuery.acceptData(elem))&&(id=elem[internalKey],data=id&&cache[id])){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);
cache[id]&&(delete cache[id],deleteExpando?delete elem[internalKey]:typeof elem.removeAttribute!==strundefined?elem.removeAttribute(internalKey):elem[internalKey]=null,deletedIds.push(id))}}}),jQuery.fn.extend({text:function(value){return access(this,function(value){return void 0===value?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},remove:function(selector,keepData){for(var elem,elems=selector?jQuery.filter(selector,this):this,i=0;null!=(elem=elems[i]);i++)keepData||1!==elem.nodeType||jQuery.cleanData(getAll(elem)),elem.parentNode&&(keepData&&jQuery.contains(elem.ownerDocument,elem)&&setGlobalEval(getAll(elem,"script")),elem.parentNode.removeChild(elem));return this},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++){for(1===elem.nodeType&&jQuery.cleanData(getAll(elem,!1));elem.firstChild;)elem.removeChild(elem.firstChild);elem.options&&jQuery.nodeName(elem,"select")&&(elem.options.length=0)}return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null==dataAndEvents?!1:dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value)return 1===elem.nodeType?elem.innerHTML.replace(rinlinejQuery,""):void 0;if(!("string"!=typeof value||rnoInnerhtml.test(value)||!support.htmlSerialize&&rnoshimcache.test(value)||!support.leadingWhitespace&&rleadingWhitespace.test(value)||wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()])){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;l>i;i++)elem=this[i]||{},1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];return this.domManip(arguments,function(elem){arg=this.parentNode,jQuery.cleanData(getAll(this)),arg&&arg.replaceChild(elem,this)}),arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,callback){args=concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&"string"==typeof value&&!support.checkClone&&rchecked.test(value))return this.each(function(index){var self=set.eq(index);isFunction&&(args[0]=value.call(this,index,self.html())),self.domManip(args,callback)});if(l&&(fragment=jQuery.buildFragment(args,this[0].ownerDocument,!1,this),first=fragment.firstChild,1===fragment.childNodes.length&&(fragment=first),first)){for(scripts=jQuery.map(getAll(fragment,"script"),disableScript),hasScripts=scripts.length;l>i;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(this[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;hasScripts>i;i++)node=scripts[i],rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl&&jQuery._evalUrl(node.src):jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,"")));fragment=first=null}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;last>=i;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}});var iframe,elemdisplay={};!function(){var shrinkWrapBlocksVal;support.shrinkWrapBlocks=function(){if(null!=shrinkWrapBlocksVal)return shrinkWrapBlocksVal;shrinkWrapBlocksVal=!1;var div,body,container;return body=document.getElementsByTagName("body")[0],body&&body.style?(div=document.createElement("div"),container=document.createElement("div"),container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",body.appendChild(container).appendChild(div),typeof div.style.zoom!==strundefined&&(div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",div.appendChild(document.createElement("div")).style.width="5px",shrinkWrapBlocksVal=3!==div.offsetWidth),body.removeChild(container),shrinkWrapBlocksVal):void 0}}();var getStyles,curCSS,rmargin=/^margin/,rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),rposition=/^(top|right|bottom|left)$/;window.getComputedStyle?(getStyles=function(elem){return elem.ownerDocument.defaultView.getComputedStyle(elem,null)},curCSS=function(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return computed=computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:void 0,computed&&(""!==ret||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name)),rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),void 0===ret?ret:ret+""}):document.documentElement.currentStyle&&(getStyles=function(elem){return elem.currentStyle},curCSS=function(elem,name,computed){var left,rs,rsLeft,ret,style=elem.style;return computed=computed||getStyles(elem),ret=computed?computed[name]:void 0,null==ret&&style&&style[name]&&(ret=style[name]),rnumnonpx.test(ret)&&!rposition.test(name)&&(left=style.left,rs=elem.runtimeStyle,rsLeft=rs&&rs.left,rsLeft&&(rs.left=elem.currentStyle.left),style.left="fontSize"===name?"1em":ret,ret=style.pixelLeft+"px",style.left=left,rsLeft&&(rs.left=rsLeft)),void 0===ret?ret:ret+""||"auto"}),function(){function computeStyleTests(){var div,body,container,contents;body=document.getElementsByTagName("body")[0],body&&body.style&&(div=document.createElement("div"),container=document.createElement("div"),container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",body.appendChild(container).appendChild(div),div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",pixelPositionVal=boxSizingReliableVal=!1,reliableMarginRightVal=!0,window.getComputedStyle&&(pixelPositionVal="1%"!==(window.getComputedStyle(div,null)||{}).top,boxSizingReliableVal="4px"===(window.getComputedStyle(div,null)||{width:"4px"}).width,contents=div.appendChild(document.createElement("div")),contents.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",contents.style.marginRight=contents.style.width="0",div.style.width="1px",reliableMarginRightVal=!parseFloat((window.getComputedStyle(contents,null)||{}).marginRight)),div.innerHTML="<table><tr><td></td><td>t</td></tr></table>",contents=div.getElementsByTagName("td"),contents[0].style.cssText="margin:0;border:0;padding:0;display:none",reliableHiddenOffsetsVal=0===contents[0].offsetHeight,reliableHiddenOffsetsVal&&(contents[0].style.display="",contents[1].style.display="none",reliableHiddenOffsetsVal=0===contents[0].offsetHeight),body.removeChild(container))}var div,style,a,pixelPositionVal,boxSizingReliableVal,reliableHiddenOffsetsVal,reliableMarginRightVal;div=document.createElement("div"),div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=div.getElementsByTagName("a")[0],style=a&&a.style,style&&(style.cssText="float:left;opacity:.5",support.opacity="0.5"===style.opacity,support.cssFloat=!!style.cssFloat,div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,support.boxSizing=""===style.boxSizing||""===style.MozBoxSizing||""===style.WebkitBoxSizing,jQuery.extend(support,{reliableHiddenOffsets:function(){return null==reliableHiddenOffsetsVal&&computeStyleTests(),reliableHiddenOffsetsVal},boxSizingReliable:function(){return null==boxSizingReliableVal&&computeStyleTests(),boxSizingReliableVal},pixelPosition:function(){return null==pixelPositionVal&&computeStyleTests(),pixelPositionVal},reliableMarginRight:function(){return null==reliableMarginRightVal&&computeStyleTests(),reliableMarginRightVal}}))}(),jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];ret=callback.apply(elem,args||[]);for(name in options)elem.style[name]=old[name];return ret};var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;if(name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value)return hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name];if(type=typeof value,"string"===type&&(ret=rrelNum.exec(value))&&(value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name)),type="number"),null!=value&&value===value&&("number"!==type||jQuery.cssNumber[origName]||(value+="px"),support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),!(hooks&&"set"in hooks&&void 0===(value=hooks.set(elem,value,extra)))))try{style[name]=value}catch(e){}}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],hooks&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),extra===!0||jQuery.isNumeric(num)?num||0:val):val}}),jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){return computed?rdisplayswap.test(jQuery.css(elem,"display"))&&0===elem.offsetWidth?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra):void 0},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),styles):0)}}}),support.opacity||(jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+100*value+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1,(value>=1||""===value)&&""===jQuery.trim(filter.replace(ralpha,""))&&style.removeAttribute&&(style.removeAttribute("filter"),""===value||currentStyle&&!currentStyle.filter)||(style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity)}}),jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){return computed?jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"]):void 0}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];4>i;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)}),jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){for(styles=getStyles(elem),len=name.length;len>i;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||"swing",this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.pos=eased=this.options.duration?jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return null==tween.elem[tween.prop]||tween.elem.style&&null!=tween.elem.style[tween.prop]?(result=jQuery.css(tween.elem,tween.prop,""),result&&"auto"!==result?result:0):tween.elem[tween.prop]},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):tween.elem.style&&(null!=tween.elem.style[jQuery.cssProps[tween.prop]]||jQuery.cssHooks[tween.prop])?jQuery.style(tween.elem,tween.prop,tween.now+tween.unit):tween.elem[tween.prop]=tween.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||"px"!==unit&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3],parts=parts||[],start=+target||1;do scale=scale||".5",start/=scale,jQuery.style(tween.elem,prop,start+unit);while(scale!==(scale=tween.cur()/target)&&1!==scale&&--maxIterations)}return parts&&(start=tween.start=+start||+target||0,tween.unit=unit,tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]),tween}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=["*"]):props=props.split(" ");for(var prop,index=0,length=props.length;length>index;index++)prop=props[index],tweeners[prop]=tweeners[prop]||[],tweeners[prop].unshift(callback)},prefilter:function(callback,prepend){prepend?animationPrefilters.unshift(callback):animationPrefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};return opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default,(null==opt.queue||opt.queue===!0)&&(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||jQuery._data(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&type!==!1&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));(dequeue||!gotoEnd)&&jQuery.dequeue(this,type)})},finish:function(type){return type!==!1&&(type=type||"fx"),this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;length>index;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.timers=[],jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;for(fxNow=jQuery.now();i<timers.length;i++)timer=timers[i],timer()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),timer()?jQuery.fx.start():jQuery.timers.pop()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx?jQuery.fx.speeds[time]||time:time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},function(){var input,div,select,a,opt;div=document.createElement("div"),div.setAttribute("className","t"),div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=div.getElementsByTagName("a")[0],select=document.createElement("select"),opt=select.appendChild(document.createElement("option")),input=div.getElementsByTagName("input")[0],a.style.cssText="top:1px",support.getSetAttribute="t"!==div.className,support.style=/top/.test(a.getAttribute("style")),support.hrefNormalized="/a"===a.getAttribute("href"),support.checkOn=!!input.value,support.optSelected=opt.selected,support.enctype=!!document.createElement("form").enctype,select.disabled=!0,support.optDisabled=!opt.disabled,input=document.createElement("input"),input.setAttribute("value",""),support.input=""===input.getAttribute("value"),input.value="t",input.setAttribute("type","radio"),support.radioValue="t"===input.value}();var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];{if(arguments.length)return isFunction=jQuery.isFunction(value),this.each(function(i){var val;1===this.nodeType&&(val=isFunction?value.call(this,i,jQuery(this).val()):value,null==val?val="":"number"==typeof val?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()],hooks&&"set"in hooks&&void 0!==hooks.set(this,val,"value")||(this.value=val))});if(elem)return hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()],hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,"value"))?ret:(ret=elem.value,"string"==typeof ret?ret.replace(rreturn,""):null==ret?"":ret)}}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:jQuery.trim(jQuery.text(elem))}},select:{get:function(elem){for(var value,option,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type||0>index,values=one?null:[],max=one?index+1:options.length,i=0>index?max:one?index:0;max>i;i++)if(option=options[i],!(!option.selected&&i!==index||(support.optDisabled?option.disabled:null!==option.getAttribute("disabled"))||option.parentNode.disabled&&jQuery.nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)if(option=options[i],jQuery.inArray(jQuery.valHooks.option.get(option),values)>=0)try{option.selected=optionSet=!0}catch(_){option.scrollHeight}else option.selected=!1;return optionSet||(elem.selectedIndex=-1),options}}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){return jQuery.isArray(value)?elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0:void 0}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})});var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=support.getSetAttribute,getSetInput=support.input;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}}),jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType)return typeof elem.getAttribute===strundefined?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)),void 0===value?hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:(ret=jQuery.find.attr(elem,name),null==ret?void 0:ret):null!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+""),value):void jQuery.removeAttr(elem,name))},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)propName=jQuery.propFix[name]||name,jQuery.expr.match.bool.test(name)?getSetInput&&getSetAttribute||!ruseDefault.test(name)?elem[propName]=!1:elem[jQuery.camelCase("default-"+name)]=elem[propName]=!1:jQuery.attr(elem,name,""),elem.removeAttribute(getSetAttribute?name:propName)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&"radio"===value&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}}}),boolHook={set:function(elem,value,name){return value===!1?jQuery.removeAttr(elem,name):getSetInput&&getSetAttribute||!ruseDefault.test(name)?elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name):elem[jQuery.camelCase("default-"+name)]=elem[name]=!0,name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=getSetInput&&getSetAttribute||!ruseDefault.test(name)?function(elem,name,isXML){var ret,handle;return isXML||(handle=attrHandle[name],attrHandle[name]=ret,ret=null!=getter(elem,name,isXML)?name.toLowerCase():null,attrHandle[name]=handle),ret}:function(elem,name,isXML){return isXML?void 0:elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null}}),getSetInput&&getSetAttribute||(jQuery.attrHooks.value={set:function(elem,value,name){return jQuery.nodeName(elem,"input")?void(elem.defaultValue=value):nodeHook&&nodeHook.set(elem,value,name)}}),getSetAttribute||(nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);return ret||elem.setAttributeNode(ret=elem.ownerDocument.createAttribute(name)),ret.value=value+="","value"===name||value===elem.getAttribute(name)?value:void 0}},attrHandle.id=attrHandle.name=attrHandle.coords=function(elem,name,isXML){var ret;return isXML?void 0:(ret=elem.getAttributeNode(name))&&""!==ret.value?ret.value:null},jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);return ret&&ret.specified?ret.value:void 0},set:nodeHook.set},jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,""===value?!1:value,name)}},jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){return""===value?(elem.setAttribute(name,"auto"),value):void 0}}})),support.style||(jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||void 0},set:function(elem,value){return elem.style.cssText=value+""}});var rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return name=jQuery.propFix[name]||name,this.each(function(){try{this[name]=void 0,delete this[name]}catch(e){}})}}),jQuery.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType)return notxml=1!==nType||!jQuery.isXMLDoc(elem),notxml&&(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}}}),support.hrefNormalized||jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4)}}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex),null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),support.enctype||(jQuery.propFix.enctype="encoding");var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,i=0,len=this.length,proceed="string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(proceed)for(classes=(value||"").match(rnotwhite)||[];len>i;i++)if(elem=this[i],cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ")){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");finalValue=jQuery.trim(cur),elem.className!==finalValue&&(elem.className=finalValue)}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,i=0,len=this.length,proceed=0===arguments.length||"string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});if(proceed)for(classes=(value||"").match(rnotwhite)||[];len>i;i++)if(elem=this[i],cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"")){for(j=0;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>=0;)cur=cur.replace(" "+clazz+" "," ");finalValue=value?jQuery.trim(cur):"",elem.className!==finalValue&&(elem.className=finalValue)}return this},toggleClass:function(value,stateVal){var type=typeof value;return"boolean"==typeof stateVal&&"string"===type?stateVal?this.addClass(value):this.removeClass(value):this.each(jQuery.isFunction(value)?function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}:function(){if("string"===type)for(var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else(type===strundefined||"boolean"===type)&&(this.className&&jQuery._data(this,"__className__",this.className),this.className=this.className||value===!1?"":jQuery._data(this,"__className__")||"")})},hasClass:function(selector){for(var className=" "+selector+" ",i=0,l=this.length;l>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0)return!0;return!1}}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var nonce=jQuery.now(),rquery=/\?/,rvalidtokens=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;jQuery.parseJSON=function(data){if(window.JSON&&window.JSON.parse)return window.JSON.parse(data+"");var requireNonComma,depth=null,str=jQuery.trim(data+"");return str&&!jQuery.trim(str.replace(rvalidtokens,function(token,comma,open,close){return requireNonComma&&comma&&(depth=0),0===depth?token:(requireNonComma=open||comma,depth+=!close-!open,"")}))?Function("return "+str)():jQuery.error("Invalid JSON: "+data)},jQuery.parseXML=function(data){var xml,tmp;if(!data||"string"!=typeof data)return null;try{window.DOMParser?(tmp=new DOMParser,xml=tmp.parseFromString(data,"text/xml")):(xml=new ActiveXObject("Microsoft.XMLDOM"),xml.async="false",xml.loadXML(data))
}catch(e){xml=void 0}return xml&&xml.documentElement&&!xml.getElementsByTagName("parsererror").length||jQuery.error("Invalid XML: "+data),xml};var ajaxLocParts,ajaxLocation,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;2!==state&&(state=2,timeoutTimer&&clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&300>status||304===status,responses&&(response=ajaxHandleResponses(s,jqXHR,responses)),response=ajaxConvert(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&(modified=jqXHR.getResponseHeader("Last-Modified"),modified&&(jQuery.lastModified[cacheURL]=modified),modified=jqXHR.getResponseHeader("etag"),modified&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,error=response.error,isSuccess=!error)):(error=statusText,(status||!statusText)&&(statusText="error",0>status&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}"object"==typeof url&&(options=url,url=void 0),options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(2===state){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return 2===state?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();return state||(name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return state||(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(2>state)for(code in map)statusCode[code]=[statusCode[code],map[code]];else jqXHR.always(map[jqXHR.status]);return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR).complete=completeDeferred.add,jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""],null==s.crossDomain&&(parts=rurl.exec(s.url.toLowerCase()),s.crossDomain=!(!parts||parts[1]===ajaxLocParts[1]&&parts[2]===ajaxLocParts[2]&&(parts[3]||("http:"===parts[1]?"80":"443"))===(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?"80":"443")))),s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),2===state)return jqXHR;fireGlobals=s.global,fireGlobals&&0===jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url,s.hasContent||(s.data&&(cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),s.cache===!1&&(s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++)),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===!1||2===state))return jqXHR.abort();strAbort="abort";for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);if(transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),s.async&&s.timeout>0&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(2>state))throw e;done(-1,e)}}else done(-1,"No Transport");return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,"script")}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}}),jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html))return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))});if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstChild&&1===elem.firstChild.nodeType;)elem=elem.firstChild;return elem}).append(this)}return this},wrapInner:function(html){return this.each(jQuery.isFunction(html)?function(i){jQuery(this).wrapInner(html.call(this,i))}:function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}}),jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0||!support.reliableHiddenOffsets()&&"none"===(elem.style&&elem.style.display||jQuery.css(elem,"display"))},jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():null==value?"":value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(void 0===traditional&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional),jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.ajaxSettings.xhr=void 0!==window.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&createStandardXHR()||createActiveXHR()}:createStandardXHR;var xhrId=0,xhrCallbacks={},xhrSupported=jQuery.ajaxSettings.xhr();window.ActiveXObject&&jQuery(window).on("unload",function(){for(var key in xhrCallbacks)xhrCallbacks[key](void 0,!0)}),support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,xhrSupported=support.ajax=!!xhrSupported,xhrSupported&&jQuery.ajaxTransport(function(options){if(!options.crossDomain||support.cors){var callback;return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest");for(i in headers)void 0!==headers[i]&&xhr.setRequestHeader(i,headers[i]+"");xhr.send(options.hasContent&&options.data||null),callback=function(_,isAbort){var status,statusText,responses;if(callback&&(isAbort||4===xhr.readyState))if(delete xhrCallbacks[id],callback=void 0,xhr.onreadystatechange=jQuery.noop,isAbort)4!==xhr.readyState&&xhr.abort();else{responses={},status=xhr.status,"string"==typeof xhr.responseText&&(responses.text=xhr.responseText);try{statusText=xhr.statusText}catch(e){statusText=""}status||!options.isLocal||options.crossDomain?1223===status&&(status=204):status=responses.text?200:404}responses&&complete(status,statusText,responses,xhr.getAllResponseHeaders())},options.async?4===xhr.readyState?setTimeout(callback):xhr.onreadystatechange=xhrCallbacks[id]=callback:callback()},abort:function(){callback&&callback(void 0,!0)}}}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type="GET",s.global=!1)}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script"),script.async=!0,s.scriptCharset&&(script.charset=s.scriptCharset),script.src=s.url,script.onload=script.onreadystatechange=function(_,isAbort){(isAbort||!script.readyState||/loaded|complete/.test(script.readyState))&&(script.onload=script.onreadystatechange=null,script.parentNode&&script.parentNode.removeChild(script),script=null,isAbort||callback(200,"success"))},head.insertBefore(script,head.firstChild)},abort:function(){script&&script.onload(void 0,!0)}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==!1&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");return jsonProp||"jsonp"===s.dataTypes[0]?(callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):s.jsonp!==!1&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0}),"script"):void 0}),jQuery.parseHTML=function(data,context,keepScripts){if(!data||"string"!=typeof data)return null;"boolean"==typeof context&&(keepScripts=context,context=!1),context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];return parsed?[context.createElement(parsed[1])]:(parsed=jQuery.buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes))};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if("string"!=typeof url&&_load)return _load.apply(this,arguments);var selector,response,type,self=this,off=url.indexOf(" ");return off>=0&&(selector=jQuery.trim(url.slice(off,url.length)),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=void 0):params&&"object"==typeof params&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])}),this},jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=("absolute"===position||"fixed"===position)&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,calculatePosition?(curPosition=curElem.position(),curTop=curPosition.top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset)),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(doc)return docElem=doc.documentElement,jQuery.contains(docElem,elem)?(typeof elem.getBoundingClientRect!==strundefined&&(box=elem.getBoundingClientRect()),win=getWindow(doc),{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}):box},position:function(){if(this[0]){var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];return"fixed"===jQuery.css(elem,"position")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),jQuery.nodeName(offsetParent[0],"html")||(parentOffset=offsetParent.offset()),parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",!0)),{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent||docElem;offsetParent&&!jQuery.nodeName(offsetParent,"html")&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);return void 0===val?win?prop in win?win[prop]:win.document.documentElement[method]:elem[method]:void(win?win.scrollTo(top?jQuery(win).scrollLeft():val,top?val:jQuery(win).scrollTop()):elem[method]=val)},method,val,arguments.length,null)}}),jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){return computed?(computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed):void 0})}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(margin===!0||value===!0?"margin":"border");return access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:void 0,chainable,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery});var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},typeof noGlobal===strundefined&&(window.jQuery=window.$=jQuery),jQuery}),function($){function Coords(obj){return obj[0]&&$.isPlainObject(obj[0])?this.data=obj[0]:this.el=obj,this.isCoords=!0,this.coords={},this.init(),this}var fn=Coords.prototype;fn.init=function(){this.set(),this.original_coords=this.get()},fn.set=function(update,not_update_offsets){var el=this.el;if(el&&!update&&(this.data=el.offset(),this.data.width=el.width(),this.data.height=el.height()),el&&update&&!not_update_offsets){var offset=el.offset();this.data.top=offset.top,this.data.left=offset.left}var d=this.data;return this.coords.x1=d.left,this.coords.y1=d.top,this.coords.x2=d.left+d.width,this.coords.y2=d.top+d.height,this.coords.cx=d.left+d.width/2,this.coords.cy=d.top+d.height/2,this.coords.width=d.width,this.coords.height=d.height,this.coords.el=el||!1,this},fn.update=function(data){if(!data&&!this.el)return this;if(data){var new_data=$.extend({},this.data,data);return this.data=new_data,this.set(!0,!0)}return this.set(!0),this},fn.get=function(){return this.coords},$.fn.coords=function(){if(this.data("coords"))return this.data("coords");var ins=new Coords(this,arguments[0]);return this.data("coords",ins),ins}}(jQuery,window,document),function($,window,document){function Collision(el,colliders,options){this.options=$.extend(defaults,options),this.$element=el,this.last_colliders=[],this.last_colliders_coords=[],"string"==typeof colliders||colliders instanceof jQuery?this.$colliders=$(colliders,this.options.colliders_context).not(this.$element):this.colliders=$(colliders),this.init()}var defaults={colliders_context:document.body},fn=Collision.prototype;fn.init=function(){this.find_collisions()},fn.overlaps=function(a,b){var x=!1,y=!1;return(b.x1>=a.x1&&b.x1<=a.x2||b.x2>=a.x1&&b.x2<=a.x2||a.x1>=b.x1&&a.x2<=b.x2)&&(x=!0),(b.y1>=a.y1&&b.y1<=a.y2||b.y2>=a.y1&&b.y2<=a.y2||a.y1>=b.y1&&a.y2<=b.y2)&&(y=!0),x&&y},fn.detect_overlapping_region=function(a,b){var regionX="",regionY="";return a.y1>b.cy&&a.y1<b.y2&&(regionX="N"),a.y2>b.y1&&a.y2<b.cy&&(regionX="S"),a.x1>b.cx&&a.x1<b.x2&&(regionY="W"),a.x2>b.x1&&a.x2<b.cx&&(regionY="E"),regionX+regionY||"C"},fn.calculate_overlapped_area_coords=function(a,b){var x1=Math.max(a.x1,b.x1),y1=Math.max(a.y1,b.y1),x2=Math.min(a.x2,b.x2),y2=Math.min(a.y2,b.y2);return $({left:x1,top:y1,width:x2-x1,height:y2-y1}).coords().get()},fn.calculate_overlapped_area=function(coords){return coords.width*coords.height},fn.manage_colliders_start_stop=function(new_colliders_coords,start_callback,stop_callback){for(var last=this.last_colliders_coords,i=0,il=last.length;il>i;i++)-1===$.inArray(last[i],new_colliders_coords)&&start_callback.call(this,last[i]);for(var j=0,jl=new_colliders_coords.length;jl>j;j++)-1===$.inArray(new_colliders_coords[j],last)&&stop_callback.call(this,new_colliders_coords[j])},fn.find_collisions=function(player_data_coords){for(var self=this,colliders_coords=[],colliders_data=[],$colliders=this.colliders||this.$colliders,count=$colliders.length,player_coords=self.$element.coords().update(player_data_coords||!1).get();count--;){var $collider=self.$colliders?$($colliders[count]):$colliders[count],$collider_coords_ins=$collider.isCoords?$collider:$collider.coords(),collider_coords=$collider_coords_ins.get(),overlaps=self.overlaps(player_coords,collider_coords);if(overlaps){var region=self.detect_overlapping_region(player_coords,collider_coords);if("C"===region){var area_coords=self.calculate_overlapped_area_coords(player_coords,collider_coords),area=self.calculate_overlapped_area(area_coords),collider_data={area:area,area_coords:area_coords,region:region,coords:collider_coords,player_coords:player_coords,el:$collider};self.options.on_overlap&&self.options.on_overlap.call(this,collider_data),colliders_coords.push($collider_coords_ins),colliders_data.push(collider_data)}}}return(self.options.on_overlap_stop||self.options.on_overlap_start)&&this.manage_colliders_start_stop(colliders_coords,self.options.on_overlap_stop,self.options.on_overlap_start),this.last_colliders_coords=colliders_coords,colliders_data},fn.get_closest_colliders=function(player_data_coords){var colliders=this.find_collisions(player_data_coords),min_area=100;return colliders.sort(function(a,b){return a.area<=min_area?1:"C"===a.region&&"C"===b.region?a.coords.y1<b.coords.y1||a.coords.x1<b.coords.x1?-1:1:a.area<b.area?1:1}),colliders},$.fn.collision=function(collider,options){return new Collision(this,collider,options)}}(jQuery,window,document),function(window){window.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)};immediate&&!timeout&&func.apply(context,args),clearTimeout(timeout),timeout=setTimeout(later,wait)}},window.throttle=function(func,wait){var context,args,timeout,throttling,more,result,whenDone=debounce(function(){more=throttling=!1},wait);return function(){context=this,args=arguments;var later=function(){timeout=null,more&&func.apply(context,args),whenDone()};return timeout||(timeout=setTimeout(later,wait)),throttling?more=!0:result=func.apply(context,args),whenDone(),throttling=!0,result}}}(window),function($,window,document){function Draggable(el,options){this.options=$.extend({},defaults,options),this.$body=$(document.body),this.$container=$(el),this.$dragitems=$(this.options.items,this.$container),this.is_dragging=!1,this.player_min_left=0+this.options.offset_left,this.init()}var defaults={items:".gs_w",distance:1,limit:!0,offset_left:0,autoscroll:!0},$window=$(window),isTouch=!!("ontouchstart"in window),pointer_events={start:isTouch?"touchstart":"mousedown.draggable",move:isTouch?"touchmove":"mousemove.draggable",end:isTouch?"touchend":"mouseup.draggable"},fn=Draggable.prototype;fn.init=function(){this.calculate_positions(),this.$container.css("position","relative"),this.enable(),$(window).bind("resize",throttle($.proxy(this.calculate_positions,this),200))},fn.get_actual_pos=function($el){var pos=$el.position();return pos},fn.get_mouse_pos=function(e){if(isTouch){var oe=e.originalEvent;e=oe.touches.length?oe.touches[0]:oe.changedTouches[0]}return{left:e.clientX,top:e.clientY}},fn.get_offset=function(e){e.preventDefault();var mouse_actual_pos=this.get_mouse_pos(e),diff_x=Math.round(mouse_actual_pos.left-this.mouse_init_pos.left),diff_y=Math.round(mouse_actual_pos.top-this.mouse_init_pos.top),left=Math.round(this.el_init_offset.left+diff_x-this.baseX),top=Math.round(this.el_init_offset.top+diff_y-this.baseY+this.scrollOffset);return this.options.limit&&(left>this.player_max_left?left=this.player_max_left:left<this.player_min_left&&(left=this.player_min_left)),{left:left,top:top,mouse_left:mouse_actual_pos.left,mouse_top:mouse_actual_pos.top}},fn.manage_scroll=function(offset){var nextScrollTop,scrollTop=$window.scrollTop(),min_window_y=scrollTop,max_window_y=min_window_y+this.window_height,mouse_down_zone=max_window_y-50,mouse_up_zone=min_window_y+50,abs_mouse_top=(offset.mouse_left,min_window_y+offset.mouse_top),max_player_y=this.doc_height-this.window_height+this.player_height;abs_mouse_top>=mouse_down_zone&&(nextScrollTop=scrollTop+30,max_player_y>nextScrollTop&&($window.scrollTop(nextScrollTop),this.scrollOffset=this.scrollOffset+30)),mouse_up_zone>=abs_mouse_top&&(nextScrollTop=scrollTop-30,nextScrollTop>0&&($window.scrollTop(nextScrollTop),this.scrollOffset=this.scrollOffset-30))},fn.calculate_positions=function(){this.window_height=$window.height()},fn.drag_handler=function(e){var node=e.target.nodeName;if((1===e.which||isTouch)&&"INPUT"!==node&&"TEXTAREA"!==node&&"SELECT"!==node&&"BUTTON"!==node){var self=this,first=!0;return this.$player=$(e.currentTarget),this.el_init_pos=this.get_actual_pos(this.$player),this.mouse_init_pos=this.get_mouse_pos(e),this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top,this.$body.on(pointer_events.move,function(mme){var mouse_actual_pos=self.get_mouse_pos(mme),diff_x=Math.abs(mouse_actual_pos.left-self.mouse_init_pos.left),diff_y=Math.abs(mouse_actual_pos.top-self.mouse_init_pos.top);return diff_x>self.options.distance||diff_y>self.options.distance?first?(first=!1,self.on_dragstart.call(self,mme),!1):(1==self.is_dragging&&self.on_dragmove.call(self,mme),!1):!1}),!1}},fn.on_dragstart=function(e){e.preventDefault(),this.drag_start=!0,this.is_dragging=!0;var offset=this.$container.offset();return this.baseX=Math.round(offset.left),this.baseY=Math.round(offset.top),this.doc_height=$(document).height(),"clone"===this.options.helper?(this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper"),this.helper=!0):this.helper=!1,this.scrollOffset=0,this.el_init_offset=this.$player.offset(),this.player_width=this.$player.width(),this.player_height=this.$player.height(),this.player_max_left=this.$container.width()-this.player_width+this.options.offset_left,this.options.start&&this.options.start.call(this.$player,e,{helper:this.helper?this.$helper:this.$player}),!1},fn.on_dragmove=function(e){var offset=this.get_offset(e);this.options.autoscroll&&this.manage_scroll(offset),(this.helper?this.$helper:this.$player).css({position:"absolute",left:offset.left,top:offset.top});var ui={position:{left:offset.left,top:offset.top}};return this.options.drag&&this.options.drag.call(this.$player,e,ui),!1},fn.on_dragstop=function(e){var offset=this.get_offset(e);this.drag_start=!1;var ui={position:{left:offset.left,top:offset.top}};return this.options.stop&&this.options.stop.call(this.$player,e,ui),this.helper&&this.$helper.remove(),!1},fn.on_select_start=function(){return!1},fn.enable=function(){this.$container.on("selectstart",this.on_select_start),this.$container.on(pointer_events.start,this.options.items,$.proxy(this.drag_handler,this)),this.$body.on(pointer_events.end,$.proxy(function(e){this.is_dragging=!1,this.$body.off(pointer_events.move),this.drag_start&&this.on_dragstop(e)},this))},fn.disable=function(){this.$container.off(pointer_events.start),this.$body.off(pointer_events.end),this.$container.off("selectstart",this.on_select_start)},fn.destroy=function(){this.disable(),$.removeData(this.$container,"drag")},$.fn.drag=function(options){return this.each(function(){$.data(this,"drag")||$.data(this,"drag",new Draggable(this,options))})}}(jQuery,window,document),function($,window,document){function Gridster(el,options){this.options=$.extend(!0,defaults,options),this.$el=$(el),this.$wrapper=this.$el.parent(),this.$widgets=$(this.options.widget_selector,this.$el).addClass("gs_w"),this.widgets=[],this.$changed=$([]),this.wrapper_width=this.$wrapper.width(),this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0],this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1],this.init()}var defaults={widget_selector:"> li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,min_rows:15,max_size_x:6,max_size_y:6,autogenerate_stylesheet:!0,avoid_overlapped_widgets:!0,serialize_params:function($w,wgd){return{col:wgd.col,row:wgd.row}},collision:{},draggable:{distance:4}};Gridster.generated_stylesheets=[];var fn=Gridster.prototype;fn.init=function(){this.generate_grid_and_stylesheet(),this.get_widgets_from_DOM(),this.set_dom_grid_height(),this.$wrapper.addClass("ready"),this.draggable(),$(window).bind("resize",throttle($.proxy(this.recalculate_faux_grid,this),200))},fn.disable=function(){return this.$wrapper.find(".player-revert").removeClass("player-revert"),this.drag_api.disable(),this},fn.enable=function(){return this.drag_api.enable(),this},fn.add_widget=function(html,size_x,size_y){var next_pos=this.next_position(size_x,size_y),$w=$(html).attr({"data-col":next_pos.col,"data-row":next_pos.row,"data-sizex":next_pos.size_x,"data-sizey":next_pos.size_y}).addClass("gs_w").appendTo(this.$el).hide();return this.$widgets=this.$widgets.add($w),this.register_widget($w),this.set_dom_grid_height(),$w.fadeIn()},fn.next_position=function(size_x,size_y){size_x||(size_x=1),size_y||(size_y=1);for(var ga=this.gridmap,cols_l=ga.length,valid_pos=[],c=1;cols_l>c;c++)for(var rows_l=ga[c].length,r=1;rows_l>=r;r++){var can_move_to=this.can_move_to({size_x:size_x,size_y:size_y},c,r);can_move_to&&valid_pos.push({col:c,row:r,size_y:size_y,size_x:size_x})}return valid_pos.length?this.sort_by_row_and_col_asc(valid_pos)[0]:!1},fn.remove_widget=function(el,callback){var $el=el instanceof jQuery?el:$(el),wgd=$el.coords().grid;this.cells_occupied_by_placeholder={},this.$widgets=this.$widgets.not($el);var $nexts=this.widgets_below($el);this.remove_from_gridmap(wgd),$el.fadeOut($.proxy(function(){$el.remove(),$nexts.each($.proxy(function(i,widget){this.move_widget_up($(widget),wgd.size_y)},this)),this.set_dom_grid_height(),callback&&callback.call(this,el)},this))},fn.serialize=function($widgets){$widgets||($widgets=this.$widgets);var result=[];return $widgets.each($.proxy(function(i,widget){result.push(this.options.serialize_params($(widget),$(widget).coords().grid))},this)),result},fn.serialize_changed=function(){return this.serialize(this.$changed)},fn.register_widget=function($el){var wgd={col:parseInt($el.attr("data-col"),10),row:parseInt($el.attr("data-row"),10),size_x:parseInt($el.attr("data-sizex"),10),size_y:parseInt($el.attr("data-sizey"),10),el:$el};
return this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:wgd.size_x,size_y:wgd.size_y},wgd.col,wgd.row)&&(wgd=this.next_position(wgd.size_x,wgd.size_y),wgd.el=$el,$el.attr({"data-col":wgd.col,"data-row":wgd.row,"data-sizex":wgd.size_x,"data-sizey":wgd.size_y})),$el.data("coords",$el.coords()),$el.data("coords").grid=wgd,this.add_to_gridmap(wgd,$el),this.widgets.push($el),this},fn.update_widget_position=function(grid_data,value){return this.for_each_cell_occupied(grid_data,function(col,row){return this.gridmap[col]?void(this.gridmap[col][row]=value):this}),this},fn.remove_from_gridmap=function(grid_data){return this.update_widget_position(grid_data,!1)},fn.add_to_gridmap=function(grid_data,value){if(this.update_widget_position(grid_data,value||grid_data.el),grid_data.el){var $widgets=this.widgets_below(grid_data.el);$widgets.each($.proxy(function(i,widget){this.move_widget_up($(widget))},this))}},fn.draggable=function(){var self=this,draggable_options=$.extend(!0,{},this.options.draggable,{offset_left:this.options.widget_margins[0],items:".gs_w",start:function(event,ui){self.$widgets.filter(".player-revert").removeClass("player-revert"),self.$player=$(this),self.$helper="clone"===self.options.draggable.helper?$(ui.helper):self.$player,self.helper=!self.$helper.is(self.$player),self.on_start_drag.call(self,event,ui),self.$el.trigger("gridster:dragstart")},stop:function(event,ui){self.on_stop_drag.call(self,event,ui),self.$el.trigger("gridster:dragstop")},drag:throttle(function(event,ui){self.on_drag.call(self,event,ui),self.$el.trigger("gridster:drag")},60)});return this.drag_api=this.$el.drag(draggable_options).data("drag"),this},fn.on_start_drag=function(event,ui){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging"),this.$player.addClass("player"),this.player_grid_data=this.$player.coords().grid,this.placeholder_grid_data=$.extend({},this.player_grid_data),this.$el.css("height",this.$el.height()+this.player_grid_data.size_y*this.min_widget_height);var colliders=this.faux_grid,coords=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data),this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.last_cols=[],this.last_rows=[],this.collision_api=this.$helper.collision(colliders,this.options.collision),this.$preview_holder=$("<li />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:coords.width,height:coords.height}}).appendTo(this.$el),this.options.draggable.start&&this.options.draggable.start.call(this,event,ui)},fn.on_drag=function(event,ui){if(null===this.$player)return!1;var abs_offset={left:ui.position.left+this.baseX,top:ui.position.top+this.baseY};this.colliders_data=this.collision_api.get_closest_colliders(abs_offset),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.helper&&this.$player&&this.$player.css({left:ui.position.left,top:ui.position.top}),this.options.draggable.drag&&this.options.draggable.drag.call(this,event,ui)},fn.on_stop_drag=function(event,ui){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging"),ui.position.left=ui.position.left+this.baseX,ui.position.top=ui.position.top+this.baseY,this.colliders_data=this.collision_api.get_closest_colliders(ui.position),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""}),this.$changed=this.$changed.add(this.$player),this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data),this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row),this.$player.coords().grid.row=this.placeholder_grid_data.row,this.$player.coords().grid.col=this.placeholder_grid_data.col,this.options.draggable.stop&&this.options.draggable.stop.call(this,event,ui),this.$preview_holder.remove(),this.$player=null,this.set_dom_grid_height()},fn.on_overlapped_column_change=function(start_callback,stop_callback){if(this.colliders_data.length){var i,cols=this.get_targeted_columns(this.colliders_data[0].el.data.col),last_n_cols=this.last_cols.length,n_cols=cols.length;for(i=0;n_cols>i;i++)-1===$.inArray(cols[i],this.last_cols)&&(start_callback||$.noop).call(this,cols[i]);for(i=0;last_n_cols>i;i++)-1===$.inArray(this.last_cols[i],cols)&&(stop_callback||$.noop).call(this,this.last_cols[i]);return this.last_cols=cols,this}},fn.on_overlapped_row_change=function(start_callback,end_callback){if(this.colliders_data.length){var i,rows=this.get_targeted_rows(this.colliders_data[0].el.data.row),last_n_rows=this.last_rows.length,n_rows=rows.length;for(i=0;n_rows>i;i++)-1===$.inArray(rows[i],this.last_rows)&&(start_callback||$.noop).call(this,rows[i]);for(i=0;last_n_rows>i;i++)-1===$.inArray(this.last_rows[i],rows)&&(end_callback||$.noop).call(this,this.last_rows[i]);this.last_rows=rows}},fn.set_player=function(col,row){this.empty_cells_player_occupies();var self=this,cell=self.colliders_data[0].el.data,to_col=cell.col,to_row=row||cell.row;this.player_grid_data={col:to_col,row:to_row,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x},this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);var $overlapped_widgets=this.get_widgets_overlapped(this.player_grid_data),constraints=this.widgets_constraints($overlapped_widgets);if(this.manage_movements(constraints.can_go_up,to_col,to_row),this.manage_movements(constraints.can_not_go_up,to_col,to_row),!$overlapped_widgets.length){var pp=this.can_go_player_up(this.player_grid_data);pp!==!1&&(to_row=pp),this.set_placeholder(to_col,to_row)}return{col:to_col,row:to_row}},fn.widgets_constraints=function($widgets){var $widgets_can_not_go_up,$widgets_can_go_up=$([]),wgd_can_go_up=[],wgd_can_not_go_up=[];return $widgets.each($.proxy(function(i,w){var $w=$(w),wgd=$w.coords().grid;this.can_go_widget_up(wgd)?($widgets_can_go_up=$widgets_can_go_up.add($w),wgd_can_go_up.push(wgd)):wgd_can_not_go_up.push(wgd)},this)),$widgets_can_not_go_up=$widgets.not($widgets_can_go_up),{can_go_up:this.sort_by_row_asc(wgd_can_go_up),can_not_go_up:this.sort_by_row_desc(wgd_can_not_go_up)}},fn.sort_by_row_asc=function(widgets){return widgets=widgets.sort(function(a,b){return a.row>b.row?1:-1})},fn.sort_by_row_and_col_asc=function(widgets){return widgets=widgets.sort(function(a,b){return a.row>b.row||a.row==b.row&&a.col>b.col?1:-1})},fn.sort_by_col_asc=function(widgets){return widgets=widgets.sort(function(a,b){return a.col>b.col?1:-1})},fn.sort_by_row_desc=function(widgets){return widgets=widgets.sort(function(a,b){return a.row+a.size_y<b.row+b.size_y?1:-1})},fn.manage_movements=function($widgets,to_col,to_row){return $.each($widgets,$.proxy(function(i,w){var wgd=w,$w=wgd.el,can_go_widget_up=this.can_go_widget_up(wgd);if(can_go_widget_up)this.move_widget_to($w,can_go_widget_up),this.set_placeholder(to_col,can_go_widget_up+wgd.size_y);else{var can_go_player_up=this.can_go_player_up(this.player_grid_data);if(!can_go_player_up){var y=to_row+this.player_grid_data.size_y-wgd.row;this.move_widget_down($w,y),this.set_placeholder(to_col,to_row)}}},this)),this},fn.is_player=function(col_or_el,row){if(row&&!this.gridmap[col_or_el])return!1;var $w=row?this.gridmap[col_or_el][row]:col_or_el;return $w&&($w.is(this.$player)||$w.is(this.$helper))},fn.is_player_in=function(col,row){var c=this.cells_occupied_by_player||{};return $.inArray(col,c.cols)>=0&&$.inArray(row,c.rows)>=0},fn.is_placeholder_in=function(col,row){var c=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(col)&&$.inArray(row,c.rows)>=0},fn.is_placeholder_in_col=function(col){var c=this.cells_occupied_by_placeholder||[];return $.inArray(col,c.cols)>=0},fn.is_empty=function(col,row){return"undefined"!=typeof this.gridmap[col]&&"undefined"!=typeof this.gridmap[col][row]&&this.gridmap[col][row]===!1?!0:!1},fn.is_occupied=function(col,row){return this.gridmap[col]&&this.gridmap[col][row]?!0:!1},fn.is_widget=function(col,row){var cell=this.gridmap[col];return cell?(cell=cell[row],cell?cell:!1):!1},fn.is_widget_under_player=function(col,row){return this.is_widget(col,row)?this.is_player_in(col,row):!1},fn.get_widgets_under_player=function(){var cells=this.cells_occupied_by_player,$widgets=$([]);return $.each(cells.cols,$.proxy(function(i,col){$.each(cells.rows,$.proxy(function(i,row){this.is_widget(col,row)&&($widgets=$widgets.add(this.gridmap[col][row]))},this))},this)),$widgets},fn.set_placeholder=function(col,row){var phgd=$.extend({},this.placeholder_grid_data),$nexts=this.widgets_below({col:phgd.col,row:phgd.row,size_y:phgd.size_y,size_x:phgd.size_x}),right_col=col+phgd.size_x-1;right_col>this.cols&&(col-=right_col-col);var moved_down=this.placeholder_grid_data.row<row,changed_column=this.placeholder_grid_data.col!==col;this.placeholder_grid_data.col=col,this.placeholder_grid_data.row=row,this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.$preview_holder.attr({"data-row":row,"data-col":col}),(moved_down||changed_column)&&$nexts.each($.proxy(function(i,widget){this.move_widget_up($(widget),this.placeholder_grid_data.col-col+phgd.size_y)},this))},fn.can_go_player_up=function(widget_grid_data){var p_bottom_row=widget_grid_data.row+widget_grid_data.size_y-1,result=!0,upper_rows=[],min_row=1e4,$widgets_under_player=this.get_widgets_under_player();return this.for_each_column_occupied(widget_grid_data,function(tcol){var grid_col=this.gridmap[tcol],r=p_bottom_row+1;for(upper_rows[tcol]=[];--r>0&&(this.is_empty(tcol,r)||this.is_player(tcol,r)||this.is_widget(tcol,r)&&grid_col[r].is($widgets_under_player));)upper_rows[tcol].push(r),min_row=min_row>r?r:min_row;return 0===upper_rows[tcol].length?(result=!1,!0):void upper_rows[tcol].sort()}),result?this.get_valid_rows(widget_grid_data,upper_rows,min_row):!1},fn.can_go_widget_up=function(widget_grid_data){var p_bottom_row=widget_grid_data.row+widget_grid_data.size_y-1,result=!0,upper_rows=[],min_row=1e4;return widget_grid_data.col<this.player_grid_data.col&&widget_grid_data.col+widget_grid_data.size_y-1>this.player_grid_data.col+this.player_grid_data.size_y-1?!1:(this.for_each_column_occupied(widget_grid_data,function(tcol){var grid_col=this.gridmap[tcol];upper_rows[tcol]=[];for(var r=p_bottom_row+1;--r>0&&(!this.is_widget(tcol,r)||this.is_player_in(tcol,r)||grid_col[r].is(widget_grid_data.el));)this.is_player(tcol,r)||this.is_placeholder_in(tcol,r)||this.is_player_in(tcol,r)||upper_rows[tcol].push(r),min_row>r&&(min_row=r);return 0===upper_rows[tcol].length?(result=!1,!0):void upper_rows[tcol].sort()}),result?this.get_valid_rows(widget_grid_data,upper_rows,min_row):!1)},fn.get_valid_rows=function(widget_grid_data,upper_rows,min_row){for(var p_top_row=widget_grid_data.row,p_bottom_row=widget_grid_data.row+widget_grid_data.size_y-1,size_y=widget_grid_data.size_y,r=min_row-1,valid_rows=[];++r<=p_bottom_row;){var common=!0;if($.each(upper_rows,function(col,rows){$.isArray(rows)&&-1===$.inArray(r,rows)&&(common=!1)}),common===!0&&(valid_rows.push(r),valid_rows.length===size_y))break}var new_row=!1;return 1===size_y?valid_rows[0]!==p_top_row&&(new_row=valid_rows[0]||!1):valid_rows[0]!==p_top_row&&(new_row=this.get_consecutive_numbers_index(valid_rows,size_y)),new_row},fn.get_consecutive_numbers_index=function(arr,size_y){for(var max=arr.length,result=[],first=!0,prev=-1,i=0;max>i;i++){if(first||arr[i]===prev+1){if(result.push(i),result.length===size_y)break;first=!1}else result=[],first=!0;prev=arr[i]}return result.length>=size_y?arr[result[0]]:!1},fn.get_widgets_overlapped=function(){var $widgets=$([]),used=[],rows_from_bottom=this.cells_occupied_by_player.rows.slice(0);return rows_from_bottom.reverse(),$.each(this.cells_occupied_by_player.cols,$.proxy(function(i,col){$.each(rows_from_bottom,$.proxy(function(i,row){if(!this.gridmap[col])return!0;var $w=this.gridmap[col][row];this.is_occupied(col,row)&&!this.is_player($w)&&-1===$.inArray($w,used)&&($widgets=$widgets.add($w),used.push($w))},this))},this)),$widgets},fn.on_start_overlapping_column=function(col){this.set_player(col,!1)},fn.on_start_overlapping_row=function(row){this.set_player(!1,row)},fn.on_stop_overlapping_column=function(col){this.set_player(col,!1);var self=this;this.for_each_widget_below(col,this.cells_occupied_by_player.rows[0],function(){self.move_widget_up(this,self.player_grid_data.size_y)})},fn.on_stop_overlapping_row=function(row){this.set_player(!1,row);for(var self=this,cols=this.cells_occupied_by_player.cols,c=0,cl=cols.length;cl>c;c++)this.for_each_widget_below(cols[c],row,function(){self.move_widget_up(this,self.player_grid_data.size_y)})},fn.move_widget_to=function($widget,row){var self=this,widget_grid_data=$widget.coords().grid,$next_widgets=(row-widget_grid_data.row,this.widgets_below($widget)),can_move_to_new_cell=this.can_move_to(widget_grid_data,widget_grid_data.col,row,$widget);return can_move_to_new_cell===!1?!1:(this.remove_from_gridmap(widget_grid_data),widget_grid_data.row=row,this.add_to_gridmap(widget_grid_data),$widget.attr("data-row",row),this.$changed=this.$changed.add($widget),$next_widgets.each(function(i,widget){var $w=$(widget),wgd=$w.coords().grid,can_go_up=self.can_go_widget_up(wgd);can_go_up&&can_go_up!==wgd.row&&self.move_widget_to($w,can_go_up)}),this)},fn.move_widget_up=function($widget,y_units){var el_grid_data=$widget.coords().grid,actual_row=el_grid_data.row,moved=[];return y_units||(y_units=1),this.can_go_up($widget)?void this.for_each_column_occupied(el_grid_data,function(col){if(-1===$.inArray($widget,moved)){var widget_grid_data=$widget.coords().grid,next_row=actual_row-y_units;if(next_row=this.can_go_up_to_row(widget_grid_data,col,next_row),!next_row)return!0;var $next_widgets=this.widgets_below($widget);this.remove_from_gridmap(widget_grid_data),widget_grid_data.row=next_row,this.add_to_gridmap(widget_grid_data),$widget.attr("data-row",widget_grid_data.row),this.$changed=this.$changed.add($widget),moved.push($widget),$next_widgets.each($.proxy(function(i,widget){this.move_widget_up($(widget),y_units)},this))}}):!1},fn.move_widget_down=function($widget,y_units){var el_grid_data=$widget.coords().grid,actual_row=el_grid_data.row,moved=[],y_diff=y_units;if(!$widget)return!1;if(-1===$.inArray($widget,moved)){var widget_grid_data=$widget.coords().grid,next_row=actual_row+y_units,$next_widgets=this.widgets_below($widget);this.remove_from_gridmap(widget_grid_data),$next_widgets.each($.proxy(function(i,widget){var $w=$(widget),wd=$w.coords().grid,tmp_y=this.displacement_diff(wd,widget_grid_data,y_diff);tmp_y>0&&this.move_widget_down($w,tmp_y)},this)),widget_grid_data.row=next_row,this.update_widget_position(widget_grid_data,$widget),$widget.attr("data-row",widget_grid_data.row),this.$changed=this.$changed.add($widget),moved.push($widget)}},fn.can_go_up_to_row=function(widget_grid_data,col,row){var r,ga=this.gridmap,result=!0,urc=[],actual_row=widget_grid_data.row;if(this.for_each_column_occupied(widget_grid_data,function(tcol){ga[tcol];for(urc[tcol]=[],r=actual_row;r--&&this.is_empty(tcol,r)&&!this.is_placeholder_in(tcol,r);)urc[tcol].push(r);return urc[tcol].length?void 0:(result=!1,!0)}),!result)return!1;for(r=row,r=1;actual_row>r;r++){for(var common=!0,uc=0,ucl=urc.length;ucl>uc;uc++)urc[uc]&&-1===$.inArray(r,urc[uc])&&(common=!1);if(common===!0){result=r;break}}return result},fn.displacement_diff=function(widget_grid_data,parent_bgd,y_units){var actual_row=widget_grid_data.row,diffs=[],parent_max_y=parent_bgd.row+parent_bgd.size_y;this.for_each_column_occupied(widget_grid_data,function(col){for(var temp_y_units=0,r=parent_max_y;actual_row>r;r++)this.is_empty(col,r)&&(temp_y_units+=1);diffs.push(temp_y_units)});var max_diff=Math.max.apply(Math,diffs);return y_units-=max_diff,y_units>0?y_units:0},fn.widgets_below=function($el){var el_grid_data=$.isPlainObject($el)?$el:$el.coords().grid,self=this,next_row=(this.gridmap,el_grid_data.row+el_grid_data.size_y-1),$nexts=$([]);return this.for_each_column_occupied(el_grid_data,function(col){self.for_each_widget_below(col,next_row,function(){return self.is_player(this)||-1!==$.inArray(this,$nexts)?void 0:($nexts=$nexts.add(this),!0)})}),this.sort_by_row_asc($nexts)},fn.set_cells_player_occupies=function(col,row){return this.remove_from_gridmap(this.placeholder_grid_data),this.placeholder_grid_data.col=col,this.placeholder_grid_data.row=row,this.add_to_gridmap(this.placeholder_grid_data,this.$player),this},fn.empty_cells_player_occupies=function(){return this.remove_from_gridmap(this.placeholder_grid_data),this},fn.can_go_up=function($el){var el_grid_data=$el.coords().grid,initial_row=el_grid_data.row,prev_row=initial_row-1,result=(this.gridmap,!0);return 1===initial_row?!1:(this.for_each_column_occupied(el_grid_data,function(col){this.is_widget(col,prev_row);return this.is_occupied(col,prev_row)||this.is_player(col,prev_row)||this.is_placeholder_in(col,prev_row)||this.is_player_in(col,prev_row)?(result=!1,!0):void 0}),result)},fn.can_move_to=function(widget_grid_data,col,row){var $w=(this.gridmap,widget_grid_data.el),future_wd={size_y:widget_grid_data.size_y,size_x:widget_grid_data.size_x,col:col,row:row},result=!0,right_col=col+widget_grid_data.size_x-1;return right_col>this.cols?!1:(this.for_each_cell_occupied(future_wd,function(tcol,trow){var $tw=this.is_widget(tcol,trow);!$tw||widget_grid_data.el&&!$tw.is($w)||(result=!1)}),result)},fn.get_targeted_columns=function(from_col){for(var max=(from_col||this.player_grid_data.col)+(this.player_grid_data.size_x-1),cols=[],col=from_col;max>=col;col++)cols.push(col);return cols},fn.get_targeted_rows=function(from_row){for(var max=(from_row||this.player_grid_data.row)+(this.player_grid_data.size_y-1),rows=[],row=from_row;max>=row;row++)rows.push(row);return rows},fn.get_cells_occupied=function(el_grid_data){var i,cells={cols:[],rows:[]};for(arguments[1]instanceof jQuery&&(el_grid_data=arguments[1].coords().grid),i=0;i<el_grid_data.size_x;i++){var col=el_grid_data.col+i;cells.cols.push(col)}for(i=0;i<el_grid_data.size_y;i++){var row=el_grid_data.row+i;cells.rows.push(row)}return cells},fn.for_each_cell_occupied=function(grid_data,callback){return this.for_each_column_occupied(grid_data,function(col){this.for_each_row_occupied(grid_data,function(row){callback.call(this,col,row)})}),this},fn.for_each_column_occupied=function(el_grid_data,callback){for(var i=0;i<el_grid_data.size_x;i++){var col=el_grid_data.col+i;callback.call(this,col,el_grid_data)}},fn.for_each_row_occupied=function(el_grid_data,callback){for(var i=0;i<el_grid_data.size_y;i++){var row=el_grid_data.row+i;callback.call(this,row,el_grid_data)}},fn._traversing_widgets=function(type,direction,col,row,callback){var ga=this.gridmap;if(ga[col]){var cr,max,action=type+"/"+direction;if(arguments[2]instanceof jQuery){var el_grid_data=arguments[2].coords().grid;col=el_grid_data.col,row=el_grid_data.row,callback=arguments[3]}var matched=[],trow=row,methods={"for_each/above":function(){for(;trow--&&!(trow>0&&this.is_widget(col,trow)&&-1===$.inArray(ga[col][trow],matched)&&(cr=callback.call(ga[col][trow],col,trow),matched.push(ga[col][trow]),cr)););},"for_each/below":function(){for(trow=row+1,max=ga[col].length;max>trow&&(!this.is_widget(col,trow)||-1!==$.inArray(ga[col][trow],matched)||(cr=callback.call(ga[col][trow],col,trow),matched.push(ga[col][trow]),!cr));trow++);}};methods[action]&&methods[action].call(this)}},fn.for_each_widget_above=function(col,row,callback){return this._traversing_widgets("for_each","above",col,row,callback),this},fn.for_each_widget_below=function(col,row,callback){return this._traversing_widgets("for_each","below",col,row,callback),this},fn.get_highest_occupied_cell=function(){for(var r,gm=this.gridmap,rows=[],row_in_col=[],c=gm.length-1;c>=1;c--)for(r=gm[c].length-1;r>=1;r--)if(this.is_widget(c,r)){rows.push(r),row_in_col[r]=c;break}var highest_row=Math.max.apply(Math,rows);return this.highest_occupied_cell={col:row_in_col[highest_row],row:highest_row},this.highest_occupied_cell},fn.get_widgets_from=function(col,row){var $widgets=(this.gridmap,$());return col&&($widgets=$widgets.add(this.$widgets.filter(function(){var tcol=$(this).attr("data-col");return tcol===col||tcol>col}))),row&&($widgets=$widgets.add(this.$widgets.filter(function(){var trow=$(this).attr("data-row");return trow===row||trow>row}))),$widgets},fn.set_dom_grid_height=function(){var r=this.get_highest_occupied_cell().row;return this.$el.css("height",r*this.min_widget_height),this},fn.generate_stylesheet=function(opts){var i,styles="",extra_cells=10,max_size_y=this.options.max_size_y,max_size_x=this.options.max_size_x;opts||(opts={}),opts.cols||(opts.cols=this.cols),opts.rows||(opts.rows=this.rows),opts.namespace||(opts.namespace=""),opts.widget_base_dimensions||(opts.widget_base_dimensions=this.options.widget_base_dimensions),opts.widget_margins||(opts.widget_margins=this.options.widget_margins),opts.min_widget_width=2*opts.widget_margins[0]+opts.widget_base_dimensions[0],opts.min_widget_height=2*opts.widget_margins[1]+opts.widget_base_dimensions[1];var serialized_opts=$.param(opts);if($.inArray(serialized_opts,Gridster.generated_stylesheets)>=0)return!1;for(Gridster.generated_stylesheets.push(serialized_opts),i=opts.cols+extra_cells;i>=0;i--)styles+=opts.namespace+' [data-col="'+(i+1)+'"] { left:'+(i*opts.widget_base_dimensions[0]+i*opts.widget_margins[0]+(i+1)*opts.widget_margins[0])+"px;} ";for(i=opts.rows+extra_cells;i>=0;i--)styles+=opts.namespace+' [data-row="'+(i+1)+'"] { top:'+(i*opts.widget_base_dimensions[1]+i*opts.widget_margins[1]+(i+1)*opts.widget_margins[1])+"px;} ";for(var y=1;max_size_y>=y;y++)styles+=opts.namespace+' [data-sizey="'+y+'"] { height:'+(y*opts.widget_base_dimensions[1]+2*(y-1)*opts.widget_margins[1])+"px;}";for(var x=1;max_size_x>=x;x++)styles+=opts.namespace+' [data-sizex="'+x+'"] { width:'+(x*opts.widget_base_dimensions[0]+2*(x-1)*opts.widget_margins[0])+"px;}";return this.add_style_tag(styles)},fn.add_style_tag=function(css){var d=document,tag=d.createElement("style");return d.getElementsByTagName("head")[0].appendChild(tag),tag.setAttribute("type","text/css"),tag.styleSheet?tag.styleSheet.cssText=css:tag.appendChild(document.createTextNode(css)),this},fn.generate_faux_grid=function(rows,cols){this.faux_grid=[],this.gridmap=[];var col,row;for(col=cols;col>0;col--)for(this.gridmap[col]=[],row=rows;row>0;row--){var coords=$({left:this.baseX+(col-1)*this.min_widget_width,top:this.baseY+(row-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:col,row:row,original_col:col,original_row:row}).coords();this.gridmap[col][row]=!1,this.faux_grid.push(coords)}return this},fn.recalculate_faux_grid=function(){var aw=this.$wrapper.width();return this.baseX=($(window).width()-aw)/2,this.baseY=this.$wrapper.offset().top,$.each(this.faux_grid,$.proxy(function(i,coords){this.faux_grid[i]=coords.update({left:this.baseX+(coords.data.col-1)*this.min_widget_width,top:this.baseY+(coords.data.row-1)*this.min_widget_height})},this)),this},fn.get_widgets_from_DOM=function(){return this.$widgets.each($.proxy(function(i,widget){this.register_widget($(widget))},this)),this},fn.generate_grid_and_stylesheet=function(){var aw=this.$wrapper.width(),ah=this.$wrapper.height(),cols=Math.floor(aw/this.min_widget_width)+this.options.extra_cols,rows=Math.floor(ah/this.min_widget_height)+this.options.extra_rows,actual_cols=this.$widgets.map(function(){return $(this).attr("data-col")});actual_cols=Array.prototype.slice.call(actual_cols,0),actual_cols.length||(actual_cols=[0]);var actual_rows=this.$widgets.map(function(){return $(this).attr("data-row")});actual_rows=Array.prototype.slice.call(actual_rows,0),actual_rows.length||(actual_rows=[0]);var min_cols=Math.max.apply(Math,actual_cols),min_rows=Math.max.apply(Math,actual_rows);return this.cols=Math.max(min_cols,cols,this.options.min_cols),this.rows=Math.max(min_rows,rows,this.options.min_rows),this.baseX=($(window).width()-aw)/2,this.baseY=this.$wrapper.offset().top,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this.generate_faux_grid(this.rows,this.cols)},$.fn.gridster=function(options){return this.each(function(){$(this).data("gridster")||$(this).data("gridster",new Gridster(this,options))})}}(jQuery,window,document),/**
 * Downward compatible, touchable dial
 *
 * Version: 1.2.0 (15/07/2012)
 * Requires: jQuery v1.7+
 *
 * Copyright (c) 2012 Anthony Terrien
 * Under MIT and GPL licenses:
 *  http://www.opensource.org/licenses/mit-license.php
 *  http://www.gnu.org/licenses/gpl.html
 *
 * Thanks to vor, eskimoblood, spiffistan, FabrizioC
 */
$(function(){"use strict";var k={},max=Math.max,min=Math.min;k.c={},k.c.d=$(document),k.c.t=function(e){return e.originalEvent.touches.length-1},k.o=function(){var s=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.run=function(){var cf=function(e,conf){var k;for(k in conf)s.o[k]=conf[k];s.init(),s._configure()._draw()};if(!this.$.data("kontroled"))return this.$.data("kontroled",!0),this.extend(),this.o=$.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:!0,readOnly:this.$.data("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")||.35,width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inline:!1,draw:null,change:null,cancel:null,release:null},this.o),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(k){var $this=$(this);s.i[k]=$this,s.v[k]=$this.val(),$this.bind("change",function(){var val={};val[k]=$this.val(),s.val(val)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.$.val(),""==this.v&&(this.v=this.o.min),this.$.bind("change",function(){s.val(s.$.val())})),!this.o.displayInput&&this.$.hide(),this.$c=$('<canvas width="'+this.o.width+'px" height="'+this.o.height+'px"></canvas>'),this.c=this.$c[0].getContext("2d"),this.$.wrap($('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>')).before(this.$c),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",cf).parent().bind("configure",cf),this._listen()._configure()._xy().init(),this.isInit=!0,this._draw(),this},this._draw=function(){var d=!0,c=document.createElement("canvas");c.width=s.o.width,c.height=s.o.height,s.g=c.getContext("2d"),s.clear(),s.dH&&(d=s.dH()),d!==!1&&s.draw(),s.c.drawImage(c,0,0),c=null},this._touch=function(e){var touchMove=function(e){var v=s.xy2val(e.originalEvent.touches[s.t].pageX,e.originalEvent.touches[s.t].pageY);v!=s.cv&&(s.cH&&s.cH(v)===!1||(s.change(v),s._draw()))};return this.t=k.c.t(e),touchMove(e),k.c.d.bind("touchmove.k",touchMove).bind("touchend.k",function(){k.c.d.unbind("touchmove.k touchend.k"),s.rH&&s.rH(s.cv)===!1||s.val(s.cv)}),this},this._mouse=function(e){var mouseMove=function(e){var v=s.xy2val(e.pageX,e.pageY);v!=s.cv&&(s.cH&&s.cH(v)===!1||(s.change(v),s._draw()))};return mouseMove(e),k.c.d.bind("mousemove.k",mouseMove).bind("keyup.k",function(e){if(27===e.keyCode){if(k.c.d.unbind("mouseup.k mousemove.k keyup.k"),s.eH&&s.eH()===!1)return;s.cancel()}}).bind("mouseup.k",function(){k.c.d.unbind("mousemove.k mouseup.k keyup.k"),s.rH&&s.rH(s.cv)===!1||s.val(s.cv)}),this},this._xy=function(){var o=this.$c.offset();return this.x=o.left,this.y=o.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),s._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),s._xy()._touch(e)}),this.listen()),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(){},this.val=function(){},this.xy2val=function(){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(h,a){var rgb;return h=h.substring(1,7),rgb=[parseInt(h.substring(0,2),16),parseInt(h.substring(2,4),16),parseInt(h.substring(4,6),16)],"rgba("+rgb[0]+","+rgb[1]+","+rgb[2]+","+a+")"},this.copy=function(f,t){for(var i in f)t[i]=f[i]}},k.Dial=function(){k.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=$.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(v){return null==v?this.v:(this.cv=this.o.stopper?max(min(v,this.o.max),this.o.min):v,this.v=this.cv,this.$.val(this.v),this._draw(),void 0)},this.xy2val=function(x,y){var a,ret;return a=Math.atan2(x-(this.x+this.w2),-(y-this.y-this.w2))-this.angleOffset,this.angleArc!=this.PI2&&0>a&&a>-.5?a=0:0>a&&(a+=this.PI2),ret=~~(.5+a*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(ret=max(min(ret,this.o.max),this.o.min)),ret},this.listen=function(){var kval,to,s=this,mw=function(e){e.preventDefault();var ori=e.originalEvent,deltaX=ori.detail||ori.wheelDeltaX,deltaY=ori.detail||ori.wheelDeltaY,v=parseInt(s.$.val())+(deltaX>0||deltaY>0?1:0>deltaX||0>deltaY?-1:0);s.cH&&s.cH(v)===!1||s.val(v)},m=1,kv={37:-1,38:1,39:1,40:-1};this.$.bind("keydown",function(e){var kc=e.keyCode;if(kval=parseInt(String.fromCharCode(kc)),isNaN(kval)&&(13!==kc&&8!==kc&&9!==kc&&189!==kc&&e.preventDefault(),$.inArray(kc,[37,38,39,40])>-1)){e.preventDefault();var v=parseInt(s.$.val())+kv[kc]*m;s.o.stopper&&(v=max(min(v,s.o.max),s.o.min)),s.change(v),s._draw(),to=window.setTimeout(function(){m*=2},30)}}).bind("keyup",function(){isNaN(kval)?to&&(window.clearTimeout(to),to=null,m=1,s.val(s.$.val())):s.$.val()>s.o.max&&s.$.val(s.o.max)||s.$.val()<s.o.min&&s.$.val(s.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",mw),this.$.bind("mousewheel DOMMouseScroll",mw)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.o.width/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2,this.lineWidth=this.xy*this.o.thickness,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var s=max(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.o.width/2+4>>0)+"px",height:(this.o.width/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.o.width/3>>0)+"px","margin-left":"-"+(3*this.o.width/4+2>>0)+"px",border:0,background:"none",font:"bold "+(this.o.width/s>>0)+"px Arial","text-align":"center",color:this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(v){this.cv=v,this.$.val(v)},this.angle=function(v){return(v-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.draw=function(){var sa,ea,c=this.g,a=this.angle(this.cv),sat=this.startAngle,eat=sat+a,r=1;c.lineWidth=this.lineWidth,this.o.cursor&&(sat=eat-this.cursorExt)&&(eat+=this.cursorExt),c.beginPath(),c.strokeStyle=this.o.bgColor,c.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,!0),c.stroke(),this.o.displayPrevious&&(ea=this.startAngle+this.angle(this.v),sa=this.startAngle,this.o.cursor&&(sa=ea-this.cursorExt)&&(ea+=this.cursorExt),c.beginPath(),c.strokeStyle=this.pColor,c.arc(this.xy,this.xy,this.radius,sa,ea,!1),c.stroke(),r=this.cv==this.v),c.beginPath(),c.strokeStyle=r?this.o.fgColor:this.fgColor,c.arc(this.xy,this.xy,this.radius,sat,eat,!1),c.stroke()},this.cancel=function(){this.val(this.v)}},$.fn.dial=$.fn.knob=function(o){return this.each(function(){var d=new k.Dial;d.o=o,d.$=$(this),d.run()}).parent()}}),function($){$.fn.extend({leanModal:function(options){function close_modal(modal_id){$("#lean_overlay").fadeOut(200),$(modal_id).css({display:"none"})}var defaults={top:100,overlay:.5,closeButton:null},overlay=$("<div id='lean_overlay'></div>");return $("body").append(overlay),options=$.extend(defaults,options),this.each(function(){var o=options;$(this).click(function(e){var modal_id=$(this).attr("href");$("#lean_overlay").click(function(){close_modal(modal_id)}),$(o.closeButton).click(function(){close_modal(modal_id)});var modal_width=($(modal_id).outerHeight(),$(modal_id).outerWidth());$("#lean_overlay").css({display:"block",opacity:0}),$("#lean_overlay").fadeTo(200,o.overlay),$(modal_id).css({display:"block",position:"fixed",opacity:0,"z-index":11e3,left:"50%","margin-left":-(modal_width/2)+"px",top:o.top+"px"}),$(modal_id).fadeTo(200,1),e.preventDefault()})})}})}(jQuery),/**
 * Timeago is a jQuery plugin that makes it easy to support automatically
 * updating fuzzy timestamps (e.g. "4 minutes ago" or "about 1 day ago").
 *
 * @name timeago
 * @version 1.1.0
 * @requires jQuery v1.2.3+
 * @author Ryan McGeary
 * @license MIT License - http://www.opensource.org/licenses/mit-license.php
 *
 * For usage and examples, visit:
 * http://timeago.yarp.com/
 *
 * Copyright (c) 2008-2013, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
 */
function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(jQuery)}(function($){function refresh(){var data=prepareData(this);return isNaN(data.datetime)||$(this).text(inWords(data.datetime)),this}function prepareData(element){if(element=$(element),!element.data("timeago")){element.data("timeago",{datetime:$t.datetime(element)});var text=$.trim(element.text());$t.settings.localeTitle?element.attr("title",element.data("timeago").datetime.toLocaleString()):!(text.length>0)||$t.isTime(element)&&element.attr("title")||element.attr("title",text)}return element.data("timeago")}function inWords(date){return $t.inWords(distance(date))}function distance(date){return(new Date).getTime()-date.getTime()}$.timeago=function(timestamp){return inWords(timestamp instanceof Date?timestamp:"string"==typeof timestamp?$.timeago.parse(timestamp):"number"==typeof timestamp?new Date(timestamp):$.timeago.datetime(timestamp))};var $t=$.timeago;$.extend($.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,localeTitle:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(distanceMillis){function substitute(stringOrFunction,number){var string=$.isFunction(stringOrFunction)?stringOrFunction(number,distanceMillis):stringOrFunction,value=$l.numbers&&$l.numbers[number]||number;return string.replace(/%d/i,value)}var $l=this.settings.strings,prefix=$l.prefixAgo,suffix=$l.suffixAgo;this.settings.allowFuture&&0>distanceMillis&&(prefix=$l.prefixFromNow,suffix=$l.suffixFromNow);var seconds=Math.abs(distanceMillis)/1e3,minutes=seconds/60,hours=minutes/60,days=hours/24,years=days/365,words=45>seconds&&substitute($l.seconds,Math.round(seconds))||90>seconds&&substitute($l.minute,1)||45>minutes&&substitute($l.minutes,Math.round(minutes))||90>minutes&&substitute($l.hour,1)||24>hours&&substitute($l.hours,Math.round(hours))||42>hours&&substitute($l.day,1)||30>days&&substitute($l.days,Math.round(days))||45>days&&substitute($l.month,1)||365>days&&substitute($l.months,Math.round(days/30))||1.5>years&&substitute($l.year,1)||substitute($l.years,Math.round(years)),separator=$l.wordSeparator||"";return void 0===$l.wordSeparator&&(separator=" "),$.trim([prefix,words,suffix].join(separator))},parse:function(iso8601){var s=$.trim(iso8601);return s=s.replace(/\.\d+/,""),s=s.replace(/-/,"/").replace(/-/,"/"),s=s.replace(/T/," ").replace(/Z/," UTC"),s=s.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(s)},datetime:function(elem){var iso8601=$(elem).attr($t.isTime(elem)?"datetime":"title");return $t.parse(iso8601)},isTime:function(elem){return"time"===$(elem).get(0).tagName.toLowerCase()}});var functions={init:function(){var refresh_el=$.proxy(refresh,this);refresh_el();var $s=$t.settings;$s.refreshMillis>0&&setInterval(refresh_el,$s.refreshMillis)},update:function(time){$(this).data("timeago",{datetime:$t.parse(time)}),refresh.apply(this)}};$.fn.timeago=function(action,options){var fn=action?functions[action]:functions.init;if(!fn)throw new Error("Unknown function name '"+action+"' for timeago");return this.each(function(){fn.call(this,options)}),this},document.createElement("abbr"),document.createElement("time")}),function(e){function O(e,t){return function(n){return j(e.call(this,n),t)}}function M(e){return function(t){return this.lang().ordinal(e.call(this,t))}}function _(){}function D(e){H(this,e)}function P(e){var t=this._data={},n=e.years||e.year||e.y||0,r=e.months||e.month||e.M||0,i=e.weeks||e.week||e.w||0,s=e.days||e.day||e.d||0,o=e.hours||e.hour||e.h||0,u=e.minutes||e.minute||e.m||0,a=e.seconds||e.second||e.s||0,f=e.milliseconds||e.millisecond||e.ms||0;this._milliseconds=f+1e3*a+6e4*u+36e5*o,this._days=s+7*i,this._months=r+12*n,t.milliseconds=f%1e3,a+=B(f/1e3),t.seconds=a%60,u+=B(a/60),t.minutes=u%60,o+=B(u/60),t.hours=o%24,s+=B(o/24),s+=7*i,t.days=s%30,r+=B(s/30),t.months=r%12,n+=B(r/12),t.years=n}function H(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function B(e){return 0>e?Math.ceil(e):Math.floor(e)}function j(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n}function F(e,t,n){var o,r=t._milliseconds,i=t._days,s=t._months;r&&e._d.setTime(+e+r*n),i&&e.date(e.date()+i*n),s&&(o=e.date(),e.date(1).month(e.month()+s*n).date(Math.min(o,e.daysInMonth())))}function I(e){return"[object Array]"===Object.prototype.toString.call(e)}function q(e,t){var s,n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0;for(s=0;n>s;s++)~~e[s]!==~~t[s]&&i++;return i+r}function R(e,t){return t.abbr=e,s[e]||(s[e]=new _),s[e].set(t),s[e]}function U(e){return e?(!s[e]&&o&&require("./lang/"+e),s[e]):t.fn._lang}function z(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function W(e){var n,r,t=e.match(a);for(n=0,r=t.length;r>n;n++)t[n]=A[t[n]]?A[t[n]]:z(t[n]);return function(i){var s="";for(n=0;r>n;n++)s+="function"==typeof t[n].call?t[n].call(i,e):t[n];return s}}function X(e,t){function r(t){return e.lang().longDateFormat(t)||t}for(var n=5;n--&&f.test(t);)t=t.replace(f,r);return C[t]||(C[t]=W(t)),C[t](e)}function V(e){switch(e){case"DDDD":return p;case"YYYY":return d;case"YYYYY":return v;case"S":case"SS":case"SSS":case"DDD":return h;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return m;case"X":return b;case"Z":case"ZZ":return g;case"T":return y;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return c;default:return new RegExp(e.replace("\\",""))}}function $(e,t,n){var r,s=n._a;switch(e){case"M":case"MM":s[1]=null==t?0:~~t-1;break;case"MMM":case"MMMM":r=U(n._l).monthsParse(t),null!=r?s[1]=r:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=t&&(s[2]=~~t);break;case"YY":s[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":s[0]=~~t;break;case"a":case"A":n._isPm="pm"===(t+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":s[3]=~~t;break;case"m":case"mm":s[4]=~~t;break;case"s":case"ss":s[5]=~~t;break;case"S":case"SS":case"SSS":s[6]=~~(1e3*("0."+t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,r=(t+"").match(x),r&&r[1]&&(n._tzh=~~r[1]),r&&r[2]&&(n._tzm=~~r[2]),r&&"+"===r[0]&&(n._tzh=-n._tzh,n._tzm=-n._tzm)}null==t&&(n._isValid=!1)}function J(e){var t,n,r=[];if(!e._d){for(t=0;7>t;t++)e._a[t]=r[t]=null==e._a[t]?2===t?1:0:e._a[t];r[3]+=e._tzh||0,r[4]+=e._tzm||0,n=new Date(0),e._useUTC?(n.setUTCFullYear(r[0],r[1],r[2]),n.setUTCHours(r[3],r[4],r[5],r[6])):(n.setFullYear(r[0],r[1],r[2]),n.setHours(r[3],r[4],r[5],r[6])),e._d=n}}function K(e){var r,i,t=e._f.match(a),n=e._i;for(e._a=[],r=0;r<t.length;r++)i=(V(t[r]).exec(n)||[])[0],i&&(n=n.slice(n.indexOf(i)+i.length)),A[t[r]]&&$(t[r],i,e);e._isPm&&e._a[3]<12&&(e._a[3]+=12),e._isPm===!1&&12===e._a[3]&&(e._a[3]=0),J(e)}function Q(e){for(var t,n,r,u,i=99;e._f.length;){if(t=H({},e),t._f=e._f.pop(),K(t),n=new D(t),n.isValid()){r=n;break}u=q(t._a,n.toArray()),i>u&&(i=u,r=n)}H(e,r)}function G(e){var t,n=e._i;if(w.exec(n)){for(e._f="YYYY-MM-DDT",t=0;4>t;t++)if(S[t][1].exec(n)){e._f+=S[t][0];break}g.exec(n)&&(e._f+=" Z"),K(e)}else e._d=new Date(n)}function Y(t){var n=t._i,r=u.exec(n);n===e?t._d=new Date:r?t._d=new Date(+r[1]):"string"==typeof n?G(t):I(n)?(t._a=n.slice(0),J(t)):t._d=new Date(n instanceof Date?+n:n)}function Z(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function et(e,t,n){var i=r(Math.abs(e)/1e3),s=r(i/60),o=r(s/60),u=r(o/24),a=r(u/365),f=45>i&&["s",i]||1===s&&["m"]||45>s&&["mm",s]||1===o&&["h"]||22>o&&["hh",o]||1===u&&["d"]||25>=u&&["dd",u]||45>=u&&["M"]||345>u&&["MM",r(u/30)]||1===a&&["y"]||["yy",a];return f[2]=t,f[3]=e>0,f[4]=n,Z.apply({},f)}function tt(e,n,r){var i=r-n,s=r-e.day();return s>i&&(s-=7),i-7>s&&(s+=7),Math.ceil(t(e).add("d",s).dayOfYear()/7)}function nt(e){var n=e._i,r=e._f;return null===n||""===n?null:("string"==typeof n&&(e._i=n=U().preparse(n)),t.isMoment(n)?(e=H({},n),e._d=new Date(+n._d)):r?I(r)?Q(e):K(e):Y(e),new D(e))}function rt(e,n){t.fn[e]=t.fn[e+"s"]=function(e){var t=this._isUTC?"UTC":"";return null!=e?(this._d["set"+t+n](e),this):this._d["get"+t+n]()}}function it(e){t.duration.fn[e]=function(){return this._data[e]}}function st(e,n){t.duration.fn["as"+e]=function(){return+this/n}}for(var t,i,n="2.0.0",r=Math.round,s={},o="undefined"!=typeof module&&module.exports,u=/^\/?Date\((\-?\d+)/i,a=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,f=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,c=/\d\d?/,h=/\d{1,3}/,p=/\d{3}/,d=/\d{1,4}/,v=/[+\-]?\d{1,6}/,m=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,g=/Z|[\+\-]\d\d:?\d\d/i,y=/T/i,b=/[\+\-]?\d+(\.\d{1,3})?/,w=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,E="YYYY-MM-DDTHH:mm:ssZ",S=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],x=/([\+\-]|\d\d)/gi,T="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),N={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},C={},k="DDD w W M D d".split(" "),L="M D H h m s w W".split(" "),A={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return j(this.year()%100,2)},YYYY:function(){return j(this.year(),4)},YYYYY:function(){return j(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return j(~~(this.milliseconds()/10),2)},SSS:function(){return j(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+j(~~(e/60),2)+":"+j(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+j(~~(10*e/6),4)},X:function(){return this.unix()}};k.length;)i=k.pop(),A[i+"o"]=M(A[i]);for(;L.length;)i=L.pop(),A[i+i]=O(A[i],2);for(A.DDDD=O(A.DDD,3),_.prototype={set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var n,r,i;for(this._monthsParse||(this._monthsParse=[]),n=0;12>n;n++)if(this._monthsParse[n]||(r=t([2e3,n]),i="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[n]=new RegExp(i.replace(".",""),"i")),this._monthsParse[n].test(e))return n},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return"function"==typeof n?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return"function"==typeof i?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return tt(e,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},t=function(e,t,n){return nt({_i:e,_f:t,_l:n,_isUTC:!1})},t.utc=function(e,t,n){return nt({_useUTC:!0,_isUTC:!0,_l:n,_i:e,_f:t})},t.unix=function(e){return t(1e3*e)},t.duration=function(e,n){var o,r=t.isDuration(e),i="number"==typeof e,s=r?e._data:i?{}:e;return i&&(n?s[n]=e:s.milliseconds=e),o=new P(s),r&&e.hasOwnProperty("_lang")&&(o._lang=e._lang),o},t.version=n,t.defaultFormat=E,t.lang=function(e,n){return e?(n?R(e,n):s[e]||U(e),void(t.duration.fn._lang=t.fn._lang=U(e))):t.fn._lang._abbr},t.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),U(e)},t.isMoment=function(e){return e instanceof D},t.isDuration=function(e){return e instanceof P},t.fn=D.prototype={clone:function(){return t(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return t.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!q(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){var n=X(this,e||t.defaultFormat);return this.lang().postformat(n)},add:function(e,n){var r;return r="string"==typeof e?t.duration(+n,e):t.duration(e,n),F(this,r,1),this},subtract:function(e,n){var r;return r="string"==typeof e?t.duration(+n,e):t.duration(e,n),F(this,r,-1),this},diff:function(e,n,r){var o,u,i=this._isUTC?t(e).utc():t(e).local(),s=6e4*(this.zone()-i.zone());return n&&(n=n.replace(/s$/,"")),"year"===n||"month"===n?(o=432e5*(this.daysInMonth()+i.daysInMonth()),u=12*(this.year()-i.year())+(this.month()-i.month()),u+=(this-t(this).startOf("month")-(i-t(i).startOf("month")))/o,"year"===n&&(u/=12)):(o=this-i-s,u="second"===n?o/1e3:"minute"===n?o/6e4:"hour"===n?o/36e5:"day"===n?o/864e5:"week"===n?o/6048e5:o),r?u:B(u)},from:function(e,n){return t.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!n)},fromNow:function(e){return this.from(t(),e)},calendar:function(){var e=this.diff(t().startOf("day"),"days",!0),n=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<t([this.year()]).zone()||this.zone()<t([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==e?t:this.add({d:e-t})},startOf:function(e){switch(e=e.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.day(0),this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(e,n){return n="undefined"!=typeof n?n:"millisecond",+this.clone().startOf(n)>+t(e).startOf(n)},isBefore:function(e,n){return n="undefined"!=typeof n?n:"millisecond",+this.clone().startOf(n)<+t(e).startOf(n)},isSame:function(e,n){return n="undefined"!=typeof n?n:"millisecond",+this.clone().startOf(n)===+t(e).startOf(n)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return t.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var n=r((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return null==e?n:this.add("d",e-n)},isoWeek:function(e){var t=tt(this,1,4);return null==e?t:this.add("d",7*(e-t))},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},lang:function(t){return t===e?this._lang:(this._lang=U(t),this)}},i=0;i<T.length;i++)rt(T[i].toLowerCase().replace(/s$/,""),T[i]);rt("year","FullYear"),t.fn.days=t.fn.day,t.fn.weeks=t.fn.week,t.fn.isoWeeks=t.fn.isoWeek,t.duration.fn=P.prototype={weeks:function(){return B(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*this._months},humanize:function(e){var t=+this,n=et(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},lang:t.fn.lang};for(i in N)N.hasOwnProperty(i)&&(st(i,N[i]),it(i.toLowerCase()));st("Weeks",6048e5),t.lang("en",{ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),o&&(module.exports=t),"undefined"==typeof ender&&(this.moment=t),"function"==typeof define&&define.amd&&define("moment",[],function(){return t})}.call(this);var Rickshaw={namespace:function(namespace){for(var parts=namespace.split("."),parent=Rickshaw,i=1,length=parts.length;length>i;i++){var currentPart=parts[i];parent[currentPart]=parent[currentPart]||{},parent=parent[currentPart]}return parent},keys:function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},extend:function(destination,source){for(var property in source)destination[property]=source[property];return destination},clone:function(obj){return JSON.parse(JSON.stringify(obj))}};if("undefined"!=typeof module&&module.exports){var d3=require("d3");module.exports=Rickshaw}!function(globalContext){function isFunction(object){return _toString.call(object)===FUNCTION_CLASS}function extend(destination,source){for(var property in source)source.hasOwnProperty(property)&&(destination[property]=source[property]);return destination}function keys(object){if(Type(object)!==OBJECT_TYPE)throw new TypeError;var results=[];for(var property in object)object.hasOwnProperty(property)&&results.push(property);return results}function Type(o){switch(o){case null:return NULL_TYPE;case void 0:return UNDEFINED_TYPE}var type=typeof o;switch(type){case"boolean":return BOOLEAN_TYPE;case"number":return NUMBER_TYPE;case"string":return STRING_TYPE}return OBJECT_TYPE}function isUndefined(object){return"undefined"==typeof object}function argumentNames(fn){var names=fn.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=names.length||names[0]?names:[]}function wrap(fn,wrapper){var __method=fn;return function(){var a=update([bind(__method,this)],arguments);return wrapper.apply(this,a)}}function update(array,args){for(var arrayLength=array.length,length=args.length;length--;)array[arrayLength+length]=args[length];return array}function merge(array,args){return array=slice.call(array,0),update(array,args)}function bind(fn,context){if(arguments.length<2&&isUndefined(arguments[0]))return this;var __method=fn,args=slice.call(arguments,2);return function(){var a=merge(args,arguments);return __method.apply(context,a)}}var _toString=Object.prototype.toString,NULL_TYPE="Null",UNDEFINED_TYPE="Undefined",BOOLEAN_TYPE="Boolean",NUMBER_TYPE="Number",STRING_TYPE="String",OBJECT_TYPE="Object",FUNCTION_CLASS="[object Function]",slice=Array.prototype.slice,emptyFunction=function(){},Class=function(){function subclass(){}function create(){function klass(){this.initialize.apply(this,arguments)}var parent=null,properties=[].slice.apply(arguments);if(isFunction(properties[0])&&(parent=properties.shift()),extend(klass,Class.Methods),klass.superclass=parent,klass.subclasses=[],parent){subclass.prototype=parent.prototype,klass.prototype=new subclass;try{parent.subclasses.push(klass)}catch(e){}}for(var i=0,length=properties.length;length>i;i++)klass.addMethods(properties[i]);return klass.prototype.initialize||(klass.prototype.initialize=emptyFunction),klass.prototype.constructor=klass,klass}function addMethods(source){var ancestor=this.superclass&&this.superclass.prototype,properties=keys(source);IS_DONTENUM_BUGGY&&(source.toString!=Object.prototype.toString&&properties.push("toString"),source.valueOf!=Object.prototype.valueOf&&properties.push("valueOf"));for(var i=0,length=properties.length;length>i;i++){var property=properties[i],value=source[property];if(ancestor&&isFunction(value)&&"$super"==argumentNames(value)[0]){var method=value;value=wrap(function(m){return function(){return ancestor[m].apply(this,arguments)}}(property),method),value.valueOf=bind(method.valueOf,method),value.toString=bind(method.toString,method)}this.prototype[property]=value}return this}var IS_DONTENUM_BUGGY=function(){for(var p in{toString:1})if("toString"===p)return!1;return!0}();return{create:create,Methods:{addMethods:addMethods}}}();globalContext.exports?globalContext.exports.Class=Class:globalContext.Class=Class}(Rickshaw),Rickshaw.namespace("Rickshaw.Compat.ClassList"),Rickshaw.Compat.ClassList=function(){"undefined"==typeof document||"classList"in document.createElement("a")||!function(view){"use strict";var classListProp="classList",protoProp="prototype",elemCtrProto=(view.HTMLElement||view.Element)[protoProp],objCtr=Object,strTrim=String[protoProp].trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array[protoProp].indexOf||function(item){for(var i=0,len=this.length;len>i;i++)if(i in this&&this[i]===item)return i;return-1},DOMEx=function(type,message){this.name=type,this.code=DOMException[type],this.message=message},checkTokenAndGetIndex=function(classList,token){if(""===token)throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(token))throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");return arrIndexOf.call(classList,token)},ClassList=function(elem){for(var trimmedClasses=strTrim.call(elem.className),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0,len=classes.length;len>i;i++)this.push(classes[i]);this._updateClassName=function(){elem.className=this.toString()}},classListProto=ClassList[protoProp]=[],classListGetter=function(){return new ClassList(this)};if(DOMEx[protoProp]=Error[protoProp],classListProto.item=function(i){return this[i]||null},classListProto.contains=function(token){return token+="",-1!==checkTokenAndGetIndex(this,token)},classListProto.add=function(token){token+="",-1===checkTokenAndGetIndex(this,token)&&(this.push(token),this._updateClassName())},classListProto.remove=function(token){token+="";var index=checkTokenAndGetIndex(this,token);-1!==index&&(this.splice(index,1),this._updateClassName())},classListProto.toggle=function(token){token+="",-1===checkTokenAndGetIndex(this,token)?this.add(token):this.remove(token)},classListProto.toString=function(){return this.join(" ")},objCtr.defineProperty){var classListPropDesc={get:classListGetter,enumerable:!0,configurable:!0};try{objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}catch(ex){-2146823252===ex.number&&(classListPropDesc.enumerable=!1,objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc))}}else objCtr[protoProp].__defineGetter__&&elemCtrProto.__defineGetter__(classListProp,classListGetter)}(window)},("undefined"!=typeof RICKSHAW_NO_COMPAT&&!RICKSHAW_NO_COMPAT||"undefined"==typeof RICKSHAW_NO_COMPAT)&&new Rickshaw.Compat.ClassList,Rickshaw.namespace("Rickshaw.Graph"),Rickshaw.Graph=function(args){if(!args.element)throw"Rickshaw.Graph needs a reference to an element";this.element=args.element,this.series=args.series,this.defaults={interpolation:"cardinal",offset:"zero",min:void 0,max:void 0,preserve:!1},Rickshaw.keys(this.defaults).forEach(function(k){this[k]=args[k]||this.defaults[k]},this),this.window={},this.updateCallbacks=[];var self=this;this.initialize=function(args){this.validateSeries(args.series),this.series.active=function(){return self.series.filter(function(s){return!s.disabled})},this.setSize({width:args.width,height:args.height}),this.element.classList.add("rickshaw_graph"),this.vis=d3.select(this.element).append("svg:svg").attr("width",this.width).attr("height",this.height);for(var name in Rickshaw.Graph.Renderer)if(name&&Rickshaw.Graph.Renderer.hasOwnProperty(name)){var r=Rickshaw.Graph.Renderer[name];r&&r.prototype&&r.prototype.render&&self.registerRenderer(new r({graph:self}))}this.setRenderer(args.renderer||"stack",args),this.discoverRange()},this.validateSeries=function(series){if(!(Array.isArray(series)||series instanceof Rickshaw.Series)){var seriesSignature=Object.prototype.toString.apply(series);throw"series is not an array: "+seriesSignature}series.forEach(function(s){if(!(s instanceof Object))throw"series element is not an object: "+s;if(!s.data)throw"series has no data: "+JSON.stringify(s);if(!Array.isArray(s.data))throw"series data is not an array: "+JSON.stringify(s.data);var x=s.data[0].x,y=s.data[0].y;if("number"!=typeof x||"number"!=typeof y&&null!==y)throw"x and y properties of points should be numbers instead of "+typeof x+" and "+typeof y;if(s.data.length>=3&&(s.data[2].x<s.data[1].x||s.data[1].x<s.data[0].x||s.data[s.data.length-1].x<s.data[0].x))throw"series data needs to be sorted on x values for series name: "+s.name},this)},this.dataDomain=function(){var data=this.series.map(function(s){return s.data}),min=d3.min(data.map(function(d){return d[0].x})),max=d3.max(data.map(function(d){return d[d.length-1].x}));return[min,max]},this.discoverRange=function(){var domain=this.renderer.domain();this.x=d3.scale.linear().domain(domain.x).range([0,this.width]),this.y=d3.scale.linear().domain(domain.y).range([this.height,0]),this.y.magnitude=d3.scale.linear().domain([domain.y[0]-domain.y[0],domain.y[1]-domain.y[0]]).range([0,this.height])},this.render=function(){this.stackData();this.discoverRange(),this.renderer.render(),this.updateCallbacks.forEach(function(callback){callback()})},this.update=this.render,this.stackData=function(){var data=this.series.active().map(function(d){return d.data}).map(function(d){return d.filter(function(d){return this._slice(d)},this)},this),preserve=this.preserve;preserve||this.series.forEach(function(series){series.scale&&(preserve=!0)}),data=preserve?Rickshaw.clone(data):data,this.series.active().forEach(function(series,index){if(series.scale){var seriesData=data[index];seriesData&&seriesData.forEach(function(d){d.y=series.scale(d.y)})}}),this.stackData.hooks.data.forEach(function(entry){data=entry.f.apply(self,[data])});var stackedData;if(!this.renderer.unstack){this._validateStackable();var layout=d3.layout.stack();layout.offset(self.offset),stackedData=layout(data)}stackedData=stackedData||data,this.stackData.hooks.after.forEach(function(entry){stackedData=entry.f.apply(self,[data])});var i=0;return this.series.forEach(function(series){series.disabled||(series.stack=stackedData[i++])}),this.stackedData=stackedData,stackedData},this._validateStackable=function(){var pointsCount,series=this.series;series.forEach(function(s){if(pointsCount=pointsCount||s.data.length,pointsCount&&s.data.length!=pointsCount)throw"stacked series cannot have differing numbers of points: "+pointsCount+" vs "+s.data.length+"; see Rickshaw.Series.fill()"},this)},this.stackData.hooks={data:[],after:[]},this._slice=function(d){if(this.window.xMin||this.window.xMax){var isInRange=!0;return this.window.xMin&&d.x<this.window.xMin&&(isInRange=!1),this.window.xMax&&d.x>this.window.xMax&&(isInRange=!1),isInRange}return!0},this.onUpdate=function(callback){this.updateCallbacks.push(callback)},this.registerRenderer=function(renderer){this._renderers=this._renderers||{},this._renderers[renderer.name]=renderer},this.configure=function(args){(args.width||args.height)&&this.setSize(args),Rickshaw.keys(this.defaults).forEach(function(k){this[k]=k in args?args[k]:k in this?this[k]:this.defaults[k]},this),this.setRenderer(args.renderer||this.renderer.name,args)},this.setRenderer=function(r,args){if("function"==typeof r)this.renderer=new r({graph:self}),this.registerRenderer(this.renderer);else{if(!this._renderers[r])throw"couldn't find renderer "+r;this.renderer=this._renderers[r]}"object"==typeof args&&this.renderer.configure(args)},this.setSize=function(args){if(args=args||{},void 0!==typeof window)var style=window.getComputedStyle(this.element,null),elementWidth=parseInt(style.getPropertyValue("width"),10),elementHeight=parseInt(style.getPropertyValue("height"),10);this.width=args.width||elementWidth||400,this.height=args.height||elementHeight||250,this.vis&&this.vis.attr("width",this.width).attr("height",this.height)},this.initialize(args)},Rickshaw.namespace("Rickshaw.Fixtures.Color"),Rickshaw.Fixtures.Color=function(){this.schemes={},this.schemes.spectrum14=["#ecb796","#dc8f70","#b2a470","#92875a","#716c49","#d2ed82","#bbe468","#a1d05d","#e7cbe6","#d8aad6","#a888c2","#9dc2d3","#649eb9","#387aa3"].reverse(),this.schemes.spectrum2000=["#57306f","#514c76","#646583","#738394","#6b9c7d","#84b665","#a7ca50","#bfe746","#e2f528","#fff726","#ecdd00","#d4b11d","#de8800","#de4800","#c91515","#9a0000","#7b0429","#580839","#31082b"],this.schemes.spectrum2001=["#2f243f","#3c2c55","#4a3768","#565270","#6b6b7c","#72957f","#86ad6e","#a1bc5e","#b8d954","#d3e04e","#ccad2a","#cc8412","#c1521d","#ad3821","#8a1010","#681717","#531e1e","#3d1818","#320a1b"],this.schemes.classic9=["#423d4f","#4a6860","#848f39","#a2b73c","#ddcb53","#c5a32f","#7d5836","#963b20","#7c2626","#491d37","#2f254a"].reverse(),this.schemes.httpStatus={503:"#ea5029",502:"#d23f14",500:"#bf3613",410:"#efacea",409:"#e291dc",403:"#f457e8",408:"#e121d2",401:"#b92dae",405:"#f47ceb",404:"#a82a9f",400:"#b263c6",301:"#6fa024",302:"#87c32b",307:"#a0d84c",304:"#28b55c",200:"#1a4f74",206:"#27839f",201:"#52adc9",202:"#7c979f",203:"#a5b8bd",204:"#c1cdd1"},this.schemes.colorwheel=["#b5b6a9","#858772","#785f43","#96557e","#4682b4","#65b9ac","#73c03a","#cb513a"].reverse(),this.schemes.cool=["#5e9d2f","#73c03a","#4682b4","#7bc3b8","#a9884e","#c1b266","#a47493","#c09fb5"],this.schemes.munin=["#00cc00","#0066b3","#ff8000","#ffcc00","#330099","#990099","#ccff00","#ff0000","#808080","#008f00","#00487d","#b35a00","#b38f00","#6b006b","#8fb300","#b30000","#bebebe","#80ff80","#80c9ff","#ffc080","#ffe680","#aa80ff","#ee00cc","#ff8080","#666600","#ffbfff","#00ffcc","#cc6699","#999900"]},Rickshaw.namespace("Rickshaw.Fixtures.RandomData"),Rickshaw.Fixtures.RandomData=function(timeInterval){timeInterval=timeInterval||1;var lastRandomValue=200,timeBase=Math.floor((new Date).getTime()/1e3);this.addData=function(data){var randomValue=100*Math.random()+15+lastRandomValue,index=data[0].length,counter=1;data.forEach(function(series){var randomVariance=20*Math.random(),v=randomValue/25+counter++ +15*(Math.cos(index*counter*11/960)+2)+7*(Math.cos(index/7)+2)+1*(Math.cos(index/17)+2);series.push({x:index*timeInterval+timeBase,y:v+randomVariance})}),lastRandomValue=.85*randomValue},this.removeData=function(data){data.forEach(function(series){series.shift()}),timeBase+=timeInterval}},Rickshaw.namespace("Rickshaw.Fixtures.Time"),Rickshaw.Fixtures.Time=function(){var self=(60*(new Date).getTimezoneOffset(),this);this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.units=[{name:"decade",seconds:315576e3,formatter:function(d){return 10*parseInt(d.getUTCFullYear()/10,10)}},{name:"year",seconds:31557600,formatter:function(d){return d.getUTCFullYear()}},{name:"month",seconds:2635200,formatter:function(d){return self.months[d.getUTCMonth()]}},{name:"week",seconds:604800,formatter:function(d){return self.formatDate(d)}},{name:"day",seconds:86400,formatter:function(d){return d.getUTCDate()}},{name:"6 hour",seconds:21600,formatter:function(d){return self.formatTime(d)}},{name:"hour",seconds:3600,formatter:function(d){return self.formatTime(d)}},{name:"15 minute",seconds:900,formatter:function(d){return self.formatTime(d)
}},{name:"minute",seconds:60,formatter:function(d){return d.getUTCMinutes()}},{name:"15 second",seconds:15,formatter:function(d){return d.getUTCSeconds()+"s"}},{name:"second",seconds:1,formatter:function(d){return d.getUTCSeconds()+"s"}}],this.unit=function(unitName){return this.units.filter(function(unit){return unitName==unit.name}).shift()},this.formatDate=function(d){return d3.time.format("%b %e")(d)},this.formatTime=function(d){return d.toUTCString().match(/(\d+:\d+):/)[1]},this.ceil=function(time,unit){var nearFuture,rounded;return"month"==unit.name?(nearFuture=new Date(1e3*(time+unit.seconds-1)),rounded=new Date(0),rounded.setUTCFullYear(nearFuture.getUTCFullYear()),rounded.setUTCMonth(nearFuture.getUTCMonth()),rounded.setUTCDate(1),rounded.setUTCHours(0),rounded.setUTCMinutes(0),rounded.setUTCSeconds(0),rounded.setUTCMilliseconds(0),rounded.getTime()/1e3):"year"==unit.name?(nearFuture=new Date(1e3*(time+unit.seconds-1)),rounded=new Date(0),rounded.setUTCFullYear(nearFuture.getUTCFullYear()),rounded.setUTCMonth(0),rounded.setUTCDate(1),rounded.setUTCHours(0),rounded.setUTCMinutes(0),rounded.setUTCSeconds(0),rounded.setUTCMilliseconds(0),rounded.getTime()/1e3):Math.ceil(time/unit.seconds)*unit.seconds}},Rickshaw.namespace("Rickshaw.Fixtures.Time.Local"),Rickshaw.Fixtures.Time.Local=function(){var self=(60*(new Date).getTimezoneOffset(),this);this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.units=[{name:"decade",seconds:315576e3,formatter:function(d){return 10*parseInt(d.getFullYear()/10,10)}},{name:"year",seconds:31557600,formatter:function(d){return d.getFullYear()}},{name:"month",seconds:2635200,formatter:function(d){return self.months[d.getMonth()]}},{name:"week",seconds:604800,formatter:function(d){return self.formatDate(d)}},{name:"day",seconds:86400,formatter:function(d){return d.getDate()}},{name:"6 hour",seconds:21600,formatter:function(d){return self.formatTime(d)}},{name:"hour",seconds:3600,formatter:function(d){return self.formatTime(d)}},{name:"15 minute",seconds:900,formatter:function(d){return self.formatTime(d)}},{name:"minute",seconds:60,formatter:function(d){return d.getMinutes()}},{name:"15 second",seconds:15,formatter:function(d){return d.getSeconds()+"s"}},{name:"second",seconds:1,formatter:function(d){return d.getSeconds()+"s"}}],this.unit=function(unitName){return this.units.filter(function(unit){return unitName==unit.name}).shift()},this.formatDate=function(d){return d3.time.format("%b %e")(d)},this.formatTime=function(d){return d.toString().match(/(\d+:\d+):/)[1]},this.ceil=function(time,unit){var nearFuture,rounded;return"day"==unit.name?(nearFuture=new Date(1e3*(time+unit.seconds-1)),rounded=new Date(0),rounded.setMilliseconds(0),rounded.setSeconds(0),rounded.setMinutes(0),rounded.setHours(0),rounded.setDate(nearFuture.getDate()),rounded.setMonth(nearFuture.getMonth()),rounded.setFullYear(nearFuture.getFullYear()),rounded.getTime()/1e3):"month"==unit.name?(nearFuture=new Date(1e3*(time+unit.seconds-1)),rounded=new Date(0),rounded.setMilliseconds(0),rounded.setSeconds(0),rounded.setMinutes(0),rounded.setHours(0),rounded.setDate(1),rounded.setMonth(nearFuture.getMonth()),rounded.setFullYear(nearFuture.getFullYear()),rounded.getTime()/1e3):"year"==unit.name?(nearFuture=new Date(1e3*(time+unit.seconds-1)),rounded=new Date(0),rounded.setFullYear(nearFuture.getFullYear()),rounded.setMilliseconds(0),rounded.setSeconds(0),rounded.setMinutes(0),rounded.setHours(0),rounded.setDate(1),rounded.setMonth(0),rounded.getTime()/1e3):Math.ceil(time/unit.seconds)*unit.seconds}},Rickshaw.namespace("Rickshaw.Fixtures.Number"),Rickshaw.Fixtures.Number.formatKMBT=function(y){var abs_y=Math.abs(y);return abs_y>=1e12?y/1e12+"T":abs_y>=1e9?y/1e9+"B":abs_y>=1e6?y/1e6+"M":abs_y>=1e3?y/1e3+"K":1>abs_y&&y>0?y.toFixed(2):0===abs_y?"":y},Rickshaw.Fixtures.Number.formatBase1024KMGTP=function(y){var abs_y=Math.abs(y);return abs_y>=0x4000000000000?y/0x4000000000000+"P":abs_y>=1099511627776?y/1099511627776+"T":abs_y>=1073741824?y/1073741824+"G":abs_y>=1048576?y/1048576+"M":abs_y>=1024?y/1024+"K":1>abs_y&&y>0?y.toFixed(2):0===abs_y?"":y},Rickshaw.namespace("Rickshaw.Color.Palette"),Rickshaw.Color.Palette=function(args){var color=new Rickshaw.Fixtures.Color;if(args=args||{},this.schemes={},this.scheme=color.schemes[args.scheme]||args.scheme||color.schemes.colorwheel,this.runningIndex=0,this.generatorIndex=0,args.interpolatedStopCount){var i,j,schemeCount=this.scheme.length-1,scheme=[];for(i=0;schemeCount>i;i++){scheme.push(this.scheme[i]);var generator=d3.interpolateHsl(this.scheme[i],this.scheme[i+1]);for(j=1;j<args.interpolatedStopCount;j++)scheme.push(generator(1/args.interpolatedStopCount*j))}scheme.push(this.scheme[this.scheme.length-1]),this.scheme=scheme}this.rotateCount=this.scheme.length,this.color=function(key){return this.scheme[key]||this.scheme[this.runningIndex++]||this.interpolateColor()||"#808080"},this.interpolateColor=function(){if(Array.isArray(this.scheme)){var color;return this.generatorIndex==2*this.rotateCount-1?(color=d3.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[0])(.5),this.generatorIndex=0,this.rotateCount*=2):(color=d3.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[this.generatorIndex+1])(.5),this.generatorIndex++),this.scheme.push(color),color}}},Rickshaw.namespace("Rickshaw.Graph.Ajax"),Rickshaw.Graph.Ajax=Rickshaw.Class.create({initialize:function(args){this.dataURL=args.dataURL,this.onData=args.onData||function(d){return d},this.onComplete=args.onComplete||function(){},this.onError=args.onError||function(){},this.args=args,this.request()},request:function(){$.ajax({url:this.dataURL,dataType:"json",success:this.success.bind(this),error:this.error.bind(this)})},error:function(){console.log("error loading dataURL: "+this.dataURL),this.onError(this)},success:function(data){data=this.onData(data),this.args.series=this._splice({data:data,series:this.args.series}),this.graph=this.graph||new Rickshaw.Graph(this.args),this.graph.render(),this.onComplete(this)},_splice:function(args){var data=args.data,series=args.series;return args.series?(series.forEach(function(s){var seriesKey=s.key||s.name;if(!seriesKey)throw"series needs a key or a name";data.forEach(function(d){var dataKey=d.key||d.name;if(!dataKey)throw"data needs a key or a name";if(seriesKey==dataKey){var properties=["color","name","data"];properties.forEach(function(p){d[p]&&(s[p]=d[p])})}})}),series):data}}),Rickshaw.namespace("Rickshaw.Graph.Annotate"),Rickshaw.Graph.Annotate=function(args){this.graph=args.graph;this.elements={timeline:args.element};var self=this;this.data={},this.elements.timeline.classList.add("rickshaw_annotation_timeline"),this.add=function(time,content,end_time){self.data[time]=self.data[time]||{boxes:[]},self.data[time].boxes.push({content:content,end:end_time})},this.update=function(){Rickshaw.keys(self.data).forEach(function(time){var annotation=self.data[time],left=self.graph.x(time);if(0>left||left>self.graph.x.range()[1])return annotation.element&&(annotation.line.classList.add("offscreen"),annotation.element.style.display="none"),void annotation.boxes.forEach(function(box){box.rangeElement&&box.rangeElement.classList.add("offscreen")});if(!annotation.element){var element=annotation.element=document.createElement("div");element.classList.add("annotation"),this.elements.timeline.appendChild(element),element.addEventListener("click",function(){element.classList.toggle("active"),annotation.line.classList.toggle("active"),annotation.boxes.forEach(function(box){box.rangeElement&&box.rangeElement.classList.toggle("active")})},!1)}annotation.element.style.left=left+"px",annotation.element.style.display="block",annotation.boxes.forEach(function(box){var element=box.element;if(element||(element=box.element=document.createElement("div"),element.classList.add("content"),element.innerHTML=box.content,annotation.element.appendChild(element),annotation.line=document.createElement("div"),annotation.line.classList.add("annotation_line"),self.graph.element.appendChild(annotation.line),box.end&&(box.rangeElement=document.createElement("div"),box.rangeElement.classList.add("annotation_range"),self.graph.element.appendChild(box.rangeElement))),box.end){var annotationRangeStart=left,annotationRangeEnd=Math.min(self.graph.x(box.end),self.graph.x.range()[1]);annotationRangeStart>annotationRangeEnd&&(annotationRangeEnd=left,annotationRangeStart=Math.max(self.graph.x(box.end),self.graph.x.range()[0]));var annotationRangeWidth=annotationRangeEnd-annotationRangeStart;box.rangeElement.style.left=annotationRangeStart+"px",box.rangeElement.style.width=annotationRangeWidth+"px",box.rangeElement.classList.remove("offscreen")}annotation.line.classList.remove("offscreen"),annotation.line.style.left=left+"px"})},this)},this.graph.onUpdate(function(){self.update()})},Rickshaw.namespace("Rickshaw.Graph.Axis.Time"),Rickshaw.Graph.Axis.Time=function(args){var self=this;this.graph=args.graph,this.elements=[],this.ticksTreatment=args.ticksTreatment||"plain",this.fixedTimeUnit=args.timeUnit;var time=args.timeFixture||new Rickshaw.Fixtures.Time;this.appropriateTimeUnit=function(){var unit,units=time.units,domain=this.graph.x.domain(),rangeSeconds=domain[1]-domain[0];return units.forEach(function(u){Math.floor(rangeSeconds/u.seconds)>=2&&(unit=unit||u)}),unit||time.units[time.units.length-1]},this.tickOffsets=function(){for(var domain=this.graph.x.domain(),unit=this.fixedTimeUnit||this.appropriateTimeUnit(),count=Math.ceil((domain[1]-domain[0])/unit.seconds),runningTick=domain[0],offsets=[],i=0;count>i;i++){var tickValue=time.ceil(runningTick,unit);runningTick=tickValue+unit.seconds/2,offsets.push({value:tickValue,unit:unit})}return offsets},this.render=function(){this.elements.forEach(function(e){e.parentNode.removeChild(e)}),this.elements=[];var offsets=this.tickOffsets();offsets.forEach(function(o){if(!(self.graph.x(o.value)>self.graph.x.range()[1])){var element=document.createElement("div");element.style.left=self.graph.x(o.value)+"px",element.classList.add("x_tick"),element.classList.add(self.ticksTreatment);var title=document.createElement("div");title.classList.add("title"),title.innerHTML=o.unit.formatter(new Date(1e3*o.value)),element.appendChild(title),self.graph.element.appendChild(element),self.elements.push(element)}})},this.graph.onUpdate(function(){self.render()})},Rickshaw.namespace("Rickshaw.Graph.Axis.X"),Rickshaw.Graph.Axis.X=function(args){var self=this,berthRate=.1;this.initialize=function(args){this.graph=args.graph,this.orientation=args.orientation||"top",this.pixelsPerTick=args.pixelsPerTick||75,args.ticks&&(this.staticTicks=args.ticks),args.tickValues&&(this.tickValues=args.tickValues),this.tickSize=args.tickSize||4,this.ticksTreatment=args.ticksTreatment||"plain",args.element?(this.element=args.element,this._discoverSize(args.element,args),this.vis=d3.select(args.element).append("svg:svg").attr("height",this.height).attr("width",this.width).attr("class","rickshaw_graph x_axis_d3"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:args.width,height:args.height})):this.vis=this.graph.vis,this.graph.onUpdate(function(){self.render()})},this.setSize=function(args){if(args=args||{},this.element){this._discoverSize(this.element.parentNode,args),this.vis.attr("height",this.height).attr("width",this.width*(1+berthRate));var berth=Math.floor(this.width*berthRate/2);this.element.style.left=-1*berth+"px"}},this.render=function(){this.graph.width!==this._renderWidth&&this.setSize({auto:!0});var axis=d3.svg.axis().scale(this.graph.x).orient(this.orientation);axis.tickFormat(args.tickFormat||function(x){return x}),this.tickValues&&axis.tickValues(this.tickValues),this.ticks=this.staticTicks||Math.floor(this.graph.width/this.pixelsPerTick);var transform,berth=Math.floor(this.width*berthRate/2)||0;if("top"==this.orientation){var yOffset=this.height||this.graph.height;transform="translate("+berth+","+yOffset+")"}else transform="translate("+berth+", 0)";this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["x_ticks_d3",this.ticksTreatment].join(" ")).attr("transform",transform).call(axis.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));var gridSize=("bottom"==this.orientation?1:-1)*this.graph.height;this.graph.vis.append("svg:g").attr("class","x_grid_d3").call(axis.ticks(this.ticks).tickSubdivide(0).tickSize(gridSize)),this._renderHeight=this.graph.height},this._discoverSize=function(element,args){if("undefined"!=typeof window){var style=window.getComputedStyle(element,null),elementHeight=parseInt(style.getPropertyValue("height"),10);if(!args.auto)var elementWidth=parseInt(style.getPropertyValue("width"),10)}this.width=(args.width||elementWidth||this.graph.width)*(1+berthRate),this.height=args.height||elementHeight||40},this.initialize(args)},Rickshaw.namespace("Rickshaw.Graph.Axis.Y"),Rickshaw.Graph.Axis.Y=Rickshaw.Class.create({initialize:function(args){this.graph=args.graph,this.orientation=args.orientation||"right",this.pixelsPerTick=args.pixelsPerTick||75,args.ticks&&(this.staticTicks=args.ticks),args.tickValues&&(this.tickValues=args.tickValues),this.tickSize=args.tickSize||4,this.ticksTreatment=args.ticksTreatment||"plain",this.tickFormat=args.tickFormat||function(y){return y},this.berthRate=.1,args.element?(this.element=args.element,this.vis=d3.select(args.element).append("svg:svg").attr("class","rickshaw_graph y_axis"),this.element=this.vis[0][0],this.element.style.position="relative",this.setSize({width:args.width,height:args.height})):this.vis=this.graph.vis;var self=this;this.graph.onUpdate(function(){self.render()})},setSize:function(args){if(args=args||{},this.element){if("undefined"!=typeof window){var style=window.getComputedStyle(this.element.parentNode,null),elementWidth=parseInt(style.getPropertyValue("width"),10);if(!args.auto)var elementHeight=parseInt(style.getPropertyValue("height"),10)}this.width=args.width||elementWidth||this.graph.width*this.berthRate,this.height=args.height||elementHeight||this.graph.height,this.vis.attr("width",this.width).attr("height",this.height*(1+this.berthRate));var berth=this.height*this.berthRate;"left"==this.orientation&&(this.element.style.top=-1*berth+"px")}},render:function(){this.graph.height!==this._renderHeight&&this.setSize({auto:!0}),this.ticks=this.staticTicks||Math.floor(this.graph.height/this.pixelsPerTick);var axis=this._drawAxis(this.graph.y);this._drawGrid(axis),this._renderHeight=this.graph.height},_drawAxis:function(scale){var axis=d3.svg.axis().scale(scale).orient(this.orientation);if(axis.tickFormat(this.tickFormat),this.tickValues&&axis.tickValues(this.tickValues),"left"==this.orientation)var berth=this.height*this.berthRate,transform="translate("+this.width+", "+berth+")";return this.element&&this.vis.selectAll("*").remove(),this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",transform).call(axis.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize)),axis},_drawGrid:function(axis){var gridSize=("right"==this.orientation?1:-1)*this.graph.width;this.graph.vis.append("svg:g").attr("class","y_grid").call(axis.ticks(this.ticks).tickSubdivide(0).tickSize(gridSize))}}),Rickshaw.namespace("Rickshaw.Graph.Axis.Y.Scaled"),Rickshaw.Graph.Axis.Y.Scaled=Rickshaw.Class.create(Rickshaw.Graph.Axis.Y,{initialize:function($super,args){if("undefined"==typeof args.scale)throw new Error("Scaled requires scale");this.scale=args.scale,this.grid="undefined"==typeof args.grid?!0:args.grid,$super(args)},_drawAxis:function($super,scale){var adjustedScale=this.scale.copy().range(scale.range());return $super(adjustedScale)},_drawGrid:function($super,axis){this.grid&&$super(axis)}}),Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Highlight"),Rickshaw.Graph.Behavior.Series.Highlight=function(args){this.graph=args.graph,this.legend=args.legend;var self=this,colorSafe={},activeLine=null,disabledColor=args.disabledColor||function(seriesColor){return d3.interpolateRgb(seriesColor,d3.rgb("#d8d8d8"))(.8).toString()};this.addHighlightEvents=function(l){l.element.addEventListener("mouseover",function(){activeLine||(activeLine=l,self.legend.lines.forEach(function(line,index){if(l!==line)colorSafe[line.series.name]=colorSafe[line.series.name]||line.series.color,line.series.color=disabledColor(line.series.color);else if(index>0&&self.graph.renderer.unstack&&(line.series.renderer?line.series.renderer.unstack:!0)){var seriesIndex=self.graph.series.length-index-1;line.originalIndex=seriesIndex;var series=self.graph.series.splice(seriesIndex,1)[0];self.graph.series.push(series)}}),self.graph.update())},!1),l.element.addEventListener("mouseout",function(){activeLine&&(activeLine=null,self.legend.lines.forEach(function(line){if(l===line&&line.hasOwnProperty("originalIndex")){var series=self.graph.series.pop();self.graph.series.splice(line.originalIndex,0,series),delete line.originalIndex}colorSafe[line.series.name]&&(line.series.color=colorSafe[line.series.name])}),self.graph.update())},!1)},this.legend&&this.legend.lines.forEach(function(l){self.addHighlightEvents(l)})},Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Order"),Rickshaw.Graph.Behavior.Series.Order=function(args){this.graph=args.graph,this.legend=args.legend;var self=this;if("undefined"==typeof window.$)throw"couldn't find jQuery at window.$";if("undefined"==typeof window.$.ui)throw"couldn't find jQuery UI at window.$.ui";$(function(){$(self.legend.list).sortable({containment:"parent",tolerance:"pointer",update:function(){var series=[];$(self.legend.list).find("li").each(function(index,item){item.series&&series.push(item.series)});for(var i=self.graph.series.length-1;i>=0;i--)self.graph.series[i]=series.shift();self.graph.update()}}),$(self.legend.list).disableSelection()}),this.graph.onUpdate(function(){var h=window.getComputedStyle(self.legend.element).height;self.legend.element.style.height=h})},Rickshaw.namespace("Rickshaw.Graph.Behavior.Series.Toggle"),Rickshaw.Graph.Behavior.Series.Toggle=function(args){this.graph=args.graph,this.legend=args.legend;var self=this;this.addAnchor=function(line){var anchor=document.createElement("a");anchor.innerHTML="&#10004;",anchor.classList.add("action"),line.element.insertBefore(anchor,line.element.firstChild),anchor.onclick=function(){if(line.series.disabled)line.series.enable(),line.element.classList.remove("disabled");else{if(this.graph.series.filter(function(s){return!s.disabled}).length<=1)return;line.series.disable(),line.element.classList.add("disabled")}}.bind(this);var label=line.element.getElementsByTagName("span")[0];label.onclick=function(){var disableAllOtherLines=line.series.disabled;if(!disableAllOtherLines)for(var i=0;i<self.legend.lines.length;i++){var l=self.legend.lines[i];if(line.series===l.series);else if(!l.series.disabled){disableAllOtherLines=!0;break}}disableAllOtherLines?(line.series.enable(),line.element.classList.remove("disabled"),self.legend.lines.forEach(function(l){line.series===l.series||(l.series.disable(),l.element.classList.add("disabled"))})):self.legend.lines.forEach(function(l){l.series.enable(),l.element.classList.remove("disabled")})}},this.legend&&("undefined"!=typeof $&&$(this.legend.list).sortable&&$(this.legend.list).sortable({start:function(event,ui){ui.item.bind("no.onclick",function(event){event.preventDefault()})},stop:function(event,ui){setTimeout(function(){ui.item.unbind("no.onclick")},250)}}),this.legend.lines.forEach(function(l){self.addAnchor(l)})),this._addBehavior=function(){this.graph.series.forEach(function(s){s.disable=function(){if(self.graph.series.length<=1)throw"only one series left";s.disabled=!0,self.graph.update()},s.enable=function(){s.disabled=!1,self.graph.update()}})},this._addBehavior(),this.updateBehaviour=function(){this._addBehavior()}},Rickshaw.namespace("Rickshaw.Graph.HoverDetail"),Rickshaw.Graph.HoverDetail=Rickshaw.Class.create({initialize:function(args){var graph=this.graph=args.graph;this.xFormatter=args.xFormatter||function(x){return new Date(1e3*x).toUTCString()},this.yFormatter=args.yFormatter||function(y){return null===y?y:y.toFixed(2)};var element=this.element=document.createElement("div");element.className="detail",this.visible=!0,graph.element.appendChild(element),this.lastEvent=null,this._addListeners(),this.onShow=args.onShow,this.onHide=args.onHide,this.onRender=args.onRender,this.formatter=args.formatter||this.formatter},formatter:function(series,x,y,formattedX,formattedY){return series.name+":&nbsp;"+formattedY},update:function(e){if(e=e||this.lastEvent,e&&(this.lastEvent=e,e.target.nodeName.match(/^(path|svg|rect|circle)$/))){var nearestPoint,graph=this.graph,eventX=e.offsetX||e.layerX,eventY=e.offsetY||e.layerY,j=0,points=[];if(this.graph.series.active().forEach(function(series){var data=this.graph.stackedData[j++];if(data.length){var domainX=graph.x.invert(eventX),domainIndexScale=d3.scale.linear().domain([data[0].x,data.slice(-1)[0].x]).range([0,data.length-1]),approximateIndex=Math.round(domainIndexScale(domainX));approximateIndex==data.length-1&&approximateIndex--;for(var dataIndex=Math.min(approximateIndex||0,data.length-1),i=approximateIndex;i<data.length-1&&(data[i]&&data[i+1]);){if(data[i].x<=domainX&&data[i+1].x>domainX){dataIndex=Math.abs(domainX-data[i].x)<Math.abs(domainX-data[i+1].x)?i:i+1;break}data[i+1].x<=domainX?i++:i--}0>dataIndex&&(dataIndex=0);var value=data[dataIndex],distance=Math.sqrt(Math.pow(Math.abs(graph.x(value.x)-eventX),2)+Math.pow(Math.abs(graph.y(value.y+value.y0)-eventY),2)),xFormatter=series.xFormatter||this.xFormatter,yFormatter=series.yFormatter||this.yFormatter,point={formattedXValue:xFormatter(value.x),formattedYValue:yFormatter(series.scale?series.scale.invert(value.y):value.y),series:series,value:value,distance:distance,order:j,name:series.name};(!nearestPoint||distance<nearestPoint.distance)&&(nearestPoint=point),points.push(point)}},this),nearestPoint){nearestPoint.active=!0;var domainX=nearestPoint.value.x,formattedXValue=nearestPoint.formattedXValue;this.element.innerHTML="",this.element.style.left=graph.x(domainX)+"px",this.visible&&this.render({points:points,detail:points,mouseX:eventX,mouseY:eventY,formattedXValue:formattedXValue,domainX:domainX})}}},hide:function(){this.visible=!1,this.element.classList.add("inactive"),"function"==typeof this.onHide&&this.onHide()},show:function(){this.visible=!0,this.element.classList.remove("inactive"),"function"==typeof this.onShow&&this.onShow()},render:function(args){var graph=this.graph,points=args.points,point=points.filter(function(p){return p.active}).shift();if(null!==point.value.y){var formattedXValue=point.formattedXValue,formattedYValue=point.formattedYValue;this.element.innerHTML="",this.element.style.left=graph.x(point.value.x)+"px";var xLabel=document.createElement("div");xLabel.className="x_label",xLabel.innerHTML=formattedXValue,this.element.appendChild(xLabel);var item=document.createElement("div");item.className="item";var series=point.series,actualY=series.scale?series.scale.invert(point.value.y):point.value.y;item.innerHTML=this.formatter(series,point.value.x,actualY,formattedXValue,formattedYValue,point),item.style.top=this.graph.y(point.value.y0+point.value.y)+"px",this.element.appendChild(item);var dot=document.createElement("div");dot.className="dot",dot.style.top=item.style.top,dot.style.borderColor=series.color,this.element.appendChild(dot),point.active&&(item.className="item active",dot.className="dot active"),this.show(),"function"==typeof this.onRender&&this.onRender(args)}},_addListeners:function(){this.graph.element.addEventListener("mousemove",function(e){this.visible=!0,this.update(e)}.bind(this),!1),this.graph.onUpdate(function(){this.update()}.bind(this)),this.graph.element.addEventListener("mouseout",function(e){!e.relatedTarget||e.relatedTarget.compareDocumentPosition(this.graph.element)&Node.DOCUMENT_POSITION_CONTAINS||this.hide()}.bind(this),!1)}}),Rickshaw.namespace("Rickshaw.Graph.JSONP"),Rickshaw.Graph.JSONP=Rickshaw.Class.create(Rickshaw.Graph.Ajax,{request:function(){$.ajax({url:this.dataURL,dataType:"jsonp",success:this.success.bind(this),error:this.error.bind(this)})}}),Rickshaw.namespace("Rickshaw.Graph.Legend"),Rickshaw.Graph.Legend=function(args){var element=this.element=args.element,graph=this.graph=args.graph,self=this;element.classList.add("rickshaw_legend");var list=this.list=document.createElement("ul");element.appendChild(list);var series=graph.series.map(function(s){return s});args.naturalOrder||(series=series.reverse()),this.lines=[],this.addLine=function(series){var line=document.createElement("li");line.className="line",series.disabled&&(line.className+=" disabled");var swatch=document.createElement("div");swatch.className="swatch",swatch.style.backgroundColor=series.color,line.appendChild(swatch);var label=document.createElement("span");label.className="label",label.innerHTML=series.name,line.appendChild(label),list.appendChild(line),line.series=series,series.noLegend&&(line.style.display="none");var _line={element:line,series:series};self.shelving&&(self.shelving.addAnchor(_line),self.shelving.updateBehaviour()),self.highlighter&&self.highlighter.addHighlightEvents(_line),self.lines.push(_line)},series.forEach(function(s){self.addLine(s)}),graph.onUpdate(function(){})},Rickshaw.namespace("Rickshaw.Graph.RangeSlider"),Rickshaw.Graph.RangeSlider=Rickshaw.Class.create({initialize:function(args){var graph=(this.element=args.element,this.graph=args.graph);this.build(),graph.onUpdate(function(){this.update()}.bind(this))},build:function(){var element=this.element,graph=this.graph,domain=graph.dataDomain();$(function(){$(element).slider({range:!0,min:domain[0],max:domain[1],values:[domain[0],domain[1]],slide:function(event,ui){if(!(ui.values[1]<=ui.values[0])){graph.window.xMin=ui.values[0],graph.window.xMax=ui.values[1],graph.update();var domain=graph.dataDomain();domain[0]==ui.values[0]&&(graph.window.xMin=void 0),domain[1]==ui.values[1]&&(graph.window.xMax=void 0)}}})}),element[0].style.width=graph.width+"px"},update:function(){var element=this.element,graph=this.graph,values=$(element).slider("option","values"),domain=graph.dataDomain();$(element).slider("option","min",domain[0]),$(element).slider("option","max",domain[1]),null==graph.window.xMin&&(values[0]=domain[0]),null==graph.window.xMax&&(values[1]=domain[1]),$(element).slider("option","values",values)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer"),Rickshaw.Graph.Renderer=Rickshaw.Class.create({initialize:function(args){this.graph=args.graph,this.tension=args.tension||this.tension,this.graph.unstacker=this.graph.unstacker||new Rickshaw.Graph.Unstacker({graph:this.graph}),this.configure(args)},seriesPathFactory:function(){},seriesStrokeFactory:function(){},defaults:function(){return{tension:.8,strokeWidth:2,unstack:!0,padding:{top:.01,right:0,bottom:.01,left:0},stroke:!1,fill:!1}},domain:function(data){var stackedData=data||this.graph.stackedData||this.graph.stackData(),firstPoint=stackedData[0][0];if(void 0===firstPoint)return{x:[null,null],y:[null,null]};var xMin=firstPoint.x,xMax=firstPoint.x,yMin=firstPoint.y+firstPoint.y0,yMax=firstPoint.y+firstPoint.y0;return stackedData.forEach(function(series){series.forEach(function(d){if(null!=d.y){var y=d.y+d.y0;yMin>y&&(yMin=y),y>yMax&&(yMax=y)}}),series[0].x<xMin&&(xMin=series[0].x),series[series.length-1].x>xMax&&(xMax=series[series.length-1].x)}),xMin-=(xMax-xMin)*this.padding.left,xMax+=(xMax-xMin)*this.padding.right,yMin="auto"===this.graph.min?yMin:this.graph.min||0,yMax=void 0===this.graph.max?yMax:this.graph.max,("auto"===this.graph.min||0>yMin)&&(yMin-=(yMax-yMin)*this.padding.bottom),void 0===this.graph.max&&(yMax+=(yMax-yMin)*this.padding.top),{x:[xMin,xMax],y:[yMin,yMax]}},render:function(args){args=args||{};var graph=this.graph,series=args.series||graph.series,vis=args.vis||graph.vis;vis.selectAll("*").remove();var data=series.filter(function(s){return!s.disabled}).map(function(s){return s.stack}),nodes=vis.selectAll("path").data(data).enter().append("svg:path").attr("d",this.seriesPathFactory()),i=0;series.forEach(function(series){series.disabled||(series.path=nodes[0][i++],this._styleSeries(series))},this)},_styleSeries:function(series){var fill=this.fill?series.color:"none",stroke=this.stroke?series.color:"none";series.path.setAttribute("fill",fill),series.path.setAttribute("stroke",stroke),series.path.setAttribute("stroke-width",this.strokeWidth),series.path.setAttribute("class",series.className)},configure:function(args){args=args||{},Rickshaw.keys(this.defaults()).forEach(function(key){return args.hasOwnProperty(key)?void("object"==typeof this.defaults()[key]?Rickshaw.keys(this.defaults()[key]).forEach(function(k){this[key][k]=void 0!==args[key][k]?args[key][k]:void 0!==this[key][k]?this[key][k]:this.defaults()[key][k]},this):this[key]=void 0!==args[key]?args[key]:void 0!==this[key]?this[key]:void 0!==this.graph[key]?this.graph[key]:this.defaults()[key]):void(this[key]=this[key]||this.graph[key]||this.defaults()[key])},this)},setStrokeWidth:function(strokeWidth){void 0!==strokeWidth&&(this.strokeWidth=strokeWidth)},setTension:function(tension){void 0!==tension&&(this.tension=tension)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Line"),Rickshaw.Graph.Renderer.Line=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"line",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0})},seriesPathFactory:function(){var graph=this.graph,factory=d3.svg.line().x(function(d){return graph.x(d.x)}).y(function(d){return graph.y(d.y)}).interpolate(this.graph.interpolation).tension(this.tension);return factory.defined&&factory.defined(function(d){return null!==d.y}),factory}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Stack"),Rickshaw.Graph.Renderer.Stack=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"stack",defaults:function($super){return Rickshaw.extend($super(),{fill:!0,stroke:!1,unstack:!1})},seriesPathFactory:function(){var graph=this.graph,factory=d3.svg.area().x(function(d){return graph.x(d.x)}).y0(function(d){return graph.y(d.y0)}).y1(function(d){return graph.y(d.y+d.y0)}).interpolate(this.graph.interpolation).tension(this.tension);return factory.defined&&factory.defined(function(d){return null!==d.y}),factory}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Bar"),Rickshaw.Graph.Renderer.Bar=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"bar",defaults:function($super){var defaults=Rickshaw.extend($super(),{gapSize:.05,unstack:!1});return delete defaults.tension,defaults},initialize:function($super,args){args=args||{},this.gapSize=args.gapSize||this.gapSize,$super(args)},domain:function($super){var domain=$super(),frequentInterval=this._frequentInterval(this.graph.stackedData.slice(-1).shift());return domain.x[1]+=Number(frequentInterval.magnitude),domain},barWidth:function(series){var frequentInterval=this._frequentInterval(series.stack),barWidth=this.graph.x(series.stack[0].x+frequentInterval.magnitude*(1-this.gapSize));return barWidth},render:function(args){args=args||{};var graph=this.graph,series=args.series||graph.series,vis=args.vis||graph.vis;vis.selectAll("*").remove();var barWidth=this.barWidth(series.active()[0]),barXOffset=0,activeSeriesCount=series.filter(function(s){return!s.disabled}).length,seriesBarWidth=this.unstack?barWidth/activeSeriesCount:barWidth,transform=function(d){var matrix=[1,0,0,d.y<0?-1:1,0,d.y<0?2*graph.y.magnitude(Math.abs(d.y)):0];return"matrix("+matrix.join(",")+")"};series.forEach(function(series){if(!series.disabled){var nodes=(this.barWidth(series),vis.selectAll("path").data(series.stack.filter(function(d){return null!==d.y})).enter().append("svg:rect").attr("x",function(d){return graph.x(d.x)+barXOffset}).attr("y",function(d){return graph.y(d.y0+Math.abs(d.y))*(d.y<0?-1:1)}).attr("width",seriesBarWidth).attr("height",function(d){return graph.y.magnitude(Math.abs(d.y))}).attr("transform",transform));Array.prototype.forEach.call(nodes[0],function(n){n.setAttribute("fill",series.color)}),this.unstack&&(barXOffset+=seriesBarWidth)}},this)},_frequentInterval:function(data){for(var intervalCounts={},i=0;i<data.length-1;i++){var interval=data[i+1].x-data[i].x;intervalCounts[interval]=intervalCounts[interval]||0,intervalCounts[interval]++}var frequentInterval={count:0,magnitude:1};return Rickshaw.keys(intervalCounts).forEach(function(i){frequentInterval.count<intervalCounts[i]&&(frequentInterval={count:intervalCounts[i],magnitude:i})}),frequentInterval}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Area"),Rickshaw.Graph.Renderer.Area=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"area",defaults:function($super){return Rickshaw.extend($super(),{unstack:!1,fill:!1,stroke:!1})
},seriesPathFactory:function(){var graph=this.graph,factory=d3.svg.area().x(function(d){return graph.x(d.x)}).y0(function(d){return graph.y(d.y0)}).y1(function(d){return graph.y(d.y+d.y0)}).interpolate(graph.interpolation).tension(this.tension);return factory.defined&&factory.defined(function(d){return null!==d.y}),factory},seriesStrokeFactory:function(){var graph=this.graph,factory=d3.svg.line().x(function(d){return graph.x(d.x)}).y(function(d){return graph.y(d.y+d.y0)}).interpolate(graph.interpolation).tension(this.tension);return factory.defined&&factory.defined(function(d){return null!==d.y}),factory},render:function(){var graph=this.graph;graph.vis.selectAll("*").remove();var method=this.unstack?"append":"insert",nodes=graph.vis.selectAll("path").data(this.graph.stackedData).enter()[method]("svg:g","g");nodes.append("svg:path").attr("d",this.seriesPathFactory()).attr("class","area"),this.stroke&&nodes.append("svg:path").attr("d",this.seriesStrokeFactory()).attr("class","line");var i=0;graph.series.forEach(function(series){series.disabled||(series.path=nodes[0][i++],this._styleSeries(series))},this)},_styleSeries:function(series){series.path&&(d3.select(series.path).select(".area").attr("fill",series.color),this.stroke&&d3.select(series.path).select(".line").attr("fill","none").attr("stroke",series.stroke||d3.interpolateRgb(series.color,"black")(.125)).attr("stroke-width",this.strokeWidth),series.className&&series.path.setAttribute("class",series.className))}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.ScatterPlot"),Rickshaw.Graph.Renderer.ScatterPlot=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"scatterplot",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!0,stroke:!1,padding:{top:.01,right:.01,bottom:.01,left:.01},dotSize:4})},initialize:function($super,args){$super(args)},render:function(args){args=args||{};var graph=this.graph,series=args.series||graph.series,vis=args.vis||graph.vis,dotSize=this.dotSize;vis.selectAll("*").remove(),series.forEach(function(series){if(!series.disabled){var nodes=vis.selectAll("path").data(series.stack.filter(function(d){return null!==d.y})).enter().append("svg:circle").attr("cx",function(d){return graph.x(d.x)}).attr("cy",function(d){return graph.y(d.y)}).attr("r",function(d){return"r"in d?d.r:dotSize});Array.prototype.forEach.call(nodes[0],function(n){n.setAttribute("fill",series.color)})}},this)}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.Multi"),Rickshaw.Graph.Renderer.Multi=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"multi",initialize:function($super,args){$super(args)},defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0})},domain:function($super){this.graph.stackData();var domains=[],groups=this._groups();this._stack(groups),groups.forEach(function(group){var data=group.series.filter(function(s){return!s.disabled}).map(function(s){return s.stack});if(data.length){var domain=$super(data);domains.push(domain)}});var xMin=d3.min(domains.map(function(d){return d.x[0]})),xMax=d3.max(domains.map(function(d){return d.x[1]})),yMin=d3.min(domains.map(function(d){return d.y[0]})),yMax=d3.max(domains.map(function(d){return d.y[1]}));return{x:[xMin,xMax],y:[yMin,yMax]}},_groups:function(){var graph=this.graph,renderGroups={};graph.series.forEach(function(series){if(!series.disabled){if(!renderGroups[series.renderer]){var ns="http://www.w3.org/2000/svg",vis=document.createElementNS(ns,"g");graph.vis[0][0].appendChild(vis);var renderer=graph._renderers[series.renderer];renderGroups[series.renderer]={renderer:renderer,series:[],vis:d3.select(vis)}}renderGroups[series.renderer].series.push(series)}},this);var groups=[];return Object.keys(renderGroups).forEach(function(key){var group=renderGroups[key];groups.push(group)}),groups},_stack:function(groups){return groups.forEach(function(group){var series=group.series.filter(function(series){return!series.disabled}),data=series.map(function(series){return series.stack});if(!group.renderer.unstack){var layout=d3.layout.stack(),stackedData=Rickshaw.clone(layout(data));series.forEach(function(series,index){series._stack=Rickshaw.clone(stackedData[index])})}},this),groups},render:function(){this.graph.series.forEach(function(series){if(!series.renderer)throw new Error("Each series needs a renderer for graph 'multi' renderer")}),this.graph.vis.selectAll("*").remove();var groups=this._groups();groups=this._stack(groups),groups.forEach(function(group){var series=group.series.filter(function(series){return!series.disabled});group.renderer.render({series:series,vis:group.vis}),series.forEach(function(s){s.stack=s._stack||s.stack||s.data})})}}),Rickshaw.namespace("Rickshaw.Graph.Renderer.LinePlot"),Rickshaw.Graph.Renderer.LinePlot=Rickshaw.Class.create(Rickshaw.Graph.Renderer,{name:"lineplot",defaults:function($super){return Rickshaw.extend($super(),{unstack:!0,fill:!1,stroke:!0,padding:{top:.01,right:.01,bottom:.01,left:.01},dotSize:3,strokeWidth:2})},initialize:function($super,args){$super(args)},seriesPathFactory:function(){var graph=this.graph,factory=d3.svg.line().x(function(d){return graph.x(d.x)}).y(function(d){return graph.y(d.y)}).interpolate(this.graph.interpolation).tension(this.tension);return factory.defined&&factory.defined(function(d){return null!==d.y}),factory},_renderDots:function(){var graph=this.graph;graph.series.forEach(function(series){if(!series.disabled){var nodes=graph.vis.selectAll("x").data(series.stack.filter(function(d){return null!==d.y})).enter().append("svg:circle").attr("cx",function(d){return graph.x(d.x)}).attr("cy",function(d){return graph.y(d.y)}).attr("r",function(d){return"r"in d?d.r:graph.renderer.dotSize});Array.prototype.forEach.call(nodes[0],function(n){n&&(n.setAttribute("data-color",series.color),n.setAttribute("fill","white"),n.setAttribute("stroke",series.color),n.setAttribute("stroke-width",this.strokeWidth))}.bind(this))}},this)},_renderLines:function(){var graph=this.graph,nodes=graph.vis.selectAll("path").data(this.graph.stackedData).enter().append("svg:path").attr("d",this.seriesPathFactory()),i=0;graph.series.forEach(function(series){series.disabled||(series.path=nodes[0][i++],this._styleSeries(series))},this)},render:function(){var graph=this.graph;graph.vis.selectAll("*").remove(),this._renderLines(),this._renderDots()}}),Rickshaw.namespace("Rickshaw.Graph.Smoother"),Rickshaw.Graph.Smoother=Rickshaw.Class.create({initialize:function(args){this.graph=args.graph,this.element=args.element,this.aggregationScale=1,this.build(),this.graph.stackData.hooks.data.push({name:"smoother",orderPosition:50,f:this.transformer.bind(this)})},build:function(){var self=this;this.element&&$(function(){$(self.element).slider({min:1,max:100,slide:function(event,ui){self.setScale(ui.value),self.graph.update()}})})},setScale:function(scale){if(1>scale)throw"scale out of range: "+scale;this.aggregationScale=scale,this.graph.update()},transformer:function(data){if(1==this.aggregationScale)return data;var aggregatedData=[];return data.forEach(function(seriesData){for(var aggregatedSeriesData=[];seriesData.length;){var avgX=0,avgY=0,slice=seriesData.splice(0,this.aggregationScale);slice.forEach(function(d){avgX+=d.x/slice.length,avgY+=d.y/slice.length}),aggregatedSeriesData.push({x:avgX,y:avgY})}aggregatedData.push(aggregatedSeriesData)}.bind(this)),aggregatedData}}),Rickshaw.namespace("Rickshaw.Graph.Unstacker"),Rickshaw.Graph.Unstacker=function(args){this.graph=args.graph;var self=this;this.graph.stackData.hooks.after.push({name:"unstacker",f:function(data){return self.graph.renderer.unstack?(data.forEach(function(seriesData){seriesData.forEach(function(d){d.y0=0})}),data):data}})},Rickshaw.namespace("Rickshaw.Series"),Rickshaw.Series=Rickshaw.Class.create(Array,{initialize:function(data,palette,options){options=options||{},this.palette=new Rickshaw.Color.Palette(palette),this.timeBase="undefined"==typeof options.timeBase?Math.floor((new Date).getTime()/1e3):options.timeBase;var timeInterval="undefined"==typeof options.timeInterval?1e3:options.timeInterval;this.setTimeInterval(timeInterval),data&&"object"==typeof data&&Array.isArray(data)&&data.forEach(function(item){this.addItem(item)},this)},addItem:function(item){if("undefined"==typeof item.name)throw"addItem() needs a name";item.color=item.color||this.palette.color(item.name),item.data=item.data||[],0===item.data.length&&this.length&&this.getIndex()>0?this[0].data.forEach(function(plot){item.data.push({x:plot.x,y:0})}):0===item.data.length&&item.data.push({x:this.timeBase-(this.timeInterval||0),y:0}),this.push(item),this.legend&&this.legend.addLine(this.itemByName(item.name))},addData:function(data,x){var index=this.getIndex();Rickshaw.keys(data).forEach(function(name){this.itemByName(name)||this.addItem({name:name})},this),this.forEach(function(item){item.data.push({x:x||(index*this.timeInterval||1)+this.timeBase,y:data[item.name]||0})},this)},getIndex:function(){return this[0]&&this[0].data&&this[0].data.length?this[0].data.length:0},itemByName:function(name){for(var i=0;i<this.length;i++)if(this[i].name==name)return this[i]},setTimeInterval:function(iv){this.timeInterval=iv/1e3},setTimeBase:function(t){this.timeBase=t},dump:function(){var data={timeBase:this.timeBase,timeInterval:this.timeInterval,items:[]};return this.forEach(function(item){var newItem={color:item.color,name:item.name,data:[]};item.data.forEach(function(plot){newItem.data.push({x:plot.x,y:plot.y})}),data.items.push(newItem)}),data},load:function(data){data.timeInterval&&(this.timeInterval=data.timeInterval),data.timeBase&&(this.timeBase=data.timeBase),data.items&&data.items.forEach(function(item){this.push(item),this.legend&&this.legend.addLine(this.itemByName(item.name))},this)}}),Rickshaw.Series.zeroFill=function(series){Rickshaw.Series.fill(series,0)},Rickshaw.Series.fill=function(series,fill){for(var x,i=0,data=series.map(function(s){return s.data});i<Math.max.apply(null,data.map(function(d){return d.length}));)x=Math.min.apply(null,data.filter(function(d){return d[i]}).map(function(d){return d[i].x})),data.forEach(function(d){d[i]&&d[i].x==x||d.splice(i,0,{x:x,y:fill})}),i++},Rickshaw.namespace("Rickshaw.Series.FixedDuration"),Rickshaw.Series.FixedDuration=Rickshaw.Class.create(Rickshaw.Series,{initialize:function(data,palette,options){if(options=options||{},"undefined"==typeof options.timeInterval)throw new Error("FixedDuration series requires timeInterval");if("undefined"==typeof options.maxDataPoints)throw new Error("FixedDuration series requires maxDataPoints");if(this.palette=new Rickshaw.Color.Palette(palette),this.timeBase="undefined"==typeof options.timeBase?Math.floor((new Date).getTime()/1e3):options.timeBase,this.setTimeInterval(options.timeInterval),this[0]&&this[0].data&&this[0].data.length?(this.currentSize=this[0].data.length,this.currentIndex=this[0].data.length):(this.currentSize=0,this.currentIndex=0),this.maxDataPoints=options.maxDataPoints,data&&"object"==typeof data&&Array.isArray(data)&&(data.forEach(function(item){this.addItem(item)},this),this.currentSize+=1,this.currentIndex+=1),this.timeBase-=(this.maxDataPoints-this.currentSize)*this.timeInterval,"undefined"!=typeof this.maxDataPoints&&this.currentSize<this.maxDataPoints)for(var i=this.maxDataPoints-this.currentSize-1;i>1;i--)this.currentSize+=1,this.currentIndex+=1,this.forEach(function(item){item.data.unshift({x:((i-1)*this.timeInterval||1)+this.timeBase,y:0,i:i})},this)},addData:function($super,data,x){if($super(data,x),this.currentSize+=1,this.currentIndex+=1,void 0!==this.maxDataPoints)for(;this.currentSize>this.maxDataPoints;)this.dropData()},dropData:function(){this.forEach(function(item){item.data.splice(0,1)}),this.currentSize-=1},getIndex:function(){return this.currentIndex}}),function(){var Batman,__slice=[].slice;Batman=function(){var mixins;return mixins=1<=arguments.length?__slice.call(arguments,0):[],function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Batman.Object,mixins,function(){})},Batman.version="0.16.0",Batman.config={pathToApp:"/",usePushState:!0,pathToHTML:"html",fetchRemoteHTML:!0,cacheViews:!1,minificationErrors:!0,protectFromCSRF:!1},(Batman.container=function(){return this}()).Batman=Batman,"function"==typeof define&&define("batman",[],function(){return Batman}),Batman.exportHelpers=function(onto){var k,_i,_len,_ref;for(_ref=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"],_i=0,_len=_ref.length;_len>_i;_i++)k=_ref[_i],onto["$"+k]=Batman[k];return onto},Batman.exportGlobals=function(){return Batman.exportHelpers(Batman.container)}}.call(this),function(){var _Batman;Batman._Batman=_Batman=function(){function _Batman(object){this.object=object}return _Batman.prototype.check=function(object){return object!==this.object?(object._batman=new Batman._Batman(object),!1):!0},_Batman.prototype.get=function(key){var reduction,results;switch(results=this.getAll(key),results.length){case 0:return void 0;case 1:return results[0];default:return reduction=null!=results[0].concat?function(a,b){return a.concat(b)}:null!=results[0].merge?function(a,b){return a.merge(b)}:results.every(function(x){return"object"==typeof x})?(results.unshift({}),function(a,b){return Batman.extend(a,b)}):void 0,reduction?results.reduceRight(reduction):results}},_Batman.prototype.getFirst=function(key){var results;return results=this.getAll(key),results[0]},_Batman.prototype.getAll=function(keyOrGetter){var getter,results,val;return getter="function"==typeof keyOrGetter?keyOrGetter:function(ancestor){var _ref;return null!=(_ref=ancestor._batman)?_ref[keyOrGetter]:void 0},results=this.ancestors(getter),(val=getter(this.object))&&results.unshift(val),results},_Batman.prototype.ancestors=function(getter){var ancestor,results,val,_i,_len,_ref;if(this._allAncestors||(this._allAncestors=this.allAncestors()),getter){for(results=[],_ref=this._allAncestors,_i=0,_len=_ref.length;_len>_i;_i++)ancestor=_ref[_i],val=getter(ancestor),null!=val&&results.push(val);return results}return this._allAncestors},_Batman.prototype.allAncestors=function(){var isClass,parent,proto,results,_ref,_ref1;return results=[],isClass=!!this.object.prototype,parent=isClass?null!=(_ref=this.object.__super__)?_ref.constructor:void 0:(proto=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:proto,null!=parent&&(null!=(_ref1=parent._batman)&&_ref1.check(parent),results.push(parent),null!=parent._batman&&(results=results.concat(parent._batman.allAncestors()))),results},_Batman.prototype.set=function(key,value){return this[key]=value},_Batman}()}.call(this),function(){var chr,_encodedChars,_encodedCharsPattern,_entityMap,_implementImmediates,_objectToString,_unsafeChars,_unsafeCharsPattern,__slice=[].slice,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Batman.typeOf=function(object){return"undefined"==typeof object?"Undefined":_objectToString.call(object).slice(8,-1)},_objectToString=Object.prototype.toString,Batman.extend=function(){var key,object,objects,to,value,_i,_len;for(to=arguments[0],objects=2<=arguments.length?__slice.call(arguments,1):[],_i=0,_len=objects.length;_len>_i;_i++){object=objects[_i];for(key in object)value=object[key],to[key]=value}return to},Batman.mixin=function(){var hasSet,key,mixin,mixins,to,value,_i,_len;for(to=arguments[0],mixins=2<=arguments.length?__slice.call(arguments,1):[],hasSet="function"==typeof to.set,_i=0,_len=mixins.length;_len>_i;_i++)if(mixin=mixins[_i],"Object"===Batman.typeOf(mixin)){for(key in mixin)__hasProp.call(mixin,key)&&(value=mixin[key],"initialize"!==key&&"uninitialize"!==key&&"prototype"!==key&&(hasSet?to.set(key,value):null!=to.nodeName?Batman.data(to,key,value):to[key]=value));"function"==typeof mixin.initialize&&mixin.initialize.call(to)}return to},Batman.unmixin=function(){var from,key,mixin,mixins,_i,_len;for(from=arguments[0],mixins=2<=arguments.length?__slice.call(arguments,1):[],_i=0,_len=mixins.length;_len>_i;_i++){mixin=mixins[_i];for(key in mixin)"initialize"!==key&&"uninitialize"!==key&&delete from[key];"function"==typeof mixin.uninitialize&&mixin.uninitialize.call(from)}return from},Batman._functionName=Batman.functionName=function(f){var _ref;return f.__name__?f.__name__:f.name?f.name:null!=(_ref=f.toString().match(/\W*function\s+([\w\$]+)\(/))?_ref[1]:void 0},Batman._isChildOf=Batman.isChildOf=function(parentNode,childNode){var node;for(node=childNode.parentNode;node;){if(node===parentNode)return!0;node=node.parentNode}return!1},_implementImmediates=function(container){var canUsePostMessage,count,functions,getHandle,handler,prefix,tasks;return canUsePostMessage=function(){var async,oldMessage;return container.postMessage?(async=!0,oldMessage=container.onmessage,container.onmessage=function(){return async=!1},container.postMessage("","*"),container.onmessage=oldMessage,async):!1},tasks=new Batman.SimpleHash,count=0,getHandle=function(){return"go"+ ++count},container.setImmediate&&container.clearImmediate?(Batman.setImmediate=function(){return container.setImmediate.apply(container,arguments)},Batman.clearImmediate=function(){return container.clearImmediate.apply(container,arguments)}):canUsePostMessage()?(prefix="com.batman.",handler=function(e){var handle,_base;if("string"==typeof e.data&&~e.data.search(prefix))return handle=e.data.substring(prefix.length),"function"==typeof(_base=tasks.unset(handle))?_base():void 0},container.addEventListener?container.addEventListener("message",handler,!1):container.attachEvent("onmessage",handler),Batman.setImmediate=function(f){var handle;return tasks.set(handle=getHandle(),f),container.postMessage(prefix+handle,"*"),handle},Batman.clearImmediate=function(handle){return tasks.unset(handle)}):"undefined"!=typeof document&&__indexOf.call(document.createElement("script"),"onreadystatechange")>=0?(Batman.setImmediate=function(){var handle,script;return handle=getHandle(),script=document.createElement("script"),script.onreadystatechange=function(){var _base;return"function"==typeof(_base=tasks.get(handle))&&_base(),script.onreadystatechange=null,script.parentNode.removeChild(script),script=null},document.documentElement.appendChild(script),handle},Batman.clearImmediate=function(handle){return tasks.unset(handle)}):("undefined"!=typeof process&&null!==process?process.nextTick:void 0)?(functions={},Batman.setImmediate=function(f){var handle;return handle=getHandle(),functions[handle]=f,process.nextTick(function(){return"function"==typeof functions[handle]&&functions[handle](),delete functions[handle]}),handle},Batman.clearImmediate=function(handle){return delete functions[handle]}):(Batman.setImmediate=function(f){return setTimeout(f,0)},Batman.clearImmediate=function(handle){return clearTimeout(handle)})},Batman.setImmediate=function(){return _implementImmediates(Batman.container),Batman.setImmediate.apply(this,arguments)},Batman.clearImmediate=function(){return _implementImmediates(Batman.container),Batman.clearImmediate.apply(this,arguments)},Batman.forEach=function(container,iterator,ctx){var e,i,k,v,_i,_len;if(container.forEach)container.forEach(iterator,ctx);else if(container.indexOf)for(i=_i=0,_len=container.length;_len>_i;i=++_i)e=container[i],iterator.call(ctx,e,i,container);else for(k in container)v=container[k],iterator.call(ctx,k,v,container)},Batman.objectHasKey=function(object,key){return"function"==typeof object.hasKey?object.hasKey(key):key in object},Batman.contains=function(container,item){return container.indexOf?__indexOf.call(container,item)>=0:"function"==typeof container.has?container.has(item):Batman.objectHasKey(container,item)},Batman.get=function(base,key){return"function"==typeof base.get?base.get(key):Batman.Property.forBaseAndKey(base,key).getValue()},Batman.getPath=function(base,segments){var segment,_i,_len;for(_i=0,_len=segments.length;_len>_i;_i++){if(segment=segments[_i],null==base)return;if(base=Batman.get(base,segment),null==base)return base}return base},_entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","/":"&#47;","'":"&#39;"},_unsafeChars=[],_encodedChars=[];for(chr in _entityMap)_unsafeChars.push(chr),_encodedChars.push(_entityMap[chr]);_unsafeCharsPattern=new RegExp("["+_unsafeChars.join("")+"]","g"),_encodedCharsPattern=new RegExp("("+_encodedChars.join("|")+")","g"),Batman.escapeHTML=function(){return function(s){return(""+s).replace(_unsafeCharsPattern,function(c){return _entityMap[c]})}}(),Batman.unescapeHTML=function(){return function(s){var node;if(null!=s)return node=Batman._unescapeHTMLNode||(Batman._unescapeHTMLNode=document.createElement("DIV")),node.innerHTML=s,Batman.DOM.textContent(node)}}(),Batman.translate=function(x,values){return null==values&&(values={}),Batman.helpers.interpolate(Batman.get(Batman.translate.messages,x),values)},Batman.translate.messages={},Batman.t=function(){return Batman.translate.apply(Batman,arguments)},Batman.redirect=function(url,replaceState){var _ref;return null==replaceState&&(replaceState=!1),null!=(_ref=Batman.navigator)?_ref.redirect(url,replaceState):void 0},Batman.initializeObject=function(object){return null!=object._batman?object._batman.check(object):object._batman=new Batman._Batman(object)}}.call(this),function(){var __slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Batman.Inflector=function(){function Inflector(){this._plural=[],this._singular=[],this._uncountable=[],this._human=[]}return Inflector.prototype.plural=function(regex,replacement){return this._plural.unshift([regex,replacement])},Inflector.prototype.singular=function(regex,replacement){return this._singular.unshift([regex,replacement])},Inflector.prototype.human=function(regex,replacement){return this._human.unshift([regex,replacement])},Inflector.prototype.uncountable=function(){var strings;return strings=1<=arguments.length?__slice.call(arguments,0):[],this._uncountable=this._uncountable.concat(strings.map(function(x){return new RegExp(""+x+"$","i")}))},Inflector.prototype.irregular=function(singular,plural){return singular.charAt(0)===plural.charAt(0)?(this.plural(new RegExp("("+singular.charAt(0)+")"+singular.slice(1)+"$","i"),"$1"+plural.slice(1)),this.plural(new RegExp("("+singular.charAt(0)+")"+plural.slice(1)+"$","i"),"$1"+plural.slice(1)),this.singular(new RegExp("("+plural.charAt(0)+")"+plural.slice(1)+"$","i"),"$1"+singular.slice(1))):(this.plural(new RegExp(""+singular+"$","i"),plural),this.plural(new RegExp(""+plural+"$","i"),plural),this.singular(new RegExp(""+plural+"$","i"),singular))},Inflector.prototype.ordinalize=function(number,radix){var absNumber,_ref;if(null==radix&&(radix=10),number=parseInt(number,radix),absNumber=Math.abs(number),_ref=absNumber%100,__indexOf.call([11,12,13],_ref)>=0)return number+"th";switch(absNumber%10){case 1:return number+"st";case 2:return number+"nd";case 3:return number+"rd";default:return number+"th"}},Inflector.prototype.pluralize=function(word){var regex,replace_string,uncountableRegex,_i,_j,_len,_len1,_ref,_ref1,_ref2;for(_ref=this._uncountable,_i=0,_len=_ref.length;_len>_i;_i++)if(uncountableRegex=_ref[_i],uncountableRegex.test(word))return word;for(_ref1=this._plural,_j=0,_len1=_ref1.length;_len1>_j;_j++)if(_ref2=_ref1[_j],regex=_ref2[0],replace_string=_ref2[1],regex.test(word))return word.replace(regex,replace_string);return word},Inflector.prototype.singularize=function(word){var regex,replace_string,uncountableRegex,_i,_j,_len,_len1,_ref,_ref1,_ref2;for(_ref=this._uncountable,_i=0,_len=_ref.length;_len>_i;_i++)if(uncountableRegex=_ref[_i],uncountableRegex.test(word))return word;for(_ref1=this._singular,_j=0,_len1=_ref1.length;_len1>_j;_j++)if(_ref2=_ref1[_j],regex=_ref2[0],replace_string=_ref2[1],regex.test(word))return word.replace(regex,replace_string);return word},Inflector.prototype.humanize=function(word){var regex,replace_string,_i,_len,_ref,_ref1;for(_ref=this._human,_i=0,_len=_ref.length;_len>_i;_i++)if(_ref1=_ref[_i],regex=_ref1[0],replace_string=_ref1[1],regex.test(word))return word.replace(regex,replace_string);return word},Inflector}()}.call(this),function(){var Inflector,camelize_rx,humanize_rx1,humanize_rx2,humanize_rx3,titleize_rx,underscore_rx1,underscore_rx2;camelize_rx=/(?:^|_|\-)(.)/g,titleize_rx=/(^|\s)([a-z])/g,underscore_rx1=/([A-Z]+)([A-Z][a-z])/g,underscore_rx2=/([a-z\d])([A-Z])/g,humanize_rx1=/_id$/,humanize_rx2=/_|-|\./g,humanize_rx3=/^\w/g,Batman.helpers={ordinalize:function(){return Batman.helpers.inflector.ordinalize.apply(Batman.helpers.inflector,arguments)},singularize:function(){return Batman.helpers.inflector.singularize.apply(Batman.helpers.inflector,arguments)},pluralize:function(count,singular,plural,includeCount){var result;return null==includeCount&&(includeCount=!0),arguments.length<2?Batman.helpers.inflector.pluralize(count):(result=1===+count?singular:plural||Batman.helpers.inflector.pluralize(singular),includeCount&&(result=""+(count||0)+" "+result),result)},camelize:function(string,firstLetterLower){return string=string.replace(camelize_rx,function(str,p1){return p1.toUpperCase()}),firstLetterLower?string.substr(0,1).toLowerCase()+string.substr(1):string},underscore:function(string){return string.replace(underscore_rx1,"$1_$2").replace(underscore_rx2,"$1_$2").replace("-","_").toLowerCase()},titleize:function(string){return string.replace(titleize_rx,function(m,p1,p2){return p1+p2.toUpperCase()})},capitalize:function(string){return Batman.developer.deprecated("capitalize","Renamed to titleize."),Batman.helpers.titleize(string)},trim:function(string){return string?string.trim():""},interpolate:function(stringOrObject,keys){var key,string,value;"object"==typeof stringOrObject?(string=stringOrObject[keys.count],string||(string=stringOrObject.other)):string=stringOrObject;for(key in keys)value=keys[key],string=string.replace(new RegExp("%\\{"+key+"\\}","g"),value);return string},humanize:function(string){return string=Batman.helpers.underscore(string),string=Batman.helpers.inflector.humanize(string),string.replace(humanize_rx1,"").replace(humanize_rx2," ").replace(humanize_rx3,function(match){return match.toUpperCase()})},toSentence:function(array){var itemString,last;return array.length<3?array.join(" and "):(last=array.pop(),itemString=array.join(", "),itemString+=", and "+last)}},Inflector=new Batman.Inflector,Batman.helpers.inflector=Inflector,Inflector.plural(/$/,"s"),Inflector.plural(/s$/i,"s"),Inflector.plural(/(ax|test)is$/i,"$1es"),Inflector.plural(/(octop|vir)us$/i,"$1i"),Inflector.plural(/(octop|vir)i$/i,"$1i"),Inflector.plural(/(alias|status)$/i,"$1es"),Inflector.plural(/(bu)s$/i,"$1ses"),Inflector.plural(/(buffal|tomat)o$/i,"$1oes"),Inflector.plural(/([ti])um$/i,"$1a"),Inflector.plural(/([ti])a$/i,"$1a"),Inflector.plural(/sis$/i,"ses"),Inflector.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),Inflector.plural(/(hive)$/i,"$1s"),Inflector.plural(/([^aeiouy]|qu)y$/i,"$1ies"),Inflector.plural(/(x|ch|ss|sh)$/i,"$1es"),Inflector.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),Inflector.plural(/([m|l])ouse$/i,"$1ice"),Inflector.plural(/([m|l])ice$/i,"$1ice"),Inflector.plural(/^(ox)$/i,"$1en"),Inflector.plural(/^(oxen)$/i,"$1"),Inflector.plural(/(quiz)$/i,"$1zes"),Inflector.singular(/s$/i,""),Inflector.singular(/(n)ews$/i,"$1ews"),Inflector.singular(/([ti])a$/i,"$1um"),Inflector.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),Inflector.singular(/(^analy)ses$/i,"$1sis"),Inflector.singular(/([^f])ves$/i,"$1fe"),Inflector.singular(/(hive)s$/i,"$1"),Inflector.singular(/(tive)s$/i,"$1"),Inflector.singular(/([lr])ves$/i,"$1f"),Inflector.singular(/([^aeiouy]|qu)ies$/i,"$1y"),Inflector.singular(/(s)eries$/i,"$1eries"),Inflector.singular(/(m)ovies$/i,"$1ovie"),Inflector.singular(/(x|ch|ss|sh)es$/i,"$1"),Inflector.singular(/([m|l])ice$/i,"$1ouse"),Inflector.singular(/(bus)es$/i,"$1"),Inflector.singular(/(o)es$/i,"$1"),Inflector.singular(/(shoe)s$/i,"$1"),Inflector.singular(/(cris|ax|test)es$/i,"$1is"),Inflector.singular(/(octop|vir)i$/i,"$1us"),Inflector.singular(/(alias|status)es$/i,"$1"),Inflector.singular(/^(ox)en/i,"$1"),Inflector.singular(/(vert|ind)ices$/i,"$1ex"),Inflector.singular(/(matr)ices$/i,"$1ix"),Inflector.singular(/(quiz)zes$/i,"$1"),Inflector.singular(/(database)s$/i,"$1"),Inflector.irregular("person","people"),Inflector.irregular("man","men"),Inflector.irregular("child","children"),Inflector.irregular("sex","sexes"),Inflector.irregular("move","moves"),Inflector.irregular("cow","kine"),Inflector.irregular("zombie","zombies"),Inflector.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")}.call(this),function(){var developer;Batman.developer={suppressed:!1,DevelopmentError:function(){var DevelopmentError;return DevelopmentError=function(message){return this.message=message,this.name="DevelopmentError"},DevelopmentError.prototype=Error.prototype,DevelopmentError}(),_ie_console:function(f,args){var arg,_i,_len,_results;for(1!==args.length&&"undefined"!=typeof console&&null!==console&&console[f]("..."+f+" of "+args.length+" items..."),_results=[],_i=0,_len=args.length;_len>_i;_i++)arg=args[_i],_results.push("undefined"!=typeof console&&null!==console?console[f](arg):void 0);return _results},suppress:function(f){return developer.suppressed=!0,f?(f(),developer.suppressed=!1):void 0},unsuppress:function(){return developer.suppressed=!1},log:function(){return developer.suppressed||null==("undefined"!=typeof console&&null!==console?console.log:void 0)?void 0:console.log.apply?console.log.apply(console,arguments):developer._ie_console("log",arguments)},warn:function(){return developer.suppressed||null==("undefined"!=typeof console&&null!==console?console.warn:void 0)?void 0:console.warn.apply?console.warn.apply(console,arguments):developer._ie_console("warn",arguments)},error:function(message){throw new developer.DevelopmentError(message)},assert:function(result,message){return result?void 0:developer.error(message)},"do":function(f){return developer.suppressed?void 0:f()},addFilters:function(){return Batman.extend(Batman.Filters,{log:function(value){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(arguments),value},logStack:function(value){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(developer.currentFilterStack),value}})},deprecated:function(deprecatedName,upgradeString){return Batman.developer.warn(""+deprecatedName+" has been deprecated.",upgradeString||"")}},developer=Batman.developer,Batman.developer.assert(function(){}.bind,"Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!")}.call(this),function(){Batman.Event=function(){function Event(base,key){this.base=base,this.key=key,this._preventCount=0}return Event.forBaseAndKey=function(base,key){return base.isEventEmitter?base.event(key):new Batman.Event(base,key)},Event.prototype.isEvent=!0,Event.prototype.isEqual=function(other){return this.constructor===other.constructor&&this.base===other.base&&this.key===other.key},Event.prototype.hashKey=function(){var key;return this.hashKey=function(){return key},key="<Batman.Event base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'},Event.prototype.addHandler=function(handler){return this.handlers||(this.handlers=[]),-1===this.handlers.indexOf(handler)&&this.handlers.push(handler),this.oneShot&&this.autofireHandler(handler),this},Event.prototype.removeHandler=function(handler){var index;return this.handlers&&-1!==(index=this.handlers.indexOf(handler))&&this.handlers.splice(index,1),this},Event.prototype.eachHandler=function(iterator){var ancestor,key,_i,_len,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;if(null!=(_ref=this.handlers)&&_ref.slice().forEach(iterator),null!=(_ref1=this.base)?_ref1.isEventEmitter:void 0)for(key=this.key,_ref3=null!=(_ref2=this.base._batman)?_ref2.ancestors():void 0,_i=0,_len=_ref3.length;_len>_i;_i++)ancestor=_ref3[_i],ancestor.isEventEmitter&&(null!=(_ref4=ancestor._batman)&&null!=(_ref5=_ref4.events)?_ref5.hasOwnProperty(key):void 0)&&null!=(_ref6=ancestor.event(key,!1))&&null!=(_ref7=_ref6.handlers)&&_ref7.slice().forEach(iterator)},Event.prototype.clearHandlers=function(){return this.handlers=void 0},Event.prototype.handlerContext=function(){return this.base},Event.prototype.prevent=function(){return++this._preventCount},Event.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount
},Event.prototype.isPrevented=function(){return this._preventCount>0},Event.prototype.autofireHandler=function(handler){return this._oneShotFired&&null!=this._oneShotArgs?handler.apply(this.handlerContext(),this._oneShotArgs):void 0},Event.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},Event.prototype.fire=function(){return this.fireWithContext(this.handlerContext(),arguments)},Event.prototype.fireWithContext=function(context,args){return this.isPrevented()||this._oneShotFired?!1:(this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=args),this.eachHandler(function(handler){return handler.apply(context,args)}))},Event.prototype.allowAndFire=function(){return this.allowAndFireWithContext(this.handlerContext(),arguments)},Event.prototype.allowAndFireWithContext=function(context,args){return this.allow(),this.fireWithContext(context,args)},Event}()}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PropertyEvent=function(_super){function PropertyEvent(){return _ref=PropertyEvent.__super__.constructor.apply(this,arguments)}return __extends(PropertyEvent,_super),PropertyEvent.prototype.eachHandler=function(iterator){return this.eachObserver(iterator)},PropertyEvent.prototype.handlerContext=function(){return this.base},PropertyEvent}(Batman.Event)}.call(this),function(){var __slice=[].slice;Batman.EventEmitter={isEventEmitter:!0,hasEvent:function(key){var _ref,_ref1;return null!=(_ref=this._batman)&&"function"==typeof _ref.get&&null!=(_ref1=_ref.get("events"))?_ref1.hasOwnProperty(key):void 0},event:function(key,createEvent){var ancestor,eventClass,events,existingEvent,newEvent,_base,_i,_len,_ref,_ref1,_ref2,_ref3;if(null==createEvent&&(createEvent=!0),Batman.initializeObject(this),eventClass=this.eventClass||Batman.Event,null!=(_ref=this._batman.events)?_ref.hasOwnProperty(key):void 0)return existingEvent=this._batman.events[key];for(_ref1=this._batman.ancestors(),_i=0,_len=_ref1.length;_len>_i&&(ancestor=_ref1[_i],!(existingEvent=null!=(_ref2=ancestor._batman)&&null!=(_ref3=_ref2.events)?_ref3[key]:void 0));_i++);return createEvent||(null!=existingEvent?existingEvent.oneShot:void 0)?(events=(_base=this._batman).events||(_base.events={}),newEvent=events[key]=new eventClass(this,key),newEvent.oneShot=null!=existingEvent?existingEvent.oneShot:void 0,newEvent):existingEvent},on:function(){var handler,key,keys,_i,_j,_len;for(keys=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),handler=arguments[_i++],_j=0,_len=keys.length;_len>_j;_j++)key=keys[_j],this.event(key).addHandler(handler);return!0},off:function(){var handler,key,keys,_i,_j,_len;for(keys=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),handler=arguments[_i++],keys.length||(key=handler,this.event(key).clearHandlers()),_j=0,_len=keys.length;_len>_j;_j++)key=keys[_j],this.event(key).removeHandler(handler);return!0},once:function(key,handler){var event,handlerWrapper;return event=this.event(key),handlerWrapper=function(){return handler.apply(this,arguments),event.removeHandler(handlerWrapper)},event.addHandler(handlerWrapper)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutate:function(wrappedFunction){var result;return this.prevent("change"),result=wrappedFunction.call(this),this.allowAndFire("change",this,this),result},mutation:function(wrappedFunction){return function(){var result,_ref;return result=wrappedFunction.apply(this,arguments),null!=(_ref=this.event("change",!1))&&_ref.fire(this,this),result}},prevent:function(key){return this.event(key).prevent(),this},allow:function(key){return this.event(key).allow(),this},fire:function(){var args,key,_ref;return key=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],null!=(_ref=this.event(key,!1))?_ref.fireWithContext(this,args):void 0},allowAndFire:function(){var args,key,_ref;return key=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],null!=(_ref=this.event(key,!1))?_ref.allowAndFireWithContext(this,args):void 0},isPrevented:function(key){var _ref;return null!=(_ref=this.event(key,!1))?_ref.isPrevented():void 0}}}.call(this),function(){var fire,__slice=[].slice;Batman.LifecycleEvents={initialize:function(){return this.prototype.fireLifecycleEvent=fire},lifecycleEvent:function(eventName,normalizeFunction){var addCallback,afterName,beforeName;return beforeName="before"+Batman.helpers.camelize(eventName),afterName="after"+Batman.helpers.camelize(eventName),addCallback=function(lifecycleEventName){return function(callbackName,options){var callback,handlers,target,_base,_ref;return"Object"===Batman.typeOf(callbackName)&&(_ref=[options,callbackName],callbackName=_ref[0],options=_ref[1]),callback="String"===Batman.typeOf(callbackName)?function(){return this[callbackName].apply(this,arguments)}:callbackName,options=("function"==typeof normalizeFunction?normalizeFunction(options):void 0)||options,target=this.prototype||this,Batman.initializeObject(target),handlers=(_base=target._batman)[lifecycleEventName]||(_base[lifecycleEventName]=[]),handlers.push({options:options,callback:callback})}},this[beforeName]=addCallback(beforeName),this.prototype[beforeName]=addCallback(beforeName),this[afterName]=addCallback(afterName),this.prototype[afterName]=addCallback(afterName)}},fire=function(){var args,callback,handlers,lifecycleEventName,options,_i,_len,_ref;if(lifecycleEventName=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],handlers=this._batman.get(lifecycleEventName))for(_i=0,_len=handlers.length;_len>_i;_i++)if(_ref=handlers[_i],options=_ref.options,callback=_ref.callback,!((null!=options?options["if"]:0)&&!options["if"].apply(this,args)||(null!=options?options.unless:void 0)&&options.unless.apply(this,args)||callback.apply(this,args)!==!1))return!1}}.call(this),function(){Batman.Enumerable={isEnumerable:!0,map:function(f,ctx){var result;return null==ctx&&(ctx=Batman.container),result=[],this.forEach(function(){return result.push(f.apply(ctx,arguments))}),result},mapToProperty:function(key){var result;return result=[],this.forEach(function(item){return result.push(Batman.get(item,key))}),result},every:function(f,ctx){var result;return null==ctx&&(ctx=Batman.container),result=!0,this.forEach(function(){return result=result&&!!f.apply(ctx,arguments)}),result},some:function(f,ctx){var result;return null==ctx&&(ctx=Batman.container),result=!1,this.forEach(function(){return result=result||!!f.apply(ctx,arguments)}),result},reduce:function(f,accumulator){var index,initialValuePassed;return index=0,initialValuePassed=null!=accumulator,this.forEach(function(element,value){return initialValuePassed?(accumulator=f(accumulator,element,value,index,self),index++):(accumulator=element,void(initialValuePassed=!0))}),accumulator},filter:function(f){var result,wrap,_this=this;return result=new this.constructor,result.add?wrap=function(result,element,value){return f(element,value,_this)&&result.add(element),result}:result.set?wrap=function(result,element,value){return f(element,value,_this)&&result.set(element,value),result}:(result.push||(result=[]),wrap=function(result,element,value){return f(element,value,_this)&&result.push(element),result}),this.reduce(wrap,result)},count:function(f,ctx){var count,_this=this;return null==ctx&&(ctx=Batman.container),f?(count=0,this.forEach(function(element,value){return f.call(ctx,element,value,_this)?count++:void 0}),count):this.length},inGroupsOf:function(groupSize){var current,i,result;return result=[],current=!1,i=0,this.forEach(function(element){return i++%groupSize===0&&(current=[],result.push(current)),current.push(element)}),result}}}.call(this),function(){var _objectToString,__slice=[].slice;_objectToString=Object.prototype.toString,Batman.SimpleHash=function(){function SimpleHash(obj){this._storage={},this.length=0,null!=obj&&this.update(obj)}return Batman.extend(SimpleHash.prototype,Batman.Enumerable),SimpleHash.prototype.hasKey=function(key){var pair,pairs,_i,_len;if(this.objectKey(key)){if(!this._objectStorage)return!1;if(pairs=this._objectStorage[this.hashKeyFor(key)])for(_i=0,_len=pairs.length;_len>_i;_i++)if(pair=pairs[_i],this.equality(pair[0],key))return!0;return!1}return key=this.prefixedKey(key),this._storage.hasOwnProperty(key)},SimpleHash.prototype.getObject=function(key){var pair,pairs,_i,_len;if(this._objectStorage&&(pairs=this._objectStorage[this.hashKeyFor(key)]))for(_i=0,_len=pairs.length;_len>_i;_i++)if(pair=pairs[_i],this.equality(pair[0],key))return pair[1]},SimpleHash.prototype.getString=function(key){return this._storage["_"+key]},SimpleHash.prototype.setObject=function(key,val){var pair,pairs,_base,_i,_len,_name;for(this._objectStorage||(this._objectStorage={}),pairs=(_base=this._objectStorage)[_name=this.hashKeyFor(key)]||(_base[_name]=[]),_i=0,_len=pairs.length;_len>_i;_i++)if(pair=pairs[_i],this.equality(pair[0],key))return pair[1]=val;return this.length++,pairs.push([key,val]),val},SimpleHash.prototype.setString=function(key,val){return key="_"+key,null==this._storage[key]&&this.length++,this._storage[key]=val},SimpleHash.prototype.get=function(key){var pair,pairs,_i,_len;if(!this.objectKey(key))return this._storage[this.prefixedKey(key)];if(this._objectStorage&&(pairs=this._objectStorage[this.hashKeyFor(key)]))for(_i=0,_len=pairs.length;_len>_i;_i++)if(pair=pairs[_i],this.equality(pair[0],key))return pair[1]},SimpleHash.prototype.set=function(key,val){var pair,pairs,_base,_i,_len,_name;if(this.objectKey(key)){for(this._objectStorage||(this._objectStorage={}),pairs=(_base=this._objectStorage)[_name=this.hashKeyFor(key)]||(_base[_name]=[]),_i=0,_len=pairs.length;_len>_i;_i++)if(pair=pairs[_i],this.equality(pair[0],key))return pair[1]=val;return this.length++,pairs.push([key,val]),val}return key=this.prefixedKey(key),null==this._storage[key]&&this.length++,this._storage[key]=val},SimpleHash.prototype.unset=function(key){var hashKey,index,obj,pair,pairs,val,value,_i,_len,_ref;if(!this.objectKey(key))return key=this.prefixedKey(key),val=this._storage[key],null!=this._storage[key]&&(this.length--,delete this._storage[key]),val;if(this._objectStorage&&(hashKey=this.hashKeyFor(key),pairs=this._objectStorage[hashKey]))for(index=_i=0,_len=pairs.length;_len>_i;index=++_i)if(_ref=pairs[index],obj=_ref[0],value=_ref[1],this.equality(obj,key))return pair=pairs.splice(index,1),pairs.length||delete this._objectStorage[hashKey],this.length--,pair[0][1]},SimpleHash.prototype.getOrSet=function(key,valueFunction){var currentValue;return currentValue=this.get(key),currentValue||(currentValue=valueFunction(),this.set(key,currentValue)),currentValue},SimpleHash.prototype.prefixedKey=function(key){return"_"+key},SimpleHash.prototype.unprefixedKey=function(key){return key.slice(1)},SimpleHash.prototype.hashKeyFor=function(obj){var hashKey,typeString;return(hashKey=null!=obj&&"function"==typeof obj.hashKey?obj.hashKey():void 0)?hashKey:(typeString=_objectToString.call(obj),"[object Array]"===typeString?typeString:obj)},SimpleHash.prototype.equality=function(lhs,rhs){return lhs===rhs?!0:lhs!==lhs&&rhs!==rhs?!0:(null!=lhs&&"function"==typeof lhs.isEqual?lhs.isEqual(rhs):void 0)&&(null!=rhs&&"function"==typeof rhs.isEqual?rhs.isEqual(lhs):void 0)?!0:!1},SimpleHash.prototype.objectKey=function(key){return"string"!=typeof key},SimpleHash.prototype.forEach=function(iterator,ctx){var key,obj,results,value,values,_i,_len,_ref,_ref1,_ref2,_ref3;if(results=[],this._objectStorage){_ref=this._objectStorage;for(key in _ref)for(values=_ref[key],_ref1=values.slice(),_i=0,_len=_ref1.length;_len>_i;_i++)_ref2=_ref1[_i],obj=_ref2[0],value=_ref2[1],results.push(iterator.call(ctx,obj,value,this))}_ref3=this._storage;for(key in _ref3)value=_ref3[key],results.push(iterator.call(ctx,this.unprefixedKey(key),value,this));return results},SimpleHash.prototype.keys=function(){var result;return result=[],Batman.SimpleHash.prototype.forEach.call(this,function(key){return result.push(key)}),result},SimpleHash.prototype.toArray=SimpleHash.prototype.keys,SimpleHash.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},SimpleHash.prototype.isEmpty=function(){return 0===this.length},SimpleHash.prototype.merge=function(){var hash,merged,others,_i,_len;for(others=1<=arguments.length?__slice.call(arguments,0):[],merged=new this.constructor,others.unshift(this),_i=0,_len=others.length;_len>_i;_i++)hash=others[_i],hash.forEach(function(obj,value){return merged.set(obj,value)});return merged},SimpleHash.prototype.update=function(object){var k,v;for(k in object)v=object[k],this.set(k,v)},SimpleHash.prototype.replace=function(object){var _this=this;return this.forEach(function(key){return key in object?void 0:_this.unset(key)}),this.update(object)},SimpleHash.prototype.toObject=function(){var key,obj,pair,value,_ref,_ref1;obj={},_ref=this._storage;for(key in _ref)value=_ref[key],obj[this.unprefixedKey(key)]=value;if(this._objectStorage){_ref1=this._objectStorage;for(key in _ref1)pair=_ref1[key],obj[key]=pair[0][1]}return obj},SimpleHash.prototype.toJSON=function(){var key,obj,objectKey,value,values,_ref,_ref1,_ref2;obj={},_ref=this._storage;for(key in _ref)value=_ref[key],obj[this.unprefixedKey(key)]=(null!=value&&"function"==typeof value.toJSON?value.toJSON():void 0)||value;if(this._objectStorage){_ref1=this._objectStorage;for(key in _ref1)values=_ref1[key],_ref2=values[0],objectKey=_ref2[0],value=_ref2[1],obj[key]=(null!=value&&"function"==typeof value.toJSON?value.toJSON():void 0)||value}return obj},SimpleHash}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.AssociationCurator=function(_super){function AssociationCurator(model){this.model=model,AssociationCurator.__super__.constructor.call(this),this._byTypeStorage=new Batman.SimpleHash}return __extends(AssociationCurator,_super),AssociationCurator.availableAssociations=["belongsTo","hasOne","hasMany"],AssociationCurator.prototype.add=function(association){var associationTypeSet;return this.set(association.label,association),(associationTypeSet=this._byTypeStorage.get(association.associationType))||(associationTypeSet=new Batman.SimpleSet,this._byTypeStorage.set(association.associationType,associationTypeSet)),associationTypeSet.add(association)},AssociationCurator.prototype.getByType=function(type){return this._byTypeStorage.get(type)},AssociationCurator.prototype.getByLabel=function(label){return this.get(label)},AssociationCurator.prototype.getAll=function(){var allAssociations,typeSets,_ref;return typeSets=this._byTypeStorage.map(function(label,typeSet){return typeSet}),allAssociations=(_ref=new Batman.SimpleSet).merge.apply(_ref,typeSets)},AssociationCurator.prototype.reset=function(){return this.forEach(function(label,association){return association.reset()}),!0},AssociationCurator.prototype.merge=function(){var others,result;return others=1<=arguments.length?__slice.call(arguments,0):[],result=AssociationCurator.__super__.merge.apply(this,arguments),result._byTypeStorage=this._byTypeStorage.merge(others.map(function(other){return other._byTypeStorage})),result},AssociationCurator.prototype._markDirtyAttribute=function(key,oldValue){var _ref;if("loading"!==(_ref=this.lifecycle.get("state"))&&"creating"!==_ref&&"saving"!==_ref&&"saved"!==_ref){if(this.lifecycle.startTransition("set"))return this.dirtyKeys.set(key,oldValue);throw new Batman.StateMachine.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}},AssociationCurator}(Batman.SimpleHash)}.call(this),function(){var __slice=[].slice;Batman.SimpleSet=function(){function SimpleSet(){var item,itemsToAdd;this._storage=[],this.length=0,itemsToAdd=function(){var _i,_len,_results;for(_results=[],_i=0,_len=arguments.length;_len>_i;_i++)item=arguments[_i],null!=item&&_results.push(item);return _results}.apply(this,arguments),itemsToAdd.length>0&&this.add.apply(this,itemsToAdd)}return Batman.extend(SimpleSet.prototype,Batman.Enumerable),SimpleSet.prototype.at=function(index){return this._storage[index]},SimpleSet.prototype.add=function(){var addedItems,item,items,_i,_len;for(items=1<=arguments.length?__slice.call(arguments,0):[],addedItems=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],-1===this._indexOfItem(item)&&(this._storage.push(item),addedItems.push(item));return this.length=this._storage.length,addedItems},SimpleSet.prototype.insert=function(){return this.insertWithIndexes.apply(this,arguments).addedItems},SimpleSet.prototype.insertWithIndexes=function(items,indexes){var addedIndexes,addedItems,i,index,item,_i,_len;for(addedIndexes=[],addedItems=[],i=_i=0,_len=items.length;_len>_i;i=++_i)item=items[i],-1===this._indexOfItem(item)&&(index=indexes[i],this._storage.splice(index,0,item),addedItems.push(item),addedIndexes.push(index));return this.length=this._storage.length,{addedItems:addedItems,addedIndexes:addedIndexes}},SimpleSet.prototype.remove=function(){return this.removeWithIndexes.apply(this,arguments).removedItems},SimpleSet.prototype.removeWithIndexes=function(){var index,item,items,removedIndexes,removedItems,_i,_len;for(items=1<=arguments.length?__slice.call(arguments,0):[],removedIndexes=[],removedItems=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],-1!==(index=this._indexOfItem(item))&&(this._storage.splice(index,1),removedItems.push(item),removedIndexes.push(index));return this.length=this._storage.length,{removedItems:removedItems,removedIndexes:removedIndexes}},SimpleSet.prototype.clear=function(){var items;return items=this._storage,this._storage=[],this.length=0,items},SimpleSet.prototype.replace=function(other){return this.clear(),this.add.apply(this,other.toArray())},SimpleSet.prototype.has=function(item){return-1!==this._indexOfItem(item)},SimpleSet.prototype.find=function(fn){var item,_i,_len,_ref;for(_ref=this._storage,_i=0,_len=_ref.length;_len>_i;_i++)if(item=_ref[_i],fn(item))return item},SimpleSet.prototype.forEach=function(iterator,ctx){var key,_i,_len,_ref;for(_ref=this._storage,_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],iterator.call(ctx,key,null,this)},SimpleSet.prototype.isEmpty=function(){return 0===this.length},SimpleSet.prototype.toArray=function(){return this._storage.slice()},SimpleSet.prototype.merge=function(){var merged,others,set,_i,_len;for(others=1<=arguments.length?__slice.call(arguments,0):[],merged=new this.constructor,others.unshift(this),_i=0,_len=others.length;_len>_i;_i++)set=others[_i],set.forEach(function(v){return merged.add(v)});return merged},SimpleSet.prototype.mappedTo=function(key){var _this=this;return this._mappings||(this._mappings=new Batman.SimpleHash),this._mappings.getOrSet(key,function(){return new Batman.SetMapping(_this,key)})},SimpleSet.prototype.indexedBy=function(key){return this._indexes||(this._indexes=new Batman.SimpleHash),this._indexes.get(key)||this._indexes.set(key,new Batman.SetIndex(this,key))},SimpleSet.prototype.indexedByUnique=function(key){return this._uniqueIndexes||(this._uniqueIndexes=new Batman.SimpleHash),this._uniqueIndexes.get(key)||this._uniqueIndexes.set(key,new Batman.UniqueSetIndex(this,key))},SimpleSet.prototype.sortedBy=function(key,order){var sortsForKey;return null==order&&(order="asc"),order="desc"===order.toLowerCase()?"desc":"asc",this._sorts||(this._sorts=new Batman.SimpleHash),sortsForKey=this._sorts.get(key)||this._sorts.set(key,new Batman.Object),sortsForKey.get(order)||sortsForKey.set(order,new Batman.SetSort(this,key,order))},SimpleSet.prototype.equality=Batman.SimpleHash.prototype.equality,SimpleSet.prototype._indexOfItem=function(givenItem){var index,item,_i,_len,_ref;for(_ref=this._storage,index=_i=0,_len=_ref.length;_len>_i;index=++_i)if(item=_ref[index],this.equality(givenItem,item))return index;return-1},SimpleSet}()}.call(this),function(){var SOURCE_TRACKER_STACK,SOURCE_TRACKER_STACK_VALID,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};SOURCE_TRACKER_STACK=[],SOURCE_TRACKER_STACK_VALID=!0,Batman.Property=function(_super){function Property(base,key){this.base=base,this.key=key}return __extends(Property,_super),Property._sourceTrackerStack=SOURCE_TRACKER_STACK,Property._sourceTrackerStackValid=SOURCE_TRACKER_STACK_VALID,Property.defaultAccessor={get:function(key){return this[key]},set:function(key,val){return this[key]=val},unset:function(key){var x;return x=this[key],delete this[key],x},cache:!1},Property.defaultAccessorForBase=function(base){var _ref;return(null!=(_ref=base._batman)?_ref.getFirst("defaultAccessor"):void 0)||Batman.Property.defaultAccessor},Property.accessorForBaseAndKey=function(base,key){var accessor,ancestor,_bm,_i,_len,_ref,_ref1,_ref2,_ref3;if(null!=(_bm=base._batman)&&(accessor=null!=(_ref=_bm.keyAccessors)?_ref.get(key):void 0,!accessor))for(_ref1=_bm.ancestors(),_i=0,_len=_ref1.length;_len>_i&&(ancestor=_ref1[_i],!(accessor=null!=(_ref2=ancestor._batman)&&null!=(_ref3=_ref2.keyAccessors)?_ref3.get(key):void 0));_i++);return accessor||this.defaultAccessorForBase(base)},Property.forBaseAndKey=function(base,key){return base.isObservable?base.property(key):new Batman.Keypath(base,key)},Property.withoutTracking=function(block){return this.wrapTrackingPrevention(block)()},Property.wrapTrackingPrevention=function(block){return function(){Batman.Property.pushDummySourceTracker();try{return block.apply(this,arguments)}finally{Batman.Property.popSourceTracker()}}},Property.registerSource=function(obj){var set;if(obj.isEventEmitter||obj instanceof Batman.Property)return SOURCE_TRACKER_STACK_VALID?set=SOURCE_TRACKER_STACK[SOURCE_TRACKER_STACK.length-1]:(set=[],SOURCE_TRACKER_STACK.push(set),SOURCE_TRACKER_STACK_VALID=!0),void(null!=set&&set.push(obj))},Property.pushSourceTracker=function(){return SOURCE_TRACKER_STACK_VALID?SOURCE_TRACKER_STACK_VALID=!1:SOURCE_TRACKER_STACK.push([])},Property.popSourceTracker=function(){return SOURCE_TRACKER_STACK_VALID?SOURCE_TRACKER_STACK.pop():void(SOURCE_TRACKER_STACK_VALID=!0)},Property.pushDummySourceTracker=function(){return SOURCE_TRACKER_STACK_VALID||(SOURCE_TRACKER_STACK.push([]),SOURCE_TRACKER_STACK_VALID=!0),SOURCE_TRACKER_STACK.push(null)},Property.prototype._isolationCount=0,Property.prototype.cached=!1,Property.prototype.value=null,Property.prototype.sources=null,Property.prototype.isProperty=!0,Property.prototype.isDead=!1,Property.prototype.isBatchingChanges=!1,Property.prototype.registerAsMutableSource=function(){return Batman.Property.registerSource(this)},Property.prototype.isEqual=function(other){return this.constructor===other.constructor&&this.base===other.base&&this.key===other.key},Property.prototype.hashKey=function(){return this._hashKey||(this._hashKey="<Batman.Property base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">')},Property.prototype.accessor=function(){return this._accessor||(this._accessor=this.constructor.accessorForBaseAndKey(this.base,this.key))},Property.prototype.eachObserver=function(iterator){var ancestor,handlers,key,object,property,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2;if(key=this.key,handlers=null!=(_ref=this.handlers)?_ref.slice():void 0)for(_i=0,_len=handlers.length;_len>_i;_i++)object=handlers[_i],iterator(object);if(this.base.isObservable)for(_ref1=this.base._batman.ancestors(),_j=0,_len1=_ref1.length;_len1>_j;_j++)if(ancestor=_ref1[_j],ancestor.isObservable&&ancestor.hasProperty(key)&&(property=ancestor.property(key),handlers=null!=(_ref2=property.handlers)?_ref2.slice():void 0))for(_k=0,_len2=handlers.length;_len2>_k;_k++)object=handlers[_k],iterator(object)},Property.prototype.observers=function(){var results;return results=[],this.eachObserver(function(observer){return results.push(observer)}),results},Property.prototype.hasObservers=function(){return this.observers().length>0},Property.prototype.updateSourcesFromTracker=function(){var handler,newSources,source,_i,_j,_len,_len1,_ref,_ref1;if(newSources=this.constructor.popSourceTracker(),handler=this.sourceChangeHandler(),this.sources)for(_ref=this.sources,_i=0,_len=_ref.length;_len>_i;_i++)source=_ref[_i],null!=source&&(source.on?source.off("change",handler):source.removeHandler(handler));if(this.sources=newSources,this.sources)for(_ref1=this.sources,_j=0,_len1=_ref1.length;_len1>_j;_j++)source=_ref1[_j],null!=source&&(source.on?source.on("change",handler):source.addHandler(handler));return null},Property.prototype.getValue=function(){if(this.registerAsMutableSource(),!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},Property.prototype.isCachable=function(){var cacheable;return this.isFinal()?!0:(cacheable=this.accessor().cache,null!=cacheable?!!cacheable:!0)},Property.prototype.isCached=function(){return this.isCachable()&&this.cached},Property.prototype.isFinal=function(){return this.final||(this.final=!!this.accessor()["final"])},Property.prototype.refresh=function(){var previousValue,value;return this.cached=!1,previousValue=this.value,value=this.getValue(),value===previousValue||this.isIsolated()||this.fire(value,previousValue,this.key),void 0!==this.value&&this.isFinal()?this.lockValue():void 0},Property.prototype.sourceChangeHandler=function(){var _this=this;return this._sourceChangeHandler||(this._sourceChangeHandler=function(){return _this._handleSourceChange()}),Batman.developer["do"](function(){return _this._sourceChangeHandler.property=_this}),this._sourceChangeHandler},Property.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:this.isDead?this._removeHandlers():this.isFinal()||this.hasObservers()?this.isBatchingChanges?void 0:this.refresh():(this.cached=!1,this._removeHandlers())},Property.prototype.valueFromAccessor=function(){var _ref;return null!=(_ref=this.accessor().get)?_ref.call(this.base,this.key):void 0},Property.prototype.setValue=function(val){var set;if(set=this.accessor().set)return this._changeValue(function(){return set.call(this.base,this.key,val)})},Property.prototype.unsetValue=function(){var unset;if(unset=this.accessor().unset)return this._changeValue(function(){return unset.call(this.base,this.key)})},Property.prototype._changeValue=function(block){var result;this.cached=!1,this.constructor.pushDummySourceTracker();try{result=block.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return this.isCached()||this.hasObservers()||this.die(),result},Property.prototype.forget=function(handler){return null!=handler?this.removeHandler(handler):this.clearHandlers()},Property.prototype.observeAndFire=function(handler){return this.observe(handler),handler.call(this.base,this.value,this.value,this.key)},Property.prototype.observe=function(handler){return this.addHandler(handler),null==this.sources&&this.getValue(),this},Property.prototype.observeOnce=function(originalHandler){var handler,self;return self=this,handler=function(){return originalHandler.apply(this,arguments),self.removeHandler(handler)},this.addHandler(handler),null==this.sources&&this.getValue(),this},Property.prototype._removeHandlers=function(){var handler,source,_i,_len,_ref;if(handler=this.sourceChangeHandler(),this.sources)for(_ref=this.sources,_i=0,_len=_ref.length;_len>_i;_i++)source=_ref[_i],source.on?source.off("change",handler):source.removeHandler(handler);return delete this.sources,this.clearHandlers()},Property.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},Property.prototype.die=function(){var _ref,_ref1;return this._removeHandlers(),null!=(_ref=this.base._batman)&&null!=(_ref1=_ref.properties)&&_ref1.unset(this.key),this.base=null,this.isDead=!0},Property.prototype.isolate=function(){return 0===this._isolationCount&&(this._preIsolationValue=this.getValue()),this._isolationCount++},Property.prototype.expose=function(){return 1===this._isolationCount?(this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue,this.key),this._preIsolationValue=null):this._isolationCount>0?this._isolationCount--:void 0},Property.prototype.isIsolated=function(){return this._isolationCount>0},Property}(Batman.PropertyEvent)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Keypath=function(_super){function Keypath(base,key){"string"==typeof key?(this.segments=key.split("."),this.depth=this.segments.length):(this.segments=[key],this.depth=1),Keypath.__super__.constructor.apply(this,arguments)}return __extends(Keypath,_super),Keypath.prototype.isCachable=function(){return 1===this.depth?Keypath.__super__.isCachable.apply(this,arguments):!0},Keypath.prototype.terminalProperty=function(){var base;return base=Batman.getPath(this.base,this.segments.slice(0,-1)),null!=base?Batman.Keypath.forBaseAndKey(base,this.segments[this.depth-1]):void 0},Keypath.prototype.valueFromAccessor=function(){return 1===this.depth?Keypath.__super__.valueFromAccessor.apply(this,arguments):Batman.getPath(this.base,this.segments)},Keypath.prototype.setValue=function(val){var _ref;return 1===this.depth?Keypath.__super__.setValue.apply(this,arguments):null!=(_ref=this.terminalProperty())?_ref.setValue(val):void 0},Keypath.prototype.unsetValue=function(){var _ref;return 1===this.depth?Keypath.__super__.unsetValue.apply(this,arguments):null!=(_ref=this.terminalProperty())?_ref.unsetValue():void 0},Keypath}(Batman.Property)}.call(this),function(){var __slice=[].slice;Batman.Observable={isObservable:!0,hasProperty:function(key){var _ref,_ref1;return null!=(_ref=this._batman)&&null!=(_ref1=_ref.properties)&&"function"==typeof _ref1.hasKey?_ref1.hasKey(key):void 0},property:function(key){var properties,propertyClass,_base;return Batman.initializeObject(this),propertyClass=this.propertyClass||Batman.Keypath,properties=(_base=this._batman).properties||(_base.properties=new Batman.SimpleHash),properties.objectKey(key)?properties.getObject(key)||properties.setObject(key,new propertyClass(this,key)):properties.getString(key)||properties.setString(key,new propertyClass(this,key))},get:function(key){return this.property(key).getValue()},set:function(key,val){return this.property(key).setValue(val)},unset:function(key){return this.property(key).unsetValue()},getOrSet:Batman.SimpleHash.prototype.getOrSet,forget:function(key,observer){var _ref;return key?this.property(key).forget(observer):null!=(_ref=this._batman.properties)&&_ref.forEach(function(key,property){return property.forget()}),this},observe:function(){var args,key,_ref;return key=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],(_ref=this.property(key)).observe.apply(_ref,args),this},observeAndFire:function(){var args,key,_ref;return key=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],(_ref=this.property(key)).observeAndFire.apply(_ref,args),this},observeOnce:function(){var args,key,_ref;return key=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],(_ref=this.property(key)).observeOnce.apply(_ref,args),this}}}.call(this),function(){var methodName,platformMethods,_i,_len;for(Batman.DOM={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(elementID){var _ref;return null!=(_ref=document.getElementById(elementID))&&"function"==typeof _ref.scrollIntoView?_ref.scrollIntoView():void 0},setStyleProperty:function(node,property,value,importance){return node.style.setProperty?node.style.setProperty(property,value,importance):node.style.setAttribute(property,value,importance)},valueForNode:function(node,value,escapeValue){var child,isSetting,nodeName,_i,_len,_ref,_results;
switch(null==value&&(value=""),null==escapeValue&&(escapeValue=!0),isSetting=arguments.length>1,nodeName=node.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return isSetting?node.value=value:node.value;case"SELECT":if(isSetting)return node.value=value;if(node.multiple){for(_ref=node.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],child.selected&&_results.push(child.value);return _results}return node.value;default:return isSetting?("OPTION"===nodeName&&(node.text=value),Batman.DOM.setInnerHTML(node,escapeValue?Batman.escapeHTML(value):value)):node.innerHTML}},nodeIsEditable:function(node){var _ref;return"INPUT"===(_ref=node.nodeName.toUpperCase())||"TEXTAREA"===_ref||"SELECT"===_ref},addEventListener:function(node,eventName,callback){var listeners;return(listeners=Batman._data(node,"listeners"))||(listeners=Batman._data(node,"listeners",{})),listeners[eventName]||(listeners[eventName]=[]),listeners[eventName].push(callback),Batman.DOM.hasAddEventListener?node.addEventListener(eventName,callback,!1):node.attachEvent("on"+eventName,callback)},removeEventListener:function(node,eventName,callback){var eventListeners,index,listeners;return(listeners=Batman._data(node,"listeners"))&&(eventListeners=listeners[eventName])&&(index=eventListeners.indexOf(callback),-1!==index&&eventListeners.splice(index,1)),Batman.DOM.hasAddEventListener?node.removeEventListener(eventName,callback,!1):node.detachEvent("on"+eventName,callback)},cleanupNode:function(node){var child,eventListeners,eventName,listeners,_i,_len,_ref;if(listeners=Batman._data(node,"listeners"))for(eventName in listeners)eventListeners=listeners[eventName],eventListeners.forEach(function(listener){return Batman.DOM.removeEventListener(node,eventName,listener)});for(Batman.removeData(node,null,null,!0),_ref=node.childNodes,_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],Batman.DOM.cleanupNode(child)},hasAddEventListener:!!("undefined"!=typeof window&&null!==window?window.addEventListener:void 0),preventDefault:function(e){return"function"==typeof e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}},platformMethods=["querySelector","querySelectorAll","setInnerHTML","containsNode","destroyNode","textContent"],_i=0,_len=platformMethods.length;_len>_i;_i++)methodName=platformMethods[_i],Batman.DOM[methodName]=function(){return Batman.developer.error("Please include a platform adapter to define "+methodName+".")}}.call(this),function(){Batman.DOM.ReaderBindingDefinition=function(){function ReaderBindingDefinition(node,keyPath,view){this.node=node,this.keyPath=keyPath,this.view=view}return ReaderBindingDefinition}(),Batman.BindingDefinitionOnlyObserve={Data:"data",Node:"node",All:"all",None:"none"},Batman.DOM.readers={target:function(definition){return definition.onlyObserve=Batman.BindingDefinitionOnlyObserve.Node,Batman.DOM.readers.bind(definition)},source:function(definition){return definition.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.readers.bind(definition)},bind:function(definition){var bindingClass,node;switch(node=definition.node,node.nodeName.toLowerCase()){case"input":switch(node.getAttribute("type")){case"checkbox":return definition.attr="checked",Batman.DOM.attrReaders.bind(definition),!0;case"radio":bindingClass=Batman.DOM.RadioBinding;break;case"file":bindingClass=Batman.DOM.FileBinding}break;case"select":bindingClass=Batman.DOM.SelectBinding}return bindingClass||(bindingClass=Batman.DOM.ValueBinding),new bindingClass(definition)},context:function(definition){return new Batman.DOM.ContextBinding(definition)},showif:function(definition){return new Batman.DOM.ShowHideBinding(definition)},hideif:function(definition){return definition.invert=!0,new Batman.DOM.ShowHideBinding(definition)},insertif:function(definition){return new Batman.DOM.InsertionBinding(definition)},removeif:function(definition){return definition.invert=!0,new Batman.DOM.InsertionBinding(definition)},deferif:function(definition){return definition.invert=!0,new Batman.DOM.DeferredRenderBinding(definition)},renderif:function(definition){return new Batman.DOM.DeferredRenderBinding(definition)},route:function(definition){return new Batman.DOM.RouteBinding(definition)},view:function(definition){return new Batman.DOM.ViewBinding(definition)},partial:function(definition){var keyPath,node,partialView,view;return node=definition.node,keyPath=definition.keyPath,view=definition.view,node.removeAttribute("data-partial"),partialView=new Batman.View({source:keyPath,parentNode:node,node:node}),{skipChildren:!0,initialized:function(){return partialView.loadView(node),view.subviews.add(partialView)}}},defineview:function(definition){var keyPath,node,view;return node=definition.node,view=definition.view,keyPath=definition.keyPath,Batman.View.store.set(Batman.Navigator.normalizePath(keyPath),node.innerHTML),{skipChildren:!0,initialized:function(){return node.parentNode?node.parentNode.removeChild(node):void 0}}},contentfor:function(definition){var contentView,keyPath,node,view;return node=definition.node,keyPath=definition.keyPath,view=definition.view,contentView=new Batman.View({html:node.innerHTML,contentFor:keyPath}),contentView.addToParentNode=function(parentNode){return parentNode.innerHTML="",parentNode.appendChild(this.get("node"))},view.subviews.add(contentView),{skipChildren:!0,initialized:function(){return node.parentNode?node.parentNode.removeChild(node):void 0}}},"yield":function(definition){var yieldObject;return yieldObject=Batman.DOM.Yield.withName(definition.keyPath),yieldObject.set("containerNode",definition.node),{skipChildren:!0}}}}.call(this),function(){var __slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Batman.DOM.events={primaryInteractionEvent:function(node,callback,view,eventName,preventDefault){return null==eventName&&(eventName=Batman.DOM.primaryInteractionEventName),null==preventDefault&&(preventDefault=!0),Batman.DOM.addEventListener(node,eventName,function(){var args,event;return event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],event.metaKey||event.ctrlKey||1===event.button||(preventDefault&&Batman.DOM.preventDefault(event),!Batman.DOM.eventIsAllowed(eventName,event))?void 0:callback.apply(null,[node,event].concat(__slice.call(args),[view]))}),"A"!==node.nodeName.toUpperCase()||node.href||(node.href="#"),node},click:function(node,callback,view,eventName,preventDefault){return null==eventName&&(eventName="click"),null==preventDefault&&(preventDefault=!0),Batman.DOM.events.primaryInteractionEvent(node,callback,view,eventName,preventDefault)},doubleclick:function(node,callback,view){return Batman.DOM.events.click(node,callback,view,"dblclick")},change:function(node,callback,view){var eventName,eventNames,oldCallback,_i,_len;for(eventNames=function(){var _ref;switch(node.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":return _ref=node.type.toLowerCase(),__indexOf.call(Batman.DOM.textInputTypes,_ref)>=0?(oldCallback=callback,callback=function(node,event,view){return"keyup"===event.type&&Batman.DOM.events.isEnter(event)?void 0:oldCallback(node,event,view)},["input","keyup","change"]):["input","change"];default:return["change"]}}(),_i=0,_len=eventNames.length;_len>_i;_i++)eventName=eventNames[_i],Batman.DOM.addEventListener(node,eventName,function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],callback.apply(null,[node].concat(__slice.call(args),[view]))})},isEnter:function(ev){var _ref,_ref1;return 13<=(_ref=ev.keyCode)&&14>=_ref||13<=(_ref1=ev.which)&&14>=_ref1||"Enter"===ev.keyIdentifier||"Enter"===ev.key},submit:function(node,callback,view){return Batman.DOM.nodeIsEditable(node)?(Batman.DOM.addEventListener(node,"keydown",function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],Batman.DOM.events.isEnter(args[0])?Batman.DOM._keyCapturingNode=node:void 0}),Batman.DOM.addEventListener(node,"keyup",function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],Batman.DOM.events.isEnter(args[0])?(Batman.DOM._keyCapturingNode===node&&(Batman.DOM.preventDefault(args[0]),callback.apply(null,[node].concat(__slice.call(args),[view]))),Batman.DOM._keyCapturingNode=null):void 0})):Batman.DOM.addEventListener(node,"submit",function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],Batman.DOM.preventDefault(args[0]),callback.apply(null,[node].concat(__slice.call(args),[view]))}),node},other:function(node,eventName,callback,view){return Batman.DOM.addEventListener(node,eventName,function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],callback.apply(null,[node].concat(__slice.call(args),[view]))})}},Batman.DOM.eventIsAllowed=function(eventName,event){var delegate,_ref,_ref1;return(delegate=null!=(_ref=Batman.currentApp)&&null!=(_ref1=_ref.shouldAllowEvent)?_ref1[eventName]:void 0)&&delegate(event)===!1?!1:!0},Batman.DOM.primaryInteractionEventName="click"}.call(this),function(){Batman.DOM.AttrReaderBindingDefinition=function(){function AttrReaderBindingDefinition(node,attr,keyPath,view){this.node=node,this.attr=attr,this.keyPath=keyPath,this.view=view}return AttrReaderBindingDefinition}(),Batman.DOM.attrReaders={_parseAttribute:function(value){return"false"===value&&(value=!1),"true"===value&&(value=!0),value},source:function(definition){return definition.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.attrReaders.bind(definition)},bind:function(definition){var bindingClass;return new(bindingClass=function(){switch(definition.attr){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}())(definition)},context:function(definition){return new Batman.DOM.ContextBinding(definition)},event:function(definition){return new Batman.DOM.EventBinding(definition)},track:function(definition){return"view"===definition.attr?new Batman.DOM.ViewTrackingBinding(definition):"click"===definition.attr?new Batman.DOM.ClickTrackingBinding(definition):void 0},addclass:function(definition){return new Batman.DOM.AddClassBinding(definition)},removeclass:function(definition){return definition.invert=!0,new Batman.DOM.AddClassBinding(definition)},foreach:function(definition){return new Batman.DOM.IteratorBinding(definition)},formfor:function(definition){return new Batman.DOM.FormBinding(definition)},style:function(definition){return new Batman.DOM.StyleAttributeBinding(definition)}}}.call(this),function(){var BatmanObject,ObjectFunctions,getAccessorObject,promiseWrapper,wrapSingleAccessor,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};getAccessorObject=function(base,accessor){var deprecated,_i,_len,_ref;for("function"==typeof accessor&&(accessor={get:accessor}),_ref=["cachable","cacheable"],_i=0,_len=_ref.length;_len>_i;_i++)deprecated=_ref[_i],deprecated in accessor&&(Batman.developer.warn('Property accessor option "'+deprecated+'" is deprecated. Use "cache" instead.'),"cache"in accessor||(accessor.cache=accessor[deprecated]));return accessor},promiseWrapper=function(fetcher){return function(defaultAccessor){return{get:function(key){var asyncDeliver,existingValue,newValue,_base,_base1,_this=this;return null!=(existingValue=defaultAccessor.get.apply(this,arguments))?existingValue:(asyncDeliver=!1,newValue=void 0,null==(_base=this._batman).promises&&(_base.promises={}),null==(_base1=this._batman.promises)[key]&&(_base1[key]=function(){var deliver,returnValue;return deliver=function(err,result){return asyncDeliver&&_this.set(key,result),newValue=result},returnValue=fetcher.call(_this,deliver,key),null==newValue&&(newValue=returnValue),!0}()),asyncDeliver=!0,newValue)},cache:!0}}},wrapSingleAccessor=function(core,wrapper){var k,v;wrapper=("function"==typeof wrapper?wrapper(core):void 0)||wrapper;for(k in core)v=core[k],k in wrapper||(wrapper[k]=v);return wrapper},ObjectFunctions={_defineAccessor:function(){var accessor,key,keys,_base,_i,_j,_len,_ref;if(keys=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),accessor=arguments[_i++],null==accessor)return Batman.Property.defaultAccessorForBase(this);if(0===keys.length&&"Object"!==(_ref=Batman.typeOf(accessor))&&"Function"!==_ref)return Batman.Property.accessorForBaseAndKey(this,accessor);if("function"==typeof accessor.promise)return this._defineWrapAccessor.apply(this,__slice.call(keys).concat([promiseWrapper(accessor.promise)]));if(Batman.initializeObject(this),0===keys.length)this._batman.defaultAccessor=getAccessorObject(this,accessor);else for((_base=this._batman).keyAccessors||(_base.keyAccessors=new Batman.SimpleHash),_j=0,_len=keys.length;_len>_j;_j++)key=keys[_j],this._batman.keyAccessors.set(key,getAccessorObject(this,accessor));return!0},_defineWrapAccessor:function(){var key,keys,wrapper,_i,_j,_len;if(keys=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),wrapper=arguments[_i++],Batman.initializeObject(this),0===keys.length)this._defineAccessor(wrapSingleAccessor(this._defineAccessor(),wrapper));else for(_j=0,_len=keys.length;_len>_j;_j++)key=keys[_j],this._defineAccessor(key,wrapSingleAccessor(this._defineAccessor(key),wrapper));return!0},_resetPromises:function(){var key;if(null!=this._batman.promises)for(key in this._batman.promises)this._resetPromise(key)},_resetPromise:function(key){this.unset(key),this.property(key).cached=!1,delete this._batman.promises[key]}},BatmanObject=function(_super){function BatmanObject(){var mixins;mixins=1<=arguments.length?__slice.call(arguments,0):[],this._batman=new Batman._Batman(this),this.mixin.apply(this,mixins)}var counter;return __extends(BatmanObject,_super),Batman.initializeObject(BatmanObject),Batman.initializeObject(BatmanObject.prototype),Batman.mixin(BatmanObject.prototype,ObjectFunctions,Batman.EventEmitter,Batman.Observable),Batman.mixin(BatmanObject,ObjectFunctions,Batman.EventEmitter,Batman.Observable),BatmanObject.classMixin=function(){return Batman.mixin.apply(Batman,[this].concat(__slice.call(arguments)))},BatmanObject.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},BatmanObject.prototype.mixin=BatmanObject.classMixin,BatmanObject.classAccessor=BatmanObject._defineAccessor,BatmanObject.accessor=function(){var _ref;return(_ref=this.prototype)._defineAccessor.apply(_ref,arguments)},BatmanObject.prototype.accessor=BatmanObject._defineAccessor,BatmanObject.wrapClassAccessor=BatmanObject._defineWrapAccessor,BatmanObject.wrapAccessor=function(){var _ref;return(_ref=this.prototype)._defineWrapAccessor.apply(_ref,arguments)},BatmanObject.prototype.wrapAccessor=BatmanObject._defineWrapAccessor,BatmanObject.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},BatmanObject.singleton=function(singletonMethodName){return null==singletonMethodName&&(singletonMethodName="sharedInstance"),this.classAccessor(singletonMethodName,{get:function(){var _name;return this[_name="_"+singletonMethodName]||(this[_name]=new this)}})},BatmanObject.accessor("_batmanID",function(){return this._batmanID()}),BatmanObject.delegate=function(){var options,properties,_i,_this=this;return properties=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),options=arguments[_i++],null==options&&(options={}),options.to||Batman.developer.warn("delegate must include to option",this,properties),properties.forEach(function(property){return _this.accessor(property,{get:function(){var _ref;return null!=(_ref=this.get(options.to))?_ref.get(property):void 0},set:function(key,value){var _ref;return null!=(_ref=this.get(options.to))?_ref.set(property,value):void 0},unset:function(){var _ref;return null!=(_ref=this.get(options.to))?_ref.unset(property):void 0}})})},BatmanObject.classDelegate=function(){var options,properties,_i,_this=this;return properties=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),options=arguments[_i++],null==options&&(options={}),options.to||Batman.developer.warn("delegate must include to option",this,properties),properties.forEach(function(property){return _this.classAccessor(property,{get:function(){var _ref;return null!=(_ref=this.get(options.to))?_ref.get(property):void 0},set:function(key,value){var _ref;return null!=(_ref=this.get(options.to))?_ref.set(property,value):void 0},unset:function(){var _ref;return null!=(_ref=this.get(options.to))?_ref.unset(property):void 0}})})},counter=0,BatmanObject.prototype._batmanID=function(){var _base;return this._batman.check(this),null==(_base=this._batman).id&&(_base.id=counter++),this._batman.id},BatmanObject.prototype.hashKey=function(){var _base;if("function"!=typeof this.isEqual)return(_base=this._batman).hashKey||(_base.hashKey="<Batman.Object "+this._batmanID()+">")},BatmanObject.prototype.toJSON=function(){var key,obj,value;obj={};for(key in this)__hasProp.call(this,key)&&(value=this[key],"_batman"!==key&&"hashKey"!==key&&"_batmanID"!==key&&(obj[key]=(null!=value?value.toJSON:void 0)?value.toJSON():value));return obj},BatmanObject.prototype.batchAccessorChanges=function(){var i,key,properties,property,result,wrappedFunction,_i,_j,_k,_len,_len1;for(properties=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),wrappedFunction=arguments[_i++],i=_j=0,_len=properties.length;_len>_j;i=++_j)key=properties[i],property=properties[i]=this.property(key),property.isBatchingChanges=!0;for(result=wrappedFunction.call(this),_k=0,_len1=properties.length;_len1>_k;_k++)property=properties[_k],property.isBatchingChanges=!1,property.refresh();return result},BatmanObject}(Object),Batman.Object=BatmanObject}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.BindingParser=function(_super){function BindingParser(view){this.view=view,BindingParser.__super__.constructor.call(this),this.node=this.view.node,this.parseTree(this.node)}var bindingSortOrder,bindingSortPositions,name,pos,viewBackedBindings,_i,_len;for(__extends(BindingParser,_super),bindingSortOrder=["defineview","foreach","renderif","view","formfor","context","bind","source","target","track","event"],viewBackedBindings=["foreach","renderif","formfor","context"],bindingSortPositions={},pos=_i=0,_len=bindingSortOrder.length;_len>_i;pos=++_i)name=bindingSortOrder[pos],bindingSortPositions[name]=pos;return BindingParser.prototype._sortBindings=function(a,b){var aindex,bindex;return aindex=bindingSortPositions[a[0]],bindex=bindingSortPositions[b[0]],null==aindex&&(aindex=bindingSortOrder.length),null==bindex&&(bindex=bindingSortOrder.length),aindex>bindex?1:bindex>aindex?-1:a[0]>b[0]?1:b[0]>a[0]?-1:0},BindingParser.prototype.parseTree=function(root){for(var skipChildren;root;)skipChildren=this.parseNode(root),root=this.nextNode(root,skipChildren);this.fire("bindingsInitialized")},BindingParser.prototype.parseNode=function(node){var attr,attrIndex,attribute,backingView,binding,bindingDefinition,bindings,isViewBacked,reader,value,_j,_k,_len1,_len2,_ref,_ref1,_ref2,_ref3;if(isViewBacked=!1,node.getAttribute&&node.attributes){for(bindings=[],_ref=node.attributes,_j=0,_len1=_ref.length;_len1>_j;_j++)attribute=_ref[_j],"data-"===(null!=(_ref1=attribute.nodeName)?_ref1.substr(0,5):void 0)&&(name=attribute.nodeName.substr(5),attrIndex=name.indexOf("-"),bindings.push(-1!==attrIndex?[name.substr(0,attrIndex),name.substr(attrIndex+1),attribute.value]:[name,void 0,attribute.value]));for(_ref2=bindings.sort(this._sortBindings),_k=0,_len2=_ref2.length;_len2>_k;_k++)if(_ref3=_ref2[_k],name=_ref3[0],attr=_ref3[1],value=_ref3[2],!isViewBacked||-1!==viewBackedBindings.indexOf(name)){if(binding=attr?(reader=Batman.DOM.attrReaders[name])?(bindingDefinition=new Batman.DOM.AttrReaderBindingDefinition(node,attr,value,this.view),reader(bindingDefinition)):void 0:(reader=Batman.DOM.readers[name])?(bindingDefinition=new Batman.DOM.ReaderBindingDefinition(node,value,this.view),reader(bindingDefinition)):void 0,(null!=binding?binding.initialized:void 0)&&this.once("bindingsInitialized",function(binding){return function(){return binding.initialized.call(binding)}}(binding)),null!=binding?binding.skipChildren:void 0)return!0;(null!=binding?binding.backWithView:void 0)&&(isViewBacked=!0)}}return isViewBacked&&(backingView=Batman._data(node,"view"))&&backingView.initializeBindings(),isViewBacked},BindingParser.prototype.nextNode=function(node,skipChildren){var children,nextParent,parentSibling,sibling;if(!skipChildren&&(children=node.childNodes,null!=children?children.length:void 0))return children[0];if(sibling=node.nextSibling,this.node!==node){if(sibling)return sibling;for(nextParent=node;nextParent=nextParent.parentNode;){if(parentSibling=nextParent.nextSibling,this.node===nextParent)return;if(parentSibling)return parentSibling}}},BindingParser}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.ValidationError=function(_super){function ValidationError(attribute,message){ValidationError.__super__.constructor.call(this,{attribute:attribute,message:message})}return __extends(ValidationError,_super),ValidationError.accessor("fullMessage",function(){return"base"===this.attribute?Batman.t("errors.base.format",{message:this.message}):Batman.t("errors.format",{attribute:Batman.helpers.humanize(Batman.ValidationError.singularizeAssociated(this.attribute)),message:this.message})}),ValidationError.singularizeAssociated=function(attribute){var i,parts,_i,_ref;for(parts=attribute.split("."),i=_i=0,_ref=parts.length-1;_ref>_i;i=_i+=1)parts[i]=Batman.helpers.singularize(parts[i]);return parts.join(" ")},ValidationError}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.StorageAdapter=function(_super){function StorageAdapter(model){var constructor;StorageAdapter.__super__.constructor.call(this,{model:model}),constructor=this.constructor,constructor.ModelMixin&&Batman.extend(model,constructor.ModelMixin),constructor.RecordMixin&&Batman.extend(model.prototype,constructor.RecordMixin)}return __extends(StorageAdapter,_super),StorageAdapter.StorageError=function(_super1){function StorageError(message){StorageError.__super__.constructor.apply(this,arguments),this.message=message}return __extends(StorageError,_super1),StorageError.prototype.name="StorageError",StorageError}(Error),StorageAdapter.RecordExistsError=function(_super1){function RecordExistsError(message){RecordExistsError.__super__.constructor.call(this,message||"Can't create this record because it already exists in the store!")}return __extends(RecordExistsError,_super1),RecordExistsError.prototype.name="RecordExistsError",RecordExistsError}(StorageAdapter.StorageError),StorageAdapter.NotFoundError=function(_super1){function NotFoundError(message){NotFoundError.__super__.constructor.call(this,message||"Record couldn't be found in storage!")}return __extends(NotFoundError,_super1),NotFoundError.prototype.name="NotFoundError",NotFoundError}(StorageAdapter.StorageError),StorageAdapter.UnauthorizedError=function(_super1){function UnauthorizedError(message){UnauthorizedError.__super__.constructor.call(this,message||"Storage operation denied due to invalid credentials!")}return __extends(UnauthorizedError,_super1),UnauthorizedError.prototype.name="UnauthorizedError",UnauthorizedError}(StorageAdapter.StorageError),StorageAdapter.NotAllowedError=function(_super1){function NotAllowedError(message){NotAllowedError.__super__.constructor.call(this,message||"Storage operation denied access to the operation!")}return __extends(NotAllowedError,_super1),NotAllowedError.prototype.name="NotAllowedError",NotAllowedError}(StorageAdapter.StorageError),StorageAdapter.NotAcceptableError=function(_super1){function NotAcceptableError(message){NotAcceptableError.__super__.constructor.call(this,message||"Storage operation permitted but the request was malformed!")}return __extends(NotAcceptableError,_super1),NotAcceptableError.prototype.name="NotAcceptableError",NotAcceptableError}(StorageAdapter.StorageError),StorageAdapter.EntityTooLargeError=function(_super1){function EntityTooLargeError(message){EntityTooLargeError.__super__.constructor.call(this,message||"Storage operation denied due to size constraints!")}return __extends(EntityTooLargeError,_super1),EntityTooLargeError.prototype.name="EntityTooLargeError",EntityTooLargeError}(StorageAdapter.StorageError),StorageAdapter.UnprocessableRecordError=function(_super1){function UnprocessableRecordError(message){UnprocessableRecordError.__super__.constructor.call(this,message||"Storage adapter could not process the record!")}return __extends(UnprocessableRecordError,_super1),UnprocessableRecordError.prototype.name="UnprocessableRecordError",UnprocessableRecordError}(StorageAdapter.StorageError),StorageAdapter.InternalStorageError=function(_super1){function InternalStorageError(message){InternalStorageError.__super__.constructor.call(this,message||"An error occurred during the storage operation!")}return __extends(InternalStorageError,_super1),InternalStorageError.prototype.name="InternalStorageError",InternalStorageError}(StorageAdapter.StorageError),StorageAdapter.NotImplementedError=function(_super1){function NotImplementedError(message){NotImplementedError.__super__.constructor.call(this,message||"This operation is not implemented by the storage adapter!")}return __extends(NotImplementedError,_super1),NotImplementedError.prototype.name="NotImplementedError",NotImplementedError}(StorageAdapter.StorageError),StorageAdapter.BadGatewayError=function(_super1){function BadGatewayError(message){BadGatewayError.__super__.constructor.call(this,message||"Storage operation failed due to unavailability of the backend!")}return __extends(BadGatewayError,_super1),BadGatewayError.prototype.name="BadGatewayError",BadGatewayError}(StorageAdapter.StorageError),StorageAdapter.prototype.isStorageAdapter=!0,StorageAdapter.prototype.onlyCertainAttributes=function(json,only){var key;for(key in json)only.indexOf(key)<0&&delete json[key];return json},StorageAdapter.prototype.exceptCertainAttributes=function(json,except){var key,_i,_len;for(_i=0,_len=except.length;_len>_i;_i++)key=except[_i],delete json[key];return json},StorageAdapter.prototype.storageKey=function(record){var model;return model=(null!=record?record.constructor:void 0)||this.model,model.get("storageKey")||Batman.helpers.pluralize(Batman.helpers.underscore(model.get("resourceName")))},StorageAdapter.prototype.getRecordFromData=function(attributes,constructor){return null==constructor&&(constructor=this.model),constructor.createFromJSON(attributes)},StorageAdapter.prototype.getRecordsFromData=function(attributeSet,constructor){return null==constructor&&(constructor=this.model),constructor.createMultipleFromJSON(attributeSet)},StorageAdapter.skipIfError=function(f){return function(env,next){return null!=env.error?next():f.call(this,env,next)}},StorageAdapter.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(__slice.call(arguments)))},StorageAdapter.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(__slice.call(arguments)))},StorageAdapter.prototype._inheritFilters=function(){var filtersByKey,filtersList,key,oldFilters,position;if(!(this._batman.check(this)&&this._batman.filters||(oldFilters=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}},null==oldFilters)))for(position in oldFilters){filtersByKey=oldFilters[position];for(key in filtersByKey)filtersList=filtersByKey[key],this._batman.filters[position][key]=filtersList.slice(0)}return!0},StorageAdapter.prototype._addFilter=function(){var filter,key,keys,position,_base,_i,_j,_len;for(position=arguments[0],keys=3<=arguments.length?__slice.call(arguments,1,_i=arguments.length-1):(_i=1,[]),filter=arguments[_i++],this._inheritFilters(),_j=0,_len=keys.length;_len>_j;_j++)key=keys[_j],(_base=this._batman.filters[position])[key]||(_base[key]=[]),this._batman.filters[position][key].push(filter);return!0},StorageAdapter.prototype.runFilter=function(position,action,env,callback){var actionFilters,allFilters,filters,next,_this=this;return this._inheritFilters(),allFilters=this._batman.filters[position].all||[],actionFilters=this._batman.filters[position][action]||[],env.action=action,filters="before"===position?actionFilters.concat(allFilters):allFilters.concat(actionFilters),(next=function(newEnv){var nextFilter;return null!=newEnv&&(env=newEnv),null!=(nextFilter=filters.shift())?nextFilter.call(_this,env,next):callback.call(_this,env)})()},StorageAdapter.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(__slice.call(arguments)))},StorageAdapter.prototype.runAfterFilter=function(action,env,callback){return this.runFilter("after",action,env,this.exportResult(callback))},StorageAdapter.prototype.exportResult=function(callback){return function(env){return callback(env.error,env.result,env)}},StorageAdapter.prototype._jsonToAttributes=function(json){return JSON.parse(json)},StorageAdapter.prototype.perform=function(key,subject,options,callback){var env,next,_this=this;return options||(options={}),env={options:options,subject:subject},next=function(newEnv){return null!=newEnv&&(env=newEnv),_this.runAfterFilter(key,env,callback)},void this.runBeforeFilter(key,env,function(env){return this[key](env,next)})},StorageAdapter}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Batman.RestStorage=function(_super){function RestStorage(){RestStorage.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=Batman.extend({},this.defaultRequestOptions)}var key,_fn,_i,_len,_ref;for(__extends(RestStorage,_super),RestStorage.CommunicationError=function(_super1){function CommunicationError(message){CommunicationError.__super__.constructor.call(this,message||"A communication error has occurred!")}return __extends(CommunicationError,_super1),CommunicationError.prototype.name="CommunicationError",CommunicationError}(RestStorage.StorageError),RestStorage.JSONContentType="application/json",RestStorage.PostBodyContentType="application/x-www-form-urlencoded",RestStorage.BaseMixin={request:function(action,options,callback){return callback||(callback=options,options={}),options.method||(options.method="GET"),options.action=action,this._doStorageOperation(options.method.toLowerCase(),options,callback)}},RestStorage.ModelMixin=Batman.extend({},RestStorage.BaseMixin,{urlNestsUnder:function(){var key,keys,parents,_i,_len;for(keys=1<=arguments.length?__slice.call(arguments,0):[],parents={},_i=0,_len=keys.length;_len>_i;_i++)key=keys[_i],parents[key+"_id"]=Batman.helpers.pluralize(key);return this.url=function(options){var childSegment,parentID,plural;childSegment=this.storageKey||Batman.helpers.pluralize(this.get("resourceName").toLowerCase());for(key in parents)if(plural=parents[key],parentID=options.data[key])return delete options.data[key],""+plural+"/"+parentID+"/"+childSegment;return childSegment},this.prototype.url=function(){var childSegment,id,parentID,plural,url;childSegment=this.constructor.storageKey||Batman.helpers.pluralize(this.constructor.get("resourceName").toLowerCase());
for(key in parents)if(plural=parents[key],parentID=this.get("dirtyKeys").get(key),void 0===parentID&&(parentID=this.get(key)),parentID){url=""+plural+"/"+parentID+"/"+childSegment;break}return url||(url=childSegment),(id=this.get("id"))&&(url+="/"+id),url}}}),RestStorage.RecordMixin=Batman.extend({},RestStorage.BaseMixin),RestStorage.prototype.defaultRequestOptions={type:"json"},RestStorage.prototype._implicitActionNames=["create","read","update","destroy","readAll"],RestStorage.prototype.serializeAsForm=!0,RestStorage.prototype.recordJsonNamespace=function(record){return Batman.helpers.singularize(this.storageKey(record))},RestStorage.prototype.collectionJsonNamespace=function(constructor){return Batman.helpers.pluralize(this.storageKey(constructor.prototype))},RestStorage.prototype._execWithOptions=function(object,key,options,context){return null==context&&(context=object),"function"==typeof object[key]?object[key].call(context,options):object[key]},RestStorage.prototype._defaultCollectionUrl=function(model){return""+this.storageKey(model.prototype)},RestStorage.prototype._addParams=function(url,options){var _ref;return!options||!options.action||(_ref=options.action,__indexOf.call(this._implicitActionNames,_ref)>=0)||(url+="/"+options.action.toLowerCase()),url},RestStorage.prototype._addUrlAffixes=function(url,subject,env){var prefix,segments;return segments=[url,this.urlSuffix(subject,env)],"/"!==url.charAt(0)&&(prefix=this.urlPrefix(subject,env),"/"!==prefix.charAt(prefix.length-1)&&segments.unshift("/"),segments.unshift(prefix)),segments.join("")},RestStorage.prototype.urlPrefix=function(object,env){return this._execWithOptions(object,"urlPrefix",env.options)||""},RestStorage.prototype.urlSuffix=function(object,env){return this._execWithOptions(object,"urlSuffix",env.options)||""},RestStorage.prototype.urlForRecord=function(record,env){var id,url,_ref;if(null!=(_ref=env.options)?_ref.recordUrl:void 0)url=this._execWithOptions(env.options,"recordUrl",env.options,record);else if(record.url)url=this._execWithOptions(record,"url",env.options);else if(url=record.constructor.url?this._execWithOptions(record.constructor,"url",env.options):this._defaultCollectionUrl(record.constructor),"create"!==env.action){if(null==(id=record.get("id")))throw new this.constructor.StorageError("Couldn't get/set record primary key on "+env.action+"!");url=url+"/"+id}return this._addUrlAffixes(this._addParams(url,env.options),record,env)},RestStorage.prototype.urlForCollection=function(model,env){var url,_ref;return url=(null!=(_ref=env.options)?_ref.collectionUrl:void 0)?this._execWithOptions(env.options,"collectionUrl",env.options,env.options.urlContext):model.url?this._execWithOptions(model,"url",env.options):this._defaultCollectionUrl(model,env.options),this._addUrlAffixes(this._addParams(url,env.options),model,env)},RestStorage.prototype.request=function(env,next){var options;return options=Batman.extend(env.options,{autosend:!1,success:function(data){return env.data=data},error:function(error){return env.error=error},loaded:function(){return env.response=env.request.get("response"),next()}}),env.request=new Batman.Request(options),env.request.send()},RestStorage.prototype.perform=function(key,record,options,callback){return options||(options={}),Batman.extend(options,this.defaultRequestOptions),RestStorage.__super__.perform.call(this,key,record,options,callback)},RestStorage.prototype.before("all",RestStorage.skipIfError(function(env,next){var error;if(!env.options.url)try{env.options.url=env.subject.prototype?this.urlForCollection(env.subject,env):this.urlForRecord(env.subject,env)}catch(_error){error=_error,env.error=error}return next()})),RestStorage.prototype.before("get","put","post","delete",RestStorage.skipIfError(function(env,next){return env.options.method=env.action.toUpperCase(),next()})),RestStorage.prototype.before("create","update",RestStorage.skipIfError(function(env,next){var data,json,namespace;return json=env.subject.toJSON(),env.options.only&&(json=this.onlyCertainAttributes(json,env.options.only)),env.options.except&&(json=this.exceptCertainAttributes(json,env.options.except)),(namespace=this.recordJsonNamespace(env.subject))?(data={},data[namespace]=json):data=json,env.options.data=data,next()})),RestStorage.prototype.before("create","update","put","post",RestStorage.skipIfError(function(env,next){return this.serializeAsForm?env.options.contentType=this.constructor.PostBodyContentType:null!=env.options.data&&(env.options.data=JSON.stringify(env.options.data),env.options.contentType=this.constructor.JSONContentType),next()})),RestStorage.prototype.after("all",RestStorage.skipIfError(function(env,next){var error,json;if(null==env.data)return next();if("string"==typeof env.data){if(env.data.length>0)try{json=this._jsonToAttributes(env.data)}catch(_error){return error=_error,env.error=error,next()}}else"object"==typeof env.data&&(json=env.data);return null!=json&&(env.json=json),next()})),RestStorage.prototype.extractFromNamespace=function(data,namespace){return namespace&&null!=data[namespace]?data[namespace]:data},RestStorage.prototype.after("create","read","update",RestStorage.skipIfError(function(env,next){var json;return null!=env.json&&(json=this.extractFromNamespace(env.json,this.recordJsonNamespace(env.subject)),env.subject._withoutDirtyTracking(function(){return this.fromJSON(json)})),env.result=env.subject,next()})),RestStorage.prototype.after("readAll",RestStorage.skipIfError(function(env,next){var namespace;return namespace=this.collectionJsonNamespace(env.subject),env.recordsAttributes=this.extractFromNamespace(env.json,namespace),"Array"!==Batman.typeOf(env.recordsAttributes)&&(namespace=this.recordJsonNamespace(env.subject.prototype),env.recordsAttributes=[this.extractFromNamespace(env.json,namespace)]),env.result=env.records=this.getRecordsFromData(env.recordsAttributes,env.subject),next()})),RestStorage.prototype.after("get","put","post","delete",RestStorage.skipIfError(function(env,next){var namespace;return null!=env.json&&(namespace=env.subject.prototype?this.collectionJsonNamespace(env.subject):this.recordJsonNamespace(env.subject),env.result=this.extractFromNamespace(env.json,namespace)),next()})),RestStorage.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},_ref=["create","read","update","destroy","readAll","get","post","put","delete"],_fn=function(key){return RestStorage.prototype[key]=RestStorage.skipIfError(function(env,next){var _base;return(_base=env.options).method||(_base.method=this.constructor.HTTPMethods[key]),this.request(env,next)})},_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],_fn(key);return RestStorage.prototype.after("all",function(env,next){return env.error&&(env.error=this._errorFor(env.error,env)),next()}),RestStorage._statusCodeErrors={0:RestStorage.CommunicationError,401:RestStorage.UnauthorizedError,403:RestStorage.NotAllowedError,404:RestStorage.NotFoundError,406:RestStorage.NotAcceptableError,409:RestStorage.RecordExistsError,413:RestStorage.EntityTooLargeError,422:RestStorage.UnprocessableRecordError,500:RestStorage.InternalStorageError,501:RestStorage.NotImplementedError,502:RestStorage.BadGatewayError},RestStorage.prototype._errorFor=function(error,env){var errorClass,request;return error instanceof Error||null==error.request?error:((errorClass=this.constructor._statusCodeErrors[error.request.status])&&(request=error.request,error=new errorClass,error.request=request,error.env=env),error)},RestStorage}.call(this,Batman.StorageAdapter)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.LocalStorage=function(_super){function LocalStorage(){return"undefined"==typeof window.localStorage?null:(LocalStorage.__super__.constructor.apply(this,arguments),void(this.storage=localStorage))}return __extends(LocalStorage,_super),LocalStorage.prototype.storageRegExpForRecord=function(record){return new RegExp("^"+this.storageKey(record)+"(\\d+)$")},LocalStorage.prototype.nextIdForRecord=function(record){var nextId,re;return re=this.storageRegExpForRecord(record),nextId=1,this._forAllStorageEntries(function(k){var matches;return(matches=re.exec(k))?nextId=Math.max(nextId,parseInt(matches[1],10)+1):void 0}),nextId},LocalStorage.prototype._forAllStorageEntries=function(iterator){var i,key,_i,_ref;for(i=_i=0,_ref=this.storage.length;_ref>=0?_ref>_i:_i>_ref;i=_ref>=0?++_i:--_i)key=this.storage.key(i),iterator.call(this,key,this.storage.getItem(key));return!0},LocalStorage.prototype._storageEntriesMatching=function(constructor,options){var re,records;return re=this.storageRegExpForRecord(constructor.prototype),records=[],this._forAllStorageEntries(function(storageKey,storageString){var data,keyMatches;return(keyMatches=re.exec(storageKey))&&(data=this._jsonToAttributes(storageString),data[constructor.primaryKey]=keyMatches[1],this._dataMatches(options,data))?records.push(data):void 0}),records},LocalStorage.prototype._dataMatches=function(conditions,data){var k,match,v;match=!0;for(k in conditions)if(v=conditions[k],data[k]!==v){match=!1;break}return match},LocalStorage.prototype.before("read","create","update","destroy",LocalStorage.skipIfError(function(env,next){var _this=this;return env.id="create"===env.action?env.subject.get("id")||env.subject._withoutDirtyTracking(function(){return env.subject.set("id",_this.nextIdForRecord(env.subject))}):env.subject.get("id"),null==env.id?env.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+env.action+"!"):env.key=this.storageKey(env.subject)+env.id,next()})),LocalStorage.prototype.before("create","update",LocalStorage.skipIfError(function(env,next){var json;return json=env.subject.toJSON(),env.options.only&&(json=this.onlyCertainAttributes(json,env.options.only)),env.options.except&&(json=this.exceptCertainAttributes(json,env.options.except)),env.recordAttributes=JSON.stringify(json),next()})),LocalStorage.prototype.after("read",LocalStorage.skipIfError(function(env,next){var error;if("string"==typeof env.recordAttributes)try{env.recordAttributes=this._jsonToAttributes(env.recordAttributes)}catch(_error){return error=_error,env.error=error,next()}return env.subject._withoutDirtyTracking(function(){return this.fromJSON(env.recordAttributes)}),next()})),LocalStorage.prototype.after("read","create","update","destroy",LocalStorage.skipIfError(function(env,next){return env.result=env.subject,next()})),LocalStorage.prototype.after("readAll",LocalStorage.skipIfError(function(env,next){return env.result=env.records=this.getRecordsFromData(env.recordsAttributes,env.subject),next()})),LocalStorage.prototype.read=LocalStorage.skipIfError(function(env,next){return env.recordAttributes=this.storage.getItem(env.key),env.recordAttributes||(env.error=new this.constructor.NotFoundError),next()}),LocalStorage.prototype.create=LocalStorage.skipIfError(function(_arg,next){var key,recordAttributes;return key=_arg.key,recordAttributes=_arg.recordAttributes,this.storage.getItem(key)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(key,recordAttributes),next()}),LocalStorage.prototype.update=LocalStorage.skipIfError(function(_arg,next){var key,recordAttributes;return key=_arg.key,recordAttributes=_arg.recordAttributes,this.storage.setItem(key,recordAttributes),next()}),LocalStorage.prototype.destroy=LocalStorage.skipIfError(function(_arg,next){var key;return key=_arg.key,this.storage.removeItem(key),next()}),LocalStorage.prototype.readAll=LocalStorage.skipIfError(function(env,next){var error;try{arguments[0].recordsAttributes=this._storageEntriesMatching(env.subject,env.options.data)}catch(_error){error=_error,arguments[0].error=error}return next()}),LocalStorage}(Batman.StorageAdapter)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.SessionStorage=function(_super){function SessionStorage(){return"undefined"==typeof window.sessionStorage?null:(SessionStorage.__super__.constructor.apply(this,arguments),void(this.storage=sessionStorage))}return __extends(SessionStorage,_super),SessionStorage}(Batman.LocalStorage)}.call(this),function(){Batman.Encoders=new Batman.Object}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.ParamsReplacer=function(_super){function ParamsReplacer(navigator,params){this.navigator=navigator,this.params=params}return __extends(ParamsReplacer,_super),ParamsReplacer.prototype.redirect=function(){return this.navigator.redirect(this.toObject(),!0)},ParamsReplacer.prototype.replace=function(params){return this.params.replace(params),this.redirect()},ParamsReplacer.prototype.update=function(params){return this.params.update(params),this.redirect()},ParamsReplacer.prototype.clear=function(){return this.params.clear(),this.redirect()},ParamsReplacer.prototype.toObject=function(){return this.params.toObject()},ParamsReplacer.accessor({get:function(k){return this.params.get(k)},set:function(k,v){var oldValue,result;return oldValue=this.params.get(k),result=this.params.set(k,v),oldValue!==v&&this.redirect(),result},unset:function(k){var hadKey,result;return hadKey=this.params.hasKey(k),result=this.params.unset(k),hadKey&&this.redirect(),result}}),ParamsReplacer}(Batman.Object)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.ParamsPusher=function(_super){function ParamsPusher(){return _ref=ParamsPusher.__super__.constructor.apply(this,arguments)}return __extends(ParamsPusher,_super),ParamsPusher.prototype.redirect=function(){return this.navigator.redirect(this.toObject())},ParamsPusher}(Batman.ParamsReplacer)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.NamedRouteQuery=function(_super){function NamedRouteQuery(routeMap,args){var key;null==args&&(args=[]),NamedRouteQuery.__super__.constructor.call(this,{routeMap:routeMap,args:args});for(key in this.get("routeMap").childrenByName)this[key]=this._queryAccess.bind(this,key)}return __extends(NamedRouteQuery,_super),NamedRouteQuery.prototype.isNamedRouteQuery=!0,NamedRouteQuery.accessor("route",function(){var collectionRoute,memberRoute,route,_i,_len,_ref,_ref1;for(_ref=this.get("routeMap"),memberRoute=_ref.memberRoute,collectionRoute=_ref.collectionRoute,_ref1=[memberRoute,collectionRoute],_i=0,_len=_ref1.length;_len>_i;_i++)if(route=_ref1[_i],null!=route&&route.namedArguments.length===this.get("args").length)return route;return collectionRoute||memberRoute}),NamedRouteQuery.accessor("path",function(){return this.path()}),NamedRouteQuery.accessor("routeMap","args","cardinality","hashValue",Batman.Property.defaultAccessor),NamedRouteQuery.accessor({get:function(key){return null!=key?"string"==typeof key?this.nextQueryForName(key):this.nextQueryWithArgument(key):void 0},cache:!1}),NamedRouteQuery.accessor("withHash",function(){var _this=this;return new Batman.Accessible(function(hashValue){return _this.withHash(hashValue)})}),NamedRouteQuery.prototype.withHash=function(hashValue){var clone;return clone=this.clone(),clone.set("hashValue",hashValue),clone},NamedRouteQuery.prototype.nextQueryForName=function(key){var map;return(map=this.get("routeMap").childrenByName[key])?new Batman.NamedRouteQuery(map,this.args):Batman.developer.error("Couldn't find a route for the name "+key+"!")},NamedRouteQuery.prototype.nextQueryWithArgument=function(arg){var args;return args=this.args.slice(0),args.push(arg),this.clone(args)},NamedRouteQuery.prototype.path=function(){var argumentName,argumentValue,index,namedArguments,params,_i,_len;for(params={},namedArguments=this.get("route.namedArguments"),index=_i=0,_len=namedArguments.length;_len>_i;index=++_i)argumentName=namedArguments[index],null!=(argumentValue=this.get("args")[index])&&(params[argumentName]=this._toParam(argumentValue));return null!=this.get("hashValue")&&(params["#"]=this.get("hashValue")),this.get("route").pathFromParams(params)},NamedRouteQuery.prototype.toString=function(){return this.path()},NamedRouteQuery.prototype.clone=function(args){return null==args&&(args=this.args),new Batman.NamedRouteQuery(this.routeMap,args)},NamedRouteQuery.prototype._toParam=function(arg){return arg instanceof Batman.AssociationProxy&&(arg=arg.get("target")),null!=(null!=arg?arg.toParam:void 0)?arg.toParam():arg},NamedRouteQuery.prototype._queryAccess=function(key,arg){var query;return query=this.nextQueryForName(key),null!=arg&&(query=query.nextQueryWithArgument(arg)),query},NamedRouteQuery}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Dispatcher=function(_super){function Dispatcher(app,routeMap){Dispatcher.__super__.constructor.call(this,{app:app,routeMap:routeMap})}var ControllerDirectory,_ref;return __extends(Dispatcher,_super),Dispatcher.canInferRoute=function(argument){return argument instanceof Batman.Model||argument instanceof Batman.AssociationProxy||argument.prototype instanceof Batman.Model},Dispatcher.paramsFromArgument=function(argument){var resourceNameFromModel;return resourceNameFromModel=function(model){return Batman.helpers.camelize(Batman.helpers.pluralize(model.get("resourceName")),!0)},this.canInferRoute(argument)?argument instanceof Batman.Model||argument instanceof Batman.AssociationProxy?(argument.isProxy&&(argument=argument.get("target")),null!=argument?{controller:resourceNameFromModel(argument.constructor),action:"show",id:("function"==typeof argument.toParam?argument.toParam():void 0)||argument.get("id")}:{}):argument.prototype instanceof Batman.Model?{controller:resourceNameFromModel(argument),action:"index"}:argument:argument},ControllerDirectory=function(_super1){function ControllerDirectory(){return _ref=ControllerDirectory.__super__.constructor.apply(this,arguments)}return __extends(ControllerDirectory,_super1),ControllerDirectory.accessor("__app",Batman.Property.defaultAccessor),ControllerDirectory.accessor(function(key){return this.get("__app."+Batman.helpers.titleize(key)+"Controller.sharedController")}),ControllerDirectory}(Batman.Object),Dispatcher.accessor("controllers",function(){return new ControllerDirectory({__app:this.get("app")})}),Dispatcher.prototype.routeForParams=function(params){return params=this.constructor.paramsFromArgument(params),this.get("routeMap").routeForParams(params)},Dispatcher.prototype.pathFromParams=function(params){var _ref1;return"string"==typeof params?params:(params=this.constructor.paramsFromArgument(params),null!=(_ref1=this.routeForParams(params))?_ref1.pathFromParams(params):void 0)},Dispatcher.prototype.dispatch=function(params,paramsMixin){var error,inferredParams,path,route,_ref1,_ref2;if(inferredParams=this.constructor.paramsFromArgument(params),route=this.routeForParams(inferredParams))_ref1=route.pathAndParamsFromArgument(inferredParams),path=_ref1[0],params=_ref1[1],paramsMixin&&Batman.mixin(params,paramsMixin),this.set("app.currentRoute",route),this.set("app.currentURL",path),this.get("app.currentParams").replace(params||{}),route.dispatch(params);else{if("Object"===Batman.typeOf(params)&&!this.constructor.canInferRoute(params))return this.get("app.currentParams").replace(params);if(this.get("app.currentParams").clear(),error={type:"404",isPrevented:!1,preventDefault:function(){return this.isPrevented=!0}},null!=(_ref2=Batman.currentApp)&&_ref2.fire("error",error),error.isPrevented)return params;if("/404"!==params)return Batman.redirect("/404")}return path},Dispatcher}.call(this,Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Route=function(_super){function Route(templatePath,baseParams){var k,matches,namedArguments,pattern,properties,regexp,regexps,_i,_len,_ref;for(regexps=this.constructor.regexps,0!==templatePath.indexOf("/")&&(templatePath="/"+templatePath),pattern=templatePath.replace(regexps.escapeRegExp,"\\$&"),regexp=RegExp("^"+pattern.replace(regexps.openOptParam,"(?:").replace(regexps.closeOptParam,")?").replace(regexps.namedParam,"([^/]+)").replace(regexps.splatParam,"(.*?)")+regexps.queryParam+"$"),regexps.namedOrSplat.lastIndex=0,namedArguments=function(){var _results;for(_results=[];matches=regexps.namedOrSplat.exec(pattern);)_results.push(matches[1]);return _results}(),properties={templatePath:templatePath,pattern:pattern,regexp:regexp,namedArguments:namedArguments,baseParams:baseParams},_ref=this.optionKeys,_i=0,_len=_ref.length;_len>_i;_i++)k=_ref[_i],properties[k]=baseParams[k],delete baseParams[k];Route.__super__.constructor.call(this,properties)}return __extends(Route,_super),Route.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}+?.,\\^$|#\s]/g,openOptParam:/\(/g,closeOptParam:/\)/g},Route.prototype.optionKeys=["member","collection"],Route.prototype.testKeys=["controller","action"],Route.prototype.isRoute=!0,Route.prototype.paramsFromPath=function(pathAndQuery){var index,match,matches,name,namedArguments,params,uri,_i,_len;for(uri=new Batman.URI(pathAndQuery),namedArguments=this.get("namedArguments"),params=Batman.extend({path:uri.path},this.get("baseParams")),matches=this.get("regexp").exec(uri.path).slice(1),index=_i=0,_len=matches.length;_len>_i;index=++_i)match=matches[index],name=namedArguments[index],null!=match&&(params[name]=decodeURIComponent(match));return Batman.extend(params,uri.queryParams)},Route.prototype.pathFromParams=function(argumentParams){var hash,key,name,newPath,params,path,query,regexp,regexps,_i,_j,_len,_len1,_ref,_ref1;for(params=Batman.extend({},argumentParams),path=this.get("templatePath"),regexps=this.constructor.regexps,_ref=this.get("namedArguments"),_i=0,_len=_ref.length;_len>_i;_i++)name=_ref[_i],regexp=RegExp(""+regexps.namePrefix+name),newPath=path.replace(regexp,null!=params[name]?params[name]:""),newPath!==path&&(delete params[name],path=newPath);for(path=path.replace(regexps.openOptParam,"").replace(regexps.closeOptParam,"").replace(/([^\/])\/+$/,"$1"),_ref1=this.testKeys,_j=0,_len1=_ref1.length;_len1>_j;_j++)key=_ref1[_j],delete params[key];return params["#"]&&(hash=params["#"],delete params["#"]),query=Batman.URI.queryFromParams(params),query&&(path+="?"+query),hash&&(path+="#"+hash),path},Route.prototype.test=function(pathOrParams){var key,path,value,_i,_len,_ref;if("string"==typeof pathOrParams)path=pathOrParams;else if(null!=pathOrParams.path)path=pathOrParams.path;else for(path=this.pathFromParams(pathOrParams),_ref=this.testKeys,_i=0,_len=_ref.length;_len>_i;_i++)if(key=_ref[_i],null!=(value=this.get(key))&&pathOrParams[key]!==value)return!1;return this.get("regexp").test(path)},Route.prototype.pathAndParamsFromArgument=function(pathOrParams){var params,path;return"string"==typeof pathOrParams?(params=this.paramsFromPath(pathOrParams),path=pathOrParams):(params=pathOrParams,path=this.pathFromParams(pathOrParams)),[path,params]},Route.prototype.dispatch=function(params){return this.test(params)?this.get("callback")(params):!1},Route.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")},Route}(Batman.Object)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.ControllerActionRoute=function(_super){function ControllerActionRoute(templatePath,options){this.callback=__bind(this.callback,this);var action,controller,_ref,_ref1;options.signature&&("String"===Batman.typeOf(options.signature)?(_ref=options.signature.split("#"),controller=_ref[0],action=_ref[1]):(_ref1=options.signature,controller=_ref1.controller,action=_ref1.action),action||(action="index"),options.controller=controller,options.action=action,delete options.signature),ControllerActionRoute.__super__.constructor.call(this,templatePath,options)}return __extends(ControllerActionRoute,_super),ControllerActionRoute.prototype.optionKeys=["member","collection","app","controller","action"],ControllerActionRoute.prototype.callback=function(params){var controller;return controller=this.get("app.dispatcher.controllers."+this.get("controller")),controller.dispatch(this.get("action"),params)},ControllerActionRoute}(Batman.Route)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.CallbackActionRoute=function(_super){function CallbackActionRoute(){return _ref=CallbackActionRoute.__super__.constructor.apply(this,arguments)}return __extends(CallbackActionRoute,_super),CallbackActionRoute.prototype.optionKeys=["member","collection","callback","app"],CallbackActionRoute.prototype.controller=!1,CallbackActionRoute.prototype.action=!1,CallbackActionRoute}(Batman.Route)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Hash=function(_super){function Hash(){this.meta=new this.constructor.Metadata(this),Batman.SimpleHash.apply(this,arguments),Hash.__super__.constructor.apply(this,arguments)}var k,_fn,_i,_j,_len,_len1,_ref,_ref1;for(__extends(Hash,_super),Hash.Metadata=function(_super1){function Metadata(hash){this.hash=hash}return __extends(Metadata,_super1),Batman.extend(Metadata.prototype,Batman.Enumerable),Metadata.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),Metadata.accessor("isEmpty","keys","toArray",function(key){return this.hash.registerAsMutableSource(),this.hash[key]()}),Metadata.prototype.forEach=function(){var _ref;return(_ref=this.hash).forEach.apply(_ref,arguments)},Metadata}(Batman.Object),Batman.extend(Hash.prototype,Batman.Enumerable),Hash.prototype.propertyClass=Batman.Property,Hash.defaultAccessor={cache:!1,get:Batman.SimpleHash.prototype.get,set:Hash.mutation(function(key,value){var oldResult,result;return oldResult=Batman.SimpleHash.prototype.get.call(this,key),result=Batman.SimpleHash.prototype.set.call(this,key,value),null!=oldResult&&oldResult!==result?this.fire("itemsWereChanged",[key],[result],[oldResult]):this.fire("itemsWereAdded",[key],[result]),result}),unset:Hash.mutation(function(key){var result;return result=Batman.SimpleHash.prototype.unset.call(this,key),null!=result&&this.fire("itemsWereRemoved",[key],[result]),result})},Hash.accessor(Hash.defaultAccessor),Hash.prototype._preventMutationEvents=function(block){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereChanged"),this.prevent("itemsWereRemoved");try{return block.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereChanged"),this.allow("itemsWereRemoved")}},Hash.prototype.clear=Hash.mutation(function(){var key,keys,values;return keys=this.keys(),values=function(){var _i,_len,_results;for(_results=[],_i=0,_len=keys.length;_len>_i;_i++)key=keys[_i],_results.push(this.get(key));return _results}.call(this),this._preventMutationEvents(function(){var _this=this;return this.forEach(function(k){return _this.unset(k)})}),Batman.SimpleHash.prototype.clear.call(this),this.fire("itemsWereRemoved",keys,values),values}),Hash.prototype.update=Hash.mutation(function(object){var addedKeys,addedValues,changedKeys,changedNewValues,changedOldValues;return addedKeys=[],addedValues=[],changedKeys=[],changedNewValues=[],changedOldValues=[],this._preventMutationEvents(function(){var _this=this;return Batman.forEach(object,function(k,v){return _this.hasKey(k)?(changedKeys.push(k),changedOldValues.push(_this.get(k)),changedNewValues.push(_this.set(k,v))):(addedKeys.push(k),addedValues.push(_this.set(k,v)))})}),addedKeys.length>0&&this.fire("itemsWereAdded",addedKeys,addedValues),changedKeys.length>0?this.fire("itemsWereChanged",changedKeys,changedNewValues,changedOldValues):void 0}),Hash.prototype.replace=Hash.mutation(function(object){var addedKeys,addedValues,changedKeys,changedNewValues,changedOldValues,removedKeys,removedValues;return addedKeys=[],addedValues=[],removedKeys=[],removedValues=[],changedKeys=[],changedOldValues=[],changedNewValues=[],this._preventMutationEvents(function(){var _this=this;return this.forEach(function(k){return Batman.objectHasKey(object,k)?void 0:(removedKeys.push(k),removedValues.push(_this.unset(k)))}),Batman.forEach(object,function(k,v){return _this.hasKey(k)?(changedKeys.push(k),changedOldValues.push(_this.get(k)),changedNewValues.push(_this.set(k,v))):(addedKeys.push(k),addedValues.push(_this.set(k,v)))})}),addedKeys.length>0&&this.fire("itemsWereAdded",addedKeys,addedValues),changedKeys.length>0&&this.fire("itemsWereChanged",changedKeys,changedNewValues,changedOldValues),removedKeys.length>0?this.fire("itemsWereRemoved",removedKeys,removedValues):void 0}),_ref=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"],_i=0,_len=_ref.length;_len>_i;_i++)k=_ref[_i],Hash.prototype[k]=Batman.SimpleHash.prototype[k];for(_ref1=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"],_fn=function(k){return Hash.prototype[k]=function(){return this.registerAsMutableSource(),Batman.SimpleHash.prototype[k].apply(this,arguments)}},_j=0,_len1=_ref1.length;_len1>_j;_j++)k=_ref1[_j],_fn(k);return Hash}.call(this,Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.RenderCache=function(_super){function RenderCache(){RenderCache.__super__.constructor.apply(this,arguments),this.keyQueue=[]}return __extends(RenderCache,_super),RenderCache.prototype.maximumLength=4,RenderCache.prototype.viewForOptions=function(options){var _this=this;return Batman.config.cacheViews||options.cache||options.viewClass.prototype.cache?this.getOrSet(options,function(){return _this._newViewFromOptions(Batman.extend({},options))}):this._newViewFromOptions(options)},RenderCache.prototype._newViewFromOptions=function(options){return new options.viewClass(options)},RenderCache.wrapAccessor(function(core){return{cache:!1,get:function(key){var result;return result=core.get.call(this,key),result&&this._addOrBubbleKey(key),result},set:function(key){var result;return result=core.set.apply(this,arguments),result.set("cached",!0),this._addOrBubbleKey(key),this._evictExpiredKeys(),result},unset:function(key){var result;return result=core.unset.apply(this,arguments),result.set("cached",!1),this._removeKeyFromQueue(key),result
}}}),RenderCache.prototype.equality=function(incomingOptions,storageOptions){var key;if(Object.keys(incomingOptions).length!==Object.keys(storageOptions).length)return!1;for(key in incomingOptions)if("view"!==key&&incomingOptions[key]!==storageOptions[key])return!1;return!0},RenderCache.prototype.reset=function(){var key,_i,_len,_ref;for(_ref=this.keyQueue.slice(0),_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],this.unset(key)},RenderCache.prototype._addOrBubbleKey=function(key){return this._removeKeyFromQueue(key),this.keyQueue.unshift(key)},RenderCache.prototype._removeKeyFromQueue=function(key){var index,queuedKey,_i,_len,_ref;for(_ref=this.keyQueue,index=_i=0,_len=_ref.length;_len>_i;index=++_i)if(queuedKey=_ref[index],this.equality(queuedKey,key)){this.keyQueue.splice(index,1);break}return key},RenderCache.prototype._evictExpiredKeys=function(){var currentKeys,i,key,_i,_ref,_ref1;if(this.length>this.maximumLength)for(currentKeys=this.keyQueue.slice(0),i=_i=_ref=this.maximumLength,_ref1=currentKeys.length;_ref1>=_ref?_ref1>_i:_i>_ref1;i=_ref1>=_ref?++_i:--_i)key=currentKeys[i],this.get(key).isInDOM()||this.unset(key)},RenderCache}(Batman.Hash)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__slice=[].slice;Batman.Controller=function(_super){function Controller(){this.redirect=__bind(this.redirect,this),this.handleError=__bind(this.handleError,this),this.errorHandler=__bind(this.errorHandler,this),Controller.__super__.constructor.apply(this,arguments),this._resetActionFrames()}return __extends(Controller,_super),Controller.singleton("sharedController"),Controller.wrapAccessor("routingKey",function(){return{get:function(){return null!=this.routingKey?this.routingKey:(Batman.config.minificationErrors&&Batman.developer.error("Please define `routingKey` on the prototype of "+Batman.functionName(this.constructor)+" in order for your controller to be minification safe."),Batman.functionName(this.constructor).replace(/Controller$/,""))}}}),Controller.classMixin(Batman.LifecycleEvents),Controller.lifecycleEvent("action",function(options){var except,normalized,only;return null==options&&(options={}),normalized={},only="String"===Batman.typeOf(options.only)?[options.only]:options.only,except="String"===Batman.typeOf(options.except)?[options.except]:options.except,normalized["if"]=function(params,frame){var _ref,_ref1;return this._afterFilterRedirect?!1:only&&(_ref=frame.action,__indexOf.call(only,_ref)<0)?!1:except&&(_ref1=frame.action,__indexOf.call(except,_ref1)>=0)?!1:!0},normalized}),Controller.beforeFilter=function(){return Batman.developer.deprecated("Batman.Controller::beforeFilter","Please use beforeAction instead."),this.beforeAction.apply(this,arguments)},Controller.afterFilter=function(){return Batman.developer.deprecated("Batman.Controller::afterFilter","Please use afterAction instead."),this.afterAction.apply(this,arguments)},Controller.afterAction(function(params){return this.autoScrollToHash&&null!=params["#"]?this.scrollToHash(params["#"]):void 0}),Controller.catchError=function(){var currentHandlers,error,errors,handlers,options,_base,_i,_j,_len,_results;for(errors=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),options=arguments[_i++],Batman.initializeObject(this),(_base=this._batman).errorHandlers||(_base.errorHandlers=new Batman.SimpleHash),handlers="Array"===Batman.typeOf(options["with"])?options["with"]:[options["with"]],_results=[],_j=0,_len=errors.length;_len>_j;_j++)error=errors[_j],currentHandlers=this._batman.errorHandlers.get(error)||[],_results.push(this._batman.errorHandlers.set(error,currentHandlers.concat(handlers)));return _results},Controller.prototype.errorHandler=function(callback){var errorFrame,_ref,_this=this;return errorFrame=null!=(_ref=this._actionFrames)?_ref[this._actionFrames.length-1]:void 0,function(err,result,env){if(!err)return"function"==typeof callback?callback(result,env):void 0;if((null!=errorFrame?!errorFrame.error:!0)&&(null!=errorFrame&&(errorFrame.error=err),!_this.handleError(err)))throw err}},Controller.prototype.handleError=function(error){var handled,_ref,_this=this;return handled=!1,null!=(_ref=this.constructor._batman.getAll("errorHandlers"))&&_ref.forEach(function(hash){return hash.forEach(function(key,value){var handler,_i,_len,_results;if(error instanceof key){for(handled=!0,_results=[],_i=0,_len=value.length;_len>_i;_i++)handler=value[_i],"string"==typeof handler&&(handler=_this[handler]),_results.push(handler.call(_this,error));return _results}})}),handled},Controller.prototype.renderCache=new Batman.RenderCache,Controller.prototype.defaultRenderYield="main",Controller.prototype.autoScrollToHash=!0,Controller.prototype.dispatch=function(action,params){var redirectTo;return null==params&&(params={}),params.controller||(params.controller=this.get("routingKey")),params.action||(params.action=action),params.target||(params.target=this),this._resetActionFrames(),this.set("action",action),this.set("params",params),this.executeAction(action,params),redirectTo=this._afterFilterRedirect,this._afterFilterRedirect=null,delete this._afterFilterRedirect,redirectTo?Batman.redirect(redirectTo):void 0},Controller.prototype.executeAction=function(action,params){var frame,oldRedirect,parentFrame,result,_ref,_ref1,_this=this;return null==params&&(params=this.get("params")),Batman.developer.assert(this[action],"Error! Controller action "+this.get("routingKey")+"."+action+" couldn't be found!"),parentFrame=this._actionFrames[this._actionFrames.length-1],frame=new Batman.ControllerActionFrame({parentFrame:parentFrame,action:action,params:params},function(){var _ref;return _this._afterFilterRedirect||_this.fireLifecycleEvent("afterAction",frame.params,frame),_this._resetActionFrames(),null!=(_ref=Batman.navigator)?_ref.redirect=oldRedirect:void 0}),this._actionFrames.push(frame),frame.startOperation({internal:!0}),oldRedirect=null!=(_ref=Batman.navigator)?_ref.redirect:void 0,null!=(_ref1=Batman.navigator)&&(_ref1.redirect=this.redirect),this.fireLifecycleEvent("beforeAction",frame.params,frame)!==!1&&(this._afterFilterRedirect||(result=this[action](params)),frame.operationOccurred||this.render()),frame.finishOperation(),result},Controller.prototype.redirect=function(url){var frame;return frame=this._actionFrames[this._actionFrames.length-1],frame?frame.operationOccurred?void Batman.developer.warn("Warning! Trying to redirect but an action has already been taken during "+this.get("routingKey")+"."+(frame.action||this.get("action"))):(frame.startAndFinishOperation(),null!=this._afterFilterRedirect?Batman.developer.warn("Warning! Multiple actions trying to redirect!"):this._afterFilterRedirect=url):("Object"===Batman.typeOf(url)&&(url.controller||(url.controller=this.get("routingKey"))),Batman.redirect(url))},Controller.prototype.render=function(options){var action,frame,view,yieldContentView,yieldName,_ref,_ref1,_ref2,_ref3,_ref4;return null==options&&(options={}),(frame=null!=(_ref=this._actionFrames)?_ref[this._actionFrames.length-1]:void 0)&&frame.startOperation(),options===!1?void frame.finishOperation():(action=(null!=frame?frame.action:void 0)||this.get("action"),(view=options.view)?options.view=null:(options.viewClass||(options.viewClass=this._viewClassForAction(action)),options.source||(options.source=(null!=(_ref1=options.viewClass)?_ref1.prototype.source:void 0)||Batman.helpers.underscore(this.get("routingKey")+"/"+action)),view=this.renderCache.viewForOptions(options)),view&&(view.once("viewDidAppear",function(){return null!=frame?frame.finishOperation():void 0}),yieldName=options.into||this.defaultRenderYield,(yieldContentView=Batman.DOM.Yield.withName(yieldName).contentView)&&(yieldContentView===view||yieldContentView.isDead||yieldContentView.die()),view.contentFor||view.parentNode||view.set("contentFor",yieldName),view.set("controller",this),null!=(_ref2=Batman.currentApp)&&null!=(_ref3=_ref2.layout)&&null!=(_ref4=_ref3.subviews)&&_ref4.add(view),this.set("currentView",view)),view)},Controller.prototype.scrollToHash=function(hash){return null==hash&&(hash=this.get("params")["#"]),Batman.DOM.scrollIntoView(hash)},Controller.prototype._resetActionFrames=function(){return this._actionFrames=[]},Controller.prototype._viewClassForAction=function(action){var classPrefix,_ref;return classPrefix=this.get("routingKey").replace("/","_"),(null!=(_ref=Batman.currentApp)?_ref[Batman.helpers.camelize(""+classPrefix+"_"+action+"_view")]:void 0)||Batman.View},Controller}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Set=function(_super){function Set(){Batman.SimpleSet.apply(this,arguments)}var k,_fn,_i,_j,_len,_len1,_ref,_ref1;for(__extends(Set,_super),Set.prototype.isCollectionEventEmitter=!0,Batman.extend(Set.prototype,Batman.Enumerable),Set._applySetAccessors=function(klass){var accessor,accessors,key;accessors={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){return this.registerAsMutableSource(),this.length},indexedBy:function(){var _this=this;return new Batman.TerminalAccessible(function(key){return _this.indexedBy(key)})},indexedByUnique:function(){var _this=this;return new Batman.TerminalAccessible(function(key){return _this.indexedByUnique(key)})},sortedBy:function(){var _this=this;return new Batman.TerminalAccessible(function(key){return _this.sortedBy(key)})},sortedByDescending:function(){var _this=this;return new Batman.TerminalAccessible(function(key){return _this.sortedBy(key,"desc")})}};for(key in accessors)accessor=accessors[key],klass.accessor(key,accessor)},Set._applySetAccessors(Set),_ref=["indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem","mappedTo"],_i=0,_len=_ref.length;_len>_i;_i++)k=_ref[_i],Set.prototype[k]=Batman.SimpleSet.prototype[k];for(_ref1=["at","find","merge","forEach","toArray","isEmpty","has"],_fn=function(k){return Set.prototype[k]=function(){return this.registerAsMutableSource(),Batman.SimpleSet.prototype[k].apply(this,arguments)}},_j=0,_len1=_ref1.length;_len1>_j;_j++)k=_ref1[_j],_fn(k);return Set.prototype.toJSON=function(){return this.map(function(value){return("function"==typeof value.toJSON?value.toJSON():void 0)||value})},Set.prototype.add=Set.mutation(function(){var addedItems;return addedItems=Batman.SimpleSet.prototype.add.apply(this,arguments),addedItems.length&&this.fire("itemsWereAdded",addedItems),addedItems}),Set.prototype.insert=function(){return this.insertWithIndexes.apply(this,arguments).addedItems},Set.prototype.insertWithIndexes=Set.mutation(function(){var addedIndexes,addedItems,_ref2;return _ref2=Batman.SimpleSet.prototype.insertWithIndexes.apply(this,arguments),addedItems=_ref2.addedItems,addedIndexes=_ref2.addedIndexes,addedItems.length&&this.fire("itemsWereAdded",addedItems,addedIndexes),{addedItems:addedItems,addedIndexes:addedIndexes}}),Set.prototype.remove=function(){return this.removeWithIndexes.apply(this,arguments).removedItems},Set.prototype.removeWithIndexes=Set.mutation(function(){var removedIndexes,removedItems,_ref2;return _ref2=Batman.SimpleSet.prototype.removeWithIndexes.apply(this,arguments),removedItems=_ref2.removedItems,removedIndexes=_ref2.removedIndexes,removedItems.length&&this.fire("itemsWereRemoved",removedItems,removedIndexes),{removedItems:removedItems,removedIndexes:removedIndexes}}),Set.prototype.clear=Set.mutation(function(){var removedItems;return removedItems=Batman.SimpleSet.prototype.clear.call(this),removedItems.length&&this.fire("itemsWereRemoved",removedItems),removedItems}),Set.prototype.replace=Set.mutation(function(other){var addedItems,removedItems;return removedItems=Batman.SimpleSet.prototype.clear.call(this),addedItems=Batman.SimpleSet.prototype.add.apply(this,other.toArray()),removedItems.length&&this.fire("itemsWereRemoved",removedItems),addedItems.length?this.fire("itemsWereAdded",addedItems):void 0}),Set}.call(this,Batman.Object)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.ErrorsSet=function(_super){function ErrorsSet(){return _ref=ErrorsSet.__super__.constructor.apply(this,arguments)}return __extends(ErrorsSet,_super),ErrorsSet.accessor(function(key){return this.indexedBy("attribute").get(key)}),ErrorsSet.prototype.add=function(key,error){return ErrorsSet.__super__.add.call(this,new Batman.ValidationError(key,error))},ErrorsSet}(Batman.Set)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.SetProxy=function(_super){function SetProxy(base){this.base=base,SetProxy.__super__.constructor.call(this),this.length=this.base.length,this.base.isCollectionEventEmitter&&(this.isCollectionEventEmitter=!0,this._setObserver=new Batman.SetObserver(this.base),this._setObserver.on("itemsWereAdded",this._handleItemsAdded.bind(this)),this._setObserver.on("itemsWereRemoved",this._handleItemsRemoved.bind(this)),this.startObserving())}var k,_fn,_i,_len,_ref;for(__extends(SetProxy,_super),Batman.extend(SetProxy.prototype,Batman.Enumerable),SetProxy.prototype.startObserving=function(){var _ref;return null!=(_ref=this._setObserver)?_ref.startObserving():void 0},SetProxy.prototype.stopObserving=function(){var _ref;return null!=(_ref=this._setObserver)?_ref.stopObserving():void 0},SetProxy.prototype._handleItemsAdded=function(items,indexes){return this.set("length",this.base.length),this.fire("itemsWereAdded",items,indexes)},SetProxy.prototype._handleItemsRemoved=function(items,indexes){return this.set("length",this.base.length),this.fire("itemsWereRemoved",items,indexes)},SetProxy.prototype.filter=function(f){return this.reduce(function(accumulator,element){return f(element)&&accumulator.add(element),accumulator},new Batman.Set)},SetProxy.prototype.replace=function(){var length,result;return length=this.property("length"),length.isolate(),result=this.base.replace.apply(this.base,arguments),length.expose(),result},Batman.Set._applySetAccessors(SetProxy),_ref=["add","insert","insertWithIndexes","remove","removeWithIndexes","at","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],_fn=function(k){return SetProxy.prototype[k]=function(){return this.base[k].apply(this.base,arguments)}},_i=0,_len=_ref.length;_len>_i;_i++)k=_ref[_i],_fn(k);return SetProxy.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(_,v){return this.length=v}}),SetProxy}.call(this,Batman.Object)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.BinarySetOperation=function(_super){function BinarySetOperation(left,right){this.left=left,this.right=right,this._setup=__bind(this._setup,this),BinarySetOperation.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return __extends(BinarySetOperation,_super),BinarySetOperation.prototype._setup=function(set,opposite){var _this=this;return set.on("itemsWereAdded",function(items){return _this._itemsWereAddedToSource.apply(_this,[set,opposite].concat(__slice.call(items)))}),set.on("itemsWereRemoved",function(items){return _this._itemsWereRemovedFromSource.apply(_this,[set,opposite].concat(__slice.call(items)))}),this._itemsWereAddedToSource.apply(this,[set,opposite].concat(__slice.call(set.toArray())))},BinarySetOperation.prototype.merge=function(){var merged,others,set,_i,_len;for(others=1<=arguments.length?__slice.call(arguments,0):[],merged=new Batman.Set,others.unshift(this),_i=0,_len=others.length;_len>_i;_i++)set=others[_i],set.forEach(function(v){return merged.add(v)});return merged},BinarySetOperation.prototype.filter=Batman.SetProxy.prototype.filter,BinarySetOperation}(Batman.Set)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.SetUnion=function(_super){function SetUnion(){return _ref=SetUnion.__super__.constructor.apply(this,arguments)}return __extends(SetUnion,_super),SetUnion.prototype._itemsWereAddedToSource=function(){var items,opposite,source;return source=arguments[0],opposite=arguments[1],items=3<=arguments.length?__slice.call(arguments,2):[],this.add.apply(this,items)},SetUnion.prototype._itemsWereRemovedFromSource=function(){var item,items,itemsToRemove,opposite,source;return source=arguments[0],opposite=arguments[1],items=3<=arguments.length?__slice.call(arguments,2):[],itemsToRemove=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],opposite.has(item)||_results.push(item);return _results}(),this.remove.apply(this,itemsToRemove)},SetUnion}(Batman.BinarySetOperation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.SetIntersection=function(_super){function SetIntersection(){return _ref=SetIntersection.__super__.constructor.apply(this,arguments)}return __extends(SetIntersection,_super),SetIntersection.prototype._itemsWereAddedToSource=function(){var item,items,itemsToAdd,opposite,source;return source=arguments[0],opposite=arguments[1],items=3<=arguments.length?__slice.call(arguments,2):[],itemsToAdd=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],opposite.has(item)&&_results.push(item);return _results}(),itemsToAdd.length>0?this.add.apply(this,itemsToAdd):void 0},SetIntersection.prototype._itemsWereRemovedFromSource=function(){var items,opposite,source;return source=arguments[0],opposite=arguments[1],items=3<=arguments.length?__slice.call(arguments,2):[],this.remove.apply(this,items)},SetIntersection}(Batman.BinarySetOperation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.SetComplement=function(_super){function SetComplement(){return _ref=SetComplement.__super__.constructor.apply(this,arguments)}return __extends(SetComplement,_super),SetComplement.prototype._itemsWereAddedToSource=function(){var item,items,itemsToAdd,itemsToRemove,opposite,source;if(source=arguments[0],opposite=arguments[1],items=3<=arguments.length?__slice.call(arguments,2):[],source===this.left){if(itemsToAdd=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],opposite.has(item)||_results.push(item);return _results}(),itemsToAdd.length>0)return this.add.apply(this,itemsToAdd)}else if(itemsToRemove=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],opposite.has(item)&&_results.push(item);return _results}(),itemsToRemove.length>0)return this.remove.apply(this,itemsToRemove)},SetComplement.prototype._itemsWereRemovedFromSource=function(){var item,items,itemsToAdd,opposite,source;return source=arguments[0],opposite=arguments[1],items=3<=arguments.length?__slice.call(arguments,2):[],source===this.left?this.remove.apply(this,items):(itemsToAdd=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],opposite.has(item)&&_results.push(item);return _results}(),itemsToAdd.length>0?this.add.apply(this,itemsToAdd):void 0)},SetComplement.prototype._addComplement=function(items,opposite){var item,itemsToAdd;return itemsToAdd=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],opposite.has(item)&&_results.push(item);return _results}(),itemsToAdd.length>0?this.add.apply(this,itemsToAdd):void 0},SetComplement}(Batman.BinarySetOperation)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.StateMachine=function(_super){function StateMachine(startState){this.nextEvents=[],this.set("_state",startState)}return __extends(StateMachine,_super),StateMachine.InvalidTransitionError=function(message){this.message=null!=message?message:""},StateMachine.InvalidTransitionError.prototype=new Error,StateMachine.transitions=function(table){var definePredicate,fromState,k,object,predicateKeys,toState,transitions,v,_fn,_ref,_this=this;for(k in table)v=table[k],v.from&&v.to&&(object={},v.from.forEach?v.from.forEach(function(fromKey){return object[fromKey]=v.to}):object[v.from]=v.to,table[k]=object);this.prototype.transitionTable=Batman.extend({},this.prototype.transitionTable,table),predicateKeys=[],definePredicate=function(state){var key;return key="is"+Batman.helpers.titleize(state),null==_this.prototype[key]?(predicateKeys.push(key),_this.prototype[key]=function(){return this.get("state")===state}):void 0},_ref=this.prototype.transitionTable,_fn=function(k){return _this.prototype[k]=function(){return this.startTransition(k)}};for(k in _ref)if(transitions=_ref[k],!this.prototype[k]){_fn(k);for(fromState in transitions)toState=transitions[fromState],definePredicate(fromState),definePredicate(toState)}return predicateKeys.length&&this.accessor.apply(this,__slice.call(predicateKeys).concat([function(key){return this[key]()}])),this},StateMachine.accessor("state",function(){return this.get("_state")}),StateMachine.prototype.isTransitioning=!1,StateMachine.prototype.transitionTable={},StateMachine.prototype._transitionEvent=function(from,into){return""+from+"->"+into},StateMachine.prototype._enterEvent=function(into){return"enter "+into},StateMachine.prototype._exitEvent=function(from){return"exit "+from},StateMachine.prototype._beforeEvent=function(into){return"before "+into},StateMachine.prototype.onTransition=function(from,into,callback){return this.on(this._transitionEvent(from,into),callback)},StateMachine.prototype.onEnter=function(into,callback){return this.on(this._enterEvent(into),callback)},StateMachine.prototype.onExit=function(from,callback){return this.on(this._exitEvent(from),callback)},StateMachine.prototype.onBefore=function(into,callback){return this.on(this._beforeEvent(into),callback)},StateMachine.prototype.offTransition=function(from,into,callback){return this.off(this._transitionEvent(from,into),callback)},StateMachine.prototype.offEnter=function(into,callback){return this.off(this._enterEvent(into),callback)},StateMachine.prototype.offExit=function(from,callback){return this.off(this._exitEvent(from),callback)},StateMachine.prototype.offBefore=function(into,callback){return this.off(this._beforeEvent(into),callback)},StateMachine.prototype.startTransition=Batman.Property.wrapTrackingPrevention(function(event){var nextState,previousState;return this.isTransitioning?void this.nextEvents.push(event):(previousState=this.get("state"),(nextState=this.nextStateForEvent(event))?(this.fire(this._beforeEvent(nextState)),this.isTransitioning=!0,this.fire(this._exitEvent(previousState)),this.set("_state",nextState),this.fire(this._transitionEvent(previousState,nextState)),this.fire(this._enterEvent(nextState)),this.fire(event),this.isTransitioning=!1,this.nextEvents.length>0&&this.startTransition(this.nextEvents.shift()),!0):!1)}),StateMachine.prototype.canStartTransition=function(event,fromState){return null==fromState&&(fromState=this.get("state")),!!this.nextStateForEvent(event,fromState)},StateMachine.prototype.nextStateForEvent=function(event,fromState){var _ref;return null==fromState&&(fromState=this.get("state")),null!=(_ref=this.transitionTable[event])?_ref[fromState]:void 0},StateMachine}(Batman.Object),Batman.DelegatingStateMachine=function(_super){function DelegatingStateMachine(startState,base){this.base=base,DelegatingStateMachine.__super__.constructor.call(this,startState)}return __extends(DelegatingStateMachine,_super),DelegatingStateMachine.prototype.fire=function(){var result,_ref;return result=DelegatingStateMachine.__super__.fire.apply(this,arguments),(_ref=this.base).fire.apply(_ref,arguments),result},DelegatingStateMachine}(Batman.StateMachine)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.Model=function(_super){function Model(idOrAttributes){null==idOrAttributes&&(idOrAttributes={}),Batman.developer.assert(this instanceof Batman.Object,"constructors must be called with new"),"Object"===Batman.typeOf(idOrAttributes)?Model.__super__.constructor.call(this,idOrAttributes):(Model.__super__.constructor.call(this),this.set("id",idOrAttributes))}var functionName,_i,_j,_len,_len1,_ref,_ref1,_ref2;for(__extends(Model,_super),Model.storageKey=null,Model.primaryKey="id",Model.persist=function(){var mechanism,options;return mechanism=arguments[0],options=2<=arguments.length?__slice.call(arguments,1):[],Batman.initializeObject(this.prototype),mechanism=mechanism.isStorageAdapter?mechanism:new mechanism(this),options.length>0&&Batman.mixin.apply(Batman,[mechanism].concat(__slice.call(options))),this.prototype._batman.storage=mechanism,mechanism},Model.storageAdapter=function(){return Batman.initializeObject(this.prototype),this.prototype._batman.storage},Model.encode=function(){var encoder,encoderForKey,encoderOrLastKey,key,keys,_base,_i,_j,_len;switch(keys=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),encoderOrLastKey=arguments[_i++],Batman.initializeObject(this.prototype),(_base=this.prototype._batman).encoders||(_base.encoders=new Batman.SimpleHash),encoder={},Batman.typeOf(encoderOrLastKey)){case"String":keys.push(encoderOrLastKey);break;case"Function":encoder.encode=encoderOrLastKey;break;default:encoder=encoderOrLastKey}for(_j=0,_len=keys.length;_len>_j;_j++)key=keys[_j],encoderForKey=Batman.extend({as:key},this.defaultEncoder,encoder),this.prototype._batman.encoders.set(key,encoderForKey)},Model.defaultEncoder={encode:function(x){return x},decode:function(x){return x}},Model.observeAndFire("primaryKey",function(newPrimaryKey,oldPrimaryKey){return this.encode(oldPrimaryKey,{encode:!1,decode:!1}),this.encode(newPrimaryKey,{encode:!1,decode:this.defaultEncoder.decode})}),Model.validate=function(){var keys,matches,optionsOrFunction,validatorClass,validators,_base,_i,_j,_len,_ref;if(keys=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),optionsOrFunction=arguments[_i++],Batman.initializeObject(this.prototype),validators=(_base=this.prototype._batman).validators||(_base.validators=[]),"function"==typeof optionsOrFunction)validators.push({keys:keys,callback:optionsOrFunction});else for(_ref=Batman.Validators,_j=0,_len=_ref.length;_len>_j;_j++)validatorClass=_ref[_j],(matches=validatorClass.matches(optionsOrFunction))&&validators.push({keys:keys,validator:new validatorClass(matches),"if":optionsOrFunction["if"],unless:optionsOrFunction.unless})},Model.classAccessor("resourceName",{get:function(){return null!=this.resourceName?this.resourceName:null!=this.prototype.resourceName?(Batman.config.minificationErrors&&Batman.developer.error("Please define the resourceName property of the "+Batman.functionName(this)+" on the constructor and not the prototype."),this.prototype.resourceName):(Batman.config.minificationErrors&&Batman.developer.error("Please define "+Batman.functionName(this)+".resourceName in order for your model to be minification safe."),Batman.helpers.underscore(Batman.functionName(this)))}}),Model.classAccessor("all",{get:function(){return this._batman.check(this),this.prototype.hasStorage()&&!this._batman.allLoadTriggered&&(this.load(),this._batman.allLoadTriggered=!0),this.get("loaded")},set:function(k,v){return this.set("loaded",v)}}),Model.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new Batman.Set)},set:function(k,v){return this._loaded=v}}),Model.classAccessor("first",function(){return this.get("all").toArray()[0]}),Model.classAccessor("last",function(){var x;return x=this.get("all").toArray(),x[x.length-1]}),Model.clear=function(){var result,_ref;return Batman.initializeObject(this),result=this.get("loaded").clear(),null!=(_ref=this._batman.get("associations"))&&_ref.reset(),this._resetPromises(),result},Model.find=function(id,callback){return this.findWithOptions(id,void 0,callback)},Model.findWithOptions=function(id,options,callback){var record,_this=this;return null==options&&(options={}),Batman.developer.assert(callback,"Must call find with a callback!"),this._pending||(this._pending={}),record=this._loadIdentity(id)||this._pending[id],null==record&&(record=new this,record._withoutDirtyTracking(function(){return this.set("id",id)}),this._pending[id]=record),record.loadWithOptions(options,function(){return delete _this._pending[id],callback.apply(_this,arguments)}),record},Model.load=function(options,callback){var _ref;return"function"==(_ref=typeof options)||"undefined"===_ref?(callback=options,options={}):options={data:options},this.loadWithOptions(options,callback)},Model.loadWithOptions=function(options,callback){var _this=this;return this.fire("loading",options),this._doStorageOperation("readAll",options,function(err,records,env){return null!=err?(_this.fire("error",err),"function"==typeof callback?callback(err,[]):void 0):(_this.fire("loaded",records,env),"function"==typeof callback?callback(err,records,env):void 0)})},Model.create=function(attrs,callback){var record,_ref;return callback||(_ref=[{},attrs],attrs=_ref[0],callback=_ref[1]),record=new this(attrs),record.save(callback),record},Model.findOrCreate=function(attrs,callback){var record;return record=this._loadIdentity(attrs[this.primaryKey]),record?(record.mixin(attrs),callback(void 0,record)):(record=new this(attrs),record.save(callback)),record},Model.createFromJSON=function(json){return this._makeOrFindRecordFromData(json)},Model.createMultipleFromJSON=function(array){return this._makeOrFindRecordsFromData(array)},Model._loadIdentity=function(id){return this.get("loaded.indexedByUnique.id").get(id)},Model._loadRecord=function(attributes){var id,record;return(id=attributes[this.primaryKey])&&(record=this._loadIdentity(id)),record||(record=new this),record._withoutDirtyTracking(function(){return this.fromJSON(attributes)}),record},Model._makeOrFindRecordFromData=function(attributes){var record;return record=this._loadRecord(attributes),this._mapIdentity(record)},Model._makeOrFindRecordsFromData=function(attributeSet){var attributes,newRecords;return newRecords=function(){var _i,_len,_results;
for(_results=[],_i=0,_len=attributeSet.length;_len>_i;_i++)attributes=attributeSet[_i],_results.push(this._loadRecord(attributes));return _results}.call(this),this._mapIdentities(newRecords),newRecords},Model._mapIdentity=function(record){var existing,id,lifecycle;return null!=(id=record.get("id"))&&((existing=this._loadIdentity(id))?(lifecycle=existing.get("lifecycle"),lifecycle.load(),existing._withoutDirtyTracking(function(){var attributes,_ref;return attributes=null!=(_ref=record.get("attributes"))?_ref.toObject():void 0,attributes?this.mixin(attributes):void 0}),lifecycle.loaded(),record=existing):this.get("loaded").add(record)),record},Model._mapIdentities=function(records){var existing,id,index,lifecycle,newRecords,record,_i,_len,_ref;for(newRecords=[],index=_i=0,_len=records.length;_len>_i;index=++_i)record=records[index],null!=(id=record.get("id"))&&((existing=this._loadIdentity(id))?(lifecycle=existing.get("lifecycle"),lifecycle.load(),existing._withoutDirtyTracking(function(){var attributes,_ref;return attributes=null!=(_ref=record.get("attributes"))?_ref.toObject():void 0,attributes?this.mixin(attributes):void 0}),lifecycle.loaded(),records[index]=existing):newRecords.push(record));return newRecords.length&&(_ref=this.get("loaded")).add.apply(_ref,newRecords),records},Model._doStorageOperation=function(operation,options,callback){var adapter;return Batman.developer.assert(this.prototype.hasStorage(),"Can't "+operation+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),adapter=this.prototype._batman.get("storage"),adapter.perform(operation,this,options,callback)},_ref=["find","load","create"],_i=0,_len=_ref.length;_len>_i;_i++)functionName=_ref[_i],Model[functionName]=Batman.Property.wrapTrackingPrevention(Model[functionName]);for(Model.InstanceLifecycleStateMachine=function(_super1){function InstanceLifecycleStateMachine(){return _ref1=InstanceLifecycleStateMachine.__super__.constructor.apply(this,arguments)}return __extends(InstanceLifecycleStateMachine,_super1),InstanceLifecycleStateMachine.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}}),InstanceLifecycleStateMachine}(Batman.DelegatingStateMachine),Model.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new Batman.Model.InstanceLifecycleStateMachine("clean",this))}),Model.accessor("attributes",function(){return this.attributes||(this.attributes=new Batman.Hash)}),Model.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new Batman.Hash)}),Model.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new Batman.SimpleSet)}),Model.accessor("errors",function(){return this.errors||(this.errors=new Batman.ErrorsSet)}),Model.accessor("isNew",function(){return this.isNew()}),Model.accessor("isDirty",function(){return this.isDirty()}),Model.accessor(Model.defaultAccessor={get:function(k){return Batman.getPath(this,["attributes",k])},set:function(k,v){return this._willSet(k)?this.get("attributes").set(k,v):this.get(k)},unset:function(k){return this.get("attributes").unset(k)}}),Model.wrapAccessor("id",function(core){return{get:function(){var primaryKey;return primaryKey=this.constructor.primaryKey,"id"===primaryKey?core.get.apply(this,arguments):this.get(primaryKey)},set:function(key,value){var primaryKey;return primaryKey=this.constructor.primaryKey,"id"===primaryKey?(this._willSet(key),core.set.apply(this,arguments)):this.set(primaryKey,value)}}}),Model.prototype.isNew=function(){return"undefined"==typeof this.get("id")},Model.prototype.isDirty=function(){return"dirty"===this.get("lifecycle.state")},Model.prototype.updateAttributes=function(attrs){return this.mixin(attrs),this},Model.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")},Model.prototype.toParam=function(){return this.get("id")},Model.prototype.toJSON=function(){var encoders,obj,_this=this;return encoders=this._batman.get("encoders"),!encoders||encoders.isEmpty()?{}:(obj={},encoders.forEach(function(key,encoder){var encodedVal,val,_ref2;if(encoder.encode&&void 0!==(val=_this.get(key)))return void 0!==(encodedVal=encoder.encode(val,key,obj,_this))?obj[null!=(_ref2="function"==typeof encoder.as?encoder.as(key,val,obj,_this):void 0)?_ref2:encoder.as]=encodedVal:void 0}),obj)},Model.prototype.fromJSON=function(data){var encoders,key,obj,value,_this=this;if(obj={},encoders=this._batman.get("encoders"),encoders&&!encoders.isEmpty()&&encoders.some(function(key,encoder){return null!=encoder.decode}))encoders.forEach(function(key,encoder){var as,_ref2;if(encoder.decode&&(as=null!=(_ref2="function"==typeof encoder.as?encoder.as(key,data[key],obj,_this):void 0)?_ref2:encoder.as,value=data[as],void 0!==value&&(null!==value||null==_this._associationForAttribute(as))))return obj[key]=encoder.decode(value,as,data,obj,_this)});else for(key in data)value=data[key],obj[key]=value;return"id"!==this.constructor.primaryKey&&(obj.id=data[this.constructor.primaryKey]),Batman.developer["do"](function(){return!encoders||encoders.length<=1?Batman.developer.warn("Warning: Model "+Batman.functionName(_this.constructor)+" has suspiciously few decoders!"):void 0}),this.mixin(obj)},Model.prototype.hasStorage=function(){return null!=this._batman.get("storage")},Model.prototype.load=function(options,callback){var _ref2;return callback?options={data:options}:(_ref2=[{},options],options=_ref2[0],callback=_ref2[1]),this.loadWithOptions(options,callback)},Model.prototype.loadWithOptions=function(options,callback){var callbackQueue,hasOptions,_ref2,_this=this;return hasOptions=0!==Object.keys(options).length,"destroying"===(_ref2=this.get("lifecycle.state"))||"destroyed"===_ref2?void("function"==typeof callback&&callback(new Error("Can't load a destroyed record!"))):this.get("lifecycle").load()?(callbackQueue=[],null!=callback&&callbackQueue.push(callback),hasOptions||(this._currentLoad=callbackQueue),this._doStorageOperation("read",options,function(err,record,env){var _j,_len1;for(err?_this.get("lifecycle").error():(_this.get("lifecycle").loaded(),record=_this.constructor._mapIdentity(record),record.get("errors").clear()),hasOptions||(_this._currentLoad=null),_j=0,_len1=callbackQueue.length;_len1>_j;_j++)(callback=callbackQueue[_j])(err,record,env)})):"loading"!==this.get("lifecycle.state")||hasOptions?"function"==typeof callback?callback(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state"))):void 0:null!=callback?this._currentLoad.push(callback):void 0},Model.prototype.save=function(options,callback){var endState,isNew,startState,storageOperation,_ref2,_ref3,_this=this;return callback||(_ref2=[{},options],options=_ref2[0],callback=_ref2[1]),isNew=this.isNew(),_ref3=isNew?["create","create","created"]:["save","update","saved"],startState=_ref3[0],storageOperation=_ref3[1],endState=_ref3[2],this.get("lifecycle").startTransition(startState)?this.validate(function(error,errors){var associations,payload;return error||errors.length?(_this.get("lifecycle").failedValidation(),"function"==typeof callback?callback(error||errors,_this):void 0):(_this.fire("validated"),associations=_this.constructor._batman.get("associations"),_this._withoutDirtyTracking(function(){var _ref4,_this=this;return null!=associations&&null!=(_ref4=associations.getByType("belongsTo"))?_ref4.forEach(function(association){return association.apply(_this)}):void 0}),payload=Batman.extend({},options,{data:options}),_this._doStorageOperation(storageOperation,payload,function(err,record,env){return err?err instanceof Batman.ErrorsSet?_this.get("lifecycle").failedValidation():_this.get("lifecycle").error():(_this.get("dirtyKeys").clear(),_this.get("_dirtiedKeys").clear(),associations&&record._withoutDirtyTracking(function(){var _ref4,_ref5;return null!=(_ref4=associations.getByType("hasOne"))&&_ref4.forEach(function(association){return association.apply(err,record)}),null!=(_ref5=associations.getByType("hasMany"))?_ref5.forEach(function(association){return association.apply(err,record)}):void 0}),record=_this.constructor._mapIdentity(record),_this.get("lifecycle").startTransition(endState)),"function"==typeof callback?callback(err,record||_this,env):void 0}))}):"function"==typeof callback?callback(new Batman.StateMachine.InvalidTransitionError("Can't save while in state "+this.get("lifecycle.state"))):void 0},Model.prototype.destroy=function(options,callback){var _ref2,_this=this;return callback||(_ref2=[{},options],options=_ref2[0],callback=_ref2[1]),this.get("lifecycle").destroy()?this._doStorageOperation("destroy",{data:options},function(err,record,env){return err?_this.get("lifecycle").error():(_this.constructor.get("loaded").remove(_this),_this.get("lifecycle").destroyed()),"function"==typeof callback?callback(err,record,env):void 0}):"function"==typeof callback?callback(new Batman.StateMachine.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state"))):void 0},Model.prototype.validate=function(callback){var args,condition,count,e,errors,finishedValidation,key,validator,validators,_j,_k,_len1,_len2,_ref2;if(errors=this.get("errors"),errors.clear(),validators=this._batman.get("validators")||[],!validators||0===validators.length)return"function"==typeof callback&&callback(void 0,errors),!0;for(count=validators.reduce(function(acc,validator){return acc+validator.keys.length},0),finishedValidation=function(){return 0===--count&&"function"==typeof callback?callback(void 0,errors):void 0},_j=0,_len1=validators.length;_len1>_j;_j++)if(validator=validators[_j],!validator["if"]||(condition="string"==typeof validator["if"]?this.get(validator["if"]):validator["if"].call(this,errors,this,key)))if(validator.unless&&(condition="string"==typeof validator.unless?this.get(validator.unless):validator.unless.call(this,errors,this,key)))finishedValidation();else for(_ref2=validator.keys,_k=0,_len2=_ref2.length;_len2>_k;_k++){key=_ref2[_k],args=[errors,this,key,finishedValidation];try{validator.validator?validator.validator.validateEach.apply(validator.validator,args):validator.callback.apply(validator,args)}catch(_error){e=_error,"function"==typeof callback&&callback(e,errors)}}else finishedValidation()},Model.prototype.associationProxy=function(association){var proxies,_base,_name;return Batman.initializeObject(this),proxies=(_base=this._batman).associationProxies||(_base.associationProxies={}),proxies[_name=association.label]||(proxies[_name]=new association.proxyClass(association,this)),proxies[association.label]},Model.prototype._willSet=function(key){return this._pauseDirtyTracking?!0:this.get("lifecycle").startTransition("set")?(this.get("_dirtiedKeys").has(key)||(this.set("dirtyKeys."+key,this.get(key)),this.get("_dirtiedKeys").add(key)),!0):!1},Model.prototype._associationForAttribute=function(attribute){var _ref2;return null!=(_ref2=this.constructor._batman.get("associations"))?_ref2.get(attribute):void 0},Model.prototype._doStorageOperation=function(operation,options,callback){var adapter;return Batman.developer.assert(this.hasStorage(),"Can't "+operation+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),adapter=this._batman.get("storage"),adapter.perform(operation,this,options,function(){return callback.apply(null,arguments)})},Model.prototype._withoutDirtyTracking=function(block){var result;return this._pauseDirtyTracking?block.call(this):(this._pauseDirtyTracking=!0,result=block.call(this),this._pauseDirtyTracking=!1,result)},_ref2=["load","save","validate","destroy"],_j=0,_len1=_ref2.length;_len1>_j;_j++)functionName=_ref2[_j],Model.prototype[functionName]=Batman.Property.wrapTrackingPrevention(Model.prototype[functionName]);return Model.prototype.reflectOnAllAssociations=function(associationType){var associations;return associations=this.constructor._batman.get("associations"),null!=associationType?null!=associations?associations.getByType(associationType):void 0:null!=associations?associations.getAll():void 0},Model.prototype.reflectOnAssociation=function(associationLabel){var _ref3;return null!=(_ref3=this.constructor._batman.get("associations"))?_ref3.getByLabel(associationLabel):void 0},Model.prototype.transaction=function(){return this._transaction([],[])},Model.prototype._transaction=function(visited,stack){var attributes,hasManys,index,key,label,newValues,transaction,value,_k,_len2,_ref3,_ref4;if(index=visited.indexOf(this),-1!==index)return stack[index];if(visited.push(this),stack.push(transaction=new this.constructor),hasManys=this.reflectOnAllAssociations("hasMany"))for(hasManys=hasManys.filter(function(association){return association.options.includeInTransaction}),_ref3=hasManys.mapToProperty("label"),_k=0,_len2=_ref3.length;_len2>_k;_k++)label=_ref3[_k],this.get(label);attributes=this.get("attributes").toObject();for(key in attributes)__hasProp.call(attributes,key)&&(value=attributes[key],value instanceof Batman.Model&&!value.isTransaction?attributes[key]=value._transaction(visited,stack):value instanceof Batman.AssociationSet&&!value.isTransaction?(newValues=new Batman.TransactionAssociationSet(value,visited,stack),attributes[key]=newValues):"Object"===Batman.typeOf(value)&&Batman.developer.warn("You're passing a mutable object ("+key+", "+value.constructor.name+") in a "+this.constructor.name+" transaction:",value));transaction._withoutDirtyTracking(function(){return transaction.updateAttributes(attributes)}),transaction._batman.base=this,_ref4=Batman.Transaction;for(key in _ref4)value=_ref4[key],transaction[key]=value;return transaction.accessor("isTransaction",function(){return this.isTransaction}),transaction.accessor("base",function(){return this.base()}),transaction},Model}.call(this,Batman.Object)}.call(this),function(){var k,_fn,_i,_len,_ref;for(_ref=Batman.AssociationCurator.availableAssociations,_fn=function(k){return Batman.Model[k]=function(label,scope){var collection,_base;return Batman.initializeObject(this),collection=(_base=this._batman).associations||(_base.associations=new Batman.AssociationCurator(this)),collection.add(new(Batman[""+Batman.helpers.titleize(k)+"Association"])(this,label,scope))}},_i=0,_len=_ref.length;_len>_i;_i++)k=_ref[_i],_fn(k)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Proxy=function(_super){function Proxy(target){Proxy.__super__.constructor.call(this),null!=target&&this.set("target",target)}return __extends(Proxy,_super),Proxy.prototype.isProxy=!0,Proxy.accessor("target",Batman.Property.defaultAccessor),Proxy.accessor({get:function(key){var _ref;return null!=(_ref=this.get("target"))?_ref.get(key):void 0},set:function(key,value){var _ref;return null!=(_ref=this.get("target"))?_ref.set(key,value):void 0},unset:function(key){var _ref;return null!=(_ref=this.get("target"))?_ref.unset(key):void 0}}),Proxy}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.AssociationProxy=function(_super){function AssociationProxy(association,model){this.association=association,this.model=model,AssociationProxy.__super__.constructor.call(this)}return __extends(AssociationProxy,_super),AssociationProxy.prototype.loaded=!1,AssociationProxy.prototype.toJSON=function(){var target;return target=this.get("target"),null!=target?this.get("target").toJSON():void 0},AssociationProxy.prototype.load=function(callback){var _this=this;return this.fetch(function(err,proxiedRecord){return err||_this._setTarget(proxiedRecord),"function"==typeof callback?callback(err,proxiedRecord):void 0}),this.get("target")},AssociationProxy.prototype.loadFromLocal=function(){var target;if(this._canLoad())return(target=this.fetchFromLocal())&&this._setTarget(target),target},AssociationProxy.prototype.fetch=function(callback){var record;return this._canLoad()?(record=this.fetchFromLocal(),record?callback(void 0,record):this.fetchFromRemote(callback)):callback(void 0,void 0)},AssociationProxy.accessor("loaded",Batman.Property.defaultAccessor),AssociationProxy.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(_,v){return v}}),AssociationProxy.prototype._canLoad=function(){return null!=(this.get("foreignValue")||this.get("primaryValue"))},AssociationProxy.prototype._setTarget=function(target){return this.set("target",target),this.set("loaded",!0),this.fire("loaded",target)},AssociationProxy}(Batman.Proxy)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.HasOneProxy=function(_super){function HasOneProxy(){return _ref=HasOneProxy.__super__.constructor.apply(this,arguments)}return __extends(HasOneProxy,_super),HasOneProxy.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),HasOneProxy.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},HasOneProxy.prototype.fetchFromRemote=function(callback){var loadOptions;return loadOptions={data:{}},loadOptions.data[this.association.foreignKey]=this.get("primaryValue"),this.association.options.url&&(loadOptions.collectionUrl=this.association.options.url,loadOptions.urlContext=this.model),this.association.getRelatedModel().loadWithOptions(loadOptions,function(error,loadedRecords){return!loadedRecords||loadedRecords.length<=0?callback(error||new Error("Couldn't find related record!"),void 0):callback(void 0,loadedRecords[0])})},HasOneProxy}(Batman.AssociationProxy)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.BelongsToProxy=function(_super){function BelongsToProxy(){return _ref=BelongsToProxy.__super__.constructor.apply(this,arguments)}return __extends(BelongsToProxy,_super),BelongsToProxy.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),BelongsToProxy.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},BelongsToProxy.prototype.fetchFromRemote=function(callback){var loadOptions;return loadOptions={},this.association.options.url&&(loadOptions.recordUrl=this.association.options.url),this.association.getRelatedModel().findWithOptions(this.get("foreignValue"),loadOptions,callback)},BelongsToProxy}(Batman.AssociationProxy)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PolymorphicBelongsToProxy=function(_super){function PolymorphicBelongsToProxy(){return _ref=PolymorphicBelongsToProxy.__super__.constructor.apply(this,arguments)}return __extends(PolymorphicBelongsToProxy,_super),PolymorphicBelongsToProxy.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),PolymorphicBelongsToProxy.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},PolymorphicBelongsToProxy.prototype.fetchFromRemote=function(callback){var loadOptions;return loadOptions={},this.association.options.url&&(loadOptions.recordUrl=this.association.options.url),this.association.getRelatedModelForType(this.get("foreignTypeValue")).findWithOptions(this.get("foreignValue"),loadOptions,callback)},PolymorphicBelongsToProxy}(Batman.BelongsToProxy)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Accessible=function(_super){function Accessible(){this.accessor.apply(this,arguments)}return __extends(Accessible,_super),Accessible}(Batman.Object),Batman.TerminalAccessible=function(_super){function TerminalAccessible(){return _ref=TerminalAccessible.__super__.constructor.apply(this,arguments)}return __extends(TerminalAccessible,_super),TerminalAccessible.prototype.propertyClass=Batman.Property,TerminalAccessible}(Batman.Accessible)}.call(this),function(){Batman.URI=function(){function URI(str){var i,matches;for(matches=strictParser.exec(str),i=14;i--;)this[attributes[i]]=matches[i]||"";this.queryParams=this.constructor.paramsFromQuery(this.query),delete this.authority,delete this.userInfo,delete this.relative,delete this.directory,delete this.file,delete this.query}var attributes,childKeyMatchers,decodeQueryComponent,encodeComponent,encodeQueryComponent,keyVal,nameParser,normalizeParams,plus,queryFromParams,r20,strictParser;return strictParser=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,attributes=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"],URI.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)},URI.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")},URI.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")},URI.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")},URI.prototype.relative=function(){var query;return query=this.queryString(),[this.path,query?"?"+query:void 0,this.hash?"#"+this.hash:void 0].join("")},URI.prototype.directory=function(){var splitPath;return splitPath=this.path.split("/"),splitPath.length>1?splitPath.slice(0,splitPath.length-1).join("/")+"/":""},URI.prototype.file=function(){var splitPath;return splitPath=this.path.split("/"),splitPath[splitPath.length-1]},URI.paramsFromQuery=function(query){var matches,params,segment,_i,_len,_ref;for(params={},_ref=query.split("&"),_i=0,_len=_ref.length;_len>_i;_i++)segment=_ref[_i],(matches=segment.match(keyVal))?normalizeParams(params,decodeQueryComponent(matches[1]),decodeQueryComponent(matches[2])):normalizeParams(params,decodeQueryComponent(segment),null);return params},URI.decodeQueryComponent=decodeQueryComponent=function(str){return decodeURIComponent(str.replace(plus,"%20"))},nameParser=/^[\[\]]*([^\[\]]+)\]*(.*)/,childKeyMatchers=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/],plus=/\+/g,r20=/%20/g,keyVal=/^([^=]*)=(.*)/,normalizeParams=function(params,name,v){var after,childKey,k,last,matches;if(matches=name.match(nameParser)){if(k=matches[1],after=matches[2],""===after)params[k]=v;else if("[]"===after){if(null==params[k]&&(params[k]=[]),"Array"!==Batman.typeOf(params[k]))throw new Error("expected Array (got "+Batman.typeOf(params[k])+') for param "'+k+'"');params[k].push(v)}else if(matches=after.match(childKeyMatchers[0])||after.match(childKeyMatchers[1])){if(childKey=matches[1],null==params[k]&&(params[k]=[]),"Array"!==Batman.typeOf(params[k]))throw new Error("expected Array (got "+Batman.typeOf(params[k])+') for param "'+k+'"');last=params[k][params[k].length-1],"Object"!==Batman.typeOf(last)||childKey in last?params[k].push(normalizeParams({},childKey,v)):normalizeParams(last,childKey,v)}else{if(null==params[k]&&(params[k]={}),"Object"!==Batman.typeOf(params[k]))throw new Error("expected Object (got "+Batman.typeOf(params[k])+') for param "'+k+'"');params[k]=normalizeParams(params[k],after,v)}return params}},URI.queryFromParams=queryFromParams=function(value,prefix){var arrayResults,k,v,valueType;if(null==value)return prefix;if(valueType=Batman.typeOf(value),null==prefix&&"Object"!==valueType)throw new Error("value must be an Object");switch(valueType){case"Array":return function(){var _i,_len;if(arrayResults=[],0===value.length)arrayResults.push(queryFromParams(null,""+prefix+"[]"));else for(_i=0,_len=value.length;_len>_i;_i++)v=value[_i],arrayResults.push(queryFromParams(v,""+prefix+"[]"));return arrayResults}().join("&");case"Object":return function(){var _results;_results=[];for(k in value)v=value[k],_results.push(queryFromParams(v,prefix?""+prefix+"["+encodeQueryComponent(k)+"]":encodeQueryComponent(k)));return _results}().join("&");default:return null!=prefix?""+prefix+"="+encodeQueryComponent(value):encodeQueryComponent(value)}},URI.encodeComponent=encodeComponent=function(str){return null!=str?encodeURIComponent(str):""},URI.encodeQueryComponent=encodeQueryComponent=function(str){return encodeComponent(str).replace(r20,"+")},URI}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Request=function(_super){function Request(options){var handler,handlers,k,_ref;handlers={};for(k in options)handler=options[k],("success"===k||"error"===k||"loading"===k||"loaded"===k)&&(handlers[k]=handler,delete options[k]);Request.__super__.constructor.call(this,options);for(k in handlers)handler=handlers[k],this.on(k,handler);(null!=(_ref=this.get("url"))?_ref.length:void 0)>0?this.autosend&&this.send():this.observe("url",function(url){return null!=url?this.send():void 0})}var dataHasFileUploads;return __extends(Request,_super),Request.objectToFormData=function(data){var formData,key,pairForList,val,_i,_len,_ref,_ref1;for(pairForList=function(key,object,first){var k,list,v;return null==first&&(first=!1),object instanceof Batman.container.File?[[key,object]]:list=function(){switch(Batman.typeOf(object)){case"Object":return list=function(){var _results;_results=[];for(k in object)v=object[k],_results.push(pairForList(first?k:""+key+"["+k+"]",v));return _results}(),list.reduce(function(acc,list){return acc.concat(list)},[]);case"Array":return object.reduce(function(acc,element){return acc.concat(pairForList(""+key+"[]",element))},[]);default:return[[key,null!=object?object:""]]}}()},formData=new Batman.container.FormData,_ref=pairForList("",data,!0),_i=0,_len=_ref.length;_len>_i;_i++)_ref1=_ref[_i],key=_ref1[0],val=_ref1[1],formData.append(key,val);return formData},Request.dataHasFileUploads=dataHasFileUploads=function(data){var k,type,v,_i,_len;if("undefined"!=typeof File&&null!==File&&data instanceof File)return!0;switch(type=Batman.typeOf(data)){case"Object":for(k in data)if(v=data[k],dataHasFileUploads(v))return!0;break;case"Array":for(_i=0,_len=data.length;_len>_i;_i++)if(v=data[_i],dataHasFileUploads(v))return!0}return!1},Request.wrapAccessor("method",function(core){return{set:function(k,val){return core.set.call(this,k,null!=val&&"function"==typeof val.toUpperCase?val.toUpperCase():void 0)}}}),Request.prototype.method="GET",Request.prototype.hasFileUploads=function(){return dataHasFileUploads(this.data)},Request.prototype.contentType="application/x-www-form-urlencoded",Request.prototype.autosend=!0,Request.prototype.send=function(){return Batman.developer.error("You must add a platform library to implement Batman.Request (for example, batman.jquery)")},Request.set("pendingRequestCount",0),Request.classAccessor("requestIsPending",function(){return this.get("pendingRequestCount")>0}),Request.prototype.on("loading",function(){return Batman.Request.set("pendingRequestCount",Batman.Request.get("pendingRequestCount")+1)}),Request.prototype.on("loaded",function(){return Batman.Request.set("pendingRequestCount",Batman.Request.get("pendingRequestCount")-1)}),Request}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.SetObserver=function(_super){function SetObserver(base){var _this=this;this.base=base,this._itemObservers=new Batman.SimpleHash,this._setObservers=new Batman.SimpleHash,this._setObservers.set("itemsWereAdded",function(){return _this.fire.apply(_this,["itemsWereAdded"].concat(__slice.call(arguments)))}),this._setObservers.set("itemsWereRemoved",function(){return _this.fire.apply(_this,["itemsWereRemoved"].concat(__slice.call(arguments)))}),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return __extends(SetObserver,_super),SetObserver.prototype.observedItemKeys=[],SetObserver.prototype.observerForItemAndKey=function(){},SetObserver.prototype._getOrSetObserverForItemAndKey=function(item,key){var _this=this;return this._itemObservers.getOrSet(item,function(){var observersByKey;return observersByKey=new Batman.SimpleHash,observersByKey.getOrSet(key,function(){return _this.observerForItemAndKey(item,key)})})},SetObserver.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},SetObserver.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},SetObserver.prototype.startObservingItems=function(items){var item,_i,_len;for(_i=0,_len=items.length;_len>_i;_i++)item=items[_i],this._manageObserversForItem(item,"observe")},SetObserver.prototype.stopObservingItems=function(items){var item,_i,_len;for(_i=0,_len=items.length;_len>_i;_i++)item=items[_i],this._manageObserversForItem(item,"forget")},SetObserver.prototype._manageObserversForItem=function(item,method){var key,_i,_len,_ref;if(null!=item?item.isObservable:void 0){for(_ref=this.observedItemKeys,_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],item[method](key,this._getOrSetObserverForItemAndKey(item,key));if("forget"===method)return this._itemObservers.unset(item)}},SetObserver.prototype._manageItemObservers=function(method){var _this=this;return this.base.forEach(function(item){return _this._manageObserversForItem(item,method)})},SetObserver.prototype._manageSetObservers=function(method){var _this=this;return this.base.isObservable?this._setObservers.forEach(function(key,observer){return _this.base.event(key)[method](observer)}):void 0},SetObserver}(Batman.Object)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.SetSort=function(_super){function SetSort(base,key,order){var _this=this;this.key=key,null==order&&(order="asc"),this.compareElements=__bind(this.compareElements,this),SetSort.__super__.constructor.call(this,base),this.descending="desc"===order.toLowerCase(),this.isSorted=!0,this.isCollectionEventEmitter&&(this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=function(item){return function(newValue,oldValue){return _this._handleItemsModified(item,newValue,oldValue)}}),this._reIndex()}return __extends(SetSort,_super),SetSort.prototype._handleItemsModified=function(item,newValue,oldValue){var match,newIndex,newStorage,oldIndex,proxyItem,wrappedCompare,_ref,_ref1,_this=this;
return proxyItem={},proxyItem[this.key]=oldValue,wrappedCompare=function(a,b){return a===item&&(a=proxyItem),b===item&&(b=proxyItem),_this.compareElements(a,b)},newStorage=this._storage.slice(),_ref=this.constructor._binarySearch(newStorage,item,wrappedCompare),match=_ref.match,oldIndex=_ref.index,match&&(newStorage.splice(oldIndex,1),_ref1=this.constructor._binarySearch(newStorage,item,this.compareElements),match=_ref1.match,newIndex=_ref1.index,oldIndex!==newIndex)?(newStorage.splice(newIndex,0,item),this.set("_storage",newStorage),this.fire("itemWasMoved",item,newIndex,oldIndex)):void 0},SetSort.prototype._handleItemsAdded=function(items){var addedIndexes,addedItems,index,item,match,newStorage,_i,_len,_ref;for(newStorage=this._storage.slice(),addedItems=[],addedIndexes=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],_ref=this.constructor._binarySearch(newStorage,item,this.compareElements),match=_ref.match,index=_ref.index,match||(newStorage.splice(index,0,item),addedItems.push(item),addedIndexes.push(index));return this.set("_storage",newStorage),this.set("length",this._storage.length),this.fire("itemsWereAdded",addedItems,addedIndexes)},SetSort.prototype._handleItemsRemoved=function(items){var index,item,match,newStorage,removedIndexes,removedItems,_i,_len,_ref;for(newStorage=this._storage.slice(),removedItems=[],removedIndexes=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],_ref=this.constructor._binarySearch(newStorage,item,this.compareElements),match=_ref.match,index=_ref.index,match&&(newStorage.splice(index,1),removedItems.push(item),removedIndexes.push(index));return this.set("_storage",newStorage),this.set("length",this._storage.length),this.fire("itemsWereRemoved",removedItems,removedIndexes)},SetSort.prototype.toArray=function(){var _base;return"function"==typeof(_base=this.base).registerAsMutableSource&&_base.registerAsMutableSource(),this._storage.slice()},SetSort.prototype.forEach=function(iterator,ctx){var e,i,_base,_i,_len,_ref;for("function"==typeof(_base=this.base).registerAsMutableSource&&_base.registerAsMutableSource(),_ref=this._storage,i=_i=0,_len=_ref.length;_len>_i;i=++_i)e=_ref[i],iterator.call(ctx,e,i,this)},SetSort.prototype.find=function(block){var item,_i,_len,_ref;for(this.base.registerAsMutableSource(),_ref=this._storage,_i=0,_len=_ref.length;_len>_i;_i++)if(item=_ref[_i],block(item))return item},SetSort.prototype.merge=function(other){return this.base.registerAsMutableSource(),function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Batman.Set,this._storage,function(){}).merge(other).sortedBy(this.key,this.order)},SetSort.prototype.compare=function(a,b){return a===b?0:void 0===a?1:void 0===b?-1:null===a?1:null===b?-1:a===!1?1:b===!1?-1:a===!0?1:b===!0?-1:a!==a?b!==b?0:1:b!==b?-1:a>b?1:b>a?-1:0},SetSort.prototype.compareElements=function(a,b){var multiple,valueA,valueB;return valueA=this.key&&null!=a?Batman.get(a,this.key):a,"function"==typeof valueA&&(valueA=valueA.call(a)),null!=valueA&&(valueA=valueA.valueOf()),valueB=this.key&&null!=b?Batman.get(b,this.key):b,"function"==typeof valueB&&(valueB=valueB.call(b)),null!=valueB&&(valueB=valueB.valueOf()),multiple=this.descending?-1:1,this.compare(valueA,valueB)*multiple},SetSort.prototype._reIndex=function(){var newOrder,_ref;return newOrder=this.base.toArray().sort(this.compareElements),null!=(_ref=this._setObserver)&&_ref.startObservingItems(newOrder),this.set("_storage",newOrder)},SetSort.prototype._indexOfItem=function(target){var index,match,_ref;return _ref=this.constructor._binarySearch(this._storage,target,this.compareElements),match=_ref.match,index=_ref.index,match?index:-1},SetSort._binarySearch=function(arr,target,compare){var direction,end,i,index,matched,result,start;for(start=0,end=arr.length-1,result={};end>=start;)if(index=(end-start>>1)+start,direction=compare(target,arr[index]),direction>0)start=index+1;else{if(!(0>direction)){for(matched=!1,i=index;i>=0&&0===compare(target,arr[i]);){if(target===arr[i]){index=i,matched=!0;break}i--}if(!matched)for(i=index+1;i<arr.length&&0===compare(target,arr[i]);){if(target===arr[i]){index=i,matched=!0;break}i++}return{match:matched,index:index}}end=index-1}return{match:!1,index:start}},SetSort}(Batman.SetProxy)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.AssociationSet=function(_super){function AssociationSet(foreignKeyValue,association){var base;this.foreignKeyValue=foreignKeyValue,this.association=association,base=new Batman.Set,AssociationSet.__super__.constructor.call(this,base,"_batmanID")}return __extends(AssociationSet,_super),AssociationSet.prototype.loaded=!1,AssociationSet.accessor("loaded",Batman.Property.defaultAccessor),AssociationSet.prototype.load=function(options,callback){var loadOptions,_this=this;return loadOptions=this._getLoadOptions(),callback?loadOptions.data=Batman.extend(loadOptions.data,options):callback=options,null==this.foreignKeyValue?callback(void 0,this):this.association.getRelatedModel().loadWithOptions(loadOptions,function(err,records,env){return err||_this.markAsLoaded(),callback(err,_this,env)})},AssociationSet.prototype._getLoadOptions=function(){var loadOptions;return loadOptions={data:{}},loadOptions.data[this.association.foreignKey]=this.foreignKeyValue,this.association.options.url&&(loadOptions.collectionUrl=this.association.options.url,loadOptions.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),loadOptions},AssociationSet.prototype.markAsLoaded=function(){return this.set("loaded",!0),this.fire("loaded")},AssociationSet.accessor("parentRecord",function(){var parentClass,parentPrimaryKey,parentPrimaryKeyValue,query;return parentClass=this.get("association.model"),parentPrimaryKey=parentClass.get("primaryKey"),parentPrimaryKeyValue=this.get("foreignKeyValue"),query={},query[parentPrimaryKey]=parentPrimaryKeyValue,parentClass.createFromJSON(query)}),AssociationSet.prototype.build=function(attrs){var associatedClass,initParams,mixedAttrs,newObj,options,scope;return null==attrs&&(attrs={}),initParams={},initParams[this.get("association.foreignKey")]=this.get("foreignKeyValue"),options=this.get("association.options"),null!=options.inverseOf&&(initParams[options.inverseOf]=this.get("parentRecord")),scope=options.namespace||Batman.currentApp,associatedClass=scope[options.name],mixedAttrs=Batman.extend(attrs,initParams),newObj=new associatedClass(mixedAttrs),this.add(newObj),newObj},AssociationSet}(Batman.SetSort)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PolymorphicAssociationSet=function(_super){function PolymorphicAssociationSet(foreignKeyValue,foreignTypeKeyValue,association){this.foreignKeyValue=foreignKeyValue,this.foreignTypeKeyValue=foreignTypeKeyValue,this.association=association,PolymorphicAssociationSet.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return __extends(PolymorphicAssociationSet,_super),PolymorphicAssociationSet.prototype._getLoadOptions=function(){var loadOptions;return loadOptions={data:{}},loadOptions.data[this.association.foreignKey]=this.foreignKeyValue,loadOptions.data[this.association.foreignTypeKey]=this.foreignTypeKeyValue,this.association.options.url&&(loadOptions.collectionUrl=this.association.options.url,loadOptions.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),loadOptions},PolymorphicAssociationSet}(Batman.AssociationSet)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.SetMapping=function(_super){function SetMapping(base,key){var initialValues,_this=this;this.base=base,this.key=key,initialValues=this.base.mapToProperty(this.key),this._counter=new this.constructor.PresenceCounter(initialValues),SetMapping.__super__.constructor.apply(this,initialValues),this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=function(item){return function(newValue,oldValue){return _this._handleItemModified(item,newValue,oldValue)}},this._setObserver.on("itemsWereAdded",this._handleItemsAdded.bind(this)),this._setObserver.on("itemsWereRemoved",this._handleItemsRemoved.bind(this)),this._setObserver.startObserving()}return __extends(SetMapping,_super),SetMapping.prototype._handleItemsAdded=function(items){var item,_i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],_results.push(this._addValueInstance(item.get(this.key)));return _results},SetMapping.prototype._handleItemsRemoved=function(items){var item,_i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],_results.push(this._removeValueInstance(item.get(this.key)));return _results},SetMapping.prototype._handleItemModified=function(item,newValue,oldValue){return this._removeValueInstance(oldValue),this._addValueInstance(newValue)},SetMapping.prototype._addValueInstance=function(mappedValue){return this._counter.increment(mappedValue),this.add(mappedValue)},SetMapping.prototype._removeValueInstance=function(mappedValue){var remaining;return remaining=this._counter.decrement(mappedValue),0===remaining?this.remove(mappedValue):void 0},SetMapping}(Batman.Set),Batman.SetMapping.PresenceCounter=function(){function PresenceCounter(initialValues){var value,_i,_len;for(this._storage=new Batman.SimpleHash,_i=0,_len=initialValues.length;_len>_i;_i++)value=initialValues[_i],this.increment(value)}return PresenceCounter.prototype.increment=function(value){var count;return count=this._storage.get(value),count?this._storage.set(value,count+1):this._storage.set(value,1)},PresenceCounter.prototype.decrement=function(value){var count;return count=this._storage.get(value),this._storage.set(value,count-1)},PresenceCounter}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.SetIndex=function(_super){function SetIndex(base,key){var _this=this;this.base=base,this.key=key,SetIndex.__super__.constructor.call(this),this._storage=new Batman.Hash,this.base.isEventEmitter&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",function(items){return _this._addItems(items)}),this._setObserver.on("itemsWereRemoved",function(items){return _this._removeItems(items)})),this._addItems(this.base._storage),this.startObserving()}return __extends(SetIndex,_super),SetIndex.accessor("toArray",function(){return this.toArray()}),Batman.extend(SetIndex.prototype,Batman.Enumerable),SetIndex.prototype.propertyClass=Batman.Property,SetIndex.accessor(function(key){return this._resultSetForKey(key)}),SetIndex.prototype.startObserving=function(){var _ref;return null!=(_ref=this._setObserver)?_ref.startObserving():void 0},SetIndex.prototype.stopObserving=function(){var _ref;return null!=(_ref=this._setObserver)?_ref.stopObserving():void 0},SetIndex.prototype.observerForItemAndKey=function(item){var _this=this;return function(newKey,oldKey){return _this._removeItemsFromKey(oldKey,[item]),_this._addItemsToKey(newKey,[item])}},SetIndex.prototype.forEach=function(iterator,ctx){var _this=this;return this._storage.forEach(function(key,set){return set.get("length")>0?iterator.call(ctx,key,set,_this):void 0})},SetIndex.prototype.toArray=function(){var results;return results=[],this._storage.forEach(function(key,set){return set.get("length")>0?results.push(key):void 0}),results},SetIndex.prototype._addItems=function(items){var index,item,itemsForKey,key,lastKey,_i,_len;if(null!=items?items.length:void 0){for(lastKey=this._keyForItem(items[0]),itemsForKey=[],index=_i=0,_len=items.length;_len>_i;index=++_i)item=items[index],Batman.SimpleHash.prototype.equality(lastKey,key=this._keyForItem(item))?itemsForKey.push(item):(this._addItemsToKey(lastKey,itemsForKey),itemsForKey=[item],lastKey=key);return itemsForKey.length?this._addItemsToKey(lastKey,itemsForKey):void 0}},SetIndex.prototype._removeItems=function(items){var index,item,itemsForKey,key,lastKey,_i,_len;if(null!=items?items.length:void 0){for(lastKey=this._keyForItem(items[0]),itemsForKey=[],index=_i=0,_len=items.length;_len>_i;index=++_i)item=items[index],Batman.SimpleHash.prototype.equality(lastKey,key=this._keyForItem(item))?itemsForKey.push(item):(this._removeItemsFromKey(lastKey,itemsForKey),itemsForKey=[item],lastKey=key);return itemsForKey.length?this._removeItemsFromKey(lastKey,itemsForKey):void 0}},SetIndex.prototype._addItemsToKey=function(key,items){var resultSet;return resultSet=this._resultSetForKey(key),resultSet.add.apply(resultSet,items),resultSet},SetIndex.prototype._removeItemsFromKey=function(key,items){var resultSet;return resultSet=this._resultSetForKey(key),resultSet.remove.apply(resultSet,items),resultSet},SetIndex.prototype._resultSetForKey=function(key){return this._storage.getOrSet(key,function(){return new Batman.Set})},SetIndex.prototype._keyForItem=function(item){return Batman.Keypath.forBaseAndKey(item,this.key).getValue()},SetIndex}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PolymorphicAssociationSetIndex=function(_super){function PolymorphicAssociationSetIndex(association,type,key){this.association=association,this.type=type,PolymorphicAssociationSetIndex.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),key)}return __extends(PolymorphicAssociationSetIndex,_super),PolymorphicAssociationSetIndex.prototype._resultSetForKey=function(key){return this.association.setForKey(key)},PolymorphicAssociationSetIndex.prototype._addItemsToKey=function(key,items){var filteredItems,item;return filteredItems=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],this.association.modelType()===item.get(this.association.foreignTypeKey)&&_results.push(item);return _results}.call(this),PolymorphicAssociationSetIndex.__super__._addItemsToKey.call(this,key,filteredItems)},PolymorphicAssociationSetIndex.prototype._removeItemsFromKey=function(key,items){var filteredItems,item;return filteredItems=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],this.association.modelType()===item.get(this.association.foreignTypeKey)&&_results.push(item);return _results}.call(this),PolymorphicAssociationSetIndex.__super__._removeItemsFromKey.call(this,key,filteredItems)},PolymorphicAssociationSetIndex}(Batman.SetIndex)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.AssociationSetIndex=function(_super){function AssociationSetIndex(association,key){this.association=association,AssociationSetIndex.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),key)}return __extends(AssociationSetIndex,_super),AssociationSetIndex.prototype._resultSetForKey=function(key){return this.association.setForKey(key)},AssociationSetIndex.prototype.forEach=function(iterator,ctx){var _this=this;return this.association.proxies.forEach(function(record,set){var key;return key=_this.association.indexValueForRecord(record),set.get("length")>0?iterator.call(ctx,key,set,_this):void 0})},AssociationSetIndex.prototype.toArray=function(){var results;return results=[],this.forEach(function(key){return results.push(key)}),results},AssociationSetIndex}(Batman.SetIndex)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.UniqueSetIndex=function(_super){function UniqueSetIndex(){this._uniqueIndex=new Batman.Hash,UniqueSetIndex.__super__.constructor.apply(this,arguments)}return __extends(UniqueSetIndex,_super),UniqueSetIndex.accessor(function(key){return this._uniqueIndex.get(key)}),UniqueSetIndex.prototype._addItemsToKey=function(key,items){return UniqueSetIndex.__super__._addItemsToKey.apply(this,arguments),this._uniqueIndex.hasKey(key)?void 0:this._uniqueIndex.set(key,items[0])},UniqueSetIndex.prototype._removeItemsFromKey=function(key){var resultSet;return resultSet=UniqueSetIndex.__super__._removeItemsFromKey.apply(this,arguments),resultSet.isEmpty()?this._uniqueIndex.unset(key):this._uniqueIndex.set(key,resultSet._storage[0])},UniqueSetIndex}(Batman.SetIndex)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.UniqueAssociationSetIndex=function(_super){function UniqueAssociationSetIndex(association,key){this.association=association,UniqueAssociationSetIndex.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),key)}return __extends(UniqueAssociationSetIndex,_super),UniqueAssociationSetIndex}(Batman.UniqueSetIndex)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PolymorphicUniqueAssociationSetIndex=function(_super){function PolymorphicUniqueAssociationSetIndex(association,type,key){this.association=association,this.type=type,PolymorphicUniqueAssociationSetIndex.__super__.constructor.call(this,this.association.getRelatedModelForType(type).get("loaded"),key)}return __extends(PolymorphicUniqueAssociationSetIndex,_super),PolymorphicUniqueAssociationSetIndex}(Batman.UniqueSetIndex)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice;Batman.Navigator=function(){function Navigator(app){this.app=app,this.handleCurrentLocation=__bind(this.handleCurrentLocation,this)}return Navigator.forApp=function(app){return new(this.defaultClass())(app)},Navigator.defaultClass=function(){return Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()?Batman.PushStateNavigator:Batman.HashbangNavigator},Navigator.prototype.start=function(){var _this=this;if("undefined"!=typeof window&&!this.started)return this.started=!0,this.startWatching(),Batman.currentApp.prevent("ready"),Batman.setImmediate(function(){return _this.started&&Batman.currentApp?(_this.checkInitialHash(),_this.handleCurrentLocation(),Batman.currentApp.allowAndFire("ready")):void 0})},Navigator.prototype.stop=function(){return this.stopWatching(),this.started=!1},Navigator.prototype.checkInitialHash=function(location){var hash,index,prefix;return null==location&&(location=window.location),prefix=Batman.HashbangNavigator.prototype.hashPrefix,hash=location.hash,hash.length>prefix.length&&hash.substr(0,prefix.length)!==prefix?this.initialHash=hash.substr(prefix.length-1):-1!==(index=hash.indexOf("##BATMAN##"))?(this.initialHash=hash.substr(index+10),this.replaceState(null,"",hash.substr(prefix.length,index-prefix.length),location)):void 0},Navigator.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},Navigator.prototype.handleLocation=function(location){var path;return path=this.pathFromLocation(location),path!==this.cachedPath?this.dispatch(path):void 0},Navigator.prototype.dispatch=function(params){var dispatcher,paramsMixin;return dispatcher=this.app.get("dispatcher"),this.cachedPath=this.initialHash?(paramsMixin={initialHash:this.initialHash},delete this.initialHash,dispatcher.dispatch(params,paramsMixin)):dispatcher.dispatch(params),this.cachedPath},Navigator.prototype.redirect=function(params,replaceState){var path,pathFromParams,_base;return null==replaceState&&(replaceState=!1),pathFromParams="function"==typeof(_base=this.app.get("dispatcher")).pathFromParams?_base.pathFromParams(params):void 0,pathFromParams&&(this._lastRedirect=pathFromParams),path=this.dispatch(params),this._lastRedirect&&(this.cachedPath=this._lastRedirect),this._lastRedirect&&this._lastRedirect!==path||this[replaceState?"replaceState":"pushState"](null,"",path),path},Navigator.prototype.push=function(params){return Batman.developer.deprecated("Navigator::push","Please use Batman.redirect({}) instead."),this.redirect(params)},Navigator.prototype.replace=function(params){return Batman.developer.deprecated("Navigator::replace","Please use Batman.redirect({}, true) instead."),this.redirect(params,!0)},Navigator.prototype.normalizePath=function(){var i,seg,segments;return segments=1<=arguments.length?__slice.call(arguments,0):[],segments=function(){var _i,_len,_results;for(_results=[],i=_i=0,_len=segments.length;_len>_i;i=++_i)seg=segments[i],_results.push((""+seg).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return _results}(),segments.join("")||"/"},Navigator.normalizePath=Navigator.prototype.normalizePath,Navigator}()}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PushStateNavigator=function(_super){function PushStateNavigator(){return _ref=PushStateNavigator.__super__.constructor.apply(this,arguments)}return __extends(PushStateNavigator,_super),PushStateNavigator.isSupported=function(){var _ref1;return null!=("undefined"!=typeof window&&null!==window&&null!=(_ref1=window.history)?_ref1.pushState:void 0)},PushStateNavigator.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"popstate",this.handleCurrentLocation)},PushStateNavigator.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"popstate",this.handleCurrentLocation)},PushStateNavigator.prototype.pushState=function(stateObject,title,path){return path!==this.pathFromLocation(window.location)?window.history.pushState(stateObject,title,this.linkTo(path)):void 0},PushStateNavigator.prototype.replaceState=function(stateObject,title,path){return path!==this.pathFromLocation(window.location)?window.history.replaceState(stateObject,title,this.linkTo(path)):void 0},PushStateNavigator.prototype.linkTo=function(url){return this.normalizePath(Batman.config.pathToApp,url)},PushStateNavigator.prototype.pathFromLocation=function(location){var fullPath,prefixPattern;return fullPath=""+(location.pathname||"")+(location.search||""),prefixPattern=new RegExp("^"+this.normalizePath(Batman.config.pathToApp)),this.normalizePath(fullPath.replace(prefixPattern,""))},PushStateNavigator.prototype.handleLocation=function(location){var hashbangPath,pushStatePath;return pushStatePath=this.pathFromLocation(location),hashbangPath=Batman.HashbangNavigator.prototype.pathFromLocation(location),"/"===pushStatePath&&"/"!==hashbangPath?this.redirect(hashbangPath,!0):PushStateNavigator.__super__.handleLocation.apply(this,arguments)},PushStateNavigator}(Batman.Navigator)}.call(this),function(){var _ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.HashbangNavigator=function(_super){function HashbangNavigator(){return this.detectHashChange=__bind(this.detectHashChange,this),this.handleHashChange=__bind(this.handleHashChange,this),_ref=HashbangNavigator.__super__.constructor.apply(this,arguments)}return __extends(HashbangNavigator,_super),HashbangNavigator.prototype.hashPrefix="#!","undefined"!=typeof window&&null!==window&&"onhashchange"in window?(HashbangNavigator.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"hashchange",this.handleHashChange)},HashbangNavigator.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"hashchange",this.handleHashChange)}):(HashbangNavigator.prototype.startWatching=function(){return this.interval=setInterval(this.detectHashChange,100)},HashbangNavigator.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),HashbangNavigator.prototype.handleHashChange=function(){return this.ignoreHashChange?this.ignoreHashChange=!1:this.handleCurrentLocation()},HashbangNavigator.prototype.detectHashChange=function(){return this.previousHash!==window.location.hash?(this.previousHash=window.location.hash,this.handleHashChange()):void 0},HashbangNavigator.prototype.pushState=function(stateObject,title,path){var link;return link=this.linkTo(path),link!==window.location.hash?(this.ignoreHashChange=!0,window.location.hash=link):void 0},HashbangNavigator.prototype.replaceState=function(stateObject,title,path,loc){var link;return null==loc&&(loc=window.location),link=this.linkTo(path),link!==loc.hash?(this.ignoreHashChange=!0,loc.replace(""+(loc.pathname||"")+(loc.search||"")+(link||""))):void 0},HashbangNavigator.prototype.linkTo=function(url){return this.hashPrefix+url},HashbangNavigator.prototype.pathFromLocation=function(location){var hash,length;return hash=location.hash,length=this.hashPrefix.length,(null!=hash?hash.substr(0,length):void 0)===this.hashPrefix?this.normalizePath(hash.substr(length)):"/"},HashbangNavigator.prototype.handleLocation=function(location){var pushStatePath;return Batman.config.usePushState?(pushStatePath=Batman.PushStateNavigator.prototype.pathFromLocation(location),"/"!==pushStatePath?location.replace(this.normalizePath(""+Batman.config.pathToApp+this.linkTo(pushStatePath)+(this.initialHash?"##BATMAN##"+this.initialHash:""))):HashbangNavigator.__super__.handleLocation.apply(this,arguments)):HashbangNavigator.__super__.handleLocation.apply(this,arguments)},HashbangNavigator}(Batman.Navigator)}.call(this),function(){Batman.RouteMap=function(){function RouteMap(){this.childrenByOrder=[],this.childrenByName={}}return RouteMap.prototype.memberRoute=null,RouteMap.prototype.collectionRoute=null,RouteMap.prototype.routeForParams=function(params){var key,route,_i,_len,_ref;if(this._cachedRoutes||(this._cachedRoutes={}),key=this.cacheKey(params),this._cachedRoutes[key])return this._cachedRoutes[key];for(_ref=this.childrenByOrder,_i=0,_len=_ref.length;_len>_i;_i++)if(route=_ref[_i],route.test(params))return this._cachedRoutes[key]=route},RouteMap.prototype.addRoute=function(name,route){var base,names,_this=this;return this.childrenByOrder.push(route),name.length>0&&(names=name.split(".")).length>0?(base=names.shift(),this.childrenByName[base]||(this.childrenByName[base]=new Batman.RouteMap),this.childrenByName[base].addRoute(names.join("."),route)):route.get("member")?(Batman.developer["do"](function(){return _this.memberRoute?Batman.developer.error("Member route with name "+name+" already exists!"):void 0}),this.memberRoute=route):(Batman.developer["do"](function(){return _this.collectionRoute?Batman.developer.error("Collection route with name "+name+" already exists!"):void 0}),this.collectionRoute=route),!0},RouteMap.prototype.cacheKey=function(params){return"string"==typeof params?params:null!=params.path?params.path:""+params.controller+"#"+params.action},RouteMap}()}.call(this),function(){var __slice=[].slice;Batman.RouteMapBuilder=function(){function RouteMapBuilder(app,routeMap,parent,baseOptions){this.app=app,this.routeMap=routeMap,this.parent=parent,this.baseOptions=null!=baseOptions?baseOptions:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return RouteMapBuilder.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],RouteMapBuilder.ROUTES={index:{cardinality:"collection",path:function(resource){return resource},name:function(resource){return resource}},"new":{cardinality:"collection",path:function(resource){return""+resource+"/new"},name:function(resource){return""+resource+".new"}},show:{cardinality:"member",path:function(resource){return""+resource+"/:id"},name:function(resource){return resource}},edit:{cardinality:"member",path:function(resource){return""+resource+"/:id/edit"},name:function(resource){return""+resource+".edit"}},collection:{cardinality:"collection",path:function(resource,name){return""+resource+"/"+name},name:function(resource,name){return""+resource+"."+name}},member:{cardinality:"member",path:function(resource,name){return""+resource+"/:id/"+name},name:function(resource,name){return""+resource+"."+name}}},RouteMapBuilder.prototype.resources=function(){var action,actions,arg,args,as,callback,childBuilder,controller,included,k,options,path,resourceName,resourceNames,resourceRoot,routeOptions,routeTemplate,v,_i,_j,_k,_len,_len1,_len2,_ref,_ref1;if(args=1<=arguments.length?__slice.call(arguments,0):[],resourceNames=function(){var _i,_len,_results;for(_results=[],_i=0,_len=args.length;_len>_i;_i++)arg=args[_i],"string"==typeof arg&&_results.push(arg);return _results}(),"function"==typeof args[args.length-1]&&(callback=args.pop()),options="object"==typeof args[args.length-1]?args.pop():{},actions={index:!0,"new":!0,show:!0,edit:!0},options.except){for(_ref=options.except,_i=0,_len=_ref.length;_len>_i;_i++)k=_ref[_i],actions[k]=!1;delete options.except}else if(options.only){for(k in actions)v=actions[k],actions[k]=!1;for(_ref1=options.only,_j=0,_len1=_ref1.length;_len1>_j;_j++)k=_ref1[_j],actions[k]=!0;delete options.only}for(_k=0,_len2=resourceNames.length;_len2>_k;_k++){resourceName=resourceNames[_k],resourceRoot=Batman.helpers.pluralize(resourceName),controller=Batman.helpers.camelize(resourceRoot,!0),childBuilder=this._childBuilder({controller:controller}),null!=callback&&callback.call(childBuilder);for(action in actions)included=actions[action],included&&(routeTemplate=this.constructor.ROUTES[action],as=routeTemplate.name(resourceRoot),path=routeTemplate.path(resourceRoot),routeOptions=Batman.extend({controller:controller,action:action,path:path,as:as},options),childBuilder[routeTemplate.cardinality](action,routeOptions))}return!0},RouteMapBuilder.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(__slice.call(arguments)))},RouteMapBuilder.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(__slice.call(arguments)))},RouteMapBuilder.prototype.root=function(signature,options){return null==options&&(options={}),this.route("/",signature,options)},RouteMapBuilder.prototype.route=function(path,signature,options,callback){return callback||("function"==typeof options?(callback=options,options=void 0):"function"==typeof signature&&(callback=signature,signature=void 0)),options?signature&&(options.signature=signature):(options="string"==typeof signature?{signature:signature}:signature,options||(options={})),callback&&(options.callback=callback),options.as||(options.as=this._nameFromPath(path)),options.path=path,this._addRoute(options)},RouteMapBuilder.prototype._addRoutesWithCardinality=function(){var cardinality,name,names,options,resourceRoot,routeOptions,routeTemplate,_i,_j,_len;
for(cardinality=arguments[0],names=3<=arguments.length?__slice.call(arguments,1,_i=arguments.length-1):(_i=1,[]),options=arguments[_i++],"string"==typeof options&&(names.push(options),options={}),options=Batman.extend({},this.baseOptions,options),options[cardinality]=!0,routeTemplate=this.constructor.ROUTES[cardinality],resourceRoot=Batman.helpers.underscore(options.controller),_j=0,_len=names.length;_len>_j;_j++)name=names[_j],routeOptions=Batman.extend({action:name},options),null==routeOptions.path&&(routeOptions.path=routeTemplate.path(resourceRoot,name)),null==routeOptions.as&&(routeOptions.as=routeTemplate.name(resourceRoot,name)),this._addRoute(routeOptions);return!0},RouteMapBuilder.prototype._addRoute=function(options){var klass,name,path,route;return null==options&&(options={}),path=this.rootPath+options.path,name=this.rootName+Batman.helpers.camelize(options.as,!0),delete options.as,delete options.path,klass=options.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute,options.app=this.app,route=new klass(path,options),this.routeMap.addRoute(name,route),""===name?this.routeMap.addRoute("root",route):void 0},RouteMapBuilder.prototype._nameFromPath=function(path){return path=path.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,"")},RouteMapBuilder.prototype._nestingPath=function(){var nestingParam,nestingSegment;return this.parent?(nestingParam=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id",nestingSegment=Batman.helpers.underscore(this.baseOptions.controller),""+this.parent._nestingPath()+nestingSegment+"/"+nestingParam+"/"):""},RouteMapBuilder.prototype._nestingName=function(){return this.parent?this.parent._nestingName()+this.baseOptions.controller+".":""},RouteMapBuilder.prototype._childBuilder=function(baseOptions){return null==baseOptions&&(baseOptions={}),new Batman.RouteMapBuilder(this.app,this.routeMap,this,baseOptions)},RouteMapBuilder}()}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.App=function(_super){function App(){return _ref=App.__super__.constructor.apply(this,arguments)}var name,_fn,_i,_len,_ref1;for(__extends(App,_super),App.classAccessor("currentParams",{get:function(){return new Batman.Hash},"final":!0}),App.classAccessor("paramsManager",{get:function(){var nav,params;if(nav=this.get("navigator"))return params=this.get("currentParams"),params.replacer=new Batman.ParamsReplacer(nav,params)},"final":!0}),App.classAccessor("paramsPusher",{get:function(){var nav,params;if(nav=this.get("navigator"))return params=this.get("currentParams"),params.pusher=new Batman.ParamsPusher(nav,params)},"final":!0}),App.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))}),App.classAccessor("routeMap",function(){return new Batman.RouteMap}),App.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))}),App.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))}),App.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),App.layout=void 0,App.shouldAllowEvent={},_ref1=Batman.RouteMapBuilder.BUILDER_FUNCTIONS,_fn=function(name){return App[name]=function(){var _ref2;return(_ref2=this.get("routeMapBuilder"))[name].apply(_ref2,arguments)}},_i=0,_len=_ref1.length;_len>_i;_i++)name=_ref1[_i],_fn(name);return App.event("ready").oneShot=!0,App.event("run").oneShot=!0,App.run=function(){var LayoutView,layout,layoutClass,_ref2,_this=this;if(Batman.currentApp){if(Batman.currentApp===this)return;Batman.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,Batman.currentApp=this,Batman.App.set("current",this),null==this.get("dispatcher")&&(this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),null==this.get("navigator")&&(this.set("navigator",Batman.Navigator.forApp(this)),Batman.navigator=this.get("navigator"),this.on("run",function(){return Object.keys(_this.get("dispatcher").routeMap).length>0?Batman.navigator.start():void 0})),this.observe("layout",function(layout){return null!=layout?layout.on("ready",function(){return _this.fire("ready")}):void 0}),layout=this.get("layout"),layout?"string"==typeof layout&&(layoutClass=this[Batman.helpers.camelize(layout)+"View"]):null!==layout&&(layoutClass=LayoutView=function(_super1){function LayoutView(){return _ref2=LayoutView.__super__.constructor.apply(this,arguments)}return __extends(LayoutView,_super1),LayoutView}(Batman.View)),layoutClass&&(layout=this.set("layout",new layoutClass({node:document.documentElement})),layout.propagateToSubviews("viewWillAppear"),layout.initializeBindings(),layout.propagateToSubviews("isInDOM",!0),layout.propagateToSubviews("viewDidAppear")),Batman.config.translations&&this.set("t",Batman.I18N.get("translations")),this.hasRun=!0,this.fire("run"),this)},App.event("ready").oneShot=!0,App.event("stop").oneShot=!0,App.stop=function(){var _ref2;return null!=(_ref2=this.navigator)&&_ref2.stop(),Batman.navigator=null,this.hasRun=!1,this.fire("stop"),this},App}.call(this,Batman.Object)}.call(this),function(){Batman.Association=function(){function Association(model,label,options){var association,defaultOptions,encoder,encoderKey,getAccessor;this.model=model,this.label=label,null==options&&(options={}),defaultOptions={namespace:Batman.currentApp,name:Batman.helpers.camelize(Batman.helpers.singularize(this.label))},this.options=Batman.extend(defaultOptions,this.defaultOptions,options),this.options.nestUrl&&(null==this.model.urlNestsUnder&&Batman.developer.error("You must persist the the model "+this.model.constructor.name+" to use the url helpers on an association"),this.model.urlNestsUnder(Batman.helpers.underscore(this.getRelatedModel().get("resourceName")))),null!=this.options.extend&&Batman.extend(this,this.options.extend),encoder={encode:this.options.saveInline?this.encoder():!1,decode:this.decoder()},encoderKey=options.encoderKey||this.label,this.model.encode(encoderKey,encoder),association=this,getAccessor=function(){return association.getAccessor.call(this,association,this.model,this.label)},this.model.accessor(this.label,{get:getAccessor,set:model.defaultAccessor.set,unset:model.defaultAccessor.unset})}return Association.prototype.associationType="",Association.prototype.isPolymorphic=!1,Association.prototype.defaultOptions={saveInline:!1,autoload:!0,nestUrl:!1,includeInTransaction:!0},Association.prototype.getRelatedModel=function(){var className,relatedModel,scope;return scope=this.options.namespace||Batman.currentApp,className=this.options.name,relatedModel=null!=scope?scope[className]:void 0,Batman.developer["do"](function(){return null==Batman.currentApp||relatedModel?void 0:Batman.developer.warn("Related model "+className+" hasn't loaded yet.")}),relatedModel},Association.prototype.getFromAttributes=function(record){return record.get("attributes."+this.label)},Association.prototype.setIntoAttributes=function(record,value){return record.get("attributes").set(this.label,value)},Association.prototype.inverse=function(){var inverse,relatedAssocs,_this=this;return(relatedAssocs=this.getRelatedModel()._batman.get("associations"))?this.options.inverseOf?relatedAssocs.getByLabel(this.options.inverseOf):(inverse=null,relatedAssocs.forEach(function(label,assoc){return assoc.getRelatedModel()===_this.model?inverse=assoc:void 0}),inverse):void 0},Association.prototype.reset=function(){return delete this.index,!0},Association}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PluralAssociation=function(_super){function PluralAssociation(){PluralAssociation.__super__.constructor.apply(this,arguments),this._resetSetHashes()}return __extends(PluralAssociation,_super),PluralAssociation.prototype.proxyClass=Batman.AssociationSet,PluralAssociation.prototype.isSingular=!1,PluralAssociation.prototype.setForRecord=function(record){var childModelSetIndex,indexValue,_this=this;return indexValue=this.indexValueForRecord(record),childModelSetIndex=this.setIndex(),Batman.Property.withoutTracking(function(){return _this._setsByRecord.getOrSet(record,function(){var existingValueSet,newSet;return null!=indexValue&&(existingValueSet=_this._setsByValue.get(indexValue),null!=existingValueSet)?existingValueSet:(newSet=_this.proxyClassInstanceForKey(indexValue),null!=indexValue&&_this._setsByValue.set(indexValue,newSet),newSet)})}),null!=indexValue?childModelSetIndex.get(indexValue):this._setsByRecord.get(record)},PluralAssociation.prototype.setForKey=Batman.Property.wrapTrackingPrevention(function(indexValue){var foundSet,_this=this;return foundSet=void 0,this._setsByRecord.forEach(function(record,set){return null==foundSet&&_this.indexValueForRecord(record)===indexValue?foundSet=set:void 0}),null!=foundSet?(foundSet.foreignKeyValue=indexValue,foundSet):this._setsByValue.getOrSet(indexValue,function(){return _this.proxyClassInstanceForKey(indexValue)})}),PluralAssociation.prototype.proxyClassInstanceForKey=function(indexValue){return new this.proxyClass(indexValue,this)},PluralAssociation.prototype.getAccessor=function(self){var relatedRecords,setInAttributes,_this=this;if(self.getRelatedModel())return(setInAttributes=self.getFromAttributes(this))?setInAttributes:(relatedRecords=self.setForRecord(this),self.setIntoAttributes(this,relatedRecords),Batman.Property.withoutTracking(function(){return!self.options.autoload||_this.isNew()||relatedRecords.loaded?void 0:relatedRecords.load(function(error){if(error)throw error})}),relatedRecords)},PluralAssociation.prototype.parentSetIndex=function(){return this.parentIndex||(this.parentIndex=this.model.get("loaded").indexedByUnique(this.primaryKey)),this.parentIndex},PluralAssociation.prototype.setIndex=function(){return this.index||(this.index=new Batman.AssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},PluralAssociation.prototype.indexValueForRecord=function(record){return record.get(this.primaryKey)},PluralAssociation.prototype.reset=function(){return PluralAssociation.__super__.reset.apply(this,arguments),this._resetSetHashes()},PluralAssociation.prototype._resetSetHashes=function(){return this._setsByRecord=new Batman.SimpleHash,this._setsByValue=new Batman.SimpleHash},PluralAssociation}(Batman.Association)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.HasManyAssociation=function(_super){function HasManyAssociation(model,label,options){return(null!=options?options.as:void 0)?function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Batman.PolymorphicHasManyAssociation,arguments,function(){}):(HasManyAssociation.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",void(this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(model.get("resourceName"))+"_id"))}return __extends(HasManyAssociation,_super),HasManyAssociation.prototype.associationType="hasMany",HasManyAssociation.prototype.indexRelatedModelOn="foreignKey",HasManyAssociation.prototype.apply=function(baseSaveError,base){var relations,set,_this=this;return baseSaveError||((relations=this.getFromAttributes(base))&&relations.forEach(function(model){return model.set(_this.foreignKey,base.get(_this.primaryKey))}),base.set(this.label,set=this.setForRecord(base)),"creating"!==base.lifecycle.get("state"))?void 0:set.markAsLoaded()},HasManyAssociation.prototype.encoder=function(){var association;return association=this,function(relationSet,_,__,record){var jsonArray;return null!=relationSet&&(jsonArray=[],relationSet.forEach(function(relation){var relationJSON;return relationJSON=relation.toJSON(),(!association.inverse()||association.inverse().options.encodeForeignKey)&&(relationJSON[association.foreignKey]=record.get(association.primaryKey)),jsonArray.push(relationJSON)})),jsonArray}},HasManyAssociation.prototype.decoder=function(){var association;return association=this,function(data,key,_,__,parentRecord){var children,id,jsonObject,newChildren,record,recordsToAdd,recordsToMap,relatedModel,_i,_len,_ref;if(!(relatedModel=association.getRelatedModel()))return void Batman.developer.error("Can't decode model "+association.options.name+" because it hasn't been loaded yet!");for(children=association.setForRecord(parentRecord),newChildren=children.filter(function(relation){return relation.isNew()}).toArray(),recordsToMap=[],recordsToAdd=[],_i=0,_len=data.length;_len>_i;_i++)jsonObject=data[_i],id=jsonObject[relatedModel.primaryKey],record=relatedModel._loadIdentity(id),null!=record?recordsToAdd.push(record):newChildren.length>0?(record=newChildren.shift(),null!=id&&recordsToMap.push(record)):(record=new relatedModel,null!=id&&recordsToMap.push(record),recordsToAdd.push(record)),record._withoutDirtyTracking(function(){return this.fromJSON(jsonObject),association.options.inverseOf?record.set(association.options.inverseOf,parentRecord):void 0});return(_ref=relatedModel.get("loaded")).add.apply(_ref,recordsToMap),children.add.apply(children,recordsToAdd),children.markAsLoaded(),children}},HasManyAssociation}(Batman.PluralAssociation)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PolymorphicHasManyAssociation=function(_super){function PolymorphicHasManyAssociation(model,label,options){options.inverseOf=this.foreignLabel=options.as,delete options.as,options.foreignKey||(options.foreignKey=""+this.foreignLabel+"_id"),PolymorphicHasManyAssociation.__super__.constructor.call(this,model,label,options),this.foreignTypeKey=options.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return __extends(PolymorphicHasManyAssociation,_super),PolymorphicHasManyAssociation.prototype.proxyClass=Batman.PolymorphicAssociationSet,PolymorphicHasManyAssociation.prototype.isPolymorphic=!0,PolymorphicHasManyAssociation.prototype.apply=function(baseSaveError,base){var relations,_this=this;baseSaveError||(relations=this.getFromAttributes(base))&&(PolymorphicHasManyAssociation.__super__.apply.apply(this,arguments),relations.forEach(function(model){return model.set(_this.foreignTypeKey,_this.modelType())}))},PolymorphicHasManyAssociation.prototype.proxyClassInstanceForKey=function(indexValue){return new this.proxyClass(indexValue,this.modelType(),this)},PolymorphicHasManyAssociation.prototype.getRelatedModelForType=function(type){var relatedModel,scope;return scope=this.options.namespace||Batman.currentApp,type?(relatedModel=null!=scope?scope[type]:void 0,relatedModel||(relatedModel=null!=scope?scope[Batman.helpers.camelize(type)]:void 0)):relatedModel=this.getRelatedModel(),Batman.developer["do"](function(){return null==Batman.currentApp||relatedModel?void 0:Batman.developer.warn("Related model "+type+" for hasMany polymorphic association "+this.label+" not found.")}),relatedModel},PolymorphicHasManyAssociation.prototype.modelType=function(){return this.model.get("resourceName")},PolymorphicHasManyAssociation.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new Batman.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn]))},PolymorphicHasManyAssociation.prototype.encoder=function(){var association;return association=this,function(relationSet,_,__,record){var jsonArray;return null!=relationSet&&(jsonArray=[],relationSet.forEach(function(relation){var relationJSON;return relationJSON=relation.toJSON(),relationJSON[association.foreignKey]=record.get(association.primaryKey),relationJSON[association.foreignTypeKey]=association.modelType(),jsonArray.push(relationJSON)})),jsonArray}},PolymorphicHasManyAssociation.prototype.decoder=function(){var association;return association=this,function(data,key,_,__,parentRecord){var children,id,jsonObject,newChildren,record,recordsToAdd,relatedModel,type,_i,_len;for(children=association.getFromAttributes(parentRecord)||association.setForRecord(parentRecord),newChildren=children.filter(function(relation){return relation.isNew()}).toArray(),recordsToAdd=[],_i=0,_len=data.length;_len>_i;_i++){if(jsonObject=data[_i],type=jsonObject[association.options.foreignTypeKey],!(relatedModel=association.getRelatedModelForType(type)))return void Batman.developer.error("Can't decode model "+association.options.name+" because it hasn't been loaded yet!");id=jsonObject[relatedModel.primaryKey],record=relatedModel._loadIdentity(id),null!=record?(record._withoutDirtyTracking(function(){return this.fromJSON(jsonObject)}),recordsToAdd.push(record)):newChildren.length>0?(record=newChildren.shift(),record._withoutDirtyTracking(function(){return this.fromJSON(jsonObject)}),record=relatedModel._mapIdentity(record)):(record=relatedModel._makeOrFindRecordFromData(jsonObject),recordsToAdd.push(record)),association.options.inverseOf&&record._withoutDirtyTracking(function(){return record.set(association.options.inverseOf,parentRecord)})}return children.add.apply(children,recordsToAdd),children.markAsLoaded(),children}},PolymorphicHasManyAssociation}(Batman.HasManyAssociation)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.SingularAssociation=function(_super){function SingularAssociation(){return _ref=SingularAssociation.__super__.constructor.apply(this,arguments)}return __extends(SingularAssociation,_super),SingularAssociation.prototype.isSingular=!0,SingularAssociation.prototype.getAccessor=function(association){var proxy,record,recordInAttributes;return(recordInAttributes=association.getFromAttributes(this))?recordInAttributes:association.getRelatedModel()?(proxy=this.associationProxy(association),record=!1,Batman.Property.withoutTracking(function(){return proxy.get("loaded")})||(association.options.autoload?Batman.Property.withoutTracking(function(){return proxy.load()}):record=proxy.loadFromLocal()),record||proxy):void 0},SingularAssociation.prototype.setIndex=function(){return this.index||(this.index=new Batman.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn]))},SingularAssociation}(Batman.Association)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.HasOneAssociation=function(_super){function HasOneAssociation(){HasOneAssociation.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(this.model.get("resourceName"))+"_id"}return __extends(HasOneAssociation,_super),HasOneAssociation.prototype.associationType="hasOne",HasOneAssociation.prototype.proxyClass=Batman.HasOneProxy,HasOneAssociation.prototype.indexRelatedModelOn="foreignKey",HasOneAssociation.prototype.apply=function(baseSaveError,base){var relation;return!baseSaveError&&(relation=this.getFromAttributes(base))?relation.set(this.foreignKey,base.get(this.primaryKey)):void 0},HasOneAssociation.prototype.encoder=function(){var association;return association=this,function(val,key,object,record){var json;if(association.options.saveInline)return(json=val.toJSON())&&(json[association.foreignKey]=record.get(association.primaryKey)),json}},HasOneAssociation.prototype.decoder=function(){var association;return association=this,function(data,_,__,___,parentRecord){var record,relatedModel;if(data)return relatedModel=association.getRelatedModel(),record=relatedModel.createFromJSON(data),association.options.inverseOf&&record.set(association.options.inverseOf,parentRecord),record}},HasOneAssociation}(Batman.SingularAssociation)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.BelongsToAssociation=function(_super){function BelongsToAssociation(model,label,options){return(null!=options?options.polymorphic:void 0)?(delete options.polymorphic,function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Batman.PolymorphicBelongsToAssociation,arguments,function(){})):(BelongsToAssociation.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey||""+this.label+"_id",this.primaryKey=this.options.primaryKey||"id",void(this.options.encodeForeignKey&&this.model.encode(this.foreignKey)))}return __extends(BelongsToAssociation,_super),BelongsToAssociation.prototype.associationType="belongsTo",BelongsToAssociation.prototype.proxyClass=Batman.BelongsToProxy,BelongsToAssociation.prototype.indexRelatedModelOn="primaryKey",BelongsToAssociation.prototype.defaultOptions={saveInline:!1,autoload:!0,encodeForeignKey:!0},BelongsToAssociation.prototype.encoder=function(){return function(val){return val.toJSON()}},BelongsToAssociation.prototype.decoder=function(){var association;return association=this,function(data,_,__,___,childRecord){var inverse,record,relatedModel;return relatedModel=association.getRelatedModel(),record=relatedModel.createFromJSON(data),association.options.inverseOf&&(inverse=association.inverse())&&(inverse instanceof Batman.HasManyAssociation?childRecord.set(association.foreignKey,record.get(association.primaryKey)):record.set(inverse.label,childRecord)),childRecord.set(association.label,record),record}},BelongsToAssociation.prototype.apply=function(base){var foreignValue,model;return(model=base.get(this.label))&&(foreignValue=model.get(this.primaryKey),void 0!==foreignValue)?base.set(this.foreignKey,foreignValue):void 0},BelongsToAssociation}(Batman.SingularAssociation)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PolymorphicBelongsToAssociation=function(_super){function PolymorphicBelongsToAssociation(){PolymorphicBelongsToAssociation.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type",this.options.encodeForeignTypeKey&&this.model.encode(this.foreignTypeKey),this.typeIndices={}}return __extends(PolymorphicBelongsToAssociation,_super),PolymorphicBelongsToAssociation.prototype.isPolymorphic=!0,PolymorphicBelongsToAssociation.prototype.proxyClass=Batman.PolymorphicBelongsToProxy,PolymorphicBelongsToAssociation.prototype.defaultOptions=Batman.mixin({},Batman.BelongsToAssociation.prototype.defaultOptions,{encodeForeignTypeKey:!0}),PolymorphicBelongsToAssociation.prototype.getRelatedModel=!1,PolymorphicBelongsToAssociation.prototype.setIndex=!1,PolymorphicBelongsToAssociation.prototype.inverse=!1,PolymorphicBelongsToAssociation.prototype.apply=function(base){var foreignTypeValue,instanceOrProxy;return PolymorphicBelongsToAssociation.__super__.apply.apply(this,arguments),(instanceOrProxy=base.get(this.label))?(foreignTypeValue=instanceOrProxy instanceof Batman.PolymorphicBelongsToProxy?instanceOrProxy.get("foreignTypeValue"):instanceOrProxy.constructor.get("resourceName"),base.set(this.foreignTypeKey,foreignTypeValue)):void 0},PolymorphicBelongsToAssociation.prototype.getAccessor=function(self){var proxy,recordInAttributes;return(recordInAttributes=self.getFromAttributes(this))?recordInAttributes:self.getRelatedModelForType(this.get(self.foreignTypeKey))?(proxy=this.associationProxy(self),Batman.Property.withoutTracking(function(){return!proxy.get("loaded")&&self.options.autoload?proxy.load():void 0}),proxy):void 0},PolymorphicBelongsToAssociation.prototype.url=function(recordOptions){var ending,helper,id,inverse,root,type,_ref,_ref1;return type=null!=(_ref=recordOptions.data)?_ref[this.foreignTypeKey]:void 0,type&&(inverse=this.inverseForType(type))?(root=Batman.helpers.pluralize(type).toLowerCase(),id=null!=(_ref1=recordOptions.data)?_ref1[this.foreignKey]:void 0,helper=inverse.isSingular?"singularize":"pluralize",ending=Batman.helpers[helper](inverse.label),"/"+root+"/"+id+"/"+ending):void 0},PolymorphicBelongsToAssociation.prototype.getRelatedModelForType=function(type){var relatedModel,scope;return scope=this.options.namespace||Batman.currentApp,type&&(relatedModel=null!=scope?scope[type]:void 0,relatedModel||(relatedModel=null!=scope?scope[Batman.helpers.camelize(type)]:void 0)),Batman.developer["do"](function(){return null==Batman.currentApp||relatedModel?void 0:Batman.developer.warn("Related model "+type+" for belongsTo polymorphic association "+this.label+" not found.")}),relatedModel},PolymorphicBelongsToAssociation.prototype.setIndexForType=function(type){var _base;return(_base=this.typeIndices)[type]||(_base[type]=new Batman.PolymorphicUniqueAssociationSetIndex(this,type,this.primaryKey)),this.typeIndices[type]},PolymorphicBelongsToAssociation.prototype.inverseForType=function(type){var inverse,relatedAssocs,_ref,_this=this;return(relatedAssocs=null!=(_ref=this.getRelatedModelForType(type))?_ref._batman.get("associations"):void 0)?this.options.inverseOf?relatedAssocs.getByLabel(this.options.inverseOf):(inverse=null,relatedAssocs.forEach(function(label,assoc){return assoc.getRelatedModel()===_this.model?inverse=assoc:void 0}),inverse):void 0},PolymorphicBelongsToAssociation.prototype.decoder=function(){var association;return association=this,function(data,key,response,___,childRecord){var foreignTypeValue,inverse,record,relatedModel;return foreignTypeValue=response[association.foreignTypeKey]||childRecord.get(association.foreignTypeKey),relatedModel=association.getRelatedModelForType(foreignTypeValue),record=relatedModel.createFromJSON(data),association.options.inverseOf&&(inverse=association.inverseForType(foreignTypeValue))&&(inverse instanceof Batman.PolymorphicHasManyAssociation?(childRecord.set(association.foreignKey,record.get(association.primaryKey)),childRecord.set(association.foreignTypeKey,foreignTypeValue)):record.set(inverse.label,childRecord)),childRecord.set(association.label,record),record}},PolymorphicBelongsToAssociation}(Batman.BelongsToAssociation)}.call(this),function(){var __hasProp={}.hasOwnProperty;Batman.Transaction={isTransaction:!0,base:function(){return this._batman.base},applyChanges:function(visited){var attributes,base,key,updatedAssociationSet,value,_ref;if(null==visited&&(visited=[]),-1!==visited.indexOf(this))return this.base();visited.push(this),attributes=this.get("attributes").toObject();for(key in attributes)__hasProp.call(attributes,key)&&(value=attributes[key],value instanceof Batman.Model&&value.isTransaction?(value.applyChanges(visited),delete attributes[key]):value instanceof Batman.TransactionAssociationSet&&(updatedAssociationSet=value.applyChanges(visited),attributes[key]=updatedAssociationSet));return base=this.base(),base.mixin(attributes),null!=(_ref="function"==typeof base.applyChanges?base.applyChanges():void 0)?_ref:base},save:function(options,callback){var finish,validated,_ref,_this=this;return callback||(_ref=[{},options],options=_ref[0],callback=_ref[1]),this.once("validated",validated=function(){return _this.applyChanges()}),finish=function(){return _this.off("validated",validated),"function"==typeof callback?callback.apply(null,arguments):void 0},this.constructor.prototype.save.call(this,options,function(err,result){return err||(result=_this.base(),result.get("dirtyKeys").clear(),result.get("_dirtiedKeys").clear(),result.get("lifecycle").startTransition("save"),result.get("lifecycle").startTransition("saved")),finish(err,result)})}}}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.TransactionAssociationSet=function(_super){function TransactionAssociationSet(associationSet,visited,stack){this.set("associationSet",associationSet),this._loader=this._addFromAssociationSet.bind(this),associationSet.on("itemsWereAdded",this._loader),this._visited=visited,this._stack=stack,this._storage=[],this._originalStorage=[],this._removedStorage=[],this.add.apply(this,associationSet.toArray())}return __extends(TransactionAssociationSet,_super),TransactionAssociationSet.prototype.isTransaction=!0,TransactionAssociationSet.delegate("association","foreignKeyValue",{to:"associationSet"}),TransactionAssociationSet.prototype._addFromAssociationSet=function(items){return this.add.apply(this,items)},TransactionAssociationSet.prototype.add=TransactionAssociationSet.mutation(function(){var addedTransactions,item,items,originalIndex,removedIndex,transactionItem,_i,_len;for(items=1<=arguments.length?__slice.call(arguments,0):[],addedTransactions=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],item instanceof Batman.Model&&!item.isTransaction?(transactionItem=item._transaction(this._visited,this._stack),this._storage.push(transactionItem),addedTransactions.push(transactionItem),originalIndex=this._originalStorage.indexOf(item),-1===originalIndex&&this._originalStorage.push(item),removedIndex=this._removedStorage.indexOf(item),removedIndex>-1&&this._removedStorage.splice(removedIndex,1)):Batman.developer.warn("You tried to add a "+item.constructor.name+" to a TransactionAssociationSet ("+this.get("association.label")+")",item);return this.length=this._storage.length,addedTransactions.length&&this.fire("itemsWereAdded",addedTransactions),addedTransactions}),TransactionAssociationSet.prototype.remove=TransactionAssociationSet.mutation(function(){var item,originalIndex,removedTransactions,transactionIndex,transactionItem,transactions,_i,_len;for(transactions=1<=arguments.length?__slice.call(arguments,0):[],removedTransactions=[],_i=0,_len=transactions.length;_len>_i;_i++){if(transactionItem=transactions[_i],!transactionItem.isTransaction)throw"Tried to remove real item from transaction set: "+t.toJSON();transactionIndex=this._storage.indexOf(transactionItem),transactionIndex>-1&&(this._storage.splice(transactionIndex,1),removedTransactions.push(transactionItem)),item=transactionItem.base(),originalIndex=this._originalStorage.indexOf(item),originalIndex>-1&&(this._removedStorage.push(item),this._originalStorage.splice(originalIndex,1))}return this.length=this._storage.length,removedTransactions.length&&this.fire("itemsWereRemoved",removedTransactions),removedTransactions}),TransactionAssociationSet.prototype.applyChanges=function(visited){var originals,target,transactionItem,_i,_len,_ref;for(_ref=this._storage,_i=0,_len=_ref.length;_len>_i;_i++)transactionItem=_ref[_i],transactionItem.applyChanges(visited);return originals=function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Batman.Set,this._originalStorage,function(){}),target=this.get("associationSet"),target.off("itemsWereAdded",this._loader),target.replace(originals),target.set("removedItems",function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);
return Object(result)===result?result:child}(Batman.Set,this._removedStorage,function(){})),target},TransactionAssociationSet.accessor("length",function(){return this.registerAsMutableSource(),this.length}),TransactionAssociationSet.prototype.build=Batman.AssociationSet.prototype.build,TransactionAssociationSet}(Batman.Set)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.Validator=function(_super){function Validator(){var mixins,options;options=arguments[0],mixins=2<=arguments.length?__slice.call(arguments,1):[],this.options=options,Validator.__super__.constructor.apply(this,mixins)}return __extends(Validator,_super),Validator.triggers=function(){var triggers;return triggers=1<=arguments.length?__slice.call(arguments,0):[],null!=this._triggers?this._triggers.concat(triggers):this._triggers=triggers},Validator.options=function(){var options;return options=1<=arguments.length?__slice.call(arguments,0):[],null!=this._options?this._options.concat(options):this._options=options},Validator.matches=function(options){var key,results,shouldReturn,value,_ref,_ref1;results={},shouldReturn=!1;for(key in options)value=options[key],~(null!=(_ref=this._options)?_ref.indexOf(key):void 0)&&(results[key]=value),~(null!=(_ref1=this._triggers)?_ref1.indexOf(key):void 0)&&(results[key]=value,shouldReturn=!0);return shouldReturn?results:void 0},Validator.prototype.validateEach=function(){return Batman.developer.error("You must override validateEach in Batman.Validator subclasses.")},Validator.prototype.format=function(attr,messageKey,interpolations,record){return this.options.message?"function"==typeof this.options.message?this.options.message.call(record,attr,messageKey):this.options.message:Batman.t("errors.messages."+messageKey,interpolations)},Validator.prototype.handleBlank=function(value){return this.options.allowBlank&&!Batman.PresenceValidator.prototype.isPresent(value)?!0:void 0},Validator}(Batman.Object)}.call(this),function(){Batman.Validators=[],Batman.extend(Batman.translate.messages,{errors:{base:{format:"%{message}"},format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_an_integer:"must be an integer",not_matching:"is not valid",invalid_association:"is not valid",not_included_in_list:"is not included in the list",included_in_list:"is included in the list",not_an_email:"is not a valid email address",confirmation_does_not_match:"and confirmation do not match"}}})}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.RegExpValidator=function(_super){function RegExpValidator(options){var _ref;this.regexp=null!=(_ref=options.regexp)?_ref:options.pattern,RegExpValidator.__super__.constructor.apply(this,arguments)}return __extends(RegExpValidator,_super),RegExpValidator.triggers("regexp","pattern"),RegExpValidator.options("allowBlank"),RegExpValidator.prototype.validateEach=function(errors,record,key,callback){var value;return value=record.get(key),this.handleBlank(value)?callback():(null!=value&&""!==value&&this.regexp.test(value)||errors.add(key,this.format(key,"not_matching",{},record)),callback())},RegExpValidator}(Batman.Validator),Batman.Validators.push(Batman.RegExpValidator)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.PresenceValidator=function(_super){function PresenceValidator(){return _ref=PresenceValidator.__super__.constructor.apply(this,arguments)}return __extends(PresenceValidator,_super),PresenceValidator.triggers("presence"),PresenceValidator.prototype.validateEach=function(errors,record,key,callback){var value;return value=record.get(key),this.isPresent(value)||errors.add(key,this.format(key,"blank",{},record)),callback()},PresenceValidator.prototype.isPresent=function(value){return null!=value&&""!==value},PresenceValidator}(Batman.Validator),Batman.Validators.push(Batman.PresenceValidator)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.NumericValidator=function(_super){function NumericValidator(){return _ref=NumericValidator.__super__.constructor.apply(this,arguments)}return __extends(NumericValidator,_super),NumericValidator.triggers("numeric","greaterThan","greaterThanOrEqualTo","equalTo","lessThan","lessThanOrEqualTo","onlyInteger"),NumericValidator.options("allowBlank"),NumericValidator.prototype.validateEach=function(errors,record,key,callback){var options,value;return options=this.options,value=record.get(key),this.handleBlank(value)?callback():(null==value||!this.isNumeric(value)&&!this.canCoerceToNumeric(value)?errors.add(key,this.format(key,"not_numeric",{},record)):options.onlyInteger&&!this.isInteger(value)?errors.add(key,this.format(key,"not_an_integer",{},record)):(null!=options.greaterThan&&value<=options.greaterThan&&errors.add(key,this.format(key,"greater_than",{count:options.greaterThan},record)),null!=options.greaterThanOrEqualTo&&value<options.greaterThanOrEqualTo&&errors.add(key,this.format(key,"greater_than_or_equal_to",{count:options.greaterThanOrEqualTo},record)),null!=options.equalTo&&value!==options.equalTo&&errors.add(key,this.format(key,"equal_to",{count:options.equalTo},record)),null!=options.lessThan&&value>=options.lessThan&&errors.add(key,this.format(key,"less_than",{count:options.lessThan},record)),null!=options.lessThanOrEqualTo&&value>options.lessThanOrEqualTo&&errors.add(key,this.format(key,"less_than_or_equal_to",{count:options.lessThanOrEqualTo},record))),callback())},NumericValidator.prototype.isNumeric=function(value){return!isNaN(parseFloat(value))&&isFinite(value)},NumericValidator.prototype.isInteger=function(value){return parseFloat(value)===(0|value)},NumericValidator.prototype.canCoerceToNumeric=function(value){return value-0==value&&value.length>0},NumericValidator}(Batman.Validator),Batman.Validators.push(Batman.NumericValidator)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.LengthValidator=function(_super){function LengthValidator(options){var range;(range=options.lengthIn||options.lengthWithin)&&(options.minLength=range[0],options.maxLength=range[1]||-1,delete options.lengthWithin,delete options.lengthIn),LengthValidator.__super__.constructor.apply(this,arguments)}return __extends(LengthValidator,_super),LengthValidator.triggers("minLength","maxLength","length","lengthWithin","lengthIn"),LengthValidator.options("allowBlank"),LengthValidator.prototype.validateEach=function(errors,record,key,callback){var options,value;return options=this.options,value=record.get(key),this.handleBlank(value)?callback():(null==value&&(value=[]),options.minLength&&value.length<options.minLength&&errors.add(key,this.format(key,"too_short",{count:options.minLength},record)),options.maxLength&&value.length>options.maxLength&&errors.add(key,this.format(key,"too_long",{count:options.maxLength},record)),options.length&&value.length!==options.length&&errors.add(key,this.format(key,"wrong_length",{count:options.length},record)),callback())},LengthValidator}(Batman.Validator),Batman.Validators.push(Batman.LengthValidator)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.InclusionValidator=function(_super){function InclusionValidator(options){this.acceptableValues=options.inclusion["in"],InclusionValidator.__super__.constructor.apply(this,arguments)}return __extends(InclusionValidator,_super),InclusionValidator.triggers("inclusion"),InclusionValidator.options("allowBlank"),InclusionValidator.prototype.validateEach=function(errors,record,key,callback){var value;return value=record.get(key),this.handleBlank(value)||-1!==this.acceptableValues.indexOf(value)||errors.add(key,this.format(key,"not_included_in_list",{},record)),callback()},InclusionValidator}(Batman.Validator),Batman.Validators.push(Batman.InclusionValidator)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.ExclusionValidator=function(_super){function ExclusionValidator(options){this.unacceptableValues=options.exclusion["in"],ExclusionValidator.__super__.constructor.apply(this,arguments)}return __extends(ExclusionValidator,_super),ExclusionValidator.triggers("exclusion"),ExclusionValidator.prototype.validateEach=function(errors,record,key,callback){return this.unacceptableValues.indexOf(record.get(key))>=0&&errors.add(key,this.format(key,"included_in_list",{},record)),callback()},ExclusionValidator}(Batman.Validator),Batman.Validators.push(Batman.ExclusionValidator)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.EmailValidator=function(_super){function EmailValidator(){return _ref=EmailValidator.__super__.constructor.apply(this,arguments)}return __extends(EmailValidator,_super),EmailValidator.triggers("email"),EmailValidator.prototype.emailRegexp=/[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9-]+(\.[a-z0-9-]+)*/,EmailValidator.prototype.validateEach=function(errors,record,key,callback){var value;return value=record.get(key),null!=value&&""!==value&&this.emailRegexp.test(value)||errors.add(key,this.format(key,"not_an_email",{},record)),callback()},EmailValidator}(Batman.Validator),Batman.Validators.push(Batman.EmailValidator)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.ConfirmationValidator=function(_super){function ConfirmationValidator(){return _ref=ConfirmationValidator.__super__.constructor.apply(this,arguments)}return __extends(ConfirmationValidator,_super),ConfirmationValidator.triggers("confirmation"),ConfirmationValidator.prototype.validateEach=function(errors,record,key,callback){var confirmation_key,confirmation_value,options,value;return options=this.options,options.confirmation?(confirmation_key="String"===Batman.typeOf(this.options.confirmation)?this.options.confirmation:key+"_confirmation",value=record.get(key),confirmation_value=record.get(confirmation_key),value!==confirmation_value&&errors.add(key,this.format(key,"confirmation_does_not_match",{},record)),callback()):void 0},ConfirmationValidator}(Batman.Validator),Batman.Validators.push(Batman.ConfirmationValidator)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.AssociatedValidator=function(_super){function AssociatedValidator(){return _ref=AssociatedValidator.__super__.constructor.apply(this,arguments)}return __extends(AssociatedValidator,_super),AssociatedValidator.triggers("associated"),AssociatedValidator.prototype.validateEach=function(errors,record,key,callback){var childFinished,count,value,_this=this;return value=record.get(key),null!=value?(value instanceof Batman.AssociationProxy&&(value="function"==typeof value.get?value.get("target"):void 0),count=1,childFinished=function(err,childErrors){return childErrors.length>0&&errors.add(key,_this.format(key,"invalid_association",{},record)),0===--count?callback():void 0},null!=(null!=value?value.forEach:void 0)?value.forEach(function(record){return count+=1,record.validate(childFinished)}):null!=(null!=value?value.validate:void 0)&&(count+=1,value.validate(childFinished)),childFinished(null,[])):callback()},AssociatedValidator}(Batman.Validator),Batman.Validators.push(Batman.AssociatedValidator)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.AssociatedFieldValidator=function(_super){function AssociatedFieldValidator(){return _ref=AssociatedFieldValidator.__super__.constructor.apply(this,arguments)}return __extends(AssociatedFieldValidator,_super),AssociatedFieldValidator.triggers("associatedFields"),AssociatedFieldValidator.prototype.validateEach=function(errors,record,key,callback){var childFinished,count,value;return value=record.get(key),null!=value?(value instanceof Batman.AssociationProxy&&(value="function"==typeof value.get?value.get("target"):void 0),count=1,childFinished=function(err,childErrors){return null!=childErrors&&childErrors.forEach(function(validationError){return errors.add(validationError.get("attribute"),validationError.get("message"))}),0===--count?callback():void 0},null!=(null!=value?value.forEach:void 0)?value.forEach(function(record){return count+=1,record.validate(childFinished)}):null!=(null!=value?value.validate:void 0)&&(count+=1,value.validate(childFinished)),childFinished(null,[])):callback()},AssociatedFieldValidator}(Batman.Validator),Batman.Validators.push(Batman.AssociatedFieldValidator)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.ControllerActionFrame=function(_super){function ControllerActionFrame(options,onComplete){ControllerActionFrame.__super__.constructor.call(this,options),this.once("complete",onComplete)}return __extends(ControllerActionFrame,_super),ControllerActionFrame.prototype.operationOccurred=!1,ControllerActionFrame.prototype.remainingOperations=0,ControllerActionFrame.prototype.event("complete").oneShot=!0,ControllerActionFrame.prototype.startOperation=function(options){return null==options&&(options={}),options.internal||(this.operationOccurred=!0),this._changeOperationsCounter(1),!0},ControllerActionFrame.prototype.finishOperation=function(){return this._changeOperationsCounter(-1),!0},ControllerActionFrame.prototype.startAndFinishOperation=function(options){return this.startOperation(options),this.finishOperation(options),!0},ControllerActionFrame.prototype._changeOperationsCounter=function(delta){var _ref;this.remainingOperations+=delta,0===this.remainingOperations&&this.fire("complete"),null!=(_ref=this.parentFrame)&&_ref._changeOperationsCounter(delta)},ControllerActionFrame}(Batman.Object)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.HTMLStore=function(_super){function HTMLStore(){HTMLStore.__super__.constructor.apply(this,arguments),this._htmlContents={},this._requestedPaths=new Batman.SimpleSet}return __extends(HTMLStore,_super),HTMLStore.prototype.propertyClass=Batman.Property,HTMLStore.prototype.fetchHTML=function(path){var _this=this;return new Batman.Request({url:Batman.Navigator.normalizePath(Batman.config.pathToHTML,""+path+".html"),type:"html",success:function(response){return _this.set(path,response)},error:function(){throw new Error("Could not load html from "+path)}})},HTMLStore.accessor({"final":!0,get:function(path){var contents;if("/"!==path.charAt(0))return this.get("/"+path);if(this._htmlContents[path])return this._htmlContents[path];if(!this._requestedPaths.has(path)){if(contents=this._sourceFromDOM(path))return contents;if(!Batman.config.fetchRemoteHTML)throw new Error("Couldn't find html source for '"+path+"'!");this.fetchHTML(path)}},set:function(path,content){return"/"!==path.charAt(0)?this.set("/"+path,content):(this._requestedPaths.add(path),this._htmlContents[path]=content)}}),HTMLStore.prototype.prefetch=function(path){return this.get(path),!0},HTMLStore.prototype._sourceFromDOM=function(path){var node,relativePath;return relativePath=path.slice(1),(node=Batman.DOM.querySelector(document,"[data-defineview*='"+relativePath+"']"))?(Batman.setImmediate(function(){var _ref;return null!=(_ref=node.parentNode)?_ref.removeChild(node):void 0}),Batman.View.store.set(Batman.Navigator.normalizePath(path),node.innerHTML)):void 0},HTMLStore}(Batman.Object)}.call(this),function(){var _base,_base1,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.View=function(_super){function View(){var superview,_this=this;this.bindings=[],this.subviews=new Batman.Set,this.subviews.on("itemsWereAdded",function(newSubviews){var subview,_i,_len;for(_i=0,_len=newSubviews.length;_len>_i;_i++)subview=newSubviews[_i],_this._addSubview(subview)}),this.subviews.on("itemsWereRemoved",function(oldSubviews){var subview,_i,_len;for(_i=0,_len=oldSubviews.length;_len>_i;_i++)subview=oldSubviews[_i],subview._removeFromSuperview()}),View.__super__.constructor.apply(this,arguments),(superview=this.superview)&&(this.superview=null,superview.subviews.add(this))}return __extends(View,_super),View.store=new Batman.HTMLStore,View.option=function(){var keys,options;return keys=1<=arguments.length?__slice.call(arguments,0):[],Batman.initializeObject(this),(options=this._batman.options)&&(keys=options.concat(keys)),this._batman.set("options",keys)},View.filter=function(key,filter){var filters;return Batman.initializeObject(this.prototype),filters=this.prototype._batman.filters||{},filters[key]=filter,this.prototype._batman.set("filters",filters)},View.viewForNode=function(node,climbTree){var view;for(null==climbTree&&(climbTree=!0);node;){if(view=Batman._data(node,"view"))return view;if(!climbTree)return;node=node.parentNode}},View.prototype.bindings=[],View.prototype.subviews=[],View.prototype.superview=null,View.prototype.controller=null,View.prototype.source=null,View.prototype.html=null,View.prototype.node=null,View.prototype.bindImmediately=!0,View.prototype.isBound=!1,View.prototype.isInDOM=!1,View.prototype.isView=!0,View.prototype.isDead=!1,View.prototype.isBackingView=!1,View.prototype._addChildBinding=function(binding){return this.bindings.push(binding)},View.prototype._addSubview=function(subview){var filters,subviewController,yieldName,yieldObject;return subviewController=subview.controller,subview.removeFromSuperview(),subview.set("controller",subviewController||this.controller),subview.set("superview",this),subview.fireAndCall("viewDidMoveToSuperview"),(yieldName=subview.contentFor)&&!subview.parentNode&&(yieldObject=Batman.DOM.Yield.withName(yieldName),yieldObject.set("contentView",subview)),(filters=this._batman.get("filters"))&&subview._batman.set("filters",Batman.mixin({},filters,subview._batman.get("filters"))),this.get("node"),subview.get("node"),this.observe("node",subview._nodesChanged),subview.observe("node",subview._nodesChanged),subview.observe("parentNode",subview._nodesChanged),subview._nodesChanged()},View.prototype._removeFromSuperview=function(){var superview;if(this.superview)return this.fireAndCall("viewWillRemoveFromSuperview"),this.forget("node",this._nodesChanged),this.forget("parentNode",this._nodesChanged),this.superview.forget("node",this._nodesChanged),superview=this.get("superview"),this.removeFromParentNode(),this.set("superview",null),this.set("controller",null)},View.prototype.removeFromSuperview=function(){var _ref;return null!=(_ref=this.superview)?_ref.subviews.remove(this):void 0},View.prototype._nodesChanged=function(){var parentNode,superviewNode;if(this.node)return this.bindImmediately&&this.initializeBindings(),superviewNode=this.superview.get("node"),parentNode=this.parentNode,"string"==typeof parentNode&&(parentNode=Batman.DOM.querySelector(superviewNode,parentNode)),parentNode||(parentNode=superviewNode),parentNode?this.addToParentNode(parentNode):void 0},View.prototype.addToParentNode=function(parentNode){var isInDOM;if(this.get("node"))return isInDOM=Batman.DOM.containsNode(parentNode),isInDOM&&this.propagateToSubviews("viewWillAppear"),this.insertIntoDOM(parentNode),this.propagateToSubviews("isInDOM",isInDOM),isInDOM?this.propagateToSubviews("viewDidAppear"):void 0},View.prototype.insertIntoDOM=function(parentNode){return parentNode!==this.node?parentNode.appendChild(this.node):void 0},View.prototype.removeFromParentNode=function(){var isInDOM,node,_ref,_ref1,_ref2;return node=this.get("node"),isInDOM=null!=(_ref=this.wasInDOM)?_ref:Batman.DOM.containsNode(node),isInDOM&&this.propagateToSubviews("viewWillDisappear"),null!=(_ref1=this.node)&&null!=(_ref2=_ref1.parentNode)&&_ref2.removeChild(this.node),this.propagateToSubviews("isInDOM",!1),isInDOM?this.propagateToSubviews("viewDidDisappear"):void 0},View.prototype.propagateToSubviews=function(eventName,value){var subview,_i,_len,_ref,_results;for(null!=value?this.set(eventName,value):this.fireAndCall(eventName),_ref=this.subviews._storage,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)subview=_ref[_i],_results.push(subview.propagateToSubviews(eventName,value));return _results},View.prototype.loadView=function(_node){var html,node;return null!=(html=this.get("html"))?(node=_node||document.createElement("div"),Batman.DOM.setInnerHTML(node,html),node):void 0},View.accessor("html",{get:function(){var handler,property,source,_this=this;if(null!=this.html)return this.html;if(source=this.get("source"))return source=Batman.Navigator.normalizePath(source),this.html=this.constructor.store.get(source),null==this.html&&(property=this.property("html"),handler=function(html){return null!=html&&_this.set("html",html),property.removeHandler(handler)},property.addHandler(handler)),this.html},set:function(key,html){return this.destroyBindings(),this.destroySubviews(),this.html=html,this.node&&null!=html&&this.loadView(this.node),this.bindImmediately?this.initializeBindings():void 0}}),View.accessor("node",{get:function(){var node;return null!=this.node||this.isDead||(node=this.loadView(),node&&this.set("node",node),this.fireAndCall("viewDidLoad")),this.node},set:function(key,node,oldNode){var _this=this;return oldNode&&Batman.removeData(oldNode,"view",!0),node!==this.node&&(this.destroyBindings(),this.destroySubviews(),this.node=node,node)?(Batman._data(node,"view",this),Batman.developer["do"](function(){var extraInfo,_base;return extraInfo=_this.get("displayName")||_this.get("source"),"function"==typeof(_base=node===document?document.body:node).setAttribute?_base.setAttribute("batman-view",_this.constructor.name+(extraInfo?": "+extraInfo:"")):void 0}),node):void 0}}),View.prototype.event("ready").oneShot=!0,View.prototype.initializeBindings=function(){return!this.isBound&&this.node?(new Batman.BindingParser(this),this.set("isBound",!0),this.fireAndCall("ready")):void 0},View.prototype.destroyBindings=function(){var binding,_i,_len,_ref;for(_ref=this.bindings,_i=0,_len=_ref.length;_len>_i;_i++)binding=_ref[_i],binding.die();return this.bindings=[],this.isBound=!1},View.prototype.destroySubviews=function(){var subview,_i,_len,_ref;if(this.isDead)return void Batman.developer.warn("Tried to destroy the subviews of a dead view.");for(_ref=this.subviews.toArray(),_i=0,_len=_ref.length;_len>_i;_i++)subview=_ref[_i],subview.die();return this.subviews.clear()},View.prototype.die=function(){var event,_,_ref,_ref1;if(this.isDead)return void Batman.developer.warn("Tried to die() a view more than once.");if(this.fireAndCall("destroy"),this.destroyBindings(),this.destroySubviews(),this.node&&(this.wasInDOM=Batman.DOM.containsNode(this.node),Batman.DOM.destroyNode(this.node)),this.removeFromSuperview(),this.forget(),null!=(_ref=this._batman.properties)&&_ref.forEach(function(key,property){return property.die()}),this._batman.events){_ref1=this._batman.events;for(_ in _ref1)event=_ref1[_],event.clearHandlers()}return this.node=null,this.parentNode=null,this.subviews=null,this.isDead=!0},View.prototype.baseForKeypath=function(keypath){return keypath.split(".")[0].split("|")[0].trim()},View.prototype.prefixForKeypath=function(keypath){var index;return index=keypath.lastIndexOf("."),-1!==index?keypath.substr(0,index):keypath},View.prototype.targetForKeypath=function(keypath,forceTarget){var controller,lookupNode,nearestNonBackingView,target;for(lookupNode=this;lookupNode;){if(target=this._testTargetForKeypath(lookupNode,keypath))return target;if(!forceTarget||nearestNonBackingView||lookupNode.isBackingView||(nearestNonBackingView=Batman.get(lookupNode,"proxiedObject")||lookupNode),!controller&&lookupNode.isView&&lookupNode.controller&&(controller=lookupNode.controller),lookupNode.isView&&lookupNode.superview)lookupNode=lookupNode.superview;else if(controller)lookupNode=controller,controller=null;else{if(lookupNode.window)break;lookupNode=Batman.currentApp&&lookupNode!==Batman.currentApp?Batman.currentApp:{window:Batman.container}}}return nearestNonBackingView},View.prototype._testTargetForKeypath=function(object,keypath){var proxiedObject;return(proxiedObject=Batman.get(object,"proxiedObject"))&&"undefined"!=typeof Batman.get(proxiedObject,keypath)?proxiedObject:"undefined"!=typeof Batman.get(object,keypath)?object:void 0},View.prototype.lookupKeypath=function(keypath){var base,target;return base=this.baseForKeypath(keypath),target=this.targetForKeypath(base),target?Batman.get(target,keypath):void 0},View.prototype.setKeypath=function(keypath,value){var prefix,target,_ref;return prefix=this.prefixForKeypath(keypath),target=this.targetForKeypath(prefix,!0),target&&target!==Batman.container&&null!=(_ref=Batman.Property.forBaseAndKey(target,keypath))?_ref.setValue(value):void 0},View.prototype.fireAndCall=function(key){return this.fire(key),"function"==typeof this[key]?this[key]():void 0},View}(Batman.Object),null==(_base=Batman.container).$context&&(_base.$context=function(node){for(var view;node;){if(view=Batman._data(node,"backingView")||Batman._data(node,"view"))return view;node=node.parentNode}}),null==(_base1=Batman.container).$subviews&&(_base1.$subviews=function(view){var subviews;return null==view&&(view=Batman.currentApp.layout),subviews=[],view.subviews.forEach(function(subview){var obj,_ref;return obj=Batman.mixin({},subview),obj.constructor=subview.constructor,obj.subviews=(null!=(_ref=subview.subviews)?_ref.length:void 0)?$subviews(subview):null,Batman.unmixin(obj,{_batman:!0}),subviews.push(obj)}),subviews})}.call(this),function(){var _ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.AbstractBinding=function(_super){function AbstractBinding(definition){this._fireDataChange=__bind(this._fireDataChange,this);var viewClass;this.node=definition.node,this.keyPath=definition.keyPath,this.view=definition.view,definition.onlyObserve&&(this.onlyObserve=definition.onlyObserve),null!=definition.skipParseFilter&&(this.skipParseFilter=definition.skipParseFilter),this.skipParseFilter||this.parseFilter(),"function"==typeof this.backWithView&&(viewClass=this.backWithView),this.backWithView&&this.setupBackingView(viewClass,definition.viewOptions),this.bindImmediately&&this.bind()}var get_dot_rx,get_rx,keypath_rx,onlyAll,onlyData,onlyNode;return __extends(AbstractBinding,_super),keypath_rx=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|(([0-9\_\-]+[a-zA-Z\_\-]|[a-zA-Z])[\w\-\.\?\!\+]*))\s*(?=$|,)/g,get_dot_rx=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,get_rx=/(?!^\s*)\[(.*?)\]/g,AbstractBinding.accessor("filteredValue",{get:function(){var result,self,unfilteredValue;return unfilteredValue=this.get("unfilteredValue"),self=this,this.filterFunctions.length>0?result=this.filterFunctions.reduce(function(value,fn,i){var args;for(args=self.filterArguments[i].map(function(argument){return argument._keypath?self.view.lookupKeypath(argument._keypath):argument}),args.unshift(value);args.length<fn.length-1;)args.push(void 0);return args.push(self),fn.apply(self.view,args)},unfilteredValue):unfilteredValue},set:function(_,newValue){return this.set("unfilteredValue",newValue)}}),AbstractBinding.accessor("unfilteredValue",{get:function(){return this._unfilteredValue(this.get("key"))},set:function(_,value){var k;return(k=this.get("key"))?this.view.setKeypath(k,value):this.set("value",value)}}),AbstractBinding.prototype._unfilteredValue=function(key){return key?this.view.lookupKeypath(key):this.get("value")},onlyAll=Batman.BindingDefinitionOnlyObserve.All,onlyData=Batman.BindingDefinitionOnlyObserve.Data,onlyNode=Batman.BindingDefinitionOnlyObserve.Node,AbstractBinding.prototype.bindImmediately=!0,AbstractBinding.prototype.shouldSet=!0,AbstractBinding.prototype.isInputBinding=!1,AbstractBinding.prototype.escapeValue=!0,AbstractBinding.prototype.onlyObserve=onlyAll,AbstractBinding.prototype.skipParseFilter=!1,AbstractBinding.prototype.isTwoWay=function(){return null!=this.key&&0===this.filterFunctions.length},AbstractBinding.prototype.bind=function(){var _ref,_ref1;return this.node&&((_ref=this.onlyObserve)===onlyAll||_ref===onlyNode)&&Batman.DOM.nodeIsEditable(this.node)&&(Batman.DOM.events.change(this.node,this._fireNodeChange.bind(this)),this.onlyObserve===onlyNode&&this._fireNodeChange()),((_ref1=this.onlyObserve)===onlyAll||_ref1===onlyData)&&this.observeAndFire("filteredValue",this._fireDataChange),this.view._addChildBinding(this)},AbstractBinding.prototype._fireNodeChange=function(event){var val;return this.shouldSet=!1,val=this.value||this.get("keyContext"),"function"==typeof this.nodeChange&&this.nodeChange(this.node,val,event),this.fire("nodeChange",this.node,val),this.shouldSet=!0},AbstractBinding.prototype._fireDataChange=function(value){return this.shouldSet?("function"==typeof this.dataChange&&this.dataChange(value,this.node),this.fire("dataChange",value,this.node)):void 0},AbstractBinding.prototype.die=function(){var _ref;return this.forget(),null!=(_ref=this._batman.properties)&&_ref.forEach(function(key,property){return property.die()}),this.node=null,this.keyPath=null,this.view=null,this.backingView=null,this.superview=null
},AbstractBinding.prototype.parseFilter=function(){var args,e,filter,filterName,filterString,filters,key,keyPath,orig,split,_ref,_ref1;for(this.filterFunctions=[],this.filterArguments=[],keyPath=this.keyPath;get_dot_rx.test(keyPath);)keyPath=keyPath.replace(get_dot_rx,"]['$1']");filters=keyPath.replace(get_rx," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{key=this.parseSegment(orig=filters.shift())[0]}catch(_error){e=_error,Batman.developer.warn(e),Batman.developer.error("Error! Couldn't parse keypath in \""+orig+'". Parsing error above.')}if(key&&key._keypath?this.key=key._keypath:this.value=key,filters.length){for(;filterString=filters.shift();){if(split=filterString.indexOf(" "),-1===split&&(split=filterString.length),filterName=filterString.substr(0,split),args=filterString.substr(split),!(filter=(null!=(_ref=this.view)&&null!=(_ref1=_ref._batman.get("filters"))?_ref1[filterName]:void 0)||Batman.Filters[filterName]))return Batman.developer.error("Unrecognized filter '"+filterName+"' in key \""+this.keyPath+'"!');this.filterFunctions.push(filter);try{this.filterArguments.push(this.parseSegment(args))}catch(_error){e=_error,Batman.developer.error('Bad filter arguments "'+args+'"!')}}return!0}},AbstractBinding.prototype.parseSegment=function(segment){return segment=segment.replace(keypath_rx,function(match,start,bool,string,object,keypath){var replacement;return null==start&&(start=""),replacement=keypath?'{"_keypath": "'+keypath+'"}':bool||string||object,start+replacement}),JSON.parse("["+segment+"]")},AbstractBinding.prototype.setupBackingView=function(viewClass,viewOptions){return this.backingView?this.backingView:this.node&&(this.backingView=Batman._data(this.node,"view"))?this.backingView:(this.superview=this.view,viewOptions||(viewOptions={}),null==viewOptions.node&&(viewOptions.node=this.node),null==viewOptions.parentNode&&(viewOptions.parentNode=this.node),viewOptions.isBackingView=!0,this.backingView=new(viewClass||Batman.BackingView)(viewOptions),this.superview.subviews.add(this.backingView),this.node&&Batman._data(this.node,"view",this.backingView),this.backingView)},AbstractBinding}(Batman.Object),Batman.BackingView=function(_super){function BackingView(){return _ref=BackingView.__super__.constructor.apply(this,arguments)}return __extends(BackingView,_super),BackingView.prototype.isBackingView=!0,BackingView.prototype.bindImmediately=!1,BackingView}(Batman.View)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.ViewBinding=function(_super){function ViewBinding(definition){this.superview=definition.view,ViewBinding.__super__.constructor.apply(this,arguments)}return __extends(ViewBinding,_super),ViewBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,ViewBinding.prototype.skipChildren=!0,ViewBinding.prototype.bindImmediately=!1,ViewBinding.prototype.initialized=function(){return this.bind()},ViewBinding.prototype.dataChange=function(viewClassOrInstance){var attributeName,definition,keyPath,option,options,_i,_len,_ref;if(null!=(_ref=this.viewInstance)&&_ref.removeFromSuperview(),viewClassOrInstance){if(viewClassOrInstance.isView?(this.fromViewClass=!1,this.viewInstance=viewClassOrInstance,this.viewInstance.removeFromSuperview()):(this.fromViewClass=!0,this.viewInstance=new viewClassOrInstance),this.node.removeAttribute("data-view"),options=this.viewInstance.constructor._batman.get("options"))for(_i=0,_len=options.length;_len>_i;_i++)option=options[_i],attributeName="data-view-"+option.toLowerCase(),(keyPath=this.node.getAttribute(attributeName))&&(this.node.removeAttribute(attributeName),definition=new Batman.DOM.ReaderBindingDefinition(this.node,keyPath,this.superview),new Batman.DOM.ViewArgumentBinding(definition,option,this.viewInstance));return this.viewInstance.set("parentNode",this.node),this.viewInstance.set("node",this.node),this.viewInstance.loadView(this.node),this.superview.subviews.add(this.viewInstance)}},ViewBinding.prototype.die=function(){return this.fromViewClass?this.viewInstance.die():this.viewInstance.removeFromSuperview(),this.superview=null,this.viewInstance=null,ViewBinding.__super__.die.apply(this,arguments)},ViewBinding}(Batman.DOM.AbstractBinding),Batman.DOM.ViewArgumentBinding=function(_super){function ViewArgumentBinding(definition,option,targetView){var _this=this;this.option=option,this.targetView=targetView,ViewArgumentBinding.__super__.constructor.call(this,definition),this.targetView.observe(this.option,this._updateValue=function(value){return _this.isDataChanging?void 0:_this.view.setKeypath(_this.keyPath,value)})}return __extends(ViewArgumentBinding,_super),ViewArgumentBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,ViewArgumentBinding.prototype.dataChange=function(value){return this.isDataChanging=!0,this.targetView.set(this.option,value),this.isDataChanging=!1},ViewArgumentBinding.prototype.die=function(){return this.targetView.forget(this.option,this._updateValue),this.targetView=null,ViewArgumentBinding.__super__.die.apply(this,arguments)},ViewArgumentBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.ValueBinding=function(_super){function ValueBinding(definition){var _ref;this.isInputBinding="input"===(_ref=definition.node.nodeName.toLowerCase())||"textarea"===_ref,ValueBinding.__super__.constructor.apply(this,arguments)}return __extends(ValueBinding,_super),ValueBinding.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.node.value):void 0},ValueBinding.prototype.dataChange=function(value){return Batman.DOM.valueForNode(this.node,value,this.escapeValue)},ValueBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.ShowHideBinding=function(_super){function ShowHideBinding(definition){var display;display=definition.node.style.display,display&&"none"!==display||(display=""),this.originalDisplay=display,this.invert=definition.invert,ShowHideBinding.__super__.constructor.apply(this,arguments)}return __extends(ShowHideBinding,_super),ShowHideBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,ShowHideBinding.prototype.dataChange=function(value){var view;return view=Batman.View.viewForNode(this.node,!1),!!value==!this.invert?(null!=view&&view.fireAndCall("viewWillShow"),this.node.style.display=this.originalDisplay,null!=view?view.fireAndCall("viewDidShow"):void 0):(null!=view&&view.fireAndCall("viewWillHide"),Batman.DOM.setStyleProperty(this.node,"display","none","important"),null!=view?view.fireAndCall("viewDidHide"):void 0)},ShowHideBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Batman.SelectView=function(_super){function SelectView(){return _ref=SelectView.__super__.constructor.apply(this,arguments)}return __extends(SelectView,_super),SelectView.prototype._addChildBinding=function(binding){return SelectView.__super__._addChildBinding.apply(this,arguments),this.fire("childBindingAdded",binding)},SelectView}(Batman.BackingView),Batman.DOM.SelectBinding=function(_super){function SelectBinding(){this.updateOptionBindings=__bind(this.updateOptionBindings,this),this.nodeChange=__bind(this.nodeChange,this),this.dataChange=__bind(this.dataChange,this),this.childBindingAdded=__bind(this.childBindingAdded,this),SelectBinding.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-bind"),this.node.removeAttribute("data-source"),this.node.removeAttribute("data-target"),this.backingView.on("childBindingAdded",this.childBindingAdded),this.backingView.initializeBindings()}return __extends(SelectBinding,_super),SelectBinding.prototype.backWithView=Batman.SelectView,SelectBinding.prototype.isInputBinding=!0,SelectBinding.prototype.canSetImplicitly=!0,SelectBinding.prototype.skipChildren=!0,SelectBinding.prototype.die=function(){return this.backingView.off("childBindingAdded",this.childBindingAdded),SelectBinding.__super__.die.apply(this,arguments)},SelectBinding.prototype.childBindingAdded=function(binding){var _this=this;if(binding instanceof Batman.DOM.CheckedBinding)binding.on("dataChange",this.nodeChange);else{if(!(binding instanceof Batman.DOM.IteratorBinding))return;binding.backingView.on("itemsWereRendered",function(){return _this._fireDataChange(_this.get("filteredValue"))})}return this._fireDataChange(this.get("filteredValue"))},SelectBinding.prototype.lastKeyContext=null,SelectBinding.prototype.dataChange=function(newValue){var child,matches,valueToChild,_i,_len,_name,_ref1;if(this.lastKeyContext||(this.lastKeyContext=this.get("keyContext")),this.lastKeyContext!==this.get("keyContext")&&(this.canSetImplicitly=!0,this.lastKeyContext=this.get("keyContext")),null!=newValue?newValue.forEach:void 0){for(valueToChild={},_ref1=this.node.children,_i=0,_len=_ref1.length;_len>_i;_i++)child=_ref1[_i],child.selected=!1,matches=valueToChild[_name=child.value]||(valueToChild[_name]=[]),matches.push(child);newValue.forEach(function(value){var children,node,_j,_len1;if(children=valueToChild[value])for(_j=0,_len1=children.length;_len1>_j;_j++)node=children[_j],node.selected=!0})}else null==newValue&&this.canSetImplicitly?this.node.value&&(this.canSetImplicitly=!1,this.set("unfilteredValue",this.node.value)):(this.canSetImplicitly=!1,Batman.DOM.valueForNode(this.node,newValue,this.escapeValue));this.updateOptionBindings(),this.fixSelectElementWidth()},SelectBinding.prototype.nodeChange=function(){var selections;this.isTwoWay()&&(selections=Batman.DOM.valueForNode(this.node),typeof selections===Array&&1===selections.length&&(selections=selections[0]),this.set("unfilteredValue",selections),this.updateOptionBindings())},SelectBinding.prototype.updateOptionBindings=function(){var binding,_i,_len,_ref1;for(_ref1=this.backingView.bindings,_i=0,_len=_ref1.length;_len>_i;_i++)binding=_ref1[_i],binding instanceof Batman.DOM.CheckedBinding&&binding._fireNodeChange()},SelectBinding.prototype.fixSelectElementWidth=function(){var _this=this;if(-1!==window.navigator.userAgent.toLowerCase().indexOf("msie"))return this._fixWidthTimeout&&clearTimeout(this._fixWidthTimeout),this._fixWidthTimeout=setTimeout(function(){return _this._fixWidthTimeout=null,_this._fixSelectElementWidth()},100)},SelectBinding.prototype._fixSelectElementWidth=function(){var previousWidth,style,_ref1;return(style=null!=(_ref1=this.get("node"))?_ref1.style:void 0)?(previousWidth=this.get("node").currentStyle.width,style.width="100%",style.width=null!=previousWidth?previousWidth:""):void 0},SelectBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.RouteBinding=function(_super){function RouteBinding(){this.routeClick=__bind(this.routeClick,this);var definition,paramKeypath;RouteBinding.__super__.constructor.apply(this,arguments),(paramKeypath=this.node.getAttribute("data-route-params"))&&(definition=new Batman.DOM.ReaderBindingDefinition(this.node,paramKeypath,this.view),this.set("queryParams",new Batman.DOM.RouteParamsBinding(definition,this)))}return __extends(RouteBinding,_super),RouteBinding.prototype.onAnchorTag=!1,RouteBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,RouteBinding.accessor("dispatcher",function(){return this.view.lookupKeypath("dispatcher")||Batman.App.get("current.dispatcher")}),RouteBinding.prototype.bind=function(){var _ref;return("a"===(_ref=this.node.nodeName)||"A"===_ref)&&(this.onAnchorTag=!0),RouteBinding.__super__.bind.apply(this,arguments),this.onAnchorTag&&this.node.getAttribute("target")?void 0:Batman.DOM.events.primaryInteractionEvent(this.node,this.routeClick)},RouteBinding.prototype.routeClick=function(node,event){var path;if(!event.__batmanActionTaken)return event.__batmanActionTaken=!0,path=this.generatePath(this.get("filteredValue"),this.get("queryParams.filteredValue")),null!=path?Batman.redirect(path):void 0},RouteBinding.prototype.dataChange=function(value,node,queryParams){var path;return value&&(path=this.generatePath(value,queryParams||this.get("queryParams.filteredValue"))),this.onAnchorTag?(path=path&&Batman.navigator?Batman.navigator.linkTo(path):"#",this.node.href=path):void 0},RouteBinding.prototype.generatePath=function(value,params){var path,uri,_ref;return path=(null!=value?value.isNamedRouteQuery:void 0)?value.get("path"):null!=(_ref=this.get("dispatcher"))?_ref.pathFromParams(value):void 0,params&&path?("Object"===Batman.typeOf(params)?null!=params.toObject&&(params=params.toObject()):params=Batman.URI.paramsFromQuery(params),uri=new Batman.URI(path),uri.queryParams=params,uri.toString()):path},RouteBinding}(Batman.DOM.AbstractBinding),Batman.DOM.RouteParamsBinding=function(_super){function RouteParamsBinding(definition,routeBinding){this.routeBinding=routeBinding,RouteParamsBinding.__super__.constructor.call(this,definition)}return __extends(RouteParamsBinding,_super),RouteParamsBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,RouteParamsBinding.prototype.dataChange=function(value){return this.routeBinding.dataChange(this.routeBinding.get("filteredValue"),this.node,value)},RouteParamsBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.RadioBinding=function(_super){function RadioBinding(){return _ref=RadioBinding.__super__.constructor.apply(this,arguments)}return __extends(RadioBinding,_super),RadioBinding.accessor("parsedNodeValue",function(){return Batman.DOM.attrReaders._parseAttribute(this.node.value)}),RadioBinding.prototype.firstBind=!0,RadioBinding.prototype.dataChange=function(){var boundValue;return boundValue=this.get("filteredValue"),null!=boundValue?this.node.checked=boundValue===Batman.DOM.attrReaders._parseAttribute(this.node.value):this.firstBind&&this.node.checked&&this.set("filteredValue",this.get("parsedNodeValue")),this.firstBind=!1},RadioBinding.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.get("parsedNodeValue")):void 0},RadioBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.FileBinding=function(_super){function FileBinding(){FileBinding.__super__.constructor.apply(this,arguments),this.view.set("fileAttributes",null)}return __extends(FileBinding,_super),FileBinding.prototype.isInputBinding=!0,FileBinding.prototype.nodeChange=function(node){return this.isTwoWay()?node.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(node.files)):this.set("filteredValue",node.files[0]||null):void 0},FileBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DeferredRenderView=function(_super){function DeferredRenderView(){return _ref=DeferredRenderView.__super__.constructor.apply(this,arguments)}return __extends(DeferredRenderView,_super),DeferredRenderView.prototype.bindImmediately=!1,DeferredRenderView}(Batman.View),Batman.DOM.DeferredRenderBinding=function(_super){function DeferredRenderBinding(definition){this.invert=definition.invert,this.attributeName=this.invert?"data-deferif":"data-renderif",DeferredRenderBinding.__super__.constructor.apply(this,arguments)}return __extends(DeferredRenderBinding,_super),DeferredRenderBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,DeferredRenderBinding.prototype.backWithView=Batman.DeferredRenderView,DeferredRenderBinding.prototype.skipChildren=!0,DeferredRenderBinding.prototype.dataChange=function(value){return!!value!=!this.invert||this.backingView.isBound?void 0:(this.node.removeAttribute(this.attributeName),this.backingView.initializeBindings())},DeferredRenderBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.developer["do"](function(){var DebuggerBinding;return DebuggerBinding=function(_super){function DebuggerBinding(){DebuggerBinding.__super__.constructor.apply(this,arguments)}return __extends(DebuggerBinding,_super),DebuggerBinding}(Batman.DOM.AbstractBinding),Batman.DOM.readers.debug=function(definition){return new DebuggerBinding(definition)}})}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.AbstractAttributeBinding=function(_super){function AbstractAttributeBinding(definition){this.attributeName=definition.attr,AbstractAttributeBinding.__super__.constructor.apply(this,arguments)}return __extends(AbstractAttributeBinding,_super),AbstractAttributeBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.Tracking={loadTracker:function(){return Batman.Tracking.tracker?Batman.Tracking.tracker:(Batman.Tracking.tracker=Batman.currentApp.EventTracker?new Batman.currentApp.EventTracker:(Batman.developer.warn("Define "+Batman.currentApp.name+".EventTracker to use data-track"),{track:function(){}}),Batman.Tracking.tracker)},trackEvent:function(type,data,node){return Batman.Tracking.loadTracker().track(type,data,node)}},Batman.DOM.ClickTrackingBinding=function(_super){function ClickTrackingBinding(){var callback,_this=this;ClickTrackingBinding.__super__.constructor.apply(this,arguments),callback=function(){return Batman.Tracking.trackEvent("click",_this.get("filteredValue"),_this.node)},Batman.DOM.events.click(this.node,callback,this.view,"click",!1),this.bind()}return __extends(ClickTrackingBinding,_super),ClickTrackingBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,ClickTrackingBinding.prototype.bindImmediately=!1,ClickTrackingBinding}(Batman.DOM.AbstractAttributeBinding),Batman.DOM.ViewTrackingBinding=function(_super){function ViewTrackingBinding(){ViewTrackingBinding.__super__.constructor.apply(this,arguments),Batman.Tracking.trackEvent("view",this.get("filteredValue"),this.node)}return __extends(ViewTrackingBinding,_super),ViewTrackingBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,ViewTrackingBinding}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.EventBinding=function(_super){function EventBinding(){var attacher,callback,_this=this;EventBinding.__super__.constructor.apply(this,arguments),callback=function(){var func,target;return func=_this.get("filteredValue"),target=_this.view.targetForKeypath(_this.functionPath||_this.unfilteredKey),target&&_this.functionPath&&(target=Batman.get(target,_this.functionPath)),null!=func?func.apply(target,arguments):void 0},(attacher=Batman.DOM.events[this.attributeName])?attacher(this.node,callback,this.view):Batman.DOM.events.other(this.node,this.attributeName,callback,this.view),this.bind()}return __extends(EventBinding,_super),EventBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,EventBinding.prototype.bindImmediately=!1,EventBinding.prototype._unfilteredValue=function(key){var index,value;return this.unfilteredKey=key,this.functionName||-1===(index=key.lastIndexOf("."))||(this.functionPath=key.substr(0,index),this.functionName=key.substr(index+1)),value=EventBinding.__super__._unfilteredValue.call(this,this.functionPath||key),this.functionName?null!=value?value[this.functionName]:void 0:value},EventBinding}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.ContextBinding=function(_super){function ContextBinding(definition){var contextAttribute,_this=this;this.contextKeypath=definition.attr||"proxiedObject",ContextBinding.__super__.constructor.apply(this,arguments),contextAttribute=this.attributeName?"data-"+this.bindingName+"-"+this.attributeName:"data-"+this.bindingName,this.node.removeAttribute(contextAttribute),this.node.insertBefore(document.createComment("batman-"+contextAttribute+'="'+this.keyPath+'"'),this.node.firstChild),this.backingView.observe(this.contextKeypath,this._updateValue=function(value){return _this.isDataChanging?void 0:_this.view.setKeypath(_this.keyPath,value)})}return __extends(ContextBinding,_super),ContextBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,ContextBinding.prototype.backWithView=!0,ContextBinding.prototype.bindingName="context",ContextBinding.prototype.dataChange=function(proxiedObject){return this.isDataChanging=!0,this.backingView.set(this.contextKeypath,proxiedObject),this.isDataChanging=!1},ContextBinding.prototype.die=function(){return this.backingView.forget(this.contextKeypath,this._updateValue),this.backingView.unset(this.contextKeypath),ContextBinding.__super__.die.apply(this,arguments)},ContextBinding}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.FormBinding=function(_super){function FormBinding(){FormBinding.__super__.constructor.apply(this,arguments),this.initializeErrorsList(),this.initializeChildBindings(),Batman.DOM.events.submit(this.node,function(node,e){return Batman.DOM.preventDefault(e)})}return __extends(FormBinding,_super),FormBinding.prototype.bindingName="formfor",FormBinding.prototype.errorClass="error",FormBinding.prototype.defaultErrorsListSelector="div.errors",FormBinding.prototype.initializeChildBindings=function(){var attribute,attributeName,binding,errorsNode,field,index,keyPath,selectedNode,selectedNodes,selectors,_i,_len;for(keyPath=this.keyPath,attribute=this.attributeName,selectors=["input","textarea","select"].map(function(nodeName){return""+nodeName+'[data-bind^="'+attribute+'"]'}),selectedNodes=Batman.DOM.querySelectorAll(this.node,selectors.join(", ")),attributeName="data-addclass-"+this.errorClass,_i=0,_len=selectedNodes.length;_len>_i;_i++)selectedNode=selectedNodes[_i],selectedNode.getAttribute(attributeName)||(binding=selectedNode.getAttribute("data-bind"),field=binding.substr(binding.indexOf(attribute)+attribute.length+1),index=field.indexOf("|"),-1!==index&&(field=field.substr(0,index)),field=field.trim(),selectedNode.setAttribute(attributeName,""+attribute+".errors."+field+".length"));errorsNode=Batman.DOM.querySelector(this.node,".errors"),errorsNode&&!errorsNode.getAttribute("data-showif")&&errorsNode.setAttribute("data-showif",""+attribute+".errors.length")},FormBinding.prototype.initializeErrorsList=function(){var errorsNode,selector;return selector=this.node.getAttribute("data-errors-list")||this.defaultErrorsListSelector,(errorsNode=Batman.DOM.querySelector(this.node,selector))?Batman.DOM.setInnerHTML(errorsNode,this.errorsListHTML()):void 0},FormBinding.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.attributeName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'},FormBinding}(Batman.DOM.ContextBinding)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.NodeAttributeBinding=function(_super){function NodeAttributeBinding(){return _ref=NodeAttributeBinding.__super__.constructor.apply(this,arguments)}return __extends(NodeAttributeBinding,_super),NodeAttributeBinding.prototype.dataChange=function(value){return null==value&&(value=""),this.node[this.attributeName]=value},NodeAttributeBinding.prototype.nodeChange=function(node){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(node[this.attributeName])):void 0},NodeAttributeBinding}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.CheckedBinding=function(_super){function CheckedBinding(){return _ref=CheckedBinding.__super__.constructor.apply(this,arguments)}return __extends(CheckedBinding,_super),CheckedBinding.prototype.isInputBinding=!0,CheckedBinding.prototype.dataChange=function(value){return this.node[this.attributeName]=!!value},CheckedBinding}(Batman.DOM.NodeAttributeBinding)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.AttributeBinding=function(_super){function AttributeBinding(){return _ref=AttributeBinding.__super__.constructor.apply(this,arguments)}return __extends(AttributeBinding,_super),AttributeBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,AttributeBinding.prototype.dataChange=function(value){return this.node.setAttribute(this.attributeName,value)},AttributeBinding.prototype.nodeChange=function(node){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(node.getAttribute(this.attributeName))):void 0},AttributeBinding}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var redundantWhitespaceRegex,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};redundantWhitespaceRegex=/[ \t]{2,}/g,Batman.DOM.AddClassBinding=function(_super){function AddClassBinding(definition){var name;this.invert=definition.invert,this.classes=function(){var _i,_len,_ref,_results;for(_ref=definition.attr.split("|"),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)name=_ref[_i],_results.push({name:name,pattern:new RegExp("(?:^|\\s)"+name+"(?:$|\\s)","i")});return _results}(),AddClassBinding.__super__.constructor.apply(this,arguments)}return __extends(AddClassBinding,_super),AddClassBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,AddClassBinding.prototype.dataChange=function(value){var currentName,includesClassName,name,pattern,_i,_len,_ref,_ref1;for(currentName=this.node.className,_ref=this.classes,_i=0,_len=_ref.length;_len>_i;_i++)_ref1=_ref[_i],name=_ref1.name,pattern=_ref1.pattern,includesClassName=pattern.test(currentName),!!value==!this.invert?includesClassName||(currentName=""+currentName+" "+name):includesClassName&&(currentName=currentName.replace(pattern," "));return this.node.className=currentName.trim().replace(redundantWhitespaceRegex," "),!0},AddClassBinding}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.AbstractCollectionBinding=function(_super){function AbstractCollectionBinding(){return _ref=AbstractCollectionBinding.__super__.constructor.apply(this,arguments)}return __extends(AbstractCollectionBinding,_super),AbstractCollectionBinding.prototype.dataChange=function(collection){var items,_items;null!=collection?this.bindCollection(collection)||(items=(null!=collection?collection.forEach:void 0)?(_items=[],collection.forEach(function(item){return _items.push(item)}),_items):Object.keys(collection),this.handleArrayChanged(items)):(this.unbindCollection(),this.collection=[],this.handleArrayChanged([]))},AbstractCollectionBinding.prototype.bindCollection=function(newCollection){var _ref1;return newCollection instanceof Batman.Hash&&(newCollection=newCollection.meta),newCollection===this.collection?!0:(this.unbindCollection(),this.collection=newCollection,(null!=(_ref1=this.collection)?_ref1.isObservable:void 0)?(this.collection.isCollectionEventEmitter&&this.handleItemsAdded&&this.handleItemsRemoved&&this.handleItemMoved?(this.collection.on("itemsWereAdded",this.handleItemsAdded),this.collection.on("itemsWereRemoved",this.handleItemsRemoved),this.collection.on("itemWasMoved",this.handleItemMoved),this.handleArrayChanged(this.collection.toArray())):this.collection.observeAndFire("toArray",this.handleArrayChanged),!0):!1)},AbstractCollectionBinding.prototype.unbindCollection=function(){var _ref1;if(null!=(_ref1=this.collection)?_ref1.isObservable:void 0)return this.collection.isCollectionEventEmitter&&this.handleItemsAdded&&this.handleItemsRemoved&&this.handleItemMoved?(this.collection.off("itemsWereAdded",this.handleItemsAdded),this.collection.off("itemsWereRemoved",this.handleItemsRemoved),this.collection.off("itemWasMoved",this.handleItemMoved)):this.collection.forget("toArray",this.handleArrayChanged)},AbstractCollectionBinding.prototype.handleArrayChanged=function(){},AbstractCollectionBinding.prototype.die=function(){return this.unbindCollection(),this.collection=null,AbstractCollectionBinding.__super__.die.apply(this,arguments)},AbstractCollectionBinding}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)
}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Batman.DOM.StyleBinding=function(_super){function StyleBinding(){this.setStyle=__bind(this.setStyle,this),this.handleArrayChanged=__bind(this.handleArrayChanged,this),this.oldStyles={},this.styleBindings={},StyleBinding.__super__.constructor.apply(this,arguments)}return __extends(StyleBinding,_super),StyleBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,StyleBinding.prototype.dataChange=function(value){var colonSplitCSSValues,cssName,key,style,_i,_len,_ref,_ref1;if(!value)return void this.resetStyles();if(this.unbindCollection(),"string"!=typeof value)if(value instanceof Batman.Hash)this.bindCollection(value);else{value instanceof Batman.Object&&(value=value.toJSON()),this.resetStyles();for(key in value)__hasProp.call(value,key)&&this.bindSingleAttribute(key,""+this.keyPath+"."+key)}else for(this.resetStyles(),_ref=value.split(";"),_i=0,_len=_ref.length;_len>_i;_i++)style=_ref[_i],_ref1=style.split(":"),cssName=_ref1[0],colonSplitCSSValues=2<=_ref1.length?__slice.call(_ref1,1):[],this.setStyle(cssName,colonSplitCSSValues.join(":"))},StyleBinding.prototype.handleArrayChanged=function(){var _this=this;return this.collection.forEach(function(key){return _this.bindSingleAttribute(key,""+_this.keyPath+"."+key)})},StyleBinding.prototype.bindSingleAttribute=function(attr,keyPath){var definition;return definition=new Batman.DOM.AttrReaderBindingDefinition(this.node,attr,keyPath,this.view),this.styleBindings[attr]=new Batman.DOM.StyleBinding.SingleStyleBinding(definition,this)},StyleBinding.prototype.setStyle=function(key,value){return key=Batman.helpers.camelize(key.trim(),!0),""===key?!1:(null==this.oldStyles[key]&&(this.oldStyles[key]=this.node.style[key]||""),(null!=value?value.trim:void 0)&&(value=value.trim()),null==value&&(value=""),this.node.style[key]=value)},StyleBinding.prototype.resetStyles=function(){var cssName,cssValue,_ref;_ref=this.oldStyles;for(cssName in _ref)__hasProp.call(_ref,cssName)&&(cssValue=_ref[cssName],this.setStyle(cssName,cssValue))},StyleBinding.prototype.resetBindings=function(){var attribute,binding,_ref;_ref=this.styleBindings;for(attribute in _ref)binding=_ref[attribute],binding._fireDataChange(""),binding.die();return this.styleBindings={}},StyleBinding.prototype.unbindCollection=function(){return this.resetBindings(),StyleBinding.__super__.unbindCollection.apply(this,arguments)},StyleBinding.SingleStyleBinding=function(_super1){function SingleStyleBinding(definition,parent){this.parent=parent,SingleStyleBinding.__super__.constructor.call(this,definition)}return __extends(SingleStyleBinding,_super1),SingleStyleBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,SingleStyleBinding.prototype.isTwoWay=function(){return!1},SingleStyleBinding.prototype.dataChange=function(value){return this.parent.setStyle(this.attributeName,value)},SingleStyleBinding}(Batman.DOM.AbstractAttributeBinding),StyleBinding}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.ClassBinding=function(_super){function ClassBinding(){this.handleArrayChanged=__bind(this.handleArrayChanged,this),this.existingClasses=arguments[0].node.className.split(" "),ClassBinding.__super__.constructor.apply(this,arguments)}return __extends(ClassBinding,_super),ClassBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,ClassBinding.prototype.dataChange=function(value){var newClasses;return null!=value?(this.unbindCollection(),"string"==typeof value?(newClasses=[value].concat(this.existingClasses),this.node.className=newClasses.join(" ").trim()):(this.bindCollection(value),this.updateFromCollection())):void 0},ClassBinding.prototype.updateFromCollection=function(){var array,existingClasses,k,newClasses,v;return this.collection?(array=this.collection.map?this.collection.map(function(x){return x}):function(){var _ref,_results;_ref=this.collection,_results=[];for(k in _ref)__hasProp.call(_ref,k)&&(v=_ref[k],_results.push(k));return _results}.call(this),null!=array.toArray&&(array=array.toArray()),existingClasses=this.existingClasses.slice(0),newClasses=array.filter(function(val){return-1===existingClasses.indexOf(val)}),this.node.className=existingClasses.concat(newClasses).join(" ").trim()):void 0},ClassBinding.prototype.handleArrayChanged=function(){return this.updateFromCollection()},ClassBinding}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.InsertionBinding=function(_super){function InsertionBinding(definition){this.invert=definition.invert,InsertionBinding.__super__.constructor.apply(this,arguments),this.placeholderNode=document.createComment('batman-insertif="'+this.keyPath+'"')}return __extends(InsertionBinding,_super),InsertionBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,InsertionBinding.prototype.bindImmediately=!1,InsertionBinding.prototype.initialized=function(){return this.bind()},InsertionBinding.prototype.dataChange=function(value){var parentNode,view;return view=Batman.View.viewForNode(this.node,!1),parentNode=this.placeholderNode.parentNode||this.node.parentNode,!!value==!this.invert?(null!=view&&view.fireAndCall("viewWillShow"),null==this.node.parentNode&&(parentNode.insertBefore(this.node,this.placeholderNode),parentNode.removeChild(this.placeholderNode)),null!=view?view.fireAndCall("viewDidShow"):void 0):(null!=view&&view.fireAndCall("viewWillHide"),null!=this.node.parentNode&&(parentNode.insertBefore(this.placeholderNode,this.node),parentNode.removeChild(this.node)),null!=view?view.fireAndCall("viewDidHide"):void 0)},InsertionBinding.prototype.die=function(){return this.placeholderNode=null,InsertionBinding.__super__.die.apply(this,arguments)},InsertionBinding}(Batman.DOM.AbstractBinding)}.call(this),function(){var _ref,_ref1,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.IteratorView=function(_super){function IteratorView(){return _ref=IteratorView.__super__.constructor.apply(this,arguments)}return __extends(IteratorView,_super),IteratorView.prototype.loadView=function(){return document.createComment("batman-iterator-"+this.iteratorName+'="'+this.iteratorPath+'"')},IteratorView.prototype.addItems=function(items,indexes){var i,item,_i,_j,_len,_len1;if(this._beginAppendItems(),indexes)for(i=_i=0,_len=items.length;_len>_i;i=++_i)item=items[i],this._insertItem(item,indexes[i]);else for(_j=0,_len1=items.length;_len1>_j;_j++)item=items[_j],this._insertItem(item);return this._finishAppendItems()},IteratorView.prototype.removeItems=function(items,indexes){var i,item,subview,_i,_j,_len,_len1,_results,_results1;if(indexes){for(_results=[],i=_i=0,_len=items.length;_len>_i;i=++_i)item=items[i],_results.push(this.subviews.at(indexes[i]).die());return _results}for(_results1=[],_j=0,_len1=items.length;_len1>_j;_j++)item=items[_j],_results1.push(function(){var _k,_len2,_ref1,_results2;for(_ref1=this.subviews._storage,_results2=[],_k=0,_len2=_ref1.length;_len2>_k;_k++)if(subview=_ref1[_k],subview.get(this.attributeName)===item){subview.unset(this.attributeName),subview.die();break}return _results2}.call(this));return _results1},IteratorView.prototype.moveItem=function(oldIndex,newIndex){var source,target;return source=this.subviews.at(oldIndex),this.subviews._storage.splice(oldIndex,1),target=this.subviews.at(newIndex),this.subviews._storage.splice(newIndex,0,source),this.node.parentNode.insertBefore(source.node,(null!=target?target.node:void 0)||this.node)},IteratorView.prototype._beginAppendItems=function(){var viewClassName;return!this.iterationViewClass&&(viewClassName=this.prototypeNode.getAttribute("data-view"))&&(this.iterationViewClass=this.lookupKeypath(viewClassName),this.prototypeNode.removeAttribute("data-view")),this.iterationViewClass||(this.iterationViewClass=Batman.IterationView),this.fragment=document.createDocumentFragment(),this.appendedViews=[],this.get("node")},IteratorView.prototype._insertItem=function(item,targetIndex){var iterationView;return iterationView=new this.iterationViewClass({node:this.prototypeNode.cloneNode(!0),parentNode:this.fragment}),iterationView.set(this.iteratorName,item),null!=targetIndex?(iterationView._targeted=!0,this.subviews.insert([iterationView],[targetIndex])):this.subviews.add(iterationView),iterationView.parentNode=null,this.appendedViews.push(iterationView)},IteratorView.prototype._finishAppendItems=function(){var index,isInDOM,sibling,subview,_i,_j,_k,_len,_len1,_ref1,_ref2,_ref3,_ref4;if(isInDOM=Batman.DOM.containsNode(this.node))for(_ref1=this.appendedViews,_i=0,_len=_ref1.length;_len>_i;_i++)subview=_ref1[_i],subview.propagateToSubviews("viewWillAppear");for(_ref2=this.subviews.toArray(),index=_j=_ref2.length-1;_j>=0;index=_j+=-1)subview=_ref2[index],subview._targeted&&((sibling=null!=(_ref3=this.subviews.at(index+1))?_ref3.get("node"):void 0)?sibling.parentNode.insertBefore(subview.get("node"),sibling):this.fragment.appendChild(subview.get("node")),delete subview._targeted);if(this.node.parentNode.insertBefore(this.fragment,this.node),this.fire("itemsWereRendered"),isInDOM)for(_ref4=this.appendedViews,_k=0,_len1=_ref4.length;_len1>_k;_k++)subview=_ref4[_k],subview.propagateToSubviews("isInDOM",isInDOM),subview.propagateToSubviews("viewDidAppear");return this.appendedViews=null,this.fragment=null},IteratorView}(Batman.View),Batman.IterationView=function(_super){function IterationView(){return _ref1=IterationView.__super__.constructor.apply(this,arguments)}return __extends(IterationView,_super),IterationView}(Batman.View)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.IteratorBinding=function(_super){function IteratorBinding(definition){this.handleItemMoved=__bind(this.handleItemMoved,this),this.handleItemsRemoved=__bind(this.handleItemsRemoved,this),this.handleItemsAdded=__bind(this.handleItemsAdded,this),this.handleArrayChanged=__bind(this.handleArrayChanged,this);var _this=this;this.iteratorName=definition.attr,this.prototypeNode=definition.node,this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),definition.viewOptions={prototypeNode:this.prototypeNode,iteratorName:this.iteratorName,iteratorPath:definition.keyPath},definition.node=null,IteratorBinding.__super__.constructor.apply(this,arguments),this.backingView.set("attributeName",this.attributeName),this.view.prevent("ready"),this._handle=Batman.setImmediate(function(){var parentNode;return _this.backingView.isDead?void Batman.developer.warn("IteratorBinding (data-foreach-"+_this.iteratorName+"='"+_this.keyPath+"') trying to insert dead backing view into DOM ("+_this.view.constructor.name+")"):(parentNode=_this.prototypeNode.parentNode,parentNode.insertBefore(_this.backingView.get("node"),_this.prototypeNode),parentNode.removeChild(_this.prototypeNode),_this.bind(),_this.view.allowAndFire("ready"))})}return __extends(IteratorBinding,_super),IteratorBinding.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,IteratorBinding.prototype.backWithView=Batman.IteratorView,IteratorBinding.prototype.skipChildren=!0,IteratorBinding.prototype.bindImmediately=!1,IteratorBinding.prototype.handleArrayChanged=function(newItems){return!this.backingView.isDead&&(this.backingView.destroySubviews(),null!=newItems?newItems.length:void 0)?this.handleItemsAdded(newItems):void 0},IteratorBinding.prototype.handleItemsAdded=function(addedItems,addedIndexes){return this.backingView.isDead?void 0:this.backingView.addItems(addedItems,addedIndexes)},IteratorBinding.prototype.handleItemsRemoved=function(removedItems,removedIndexes){return this.backingView.isDead?void 0:this.collection.length?this.backingView.removeItems(removedItems,removedIndexes):this.backingView.destroySubviews()},IteratorBinding.prototype.handleItemMoved=function(item,newIndex,oldIndex){return this.backingView.isDead?void 0:this.backingView.moveItem(oldIndex,newIndex)},IteratorBinding.prototype.die=function(){return this._handle&&Batman.clearImmediate(this._handle),this.prototypeNode=null,IteratorBinding.__super__.die.apply(this,arguments)},IteratorBinding}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var _ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.StyleAttributeBinding=function(_super){function StyleAttributeBinding(){return _ref=StyleAttributeBinding.__super__.constructor.apply(this,arguments)}return __extends(StyleAttributeBinding,_super),StyleAttributeBinding.prototype.dataChange=function(value){return this.node.style[Batman.Filters.camelize(this.attributeName,!0)]=value},StyleAttributeBinding}(Batman.DOM.NodeAttributeBinding)}.call(this),function(){var isEmptyDataObject;isEmptyDataObject=function(obj){var name;for(name in obj)return!1;return!0},Batman.extend(Batman,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){var div,e;try{return div=document.createElement("div"),delete div.test}catch(_error){return e=_error,Batman.canDeleteExpando=!1}}(),noData:{embed:!0,EMBED:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",OBJECT:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0,APPLET:!0},hasData:function(elem){return elem=elem.nodeType?Batman.cache[elem[Batman.expando]]:elem[Batman.expando],!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data,pvt){var cache,getByName,id,internalKey,ret,thisCache;if(Batman.acceptData(elem)&&(internalKey=Batman.expando,getByName="string"==typeof name,cache=Batman.cache,id=elem[Batman.expando],!(!id||pvt&&id&&cache[id]&&!cache[id][internalKey])||!getByName||void 0!==data))return id||(3!==elem.nodeType?elem[Batman.expando]=id=++Batman.uuid:id=Batman.expando),cache[id]||(cache[id]={}),("object"==typeof name||"function"==typeof name)&&(pvt?cache[id][internalKey]=Batman.extend(cache[id][internalKey],name):cache[id]=Batman.extend(cache[id],name)),thisCache=cache[id],pvt&&(thisCache[internalKey]||(thisCache[internalKey]={}),thisCache=thisCache[internalKey]),void 0!==data&&(thisCache[name]=data),ret=getByName?thisCache[name]:thisCache},removeData:function(elem,name,pvt,all){var cache,id,internalCache,internalKey,isNode,thisCache;if(Batman.acceptData(elem)&&(internalKey=Batman.expando,isNode=elem.nodeType,cache=Batman.cache,id=elem[Batman.expando],cache[id]&&!(name&&(thisCache=pvt?cache[id][internalKey]:cache[id],thisCache&&(delete thisCache[name],!isEmptyDataObject(thisCache)))||pvt&&(delete cache[id][internalKey],!isEmptyDataObject(cache[id])))))return internalCache=cache[id][internalKey],Batman.canDeleteExpando||!cache.setInterval?delete cache[id]:cache[id]=null,internalCache&&!all?(cache[id]={},cache[id][internalKey]=internalCache):Batman.canDeleteExpando?delete elem[Batman.expando]:elem.removeAttribute?elem.removeAttribute(Batman.expando):elem[Batman.expando]=null},_data:function(elem,name,data){return Batman.data(elem,name,data,!0)},acceptData:function(elem){var match;if(elem)return elem.___acceptData||(elem.___acceptData=elem.nodeName?(match=Batman.noData[elem.nodeName],match?!(match===!0||elem.getAttribute("classid")!==match):!0):!0)}})}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Batman.DOM.Yield=function(_super){function Yield(name){this.name=name}return __extends(Yield,_super),Yield.yields={},Yield.reset=function(){return this.yields={}},Yield.withName=function(name){var _base;return(_base=this.yields)[name]||(_base[name]=new this(name))},Yield.accessor("contentView",{get:function(){return this.contentView},set:function(key,view){return this.contentView!==view?(this.contentView&&this.contentView.removeFromSuperview(),this.contentView=view,this.containerNode&&view?view.set("parentNode",this.containerNode):void 0):void 0}}),Yield.accessor("containerNode",{get:function(){return this.containerNode},set:function(key,node){return this.containerNode!==node?(this.containerNode=node,this.contentView?this.contentView.set("parentNode",node):void 0):void 0}}),Yield}(Batman.Object)}.call(this),function(){var buntUndefined,defaultAndOr,__slice=[].slice;buntUndefined=function(f){return function(value){return null==value?void 0:f.apply(this,arguments)}},defaultAndOr=function(lhs,rhs){return lhs||rhs},Batman.Filters={raw:buntUndefined(function(value,binding){return binding.escapeValue=!1,value}),get:buntUndefined(function(value,key){return null!=value.get?value.get(key):value[key]}),equals:buntUndefined(function(lhs,rhs){return lhs===rhs}),eq:function(lhs,rhs){return lhs===rhs},neq:function(lhs,rhs){return lhs!==rhs},lt:buntUndefined(function(lhs,rhs){return rhs>lhs}),gt:buntUndefined(function(lhs,rhs){return lhs>rhs}),lteq:buntUndefined(function(lhs,rhs){return rhs>=lhs}),gteq:buntUndefined(function(lhs,rhs){return lhs>=rhs}),and:function(lhs,rhs){return lhs&&rhs},or:function(lhs,rhs){return lhs||rhs},not:function(value){return!value},ceil:function(value){return Math.ceil(value)},floor:function(value){return Math.floor(value)},round:function(value){return Math.round(value)},precision:function(value,p){return parseFloat(value).toPrecision(p)},fixed:function(value,f){return parseFloat(value).toFixed(f)},delimitNumber:function(value){return value=value.toString(),value.replace(/(^|[^\w.])(\d{4,})/g,function($0,$1,$2){return $1+$2.replace(/\d(?=(?:\d\d\d)+(?!\d))/g,"$&,")})},trim:buntUndefined(function(value){return value.trim()}),matches:buntUndefined(function(value,searchFor){return-1!==value.indexOf(searchFor)}),truncate:buntUndefined(function(value,length,end,binding){return null==end&&(end="..."),binding||(binding=end,end="..."),value.length>length&&(value=value.substr(0,length-end.length)+end),value}),"default":function(value,defaultValue){return null!=value&&""!==value?value:defaultValue},prepend:function(value,string){return(null!=string?string:"")+(null!=value?value:"")},append:function(value,string){return(null!=value?value:"")+(null!=string?string:"")},replace:buntUndefined(function(value,searchFor,replaceWith,flags,binding){return binding||(binding=flags,flags=void 0),void 0===flags?value.replace(searchFor,replaceWith):value.replace(searchFor,replaceWith,flags)}),downcase:buntUndefined(function(value){return value.toLowerCase()}),upcase:buntUndefined(function(value){return value.toUpperCase()}),pluralize:buntUndefined(function(string,count,includeCount,binding){return binding||(binding=includeCount,includeCount=!0,binding||(binding=count,count=void 0)),null!=count?Batman.helpers.pluralize(count,string,void 0,includeCount):Batman.helpers.pluralize(string)}),humanize:buntUndefined(function(string){return Batman.helpers.humanize(string)}),join:buntUndefined(function(value,withWhat,binding){return null==withWhat&&(withWhat=""),binding||(binding=withWhat,withWhat=""),value.join(withWhat)}),sort:buntUndefined(function(value){return value.sort()}),map:buntUndefined(function(value,key){return value.map(function(x){return Batman.get(x,key)})}),has:function(set,item){return null==set?!1:Batman.contains(set,item)},first:buntUndefined(function(value){return value[0]}),meta:buntUndefined(function(value,keypath){return Batman.developer.assert(value.meta,"Error, value doesn't have a meta to filter on!"),value.meta.get(keypath)}),interpolate:function(string,interpolationKeypaths,binding){var k,v,values;if(binding||(binding=interpolationKeypaths,interpolationKeypaths=void 0),string){values={};for(k in interpolationKeypaths)v=interpolationKeypaths[k],values[k]=this.lookupKeypath(v),null==values[k]&&(Batman.developer.warn("Warning! Undefined interpolation key "+k+" for interpolation",string),values[k]="");return Batman.helpers.interpolate(string,values)}},withArguments:function(){var binding,block,curryArgs,_i;return block=arguments[0],curryArgs=3<=arguments.length?__slice.call(arguments,1,_i=arguments.length-1):(_i=1,[]),binding=arguments[_i++],block?"function"==typeof block?function(){return block.call.apply(block,[this].concat(__slice.call(curryArgs),__slice.call(arguments)))}:"function"==typeof block.get?block.get.apply(block,curryArgs):void 0:void 0},escape:buntUndefined(Batman.escapeHTML)},function(){var k,_i,_len,_ref,_results;for(_ref=["capitalize","singularize","underscore","camelize"],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)k=_ref[_i],_results.push(Batman.Filters[k]=buntUndefined(Batman.helpers[k]));return _results}(),Batman.developer.addFilters()}.call(this),function(){}.call(this),function(){var window=this,document=this.document,old=this.zest,compareDocumentPosition=function(){return document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)}:function(a,b){for(var el=a.ownerDocument.getElementsByTagName("*"),i=el.length;i--;){if(el[i]===a)return 2;if(el[i]===b)return 4}return 1}}(),order=function(a,b){return 2&compareDocumentPosition(a,b)?1:-1},next=function(el){for(;(el=el.nextSibling)&&1!==el.nodeType;);return el},prev=function(el){for(;(el=el.previousSibling)&&1!==el.nodeType;);return el},child=function(el){if(el=el.firstChild)for(;1!==el.nodeType&&(el=el.nextSibling););return el},lastChild=function(el){if(el=el.lastChild)for(;1!==el.nodeType&&(el=el.previousSibling););return el},unquote=function(str){if(!str)return str;var ch=str[0];return'"'===ch||"'"===ch?str.slice(1,-1):str},indexOf=function(){return Array.prototype.indexOf?Array.prototype.indexOf:function(obj,item){for(var i=this.length;i--;)if(this[i]===item)return i;return-1}}(),makeInside=function(start,end){var regex=rules.inside.source.replace(/</g,start).replace(/>/g,end);return new RegExp(regex)},replace=function(regex,name,val){return regex=regex.source,regex=regex.replace(name,val.source||val),new RegExp(regex)},truncateUrl=function(url,num){return url.replace(/^(?:\w+:\/\/|\/+)/,"").replace(/(?:\/+|\/*#.*?)$/,"").split("/",num).join("/")},parseNth=function(param){var cap,param=param.replace(/\s+/g,"");return"even"===param?param="2n+0":"odd"===param?param="2n+1":~param.indexOf("n")||(param="0n"+param),cap=/^([+-])?(\d+)?n([+-])?(\d+)?$/.exec(param),{group:"-"===cap[1]?-(cap[2]||1):+(cap[2]||1),offset:cap[4]?"-"===cap[3]?-cap[4]:+cap[4]:0}},nth=function(param,test,last){var param=parseNth(param),group=param.group,offset=param.offset,find=last?lastChild:child,advance=last?prev:next;return function(el){if(1===el.parentNode.nodeType)for(var rel=find(el.parentNode),pos=0;rel;){if(test(rel,el)&&pos++,rel===el)return pos-=offset,group&&pos?!(pos%group)&&0>pos==0>group:!pos;rel=advance(rel)}}},selectors={"*":function(){return function(){var el=document.createElement("div");return el.appendChild(document.createComment("")),!!el.getElementsByTagName("*")[0]}()?function(el){return 1===el.nodeType?!0:void 0}:function(){return!0}}(),type:function(type){return type=type.toLowerCase(),function(el){return el.nodeName.toLowerCase()===type}},attr:function(key,op,val,i){return op=operators[op],function(el){var attr;switch(key){case"for":attr=el.htmlFor;break;case"class":attr=el.className,""===attr&&null==el.getAttribute("class")&&(attr=null);break;case"href":attr=el.getAttribute("href",2);break;case"title":attr=el.getAttribute("title")||null;break;case"id":if(el.getAttribute){attr=el.getAttribute("id");break}default:attr=null!=el[key]?el[key]:el.getAttribute&&el.getAttribute(key)}if(null!=attr)return attr+="",i&&(attr=attr.toLowerCase(),val=val.toLowerCase()),op(attr,val)}},":first-child":function(el){return!prev(el)&&1===el.parentNode.nodeType},":last-child":function(el){return!next(el)&&1===el.parentNode.nodeType},":only-child":function(el){return!prev(el)&&!next(el)&&1===el.parentNode.nodeType},":nth-child":function(param,last){return nth(param,function(){return!0},last)},":nth-last-child":function(param){return selectors[":nth-child"](param,!0)},":root":function(el){return el.ownerDocument.documentElement===el},":empty":function(el){return!el.firstChild},":not":function(sel){var test=compileGroup(sel);return function(el){return!test(el)}},":first-of-type":function(el){if(1===el.parentNode.nodeType){for(var type=el.nodeName;el=prev(el);)if(el.nodeName===type)return;return!0}},":last-of-type":function(el){if(1===el.parentNode.nodeType){for(var type=el.nodeName;el=next(el);)if(el.nodeName===type)return;return!0}},":only-of-type":function(el){return selectors[":first-of-type"](el)&&selectors[":last-of-type"](el)},":nth-of-type":function(param,last){return nth(param,function(rel,el){return rel.nodeName===el.nodeName},last)},":nth-last-of-type":function(param){return selectors[":nth-of-type"](param,!0)},":checked":function(el){return!(!el.checked&&!el.selected)},":indeterminate":function(el){return!selectors[":checked"](el)},":enabled":function(el){return!el.disabled&&"hidden"!==el.type},":disabled":function(el){return!!el.disabled},":target":function(el){return el.id===window.location.hash.substring(1)},":focus":function(el){return el===el.ownerDocument.activeElement},":matches":function(sel){return compileGroup(sel)},":nth-match":function(param,last){var args=param.split(/\s*,\s*/),arg=args.shift(),test=compileGroup(args.join(","));return nth(arg,test,last)},":nth-last-match":function(param){return selectors[":nth-match"](param,!0)},":links-here":function(el){return el+""==window.location+""},":lang":function(param){return function(el){for(;el;){if(el.lang)return 0===el.lang.indexOf(param);el=el.parentNode}}},":dir":function(param){return function(el){for(;el;){if(el.dir)return el.dir===param;el=el.parentNode}}},":scope":function(el,con){var context=con||el.ownerDocument;return 9===context.nodeType?el===context.documentElement:el===context},":any-link":function(el){return"string"==typeof el.href},":local-link":function(el){if(el.nodeName)return el.href&&el.host===window.location.host;var param=+el+1;return function(el){if(el.href){var url=window.location+"",href=el+"";return truncateUrl(url,param)===truncateUrl(href,param)}}},":default":function(el){return!!el.defaultSelected},":valid":function(el){return el.willValidate||el.validity&&el.validity.valid},":invalid":function(el){return!selectors[":valid"](el)},":in-range":function(el){return el.value>el.min&&el.value<=el.max},":out-of-range":function(el){return!selectors[":in-range"](el)},":required":function(el){return!!el.required},":optional":function(el){return!el.required},":read-only":function(el){if(el.readOnly)return!0;var attr=el.getAttribute("contenteditable"),prop=el.contentEditable,name=el.nodeName.toLowerCase();return name="input"!==name&&"textarea"!==name,(name||el.disabled)&&null==attr&&"true"!==prop},":read-write":function(el){return!selectors[":read-only"](el)},":hover":function(){throw new Error(":hover is not supported.")},":active":function(){throw new Error(":active is not supported.")},":link":function(){throw new Error(":link is not supported.")},":visited":function(){throw new Error(":visited is not supported.")},":column":function(){throw new Error(":column is not supported.")},":nth-column":function(){throw new Error(":nth-column is not supported.")},":nth-last-column":function(){throw new Error(":nth-last-column is not supported.")},":current":function(){throw new Error(":current is not supported.")},":past":function(){throw new Error(":past is not supported.")},":future":function(){throw new Error(":future is not supported.")},":contains":function(param){return function(el){var text=el.innerText||el.textContent||el.value||"";return!!~text.indexOf(param)}},":has":function(param){return function(el){return zest(param,el).length>0}}},operators={"-":function(){return!0},"=":function(attr,val){return attr===val},"*=":function(attr,val){return-1!==attr.indexOf(val)},"~=":function(attr,val){var f,l,i=attr.indexOf(val);if(-1!==i)return f=attr[i-1],l=attr[i+val.length],!(f&&" "!==f||l&&" "!==l)},"|=":function(attr,val){var l,i=attr.indexOf(val);if(0===i)return l=attr[i+val.length],"-"===l||!l},"^=":function(attr,val){return 0===attr.indexOf(val)},"$=":function(attr,val){return attr.indexOf(val)+val.length===attr.length},"!=":function(attr,val){return attr!==val}},combinators={" ":function(test){return function(el){for(;el=el.parentNode;)if(test(el))return el}},">":function(test){return function(el){return test(el=el.parentNode)&&el}},"+":function(test){return function(el){return test(el=prev(el))&&el}},"~":function(test){return function(el){for(;el=prev(el);)if(test(el))return el}},noop:function(test){return function(el){return test(el)&&el}},ref:function(test,name){function ref(el){for(var doc=el.ownerDocument,nodes=doc.getElementsByTagName("*"),i=nodes.length;i--;)if(node=nodes[i],ref.test(el))return node=null,!0;node=null}var node;return ref.combinator=function(el){if(node&&node.getAttribute){var attr=node.getAttribute(name)||"";return"#"===attr[0]&&(attr=attr.substring(1)),attr===el.id&&test(node)?node:void 0}},ref}},rules={qname:/^ *([\w\-]+|\*)/,simple:/^(?:([.#][\w\-]+)|pseudo|attr)/,ref:/^ *\/([\w\-]+)\/ */,combinator:/^(?: +([^ \w*]) +|( )+|([^ \w*]))(?! *$)/,attr:/^\[([\w\-]+)(?:([^\w]?=)(inside))?\]/,pseudo:/^(:[\w\-]+)(?:\((inside)\))?/,inside:/(?:"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|<[^"'>]*>|\\["'>]|[^"'>])*/};rules.inside=replace(rules.inside,"[^\"'>]*",rules.inside),rules.attr=replace(rules.attr,"inside",makeInside("\\[","\\]")),rules.pseudo=replace(rules.pseudo,"inside",makeInside("\\(","\\)")),rules.simple=replace(rules.simple,"pseudo",rules.pseudo),rules.simple=replace(rules.simple,"attr",rules.attr);var compile=function(sel){for(var test,subject,qname,cap,op,ref,sel=sel.replace(/^\s+|\s+$/g,""),filter=[],buff=[];sel;){if(cap=rules.qname.exec(sel))sel=sel.substring(cap[0].length),qname=cap[1],buff.push(tok(qname,!0));else{if(!(cap=rules.simple.exec(sel)))throw new Error("Invalid selector.");sel=sel.substring(cap[0].length),qname="*",buff.push(tok(qname,!0)),buff.push(tok(cap))}for(;cap=rules.simple.exec(sel);)sel=sel.substring(cap[0].length),buff.push(tok(cap));if("!"===sel[0]&&(sel=sel.substring(1),subject=makeSubject(),subject.qname=qname,buff.push(subject.simple)),cap=rules.ref.exec(sel))sel=sel.substring(cap[0].length),ref=combinators.ref(makeSimple(buff),cap[1]),filter.push(ref.combinator),buff=[];else{if(cap=rules.combinator.exec(sel)){if(sel=sel.substring(cap[0].length),op=cap[1]||cap[2]||cap[3],","===op){filter.push(combinators.noop(makeSimple(buff)));break}}else op="noop";filter.push(combinators[op](makeSimple(buff))),buff=[]}}return test=makeTest(filter),test.qname=qname,test.sel=sel,subject&&(subject.lname=test.qname,subject.test=test,subject.qname=subject.qname,subject.sel=test.sel,test=subject),ref&&(ref.test=test,ref.qname=test.qname,ref.sel=test.sel,test=ref),test},tok=function(cap,qname){if(qname)return"*"===cap?selectors["*"]:selectors.type(cap);if(cap[1])return"."===cap[1][0]?selectors.attr("class","~=",cap[1].substring(1)):selectors.attr("id","=",cap[1].substring(1));if(cap[2])return cap[3]?selectors[cap[2]](unquote(cap[3])):selectors[cap[2]];if(cap[4]){var i;return cap[6]&&(i=cap[6].length,cap[6]=cap[6].replace(/ +i$/,""),i=i>cap[6].length),selectors.attr(cap[4],cap[5]||"-",unquote(cap[6]),i)
}throw new Error("Unknown Selector.")},makeSimple=function(func){var i,l=func.length;return 2>l?func[0]:function(el){if(el){for(i=0;l>i;i++)if(!func[i](el))return;return!0}}},makeTest=function(func){return func.length<2?function(el){return!!func[0](el)}:function(el){for(var i=func.length;i--;)if(!(el=func[i](el)))return;return!0}},makeSubject=function(){function subject(el){for(var node=el.ownerDocument,scope=node.getElementsByTagName(subject.lname),i=scope.length;i--;)if(subject.test(scope[i])&&target===el)return target=null,!0;target=null}var target;return subject.simple=function(el){return target=el,!0},subject},compileGroup=function(sel){for(var test=compile(sel),tests=[test];test.sel;)test=compile(test.sel),tests.push(test);return tests.length<2?test:function(el){for(var l=tests.length,i=0;l>i;i++)if(tests[i](el))return!0}},find=function(sel,node){for(var el,results=[],test=compile(sel),scope=node.getElementsByTagName(test.qname),i=0;el=scope[i++];)test(el)&&results.push(el);if(test.sel){for(;test.sel;)for(test=compile(test.sel),scope=node.getElementsByTagName(test.qname),i=0;el=scope[i++];)test(el)&&!~indexOf.call(results,el)&&results.push(el);results.sort(order)}return results},select=function(){var slice=function(){try{return Array.prototype.slice.call(document.getElementsByTagName("zest")),Array.prototype.slice}catch(e){return e=null,function(){for(var a=[],i=0,l=this.length;l>i;i++)a.push(this[i]);return a}}}();return document.querySelectorAll?function(sel,node){try{return slice.call(node.querySelectorAll(sel))}catch(e){return find(sel,node)}}:function(sel,node){try{if("#"===sel[0]&&/^#[\w\-]+$/.test(sel))return[node.getElementById(sel.substring(1))];if("."===sel[0]&&/^\.[\w\-]+$/.test(sel))return sel=node.getElementsByClassName(sel.substring(1)),slice.call(sel);if(/^[\w\-]+$/.test(sel))return slice.call(node.getElementsByTagName(sel))}catch(e){}return find(sel,node)}}(),zest=function(sel,node){try{sel=select(sel,node||document)}catch(e){window.ZEST_DEBUG&&console.log(e.stack||e+""),sel=[]}return sel};zest.selectors=selectors,zest.operators=operators,zest.combinators=combinators,zest.compile=compileGroup,zest.matches=function(el,sel){return!!compileGroup(sel)(el)},zest.cache=function(){if(!compile.raw){var raw=compile,cache={};compile=function(sel){return cache[sel]||(cache[sel]=raw(sel))},compile.raw=raw,zest._cache=cache}},zest.noCache=function(){compile.raw&&(compile=compile.raw,delete zest._cache)},zest.noConflict=function(){return window.zest=old,zest},zest.noNative=function(){select=find},"undefined"!=typeof module?module.exports=zest:this.zest=zest,window.ZEST_DEBUG?zest.noNative():zest.cache()}.call(function(){return this||("undefined"!=typeof window?window:global)}()),!function(name,definition){"undefined"!=typeof module?module.exports=definition():"function"==typeof define&&define.amd?define(name,definition):this[name]=definition()}("reqwest",function(){function handleReadyState(o,success,error){return function(){o&&4==o[readyState]&&(twoHundo.test(o.status)?success(o):error(o))}}function setHeaders(http,o){var h,headers=o.headers||{};headers.Accept=headers.Accept||defaultHeaders.accept[o.type]||defaultHeaders.accept["*"],o.crossOrigin||headers[requestedWith]||(headers[requestedWith]=defaultHeaders.requestedWith),headers[contentType]||(headers[contentType]=o.contentType||defaultHeaders.contentType);for(h in headers)headers.hasOwnProperty(h)&&http.setRequestHeader(h,headers[h])}function generalCallback(data){lastValue=data}function urlappend(url,s){return url+(/\?/.test(url)?"&":"?")+s}function handleJsonp(o,fn,err,url){var reqId=uniqid++,cbkey=o.jsonpCallback||"callback",cbval=o.jsonpCallbackName||"reqwest_"+reqId,cbreg=new RegExp("((^|\\?|&)"+cbkey+")=([^&]+)"),match=url.match(cbreg),script=doc.createElement("script"),loaded=0;match?"?"===match[3]?url=url.replace(cbreg,"$1="+cbval):cbval=match[3]:url=urlappend(url,cbkey+"="+cbval),win[cbval]=generalCallback,script.type="text/javascript",script.src=url,script.async=!0,"undefined"!=typeof script.onreadystatechange&&(script.event="onclick",script.htmlFor=script.id="_reqwest_"+reqId),script.onload=script.onreadystatechange=function(){return script[readyState]&&"complete"!==script[readyState]&&"loaded"!==script[readyState]||loaded?!1:(script.onload=script.onreadystatechange=null,script.onclick&&script.onclick(),o.success&&o.success(lastValue),lastValue=void 0,head.removeChild(script),void(loaded=1))},head.appendChild(script)}function getRequest(o,fn,err){var http,method=(o.method||"GET").toUpperCase(),url="string"==typeof o?o:o.url,data=o.processData!==!1&&o.data&&"string"!=typeof o.data?reqwest.toQueryString(o.data):o.data||null;return"jsonp"!=o.type&&"GET"!=method||!data||(url=urlappend(url,data),data=null),"jsonp"==o.type?handleJsonp(o,fn,err,url):(http=xhr(),http.open(method,url,!0),setHeaders(http,o),http.onreadystatechange=handleReadyState(http,fn,err),o.before&&o.before(http),http.send(data),http)}function Reqwest(o,fn){this.o=o,this.fn=fn,init.apply(this,arguments)}function setType(url){var m=url.match(/\.(json|jsonp|html|xml)(\?|$)/);return m?m[1]:"js"}function init(o,fn){function complete(resp){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(resp)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(resp,msg,t){o.error&&o.error(resp,msg,t),complete(resp)}this.url="string"==typeof o?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(o,fn){return new Reqwest(o,fn)}function normalize(s){return s?s.replace(/\r?\n/g,"\r\n"):""}function serial(el,cb){var n=el.name,t=el.tagName.toLowerCase(),optCb=function(o){o&&!o.disabled&&cb(n,normalize(o.attributes.value&&o.attributes.value.specified?o.value:o.text))};if(!el.disabled&&n)switch(t){case"input":if(!/reset|button|image|file/i.test(el.type)){var ch=/checkbox/i.test(el.type),ra=/radio/i.test(el.type),val=el.value;(!(ch||ra)||el.checked)&&cb(n,normalize(ch&&""===val?"on":val))}break;case"textarea":cb(n,normalize(el.value));break;case"select":if("select-one"===el.type.toLowerCase())optCb(el.selectedIndex>=0?el.options[el.selectedIndex]:null);else for(var i=0;el.length&&i<el.length;i++)el.options[i].selected&&optCb(el.options[i])}}function eachFormElement(){var e,i,j,cb=this,serializeSubtags=function(e,tags){for(var i=0;i<tags.length;i++){var fa=e[byTag](tags[i]);for(j=0;j<fa.length;j++)serial(fa[j],cb)}};for(i=0;i<arguments.length;i++)e=arguments[i],/input|select|textarea/i.test(e.tagName)&&serial(e,cb),serializeSubtags(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var hash={};return eachFormElement.apply(function(name,value){name in hash?(hash[name]&&!isArray(hash[name])&&(hash[name]=[hash[name]]),hash[name].push(value)):hash[name]=value},arguments),hash}var context=this,win=window,doc=document,old=context.reqwest,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var arr=[];return eachFormElement.apply(function(name,value){arr.push({name:name,value:value})},arguments),arr},reqwest.serialize=function(){if(0===arguments.length)return"";var opt,fn,args=Array.prototype.slice.call(arguments,0);return opt=args.pop(),opt&&opt.nodeType&&args.push(opt)&&(opt=null),opt&&(opt=opt.type),fn="map"==opt?serializeHash:"array"==opt?reqwest.serializeArray:serializeQueryString,fn.apply(null,args)},reqwest.toQueryString=function(o){var i,qs="",enc=encodeURIComponent,push=function(k,v){qs+=enc(k)+"="+enc(v)+"&"};if(isArray(o))for(i=0;o&&i<o.length;i++)push(o[i].name,o[i].value);else for(var k in o)if(Object.hasOwnProperty.call(o,k)){var v=o[k];if(isArray(v))for(i=0;i<v.length;i++)push(k,v[i]);else push(k,o[k])}return qs.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(o,fn){return o&&(o.type&&(o.method=o.type)&&delete o.type,o.dataType&&(o.type=o.dataType),o.jsonpCallback&&(o.jsonpCallbackName=o.jsonpCallback)&&delete o.jsonpCallback,o.jsonp&&(o.jsonpCallback=o.jsonp)),new Reqwest(o,fn)},reqwest}),function(){var SAFARI_CONTAINS_IS_BROKEN,version;/Safari/.test(navigator.userAgent)&&(version=/WebKit\/(\S+)/.exec(navigator.userAgent),version&&parseFloat(version)<540&&(SAFARI_CONTAINS_IS_BROKEN=!0)),("undefined"!=typeof window&&null!==window?window:global).containsNode=function(parent,child){if(parent===child)return!0;if(parent.contains&&!SAFARI_CONTAINS_IS_BROKEN)return parent.contains(child);if(parent.compareDocumentPosition)return!!(16&parent.compareDocumentPosition(child));for(;child&&parent!==child;)child=child.parentNode;return child===parent}}.call(this),function(){Batman.extend(Batman.DOM,{querySelectorAll:function(node,selector){return zest(selector,node)},querySelector:function(node,selector){return zest(selector,node)[0]},setInnerHTML:function(node,html){return null!=node?node.innerHTML=html:void 0},containsNode:function(parent,child){return child||(child=parent,parent=document.body),window.containsNode(parent,child)},textContent:function(node){var _ref;return null!=(_ref=node.textContent)?_ref:node.innerText},destroyNode:function(node){var _ref;return Batman.DOM.cleanupNode(node),null!=node&&null!=(_ref=node.parentNode)?_ref.removeChild(node):void 0}}),Batman.extend(Batman.Request.prototype,{_parseResponseHeaders:function(xhr){var headers;return headers=xhr.getAllResponseHeaders().split("\n").reduce(function(acc,header){var key,matches,value;return(matches=header.match(/([^:]*):\s*(.*)/))&&(key=matches[1],value=matches[2],acc[key]=value),acc},{})},send:function(data){var options,xhr,_ref,_this=this;return null==data&&(data=this.get("data")),this.fire("loading"),options={url:this.get("url"),method:this.get("method"),type:this.get("type"),headers:this.get("headers"),success:function(response){return _this.mixin({xhr:xhr,response:response,status:"undefined"!=typeof xhr&&null!==xhr?xhr.status:void 0,responseHeaders:_this._parseResponseHeaders(xhr)}),_this.fire("success",response)},error:function(xhr){return _this.mixin({xhr:xhr,response:xhr.responseText||xhr.content,status:xhr.status,responseHeaders:_this._parseResponseHeaders(xhr)}),xhr.request=_this,_this.fire("error",xhr)},complete:function(){return _this.fire("loaded")}},"PUT"===(_ref=options.method)||"POST"===_ref?this.hasFileUploads()?options.data=this.constructor.objectToFormData(data):(options.contentType=this.get("contentType"),options.data=Batman.URI.queryFromParams(data)):options.data=data,xhr=reqwest(options).request}})}.call(this),function(){}.call(this),function(){Batman.extend(Batman.DOM,{querySelectorAll:function(node,selector){return jQuery(selector,node)},querySelector:function(node,selector){return jQuery(selector,node)[0]},setInnerHTML:function(node,html){return jQuery(node).html(html)},destroyNode:function(node){Batman.DOM.cleanupNode(node),jQuery(node).remove()},containsNode:function(parent,child){return child||(child=parent,parent=document.body),$.contains(parent,child)},textContent:function(node){return jQuery(node).text()},addEventListener:function(node,eventName,callback){return $(node).on(eventName,callback)},removeEventListener:function(node,eventName,callback){return $(node).off(eventName,callback)}}),Batman.View.accessor("$node",function(){return this.get("node")?$(this.node):void 0}),Batman.extend(Batman.Request.prototype,{_parseResponseHeaders:function(xhr){var headers;return headers=xhr.getAllResponseHeaders().split("\n").reduce(function(acc,header){var key,matches,value;return(matches=header.match(/([^:]*):\s*(.*)/))&&(key=matches[1],value=matches[2],acc[key]=value),acc},{})},_prepareOptions:function(data){var options,_ref,_this=this;return options={url:this.get("url"),type:this.get("method"),dataType:this.get("type"),data:data||this.get("data"),username:this.get("username"),password:this.get("password"),headers:this.get("headers"),beforeSend:function(){return _this.fire("loading")},success:function(response,textStatus,xhr){return _this.mixin({xhr:xhr,status:xhr.status,response:response,responseHeaders:_this._parseResponseHeaders(xhr)}),_this.fire("success",response)},error:function(xhr){return _this.mixin({xhr:xhr,status:xhr.status,response:xhr.responseText,responseHeaders:_this._parseResponseHeaders(xhr)}),xhr.request=_this,_this.fire("error",xhr)},complete:function(){return _this.fire("loaded")}},("PUT"===(_ref=this.get("method"))||"POST"===_ref)&&(this.hasFileUploads()?(options.contentType=!1,options.processData=!1,options.data=this.constructor.objectToFormData(options.data)):(options.contentType=this.get("contentType"),"object"==typeof options.data&&(options.processData=!1,options.data=Batman.URI.queryFromParams(options.data)))),options},send:function(data){return jQuery.ajax(this._prepareOptions(data))}})}.call(this),d3=function(){function n(n){return null!=n&&!isNaN(n)}function t(n){return n.length}function e(n){for(var t=1;n*t%1;)t*=10;return t}function r(n,t){try{for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}catch(r){n.prototype=t}}function i(){}function u(){}function a(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function o(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var e=0,r=Ca.length;r>e;++e){var i=Ca[e]+t;if(i in n)return i}}function c(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}function l(n){return Array.prototype.slice.call(n)}function s(){}function f(){}function h(n){function t(){for(var t,r=e,i=-1,u=r.length;++i<u;)(t=r[i].on)&&t.apply(this,arguments);return n}var e=[],r=new i;return t.on=function(t,i){var u,a=r.get(t);return arguments.length<2?a&&a.on:(a&&(a.on=null,e=e.slice(0,u=e.indexOf(a)).concat(e.slice(u+1)),r.remove(t)),i&&e.push(r.set(t,{on:i})),n)},t}function g(){ya.event.preventDefault()}function p(){for(var n,t=ya.event;n=t.sourceEvent;)t=n;return t}function m(n){for(var t=new f,e=0,r=arguments.length;++e<r;)t[arguments[e]]=h(t);return t.of=function(e,r){return function(i){try{var u=i.sourceEvent=ya.event;i.target=n,ya.event=i,t[i.type].apply(e,r)}finally{ya.event=u}}},t}function d(n){return La(n,Ya),n}function v(n){return"function"==typeof n?n:function(){return Ha(n,this)}}function y(n){return"function"==typeof n?n:function(){return Fa(n,this)}}function M(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function i(){this.setAttribute(n,t)}function u(){this.setAttributeNS(n.space,n.local,t)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=ya.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?o:a:n.local?u:i}function x(n){return n.trim().replace(/\s+/g," ")}function b(n){return new RegExp("(?:^|\\s+)"+ya.requote(n)+"(?:\\s+|$)","g")}function _(n,t){function e(){for(var e=-1;++e<i;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<i;)n[e](this,r)}n=n.trim().split(/\s+/).map(w);var i=n.length;return"function"==typeof t?r:e}function w(n){var t=b(n);return function(e,r){if(i=e.classList)return r?i.add(n):i.remove(n);var i=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||e.setAttribute("class",x(i+" "+n))):e.setAttribute("class",x(i.replace(t," ")))}}function S(n,t,e){function r(){this.style.removeProperty(n)}function i(){this.style.setProperty(n,t,e)}function u(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?u:i}function E(n,t){function e(){delete this[n]}function r(){this[n]=t}function i(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?i:r}function k(n){return"function"==typeof n?n:(n=ya.ns.qualify(n)).local?function(){return Ma.createElementNS(n.space,n.local)}:function(){return Ma.createElementNS(this.namespaceURI,n)}}function A(n){return{__data__:n}}function N(n){return function(){return Oa(this,n)}}function q(n){return arguments.length||(n=ya.ascending),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function T(n,t){for(var e=0,r=n.length;r>e;e++)for(var i,u=n[e],a=0,o=u.length;o>a;a++)(i=u[a])&&t(i,a,e);return n}function C(n){return La(n,Ua),n}function z(n){var t,e;return function(r,i,u){var a,o=n[u].update,c=o.length;for(u!=e&&(e=u,t=0),i>=t&&(t=i+1);!(a=o[t])&&++t<c;);return a}}function D(n,t,e){function r(){var t=this[a];t&&(this.removeEventListener(n,t,t.$),delete this[a])}function i(){var i=c(t,za(arguments));r.call(this),this.addEventListener(n,this[a]=i,i.$=e),i._=t}function u(){var t,e=new RegExp("^__on([^.]+)"+ya.requote(n)+"$");for(var r in this)if(t=r.match(e)){var i=this[r];this.removeEventListener(t[1],i,i.$),delete this[r]}}var a="__on"+n,o=n.indexOf("."),c=j;o>0&&(n=n.substring(0,o));var l=Va.get(n);return l&&(n=l,c=L),o?t?i:r:t?s:u}function j(n,t){return function(e){var r=ya.event;ya.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{ya.event=r}}}function L(n,t){var e=j(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function H(){var n=".dragsuppress-"+ ++Za,t="touchmove"+n,e="selectstart"+n,r="dragstart"+n,i="click"+n,u=ya.select(ba).on(t,g).on(e,g).on(r,g),a=xa.style,o=a[Xa];return a[Xa]="none",function(t){function e(){u.on(i,null)}u.on(n,null),a[Xa]=o,t&&(u.on(i,function(){g(),e()},!0),setTimeout(e,0))}}function F(n,t){var e=n.ownerSVGElement||n;if(e.createSVGPoint){var r=e.createSVGPoint();if(0>Ba&&(ba.scrollX||ba.scrollY)){e=ya.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var i=e[0][0].getScreenCTM();Ba=!(i.f||i.e),e.remove()}return Ba?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(n.getScreenCTM().inverse()),[r.x,r.y]}var u=n.getBoundingClientRect();return[t.clientX-u.left-n.clientLeft,t.clientY-u.top-n.clientTop]}function P(){}function O(n,t,e){return new Y(n,t,e)}function Y(n,t,e){this.h=n,this.s=t,this.l=e}function R(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?u+(a-u)*n/60:180>n?a:240>n?u+(a-u)*(240-n)/60:u}function i(n){return Math.round(255*r(n))}var u,a;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,a=.5>=e?e*(1+t):e+t-e*t,u=2*e-a,at(i(n+120),i(n),i(n-120))}function U(n){return n>0?1:0>n?-1:0}function I(n){return n>1?0:-1>n?Ka:Math.acos(n)}function V(n){return n>1?Ka/2:-1>n?-Ka/2:Math.asin(n)}function X(n){return(Math.exp(n)-Math.exp(-n))/2}function Z(n){return(Math.exp(n)+Math.exp(-n))/2}function B(n){return(n=Math.sin(n/2))*n}function $(n,t,e){return new W(n,t,e)}function W(n,t,e){this.h=n,this.c=t,this.l=e}function J(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),G(e,Math.cos(n*=to)*t,Math.sin(n)*t)}function G(n,t,e){return new K(n,t,e)}function K(n,t,e){this.l=n,this.a=t,this.b=e}function Q(n,t,e){var r=(n+16)/116,i=r+t/500,u=r-e/200;return i=tt(i)*uo,r=tt(r)*ao,u=tt(u)*oo,at(rt(3.2404542*i-1.5371385*r-.4985314*u),rt(-.969266*i+1.8760108*r+.041556*u),rt(.0556434*i-.2040259*r+1.0572252*u))}function nt(n,t,e){return n>0?$(Math.atan2(e,t)*eo,Math.sqrt(t*t+e*e),n):$(0/0,0/0,n)}function tt(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function et(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function rt(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function it(n){return at(n>>16,255&n>>8,255&n)}function ut(n){return it(n)+""}function at(n,t,e){return new ot(n,t,e)}function ot(n,t,e){this.r=n,this.g=t,this.b=e}function ct(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function lt(n,t,e){var r,i,u,a=0,o=0,c=0;if(r=/([a-z]+)\((.*)\)/i.exec(n))switch(i=r[2].split(","),r[1]){case"hsl":return e(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(gt(i[0]),gt(i[1]),gt(i[2]))}return(u=so.get(n))?t(u.r,u.g,u.b):(null!=n&&"#"===n.charAt(0)&&(4===n.length?(a=n.charAt(1),a+=a,o=n.charAt(2),o+=o,c=n.charAt(3),c+=c):7===n.length&&(a=n.substring(1,3),o=n.substring(3,5),c=n.substring(5,7)),a=parseInt(a,16),o=parseInt(o,16),c=parseInt(c,16)),t(a,o,c))}function st(n,t,e){var r,i,u=Math.min(n/=255,t/=255,e/=255),a=Math.max(n,t,e),o=a-u,c=(a+u)/2;return o?(i=.5>c?o/(a+u):o/(2-a-u),r=n==a?(t-e)/o+(e>t?6:0):t==a?(e-n)/o+2:(n-t)/o+4,r*=60):(r=0/0,i=c>0&&1>c?0:r),O(r,i,c)}function ft(n,t,e){n=ht(n),t=ht(t),e=ht(e);var r=et((.4124564*n+.3575761*t+.1804375*e)/uo),i=et((.2126729*n+.7151522*t+.072175*e)/ao),u=et((.0193339*n+.119192*t+.9503041*e)/oo);return G(116*i-16,500*(r-i),200*(i-u))}function ht(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function gt(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function pt(n){return"function"==typeof n?n:function(){return n}}function mt(n){return n}function dt(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),vt(t,e,n,r)}}function vt(n,t,e,r){function i(){var n,t=c.status;if(!t&&c.responseText||t>=200&&300>t||304===t){try{n=e.call(u,c)}catch(r){return void a.error.call(u,r)}a.load.call(u,n)}else a.error.call(u,c)}var u={},a=ya.dispatch("progress","load","error"),o={},c=new XMLHttpRequest,l=null;return!ba.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(n)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=i:c.onreadystatechange=function(){c.readyState>3&&i()},c.onprogress=function(n){var t=ya.event;ya.event=n;try{a.progress.call(u,c)}finally{ya.event=t}},u.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?o[n]:(null==t?delete o[n]:o[n]=t+"",u)},u.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",u):t},u.responseType=function(n){return arguments.length?(l=n,u):l},u.response=function(n){return e=n,u},["get","post"].forEach(function(n){u[n]=function(){return u.send.apply(u,[n].concat(za(arguments)))}}),u.send=function(e,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),c.open(e,n,!0),null==t||"accept"in o||(o.accept=t+",*/*"),c.setRequestHeader)for(var a in o)c.setRequestHeader(a,o[a]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=l&&(c.responseType=l),null!=i&&u.on("error",i).on("load",function(n){i(null,n)}),c.send(null==r?null:r),u},u.abort=function(){return c.abort(),u},ya.rebind(u,a,"on"),null==r?u:u.get(yt(r))}function yt(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function Mt(){var n=bt(),t=_t()-n;t>24?(isFinite(t)&&(clearTimeout(po),po=setTimeout(Mt,t)),go=0):(go=1,vo(Mt))}function xt(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now()),mo.callback=n,mo.time=e+t}function bt(){var n=Date.now();for(mo=fo;mo;)n>=mo.time&&(mo.flush=mo.callback(n-mo.time)),mo=mo.next;return n}function _t(){for(var n,t=fo,e=1/0;t;)t.flush?t=n?n.next=t.next:fo=t.next:(t.time<e&&(e=t.time),t=(n=t).next);return ho=n,e}function wt(n,t){var e=Math.pow(10,3*Math.abs(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function St(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Et(n){return n+""}function kt(){}function At(n,t,e){var r=e.s=n+t,i=r-n,u=r-i;e.t=n-u+(t-i)}function Nt(n,t){n&&qo.hasOwnProperty(n.type)&&qo[n.type](n,t)}function qt(n,t,e){var r,i=-1,u=n.length-e;for(t.lineStart();++i<u;)r=n[i],t.point(r[0],r[1]);t.lineEnd()}function Tt(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)qt(n[e],t,1);t.polygonEnd()}function Ct(){function n(n,t){n*=to,t=t*to/2+Ka/4;var e=n-r,a=Math.cos(t),o=Math.sin(t),c=u*o,l=i*a+c*Math.cos(e),s=c*Math.sin(e);Co.add(Math.atan2(s,l)),r=n,i=a,u=o}var t,e,r,i,u;zo.point=function(a,o){zo.point=n,r=(t=a)*to,i=Math.cos(o=(e=o)*to/2+Ka/4),u=Math.sin(o)},zo.lineEnd=function(){n(t,e)}}function zt(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function Dt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function jt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Lt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Ht(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Ft(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Pt(n){return[Math.atan2(n[1],n[0]),V(n[2])]}function Ot(n,t){return Math.abs(n[0]-t[0])<Qa&&Math.abs(n[1]-t[1])<Qa}function Yt(n,t){n*=to;var e=Math.cos(t*=to);Rt(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function Rt(n,t,e){++Do,Lo+=(n-Lo)/Do,Ho+=(t-Ho)/Do,Fo+=(e-Fo)/Do}function Ut(){function n(n,i){n*=to;var u=Math.cos(i*=to),a=u*Math.cos(n),o=u*Math.sin(n),c=Math.sin(i),l=Math.atan2(Math.sqrt((l=e*c-r*o)*l+(l=r*a-t*c)*l+(l=t*o-e*a)*l),t*a+e*o+r*c);jo+=l,Po+=l*(t+(t=a)),Oo+=l*(e+(e=o)),Yo+=l*(r+(r=c)),Rt(t,e,r)}var t,e,r;Vo.point=function(i,u){i*=to;var a=Math.cos(u*=to);t=a*Math.cos(i),e=a*Math.sin(i),r=Math.sin(u),Vo.point=n,Rt(t,e,r)}}function It(){Vo.point=Yt}function Vt(){function n(n,t){n*=to;var e=Math.cos(t*=to),a=e*Math.cos(n),o=e*Math.sin(n),c=Math.sin(t),l=i*c-u*o,s=u*a-r*c,f=r*o-i*a,h=Math.sqrt(l*l+s*s+f*f),g=r*a+i*o+u*c,p=h&&-I(g)/h,m=Math.atan2(h,g);Ro+=p*l,Uo+=p*s,Io+=p*f,jo+=m,Po+=m*(r+(r=a)),Oo+=m*(i+(i=o)),Yo+=m*(u+(u=c)),Rt(r,i,u)}var t,e,r,i,u;Vo.point=function(a,o){t=a,e=o,Vo.point=n,a*=to;var c=Math.cos(o*=to);r=c*Math.cos(a),i=c*Math.sin(a),u=Math.sin(o),Rt(r,i,u)},Vo.lineEnd=function(){n(t,e),Vo.lineEnd=It,Vo.point=Yt}}function Xt(){return!0}function Zt(n,t,e,r,i){var u=[],a=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(Ot(e,r)){i.lineStart();for(var o=0;t>o;++o)i.point((e=n[o])[0],e[1]);return void i.lineEnd()}var c={point:e,points:n,other:null,visited:!1,entry:!0,subject:!0},l={point:e,points:[e],other:c,visited:!1,entry:!1,subject:!1};c.other=l,u.push(c),a.push(l),c={point:r,points:[r],other:null,visited:!1,entry:!1,subject:!0},l={point:r,points:[r],other:c,visited:!1,entry:!0,subject:!1},c.other=l,u.push(c),a.push(l)}}),a.sort(t),Bt(u),Bt(a),u.length){if(e)for(var o=1,c=!e(a[0].point),l=a.length;l>o;++o)a[o].entry=c=!c;for(var s,f,h,g=u[0];;){for(s=g;s.visited;)if((s=s.next)===g)return;f=s.points,i.lineStart();do{if(s.visited=s.other.visited=!0,s.entry){if(s.subject)for(var o=0;o<f.length;o++)i.point((h=f[o])[0],h[1]);else r(s.point,s.next.point,1,i);s=s.next}else{if(s.subject){f=s.prev.points;for(var o=f.length;--o>=0;)i.point((h=f[o])[0],h[1])}else r(s.point,s.prev.point,-1,i);s=s.prev}s=s.other,f=s.points}while(!s.visited);i.lineEnd()}}}function Bt(n){if(t=n.length){for(var t,e,r=0,i=n[0];++r<t;)i.next=e=n[r],e.prev=i,i=e;i.next=e=n[0],e.prev=i}}function $t(n,t,e,r){return function(i){function u(t,e){n(t,e)&&i.point(t,e)}function a(n,t){m.point(n,t)}function o(){d.point=a,m.lineStart()}function c(){d.point=u,m.lineEnd()}function l(n,t){y.point(n,t),p.push([n,t])}function s(){y.lineStart(),p=[]}function f(){l(p[0][0],p[0][1]),y.lineEnd();var n,t=y.clean(),e=v.buffer(),r=e.length;if(p.pop(),g.push(p),p=null,r){if(1&t){n=e[0];var u,r=n.length-1,a=-1;for(i.lineStart();++a<r;)i.point((u=n[a])[0],u[1]);return void i.lineEnd()}r>1&&2&t&&e.push(e.pop().concat(e.shift())),h.push(e.filter(Wt))}}var h,g,p,m=t(i),d={point:u,lineStart:o,lineEnd:c,polygonStart:function(){d.point=l,d.lineStart=s,d.lineEnd=f,h=[],g=[],i.polygonStart()},polygonEnd:function(){d.point=u,d.lineStart=o,d.lineEnd=c,h=ya.merge(h),h.length?Zt(h,Gt,null,e,i):r(g)&&(i.lineStart(),e(null,null,1,i),i.lineEnd()),i.polygonEnd(),h=g=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},v=Jt(),y=t(v);return d}}function Wt(n){return n.length>1}function Jt(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:s,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Gt(n,t){return((n=n.point)[0]<0?n[1]-Ka/2-Qa:Ka/2-n[1])-((t=t.point)[0]<0?t[1]-Ka/2-Qa:Ka/2-t[1])}function Kt(n,t){var e=n[0],r=n[1],i=[Math.sin(e),-Math.cos(e),0],u=0,a=!1,o=!1,c=0;Co.reset();for(var l=0,s=t.length;s>l;++l){var f=t[l],h=f.length;if(h){for(var g=f[0],p=g[0],m=g[1]/2+Ka/4,d=Math.sin(m),v=Math.cos(m),y=1;;){y===h&&(y=0),n=f[y];var M=n[0],x=n[1]/2+Ka/4,b=Math.sin(x),_=Math.cos(x),w=M-p,S=Math.abs(w)>Ka,E=d*b;if(Co.add(Math.atan2(E*Math.sin(w),v*_+E*Math.cos(w))),Math.abs(x)<Qa&&(o=!0),u+=S?w+(w>=0?2:-2)*Ka:w,S^p>=e^M>=e){var k=jt(zt(g),zt(n));Ft(k);var A=jt(i,k);Ft(A);var N=(S^w>=0?-1:1)*V(A[2]);r>N&&(c+=S^w>=0?1:-1)}if(!y++)break;p=M,d=b,v=_,g=n}Math.abs(u)>Qa&&(a=!0)}}return(!o&&!a&&0>Co||-Qa>u)^1&c}function Qt(n){var t,e=0/0,r=0/0,i=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(u,a){var o=u>0?Ka:-Ka,c=Math.abs(u-e);Math.abs(c-Ka)<Qa?(n.point(e,r=(r+a)/2>0?Ka/2:-Ka/2),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(o,r),n.point(u,r),t=0):i!==o&&c>=Ka&&(Math.abs(e-i)<Qa&&(e-=i*Qa),Math.abs(u-o)<Qa&&(u-=o*Qa),r=ne(e,r,u,a),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(o,r),t=0),n.point(e=u,r=a),i=o},lineEnd:function(){n.lineEnd(),e=r=0/0},clean:function(){return 2-t}}}function ne(n,t,e,r){var i,u,a=Math.sin(n-e);return Math.abs(a)>Qa?Math.atan((Math.sin(t)*(u=Math.cos(r))*Math.sin(e)-Math.sin(r)*(i=Math.cos(t))*Math.sin(n))/(i*u*a)):(t+r)/2}function te(n,t,e,r){var i;if(null==n)i=e*Ka/2,r.point(-Ka,i),r.point(0,i),r.point(Ka,i),r.point(Ka,0),r.point(Ka,-i),r.point(0,-i),r.point(-Ka,-i),r.point(-Ka,0),r.point(-Ka,i);else if(Math.abs(n[0]-t[0])>Qa){var u=(n[0]<t[0]?1:-1)*Ka;i=e*u/2,r.point(-u,i),r.point(0,i),r.point(u,i)}else r.point(t[0],t[1])}function ee(n){return Kt(Zo,n)}function re(n){function t(n,t){return Math.cos(n)*Math.cos(t)>a}function e(n){var e,u,a,c,s;return{lineStart:function(){c=a=!1,s=1},point:function(f,h){var g,p=[f,h],m=t(f,h),d=o?m?0:i(f,h):m?i(f+(0>f?Ka:-Ka),h):0;if(!e&&(c=a=m)&&n.lineStart(),m!==a&&(g=r(e,p),(Ot(e,g)||Ot(p,g))&&(p[0]+=Qa,p[1]+=Qa,m=t(p[0],p[1]))),m!==a)s=0,m?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;else if(l&&e&&o^m){var v;d&u||!(v=r(p,e,!0))||(s=0,o?(n.lineStart(),n.point(v[0][0],v[0][1]),n.point(v[1][0],v[1][1]),n.lineEnd()):(n.point(v[1][0],v[1][1]),n.lineEnd(),n.lineStart(),n.point(v[0][0],v[0][1])))}!m||e&&Ot(e,p)||n.point(p[0],p[1]),e=p,a=m,u=d},lineEnd:function(){a&&n.lineEnd(),e=null},clean:function(){return s|(c&&a)<<1}}}function r(n,t,e){var r=zt(n),i=zt(t),u=[1,0,0],o=jt(r,i),c=Dt(o,o),l=o[0],s=c-l*l;if(!s)return!e&&n;var f=a*c/s,h=-a*l/s,g=jt(u,o),p=Ht(u,f),m=Ht(o,h);Lt(p,m);var d=g,v=Dt(p,d),y=Dt(d,d),M=v*v-y*(Dt(p,p)-1);if(!(0>M)){var x=Math.sqrt(M),b=Ht(d,(-v-x)/y);if(Lt(b,p),b=Pt(b),!e)return b;var _,w=n[0],S=t[0],E=n[1],k=t[1];w>S&&(_=w,w=S,S=_);var A=S-w,N=Math.abs(A-Ka)<Qa,q=N||Qa>A;if(!N&&E>k&&(_=E,E=k,k=_),q?N?E+k>0^b[1]<(Math.abs(b[0]-w)<Qa?E:k):E<=b[1]&&b[1]<=k:A>Ka^(w<=b[0]&&b[0]<=S)){var T=Ht(d,(-v+x)/y);return Lt(T,p),[b,Pt(T)]}}}function i(t,e){var r=o?n:Ka-n,i=0;return-r>t?i|=1:t>r&&(i|=2),-r>e?i|=4:e>r&&(i|=8),i}function u(n){return Kt(c,n)}var a=Math.cos(n),o=a>0,c=[n,0],l=Math.abs(a)>Qa,s=Ne(n,6*to);return $t(t,e,s,u)}function ie(n,t,e,r){function i(r,i){return Math.abs(r[0]-n)<Qa?i>0?0:3:Math.abs(r[0]-e)<Qa?i>0?2:1:Math.abs(r[1]-t)<Qa?i>0?1:0:i>0?3:2}function u(n,t){return a(n.point,t.point)}function a(n,t){var e=i(n,1),r=i(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}function o(i,u){var a=u[0]-i[0],o=u[1]-i[1],c=[0,1];return Math.abs(a)<Qa&&Math.abs(o)<Qa?n<=i[0]&&i[0]<=e&&t<=i[1]&&i[1]<=r:ue(n-i[0],a,c)&&ue(i[0]-e,-a,c)&&ue(t-i[1],o,c)&&ue(i[1]-r,-o,c)?(c[1]<1&&(u[0]=i[0]+c[1]*a,u[1]=i[1]+c[1]*o),c[0]>0&&(i[0]+=c[0]*a,i[1]+=c[0]*o),!0):!1
}return function(c){function l(u){var a=i(u,-1),o=s([0===a||3===a?n:e,a>1?r:t]);return o}function s(n){for(var t=0,e=M.length,r=n[1],i=0;e>i;++i)for(var u,a=1,o=M[i],c=o.length,l=o[0];c>a;++a)u=o[a],l[1]<=r?u[1]>r&&f(l,u,n)>0&&++t:u[1]<=r&&f(l,u,n)<0&&--t,l=u;return 0!==t}function f(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}function h(u,o,c,l){var s=0,f=0;if(null==u||(s=i(u,c))!==(f=i(o,c))||a(u,o)<0^c>0){do l.point(0===s||3===s?n:e,s>1?r:t);while((s=(s+c+4)%4)!==f)}else l.point(o[0],o[1])}function g(i,u){return i>=n&&e>=i&&u>=t&&r>=u}function p(n,t){g(n,t)&&c.point(n,t)}function m(){T.point=v,M&&M.push(x=[]),A=!0,k=!1,S=E=0/0}function d(){y&&(v(b,_),w&&k&&q.rejoin(),y.push(q.buffer())),T.point=p,k&&c.lineEnd()}function v(n,t){n=Math.max(-Bo,Math.min(Bo,n)),t=Math.max(-Bo,Math.min(Bo,t));var e=g(n,t);if(M&&x.push([n,t]),A)b=n,_=t,w=e,A=!1,e&&(c.lineStart(),c.point(n,t));else if(e&&k)c.point(n,t);else{var r=[S,E],i=[n,t];o(r,i)?(k||(c.lineStart(),c.point(r[0],r[1])),c.point(i[0],i[1]),e||c.lineEnd()):e&&(c.lineStart(),c.point(n,t))}S=n,E=t,k=e}var y,M,x,b,_,w,S,E,k,A,N=c,q=Jt(),T={point:p,lineStart:m,lineEnd:d,polygonStart:function(){c=q,y=[],M=[]},polygonEnd:function(){c=N,(y=ya.merge(y)).length?(c.polygonStart(),Zt(y,u,l,h,c),c.polygonEnd()):s([n,t])&&(c.polygonStart(),c.lineStart(),h(null,null,1,c),c.lineEnd(),c.polygonEnd()),y=M=x=null}};return T}}function ue(n,t,e){if(Math.abs(t)<Qa)return 0>=n;var r=n/t;if(t>0){if(r>e[1])return!1;r>e[0]&&(e[0]=r)}else{if(r<e[0])return!1;r<e[1]&&(e[1]=r)}return!0}function ae(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function oe(n){var t=0,e=Ka/3,r=be(n),i=r(t,e);return i.parallels=function(n){return arguments.length?r(t=n[0]*Ka/180,e=n[1]*Ka/180):[180*(t/Ka),180*(e/Ka)]},i}function ce(n,t){function e(n,t){var e=Math.sqrt(u-2*i*Math.sin(t))/i;return[e*Math.sin(n*=i),a-e*Math.cos(n)]}var r=Math.sin(n),i=(r+Math.sin(t))/2,u=1+r*(2*i-r),a=Math.sqrt(u)/i;return e.invert=function(n,t){var e=a-t;return[Math.atan2(n,e)/i,V((u-(n*n+e*e)*i*i)/(2*i))]},e}function le(){function n(n,t){Wo+=i*n-r*t,r=n,i=t}var t,e,r,i;nc.point=function(u,a){nc.point=n,t=r=u,e=i=a},nc.lineEnd=function(){n(t,e)}}function se(n,t){Jo>n&&(Jo=n),n>Ko&&(Ko=n),Go>t&&(Go=t),t>Qo&&(Qo=t)}function fe(){function n(n,t){a.push("M",n,",",t,u)}function t(n,t){a.push("M",n,",",t),o.point=e}function e(n,t){a.push("L",n,",",t)}function r(){o.point=n}function i(){a.push("Z")}var u=he(4.5),a=[],o={point:n,lineStart:function(){o.point=t},lineEnd:r,polygonStart:function(){o.lineEnd=i},polygonEnd:function(){o.lineEnd=r,o.point=n},pointRadius:function(n){return u=he(n),o},result:function(){if(a.length){var n=a.join("");return a=[],n}}};return o}function he(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function ge(n,t){Lo+=n,Ho+=t,++Fo}function pe(){function n(n,r){var i=n-t,u=r-e,a=Math.sqrt(i*i+u*u);Po+=a*(t+n)/2,Oo+=a*(e+r)/2,Yo+=a,ge(t=n,e=r)}var t,e;ec.point=function(r,i){ec.point=n,ge(t=r,e=i)}}function me(){ec.point=ge}function de(){function n(n,t){var e=n-r,u=t-i,a=Math.sqrt(e*e+u*u);Po+=a*(r+n)/2,Oo+=a*(i+t)/2,Yo+=a,a=i*n-r*t,Ro+=a*(r+n),Uo+=a*(i+t),Io+=3*a,ge(r=n,i=t)}var t,e,r,i;ec.point=function(u,a){ec.point=n,ge(t=r=u,e=i=a)},ec.lineEnd=function(){n(t,e)}}function ve(n){function t(t,e){n.moveTo(t,e),n.arc(t,e,a,0,2*Ka)}function e(t,e){n.moveTo(t,e),o.point=r}function r(t,e){n.lineTo(t,e)}function i(){o.point=t}function u(){n.closePath()}var a=4.5,o={point:t,lineStart:function(){o.point=e},lineEnd:i,polygonStart:function(){o.lineEnd=u},polygonEnd:function(){o.lineEnd=i,o.point=t},pointRadius:function(n){return a=n,o},result:s};return o}function ye(n){function t(t){function r(e,r){e=n(e,r),t.point(e[0],e[1])}function i(){M=0/0,S.point=a,t.lineStart()}function a(r,i){var a=zt([r,i]),o=n(r,i);e(M,x,y,b,_,w,M=o[0],x=o[1],y=r,b=a[0],_=a[1],w=a[2],u,t),t.point(M,x)}function o(){S.point=r,t.lineEnd()}function c(){i(),S.point=l,S.lineEnd=s}function l(n,t){a(f=n,h=t),g=M,p=x,m=b,d=_,v=w,S.point=a}function s(){e(M,x,y,b,_,w,g,p,f,m,d,v,u,t),S.lineEnd=o,o()}var f,h,g,p,m,d,v,y,M,x,b,_,w,S={point:r,lineStart:i,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=c},polygonEnd:function(){t.polygonEnd(),S.lineStart=i}};return S}function e(t,u,a,o,c,l,s,f,h,g,p,m,d,v){var y=s-t,M=f-u,x=y*y+M*M;if(x>4*r&&d--){var b=o+g,_=c+p,w=l+m,S=Math.sqrt(b*b+_*_+w*w),E=Math.asin(w/=S),k=Math.abs(Math.abs(w)-1)<Qa?(a+h)/2:Math.atan2(_,b),A=n(k,E),N=A[0],q=A[1],T=N-t,C=q-u,z=M*T-y*C;(z*z/x>r||Math.abs((y*T+M*C)/x-.5)>.3||i>o*g+c*p+l*m)&&(e(t,u,a,o,c,l,N,q,k,b/=S,_/=S,w,d,v),v.point(N,q),e(N,q,k,b,_,w,s,f,h,g,p,m,d,v))}}var r=.5,i=Math.cos(30*to),u=16;return t.precision=function(n){return arguments.length?(u=(r=n*n)>0&&16,t):Math.sqrt(r)},t}function Me(n){var t=ye(function(t,e){return n([t*eo,e*eo])});return function(n){return n=t(n),{point:function(t,e){n.point(t*to,e*to)},sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}}function xe(n){return be(function(){return n})()}function be(n){function t(n){return n=o(n[0]*to,n[1]*to),[n[0]*h+c,l-n[1]*h]}function e(n){return n=o.invert((n[0]-c)/h,(l-n[1])/h),n&&[n[0]*eo,n[1]*eo]}function r(){o=ae(a=Se(v,y,M),u);var n=u(m,d);return c=g-n[0]*h,l=p+n[1]*h,i()}function i(){return s&&(s.valid=!1,s=null),t}var u,a,o,c,l,s,f=ye(function(n,t){return n=u(n,t),[n[0]*h+c,l-n[1]*h]}),h=150,g=480,p=250,m=0,d=0,v=0,y=0,M=0,x=Xo,b=mt,_=null,w=null;return t.stream=function(n){return s&&(s.valid=!1),s=_e(a,x(f(b(n)))),s.valid=!0,s},t.clipAngle=function(n){return arguments.length?(x=null==n?(_=n,Xo):re((_=+n)*to),i()):_},t.clipExtent=function(n){return arguments.length?(w=n,b=null==n?mt:ie(n[0][0],n[0][1],n[1][0],n[1][1]),i()):w},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],r()):[g,p]},t.center=function(n){return arguments.length?(m=n[0]%360*to,d=n[1]%360*to,r()):[m*eo,d*eo]},t.rotate=function(n){return arguments.length?(v=n[0]%360*to,y=n[1]%360*to,M=n.length>2?n[2]%360*to:0,r()):[v*eo,y*eo,M*eo]},ya.rebind(t,f,"precision"),function(){return u=n.apply(this,arguments),t.invert=u.invert&&e,r()}}function _e(n,t){return{point:function(e,r){r=n(e*to,r*to),e=r[0],t.point(e>Ka?e-2*Ka:-Ka>e?e+2*Ka:e,r[1])},sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function we(n,t){return[n,t]}function Se(n,t,e){return n?t||e?ae(ke(n),Ae(t,e)):ke(n):t||e?Ae(t,e):we}function Ee(n){return function(t,e){return t+=n,[t>Ka?t-2*Ka:-Ka>t?t+2*Ka:t,e]}}function ke(n){var t=Ee(n);return t.invert=Ee(-n),t}function Ae(n,t){function e(n,t){var e=Math.cos(t),o=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*r+o*i;return[Math.atan2(c*u-s*a,o*r-l*i),V(s*u+c*a)]}var r=Math.cos(n),i=Math.sin(n),u=Math.cos(t),a=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),o=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*u-c*a;return[Math.atan2(c*u+l*a,o*r+s*i),V(s*r-o*i)]},e}function Ne(n,t){var e=Math.cos(n),r=Math.sin(n);return function(i,u,a,o){null!=i?(i=qe(e,i),u=qe(e,u),(a>0?u>i:i>u)&&(i+=2*a*Ka)):(i=n+2*a*Ka,u=n);for(var c,l=a*t,s=i;a>0?s>u:u>s;s-=l)o.point((c=Pt([e,-r*Math.cos(s),-r*Math.sin(s)]))[0],c[1])}}function qe(n,t){var e=zt(t);e[0]-=n,Ft(e);var r=I(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Qa)%(2*Math.PI)}function Te(n,t,e){var r=ya.range(n,t-Qa,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function Ce(n,t,e){var r=ya.range(n,t-Qa,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function ze(n){return n.source}function De(n){return n.target}function je(n,t,e,r){var i=Math.cos(t),u=Math.sin(t),a=Math.cos(r),o=Math.sin(r),c=i*Math.cos(n),l=i*Math.sin(n),s=a*Math.cos(e),f=a*Math.sin(e),h=2*Math.asin(Math.sqrt(B(r-t)+i*a*B(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*c+t*s,i=e*l+t*f,a=e*u+t*o;return[Math.atan2(i,r)*eo,Math.atan2(a,Math.sqrt(r*r+i*i))*eo]}:function(){return[n*eo,t*eo]};return p.distance=h,p}function Le(){function n(n,i){var u=Math.sin(i*=to),a=Math.cos(i),o=Math.abs((n*=to)-t),c=Math.cos(o);rc+=Math.atan2(Math.sqrt((o=a*Math.sin(o))*o+(o=r*u-e*a*c)*o),e*u+r*a*c),t=n,e=u,r=a}var t,e,r;ic.point=function(i,u){t=i*to,e=Math.sin(u*=to),r=Math.cos(u),ic.point=n},ic.lineEnd=function(){ic.point=ic.lineEnd=s}}function He(n,t){function e(t,e){var r=Math.cos(t),i=Math.cos(e),u=n(r*i);return[u*i*Math.sin(t),u*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),i=t(r),u=Math.sin(i),a=Math.cos(i);return[Math.atan2(n*u,r*a),Math.asin(r&&e*u/r)]},e}function Fe(n,t){function e(n,t){var e=Math.abs(Math.abs(t)-Ka/2)<Qa?0:a/Math.pow(i(t),u);return[e*Math.sin(u*n),a-e*Math.cos(u*n)]}var r=Math.cos(n),i=function(n){return Math.tan(Ka/4+n/2)},u=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(i(t)/i(n)),a=r*Math.pow(i(n),u)/u;return u?(e.invert=function(n,t){var e=a-t,r=U(u)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/u,2*Math.atan(Math.pow(a/r,1/u))-Ka/2]},e):Oe}function Pe(n,t){function e(n,t){var e=u-t;return[e*Math.sin(i*n),u-e*Math.cos(i*n)]}var r=Math.cos(n),i=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),u=r/i+n;return Math.abs(i)<Qa?we:(e.invert=function(n,t){var e=u-t;return[Math.atan2(n,e)/i,u-U(i)*Math.sqrt(n*n+e*e)]},e)}function Oe(n,t){return[n,Math.log(Math.tan(Ka/4+t/2))]}function Ye(n){var t,e=xe(n),r=e.scale,i=e.translate,u=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=i.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var a=u.apply(e,arguments);if(a===e){if(t=null==n){var o=Ka*r(),c=i();u([[c[0]-o,c[1]-o],[c[0]+o,c[1]+o]])}}else t&&(a=null);return a},e.clipExtent(null)}function Re(n,t){var e=Math.cos(t)*Math.sin(n);return[Math.log((1+e)/(1-e))/2,Math.atan2(Math.tan(t),Math.cos(n))]}function Ue(n){function t(t){function a(){l.push("M",u(n(s),o))}for(var c,l=[],s=[],f=-1,h=t.length,g=pt(e),p=pt(r);++f<h;)i.call(this,c=t[f],f)?s.push([+g.call(this,c,f),+p.call(this,c,f)]):s.length&&(a(),s=[]);return s.length&&a(),l.length?l.join(""):null}var e=Ie,r=Ve,i=Xt,u=Xe,a=u.key,o=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(i=n,t):i},t.interpolate=function(n){return arguments.length?(a="function"==typeof n?u=n:(u=sc.get(n)||Xe).key,t):a},t.tension=function(n){return arguments.length?(o=n,t):o},t}function Ie(n){return n[0]}function Ve(n){return n[1]}function Xe(n){return n.join("L")}function Ze(n){return Xe(n)+"Z"}function Be(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&i.push("H",r[0]),i.join("")}function $e(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("V",(r=n[t])[1],"H",r[0]);return i.join("")}function We(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("H",(r=n[t])[0],"V",r[1]);return i.join("")}function Je(n,t){return n.length<4?Xe(n):n[1]+Qe(n.slice(1,n.length-1),nr(n,t))}function Ge(n,t){return n.length<3?Xe(n):n[0]+Qe((n.push(n[0]),n),nr([n[n.length-2]].concat(n,[n[1]]),t))}function Ke(n,t){return n.length<3?Xe(n):n[0]+Qe(n,nr(n,t))}function Qe(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return Xe(n);var e=n.length!=t.length,r="",i=n[0],u=n[1],a=t[0],o=a,c=1;if(e&&(r+="Q"+(u[0]-2*a[0]/3)+","+(u[1]-2*a[1]/3)+","+u[0]+","+u[1],i=n[1],c=2),t.length>1){o=t[1],u=n[c],c++,r+="C"+(i[0]+a[0])+","+(i[1]+a[1])+","+(u[0]-o[0])+","+(u[1]-o[1])+","+u[0]+","+u[1];for(var l=2;l<t.length;l++,c++)u=n[c],o=t[l],r+="S"+(u[0]-o[0])+","+(u[1]-o[1])+","+u[0]+","+u[1]}if(e){var s=n[c];r+="Q"+(u[0]+2*o[0]/3)+","+(u[1]+2*o[1]/3)+","+s[0]+","+s[1]}return r}function nr(n,t){for(var e,r=[],i=(1-t)/2,u=n[0],a=n[1],o=1,c=n.length;++o<c;)e=u,u=a,a=n[o],r.push([i*(a[0]-e[0]),i*(a[1]-e[1])]);return r}function tr(n){if(n.length<3)return Xe(n);var t=1,e=n.length,r=n[0],i=r[0],u=r[1],a=[i,i,i,(r=n[1])[0]],o=[u,u,u,r[1]],c=[i,",",u,"L",ur(gc,a),",",ur(gc,o)];for(n.push(n[e-1]);++t<=e;)r=n[t],a.shift(),a.push(r[0]),o.shift(),o.push(r[1]),ar(c,a,o);return n.pop(),c.push("L",r),c.join("")}function er(n){if(n.length<4)return Xe(n);for(var t,e=[],r=-1,i=n.length,u=[0],a=[0];++r<3;)t=n[r],u.push(t[0]),a.push(t[1]);for(e.push(ur(gc,u)+","+ur(gc,a)),--r;++r<i;)t=n[r],u.shift(),u.push(t[0]),a.shift(),a.push(t[1]),ar(e,u,a);return e.join("")}function rr(n){for(var t,e,r=-1,i=n.length,u=i+4,a=[],o=[];++r<4;)e=n[r%i],a.push(e[0]),o.push(e[1]);for(t=[ur(gc,a),",",ur(gc,o)],--r;++r<u;)e=n[r%i],a.shift(),a.push(e[0]),o.shift(),o.push(e[1]),ar(t,a,o);return t.join("")}function ir(n,t){var e=n.length-1;if(e)for(var r,i,u=n[0][0],a=n[0][1],o=n[e][0]-u,c=n[e][1]-a,l=-1;++l<=e;)r=n[l],i=l/e,r[0]=t*r[0]+(1-t)*(u+i*o),r[1]=t*r[1]+(1-t)*(a+i*c);return tr(n)}function ur(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function ar(n,t,e){n.push("C",ur(fc,t),",",ur(fc,e),",",ur(hc,t),",",ur(hc,e),",",ur(gc,t),",",ur(gc,e))}function or(n,t){return(t[1]-n[1])/(t[0]-n[0])}function cr(n){for(var t=0,e=n.length-1,r=[],i=n[0],u=n[1],a=r[0]=or(i,u);++t<e;)r[t]=(a+(a=or(i=u,u=n[t+1])))/2;return r[t]=a,r}function lr(n){for(var t,e,r,i,u=[],a=cr(n),o=-1,c=n.length-1;++o<c;)t=or(n[o],n[o+1]),Math.abs(t)<1e-6?a[o]=a[o+1]=0:(e=a[o]/t,r=a[o+1]/t,i=e*e+r*r,i>9&&(i=3*t/Math.sqrt(i),a[o]=i*e,a[o+1]=i*r));for(o=-1;++o<=c;)i=(n[Math.min(c,o+1)][0]-n[Math.max(0,o-1)][0])/(6*(1+a[o]*a[o])),u.push([i||0,a[o]*i||0]);return u}function sr(n){return n.length<3?Xe(n):n[0]+Qe(n,lr(n))}function fr(n,t,e,r){var i,u,a,o,c,l,s;return i=r[n],u=i[0],a=i[1],i=r[t],o=i[0],c=i[1],i=r[e],l=i[0],s=i[1],(s-a)*(o-u)-(c-a)*(l-u)>0}function hr(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function gr(n,t,e,r){var i=n[0],u=e[0],a=t[0]-i,o=r[0]-u,c=n[1],l=e[1],s=t[1]-c,f=r[1]-l,h=(o*(c-l)-f*(i-u))/(f*a-o*s);return[i+h*a,c+h*s]}function pr(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function mr(n,t){var e={list:n.map(function(n,t){return{index:t,x:n[0],y:n[1]}}).sort(function(n,t){return n.y<t.y?-1:n.y>t.y?1:n.x<t.x?-1:n.x>t.x?1:0}),bottomSite:null},r={list:[],leftEnd:null,rightEnd:null,init:function(){r.leftEnd=r.createHalfEdge(null,"l"),r.rightEnd=r.createHalfEdge(null,"l"),r.leftEnd.r=r.rightEnd,r.rightEnd.l=r.leftEnd,r.list.unshift(r.leftEnd,r.rightEnd)},createHalfEdge:function(n,t){return{edge:n,side:t,vertex:null,l:null,r:null}},insert:function(n,t){t.l=n,t.r=n.r,n.r.l=t,n.r=t},leftBound:function(n){var t=r.leftEnd;do t=t.r;while(t!=r.rightEnd&&i.rightOf(t,n));return t=t.l},del:function(n){n.l.r=n.r,n.r.l=n.l,n.edge=null},right:function(n){return n.r},left:function(n){return n.l},leftRegion:function(n){return null==n.edge?e.bottomSite:n.edge.region[n.side]},rightRegion:function(n){return null==n.edge?e.bottomSite:n.edge.region[mc[n.side]]}},i={bisect:function(n,t){var e={region:{l:n,r:t},ep:{l:null,r:null}},r=t.x-n.x,i=t.y-n.y,u=r>0?r:-r,a=i>0?i:-i;return e.c=n.x*r+n.y*i+.5*(r*r+i*i),u>a?(e.a=1,e.b=i/r,e.c/=r):(e.b=1,e.a=r/i,e.c/=i),e},intersect:function(n,t){var e=n.edge,r=t.edge;if(!e||!r||e.region.r==r.region.r)return null;var i=e.a*r.b-e.b*r.a;if(Math.abs(i)<1e-10)return null;var u,a,o=(e.c*r.b-r.c*e.b)/i,c=(r.c*e.a-e.c*r.a)/i,l=e.region.r,s=r.region.r;l.y<s.y||l.y==s.y&&l.x<s.x?(u=n,a=e):(u=t,a=r);var f=o>=a.region.r.x;return f&&"l"===u.side||!f&&"r"===u.side?null:{x:o,y:c}},rightOf:function(n,t){var e=n.edge,r=e.region.r,i=t.x>r.x;if(i&&"l"===n.side)return 1;if(!i&&"r"===n.side)return 0;if(1===e.a){var u=t.y-r.y,a=t.x-r.x,o=0,c=0;if(!i&&e.b<0||i&&e.b>=0?c=o=u>=e.b*a:(c=t.x+t.y*e.b>e.c,e.b<0&&(c=!c),c||(o=1)),!o){var l=r.x-e.region.l.x;c=e.b*(a*a-u*u)<l*u*(1+2*a/l+e.b*e.b),e.b<0&&(c=!c)}}else{var s=e.c-e.a*t.x,f=t.y-s,h=t.x-r.x,g=s-r.y;c=f*f>h*h+g*g}return"l"===n.side?c:!c},endPoint:function(n,e,r){n.ep[e]=r,n.ep[mc[e]]&&t(n)},distance:function(n,t){var e=n.x-t.x,r=n.y-t.y;return Math.sqrt(e*e+r*r)}},u={list:[],insert:function(n,t,e){n.vertex=t,n.ystar=t.y+e;for(var r=0,i=u.list,a=i.length;a>r;r++){var o=i[r];if(!(n.ystar>o.ystar||n.ystar==o.ystar&&t.x>o.vertex.x))break}i.splice(r,0,n)},del:function(n){for(var t=0,e=u.list,r=e.length;r>t&&e[t]!=n;++t);e.splice(t,1)},empty:function(){return 0===u.list.length},nextEvent:function(n){for(var t=0,e=u.list,r=e.length;r>t;++t)if(e[t]==n)return e[t+1];return null},min:function(){var n=u.list[0];return{x:n.vertex.x,y:n.ystar}},extractMin:function(){return u.list.shift()}};r.init(),e.bottomSite=e.list.shift();for(var a,o,c,l,s,f,h,g,p,m,d,v,y,M=e.list.shift();;)if(u.empty()||(a=u.min()),M&&(u.empty()||M.y<a.y||M.y==a.y&&M.x<a.x))o=r.leftBound(M),c=r.right(o),h=r.rightRegion(o),v=i.bisect(h,M),f=r.createHalfEdge(v,"l"),r.insert(o,f),m=i.intersect(o,f),m&&(u.del(o),u.insert(o,m,i.distance(m,M))),o=f,f=r.createHalfEdge(v,"r"),r.insert(o,f),m=i.intersect(f,c),m&&u.insert(f,m,i.distance(m,M)),M=e.list.shift();else{if(u.empty())break;o=u.extractMin(),l=r.left(o),c=r.right(o),s=r.right(c),h=r.leftRegion(o),g=r.rightRegion(c),d=o.vertex,i.endPoint(o.edge,o.side,d),i.endPoint(c.edge,c.side,d),r.del(o),u.del(c),r.del(c),y="l",h.y>g.y&&(p=h,h=g,g=p,y="r"),v=i.bisect(h,g),f=r.createHalfEdge(v,y),r.insert(l,f),i.endPoint(v,mc[y],d),m=i.intersect(l,f),m&&(u.del(l),u.insert(l,m,i.distance(m,h))),m=i.intersect(f,s),m&&u.insert(f,m,i.distance(m,h))}for(o=r.right(r.leftEnd);o!=r.rightEnd;o=r.right(o))t(o.edge)}function dr(n){return n.x}function vr(n){return n.y}function yr(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function Mr(n,t,e,r,i,u){if(!n(t,e,r,i,u)){var a=.5*(e+i),o=.5*(r+u),c=t.nodes;c[0]&&Mr(n,c[0],e,r,a,o),c[1]&&Mr(n,c[1],a,r,i,o),c[2]&&Mr(n,c[2],e,o,a,u),c[3]&&Mr(n,c[3],a,o,i,u)}}function xr(n,t){n=ya.rgb(n),t=ya.rgb(t);var e=n.r,r=n.g,i=n.b,u=t.r-e,a=t.g-r,o=t.b-i;return function(n){return"#"+ct(Math.round(e+u*n))+ct(Math.round(r+a*n))+ct(Math.round(i+o*n))}}function br(n,t){var e,r={},i={};for(e in n)e in t?r[e]=Sr(n[e],t[e]):i[e]=n[e];for(e in t)e in n||(i[e]=t[e]);return function(n){for(e in r)i[e]=r[e](n);return i}}function _r(n,t){return t-=n=+n,function(e){return n+t*e}}function wr(n,t){var e,r,i,u,a,o=0,c=0,l=[],s=[];for(n+="",t+="",dc.lastIndex=0,r=0;e=dc.exec(t);++r)e.index&&l.push(t.substring(o,c=e.index)),s.push({i:l.length,x:e[0]}),l.push(null),o=dc.lastIndex;for(o<t.length&&l.push(t.substring(o)),r=0,u=s.length;(e=dc.exec(n))&&u>r;++r)if(a=s[r],a.x==e[0]){if(a.i)if(null==l[a.i+1])for(l[a.i-1]+=a.x,l.splice(a.i,1),i=r+1;u>i;++i)s[i].i--;else for(l[a.i-1]+=a.x+l[a.i+1],l.splice(a.i,2),i=r+1;u>i;++i)s[i].i-=2;else if(null==l[a.i+1])l[a.i]=a.x;else for(l[a.i]=a.x+l[a.i+1],l.splice(a.i+1,1),i=r+1;u>i;++i)s[i].i--;s.splice(r,1),u--,r--}else a.x=_r(parseFloat(e[0]),parseFloat(a.x));for(;u>r;)a=s.pop(),null==l[a.i+1]?l[a.i]=a.x:(l[a.i]=a.x+l[a.i+1],l.splice(a.i+1,1)),u--;return 1===l.length?null==l[0]?(a=s[0].x,function(n){return a(n)+""}):function(){return t}:function(n){for(r=0;u>r;++r)l[(a=s[r]).i]=a.x(n);return l.join("")}}function Sr(n,t){for(var e,r=ya.interpolators.length;--r>=0&&!(e=ya.interpolators[r](n,t)););return e}function Er(n,t){var e,r=[],i=[],u=n.length,a=t.length,o=Math.min(n.length,t.length);for(e=0;o>e;++e)r.push(Sr(n[e],t[e]));for(;u>e;++e)i[e]=n[e];for(;a>e;++e)i[e]=t[e];return function(n){for(e=0;o>e;++e)i[e]=r[e](n);return i}}function kr(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function Ar(n){return function(t){return 1-n(1-t)}}function Nr(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function qr(n){return n*n}function Tr(n){return n*n*n}function Cr(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)}function zr(n){return function(t){return Math.pow(t,n)}}function Dr(n){return 1-Math.cos(n*Ka/2)}function jr(n){return Math.pow(2,10*(n-1))}function Lr(n){return 1-Math.sqrt(1-n*n)}function Hr(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/(2*Ka)*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,10*-r)*Math.sin(2*(r-e)*Ka/t)}}function Fr(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function Pr(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Or(n,t){n=ya.hcl(n),t=ya.hcl(t);var e=n.h,r=n.c,i=n.l,u=t.h-e,a=t.c-r,o=t.l-i;return isNaN(a)&&(a=0,r=isNaN(r)?t.c:r),isNaN(u)?(u=0,e=isNaN(e)?t.h:e):u>180?u-=360:-180>u&&(u+=360),function(n){return J(e+u*n,r+a*n,i+o*n)+""}}function Yr(n,t){n=ya.hsl(n),t=ya.hsl(t);var e=n.h,r=n.s,i=n.l,u=t.h-e,a=t.s-r,o=t.l-i;return isNaN(a)&&(a=0,r=isNaN(r)?t.s:r),isNaN(u)?(u=0,e=isNaN(e)?t.h:e):u>180?u-=360:-180>u&&(u+=360),function(n){return R(e+u*n,r+a*n,i+o*n)+""}}function Rr(n,t){n=ya.lab(n),t=ya.lab(t);var e=n.l,r=n.a,i=n.b,u=t.l-e,a=t.a-r,o=t.b-i;return function(n){return Q(e+u*n,r+a*n,i+o*n)+""}}function Ur(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function Ir(n){var t=[n.a,n.b],e=[n.c,n.d],r=Xr(t),i=Vr(t,e),u=Xr(Zr(e,t,-i))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*eo,this.translate=[n.e,n.f],this.scale=[r,u],this.skew=u?Math.atan2(i,u)*eo:0}function Vr(n,t){return n[0]*t[0]+n[1]*t[1]}function Xr(n){var t=Math.sqrt(Vr(n,n));return t&&(n[0]/=t,n[1]/=t),t}function Zr(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function Br(n,t){var e,r=[],i=[],u=ya.transform(n),a=ya.transform(t),o=u.translate,c=a.translate,l=u.rotate,s=a.rotate,f=u.skew,h=a.skew,g=u.scale,p=a.scale;return o[0]!=c[0]||o[1]!=c[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:_r(o[0],c[0])},{i:3,x:_r(o[1],c[1])})):r.push(c[0]||c[1]?"translate("+c+")":""),l!=s?(l-s>180?s+=360:s-l>180&&(l+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:_r(l,s)})):s&&r.push(r.pop()+"rotate("+s+")"),f!=h?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:_r(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:e-4,x:_r(g[0],p[0])},{i:e-2,x:_r(g[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=i.length,function(n){for(var t,u=-1;++u<e;)r[(t=i[u]).i]=t.x(n);return r.join("")}}function $r(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return(e-n)*t}}function Wr(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return Math.max(0,Math.min(1,(e-n)*t))}}function Jr(n){for(var t=n.source,e=n.target,r=Kr(t,e),i=[t];t!==r;)t=t.parent,i.push(t);for(var u=i.length;e!==r;)i.splice(u,0,e),e=e.parent;return i}function Gr(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Kr(n,t){if(n===t)return n;for(var e=Gr(n),r=Gr(t),i=e.pop(),u=r.pop(),a=null;i===u;)a=i,i=e.pop(),u=r.pop();return a}function Qr(n){n.fixed|=2}function ni(n){n.fixed&=-7}function ti(n){n.fixed|=4,n.px=n.x,n.py=n.y}function ei(n){n.fixed&=-5}function ri(n,t,e){var r=0,i=0;if(n.charge=0,!n.leaf)for(var u,a=n.nodes,o=a.length,c=-1;++c<o;)u=a[c],null!=u&&(ri(u,t,e),n.charge+=u.charge,r+=u.charge*u.cx,i+=u.charge*u.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var l=t*e[n.point.index];n.charge+=n.pointCharge=l,r+=l*n.point.x,i+=l*n.point.y}n.cx=r/n.charge,n.cy=i/n.charge}function ii(n,t){return ya.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=ci,n}function ui(n){return n.children}function ai(n){return n.value}function oi(n,t){return t.value-n.value}function ci(n){return ya.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function li(n){return n.x}function si(n){return n.y}function fi(n,t,e){n.y0=t,n.y=e}function hi(n){return ya.range(n.length)}function gi(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function pi(n){for(var t,e=1,r=0,i=n[0][1],u=n.length;u>e;++e)(t=n[e][1])>i&&(r=e,i=t);return r}function mi(n){return n.reduce(di,0)}function di(n,t){return n+t[1]}function vi(n,t){return yi(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function yi(n,t){for(var e=-1,r=+n[0],i=(n[1]-r)/t,u=[];++e<=t;)u[e]=i*e+r;return u}function Mi(n){return[ya.min(n),ya.max(n)]}function xi(n,t){return n.parent==t.parent?1:2}function bi(n){var t=n.children;return t&&t.length?t[0]:n._tree.thread}function _i(n){var t,e=n.children;return e&&(t=e.length)?e[t-1]:n._tree.thread}function wi(n,t){var e=n.children;if(e&&(i=e.length))for(var r,i,u=-1;++u<i;)t(r=wi(e[u],t),n)>0&&(n=r);return n}function Si(n,t){return n.x-t.x}function Ei(n,t){return t.x-n.x}function ki(n,t){return n.depth-t.depth}function Ai(n,t){function e(n,r){var i=n.children;if(i&&(a=i.length))for(var u,a,o=null,c=-1;++c<a;)u=i[c],e(u,o),o=u;t(n,r)}e(n,null)}function Ni(n){for(var t,e=0,r=0,i=n.children,u=i.length;--u>=0;)t=i[u]._tree,t.prelim+=e,t.mod+=e,e+=t.shift+(r+=t.change)}function qi(n,t,e){n=n._tree,t=t._tree;var r=e/(t.number-n.number);n.change+=r,t.change-=r,t.shift+=e,t.prelim+=e,t.mod+=e}function Ti(n,t,e){return n._tree.ancestor.parent==t.parent?n._tree.ancestor:e}function Ci(n,t){return n.value-t.value}function zi(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function Di(n,t){n._pack_next=t,t._pack_prev=n}function ji(n,t){var e=t.x-n.x,r=t.y-n.y,i=n.r+t.r;return.999*i*i>e*e+r*r}function Li(n){function t(n){s=Math.min(n.x-n.r,s),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((e=n.children)&&(l=e.length)){var e,r,i,u,a,o,c,l,s=1/0,f=-1/0,h=1/0,g=-1/0;if(e.forEach(Hi),r=e[0],r.x=-r.r,r.y=0,t(r),l>1&&(i=e[1],i.x=i.r,i.y=0,t(i),l>2))for(u=e[2],Oi(r,i,u),t(u),zi(r,u),r._pack_prev=u,zi(u,i),i=r._pack_next,a=3;l>a;a++){Oi(r,i,u=e[a]);var p=0,m=1,d=1;for(o=i._pack_next;o!==i;o=o._pack_next,m++)if(ji(o,u)){p=1;break}if(1==p)for(c=r._pack_prev;c!==o._pack_prev&&!ji(c,u);c=c._pack_prev,d++);p?(d>m||m==d&&i.r<r.r?Di(r,i=o):Di(r=c,i),a--):(zi(r,u),i=u,t(u))}var v=(s+f)/2,y=(h+g)/2,M=0;for(a=0;l>a;a++)u=e[a],u.x-=v,u.y-=y,M=Math.max(M,u.r+Math.sqrt(u.x*u.x+u.y*u.y));n.r=M,e.forEach(Fi)}}function Hi(n){n._pack_next=n._pack_prev=n}function Fi(n){delete n._pack_next,delete n._pack_prev}function Pi(n,t,e,r){var i=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,i)for(var u=-1,a=i.length;++u<a;)Pi(i[u],t,e,r)}function Oi(n,t,e){var r=n.r+e.r,i=t.x-n.x,u=t.y-n.y;if(r&&(i||u)){var a=t.r+e.r,o=i*i+u*u;a*=a,r*=r;var c=.5+(r-a)/(2*o),l=Math.sqrt(Math.max(0,2*a*(r+o)-(r-=o)*r-a*a))/(2*o);e.x=n.x+c*i+l*u,e.y=n.y+c*u-l*i}else e.x=n.x+r,e.y=n.y}function Yi(n){return 1+ya.max(n,function(n){return n.y})}function Ri(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Ui(n){var t=n.children;return t&&t.length?Ui(t[0]):n}function Ii(n){var t,e=n.children;return e&&(t=e.length)?Ii(e[t-1]):n}function Vi(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Xi(n,t){var e=n.x+t[3],r=n.y+t[0],i=n.dx-t[1]-t[3],u=n.dy-t[0]-t[2];return 0>i&&(e+=i/2,i=0),0>u&&(r+=u/2,u=0),{x:e,y:r,dx:i,dy:u}}function Zi(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function Bi(n){return n.rangeExtent?n.rangeExtent():Zi(n.range())}function $i(n,t,e,r){var i=e(n[0],n[1]),u=r(t[0],t[1]);return function(n){return u(i(n))}}function Wi(n,t){var e,r=0,i=n.length-1,u=n[r],a=n[i];return u>a&&(e=r,r=i,i=e,e=u,u=a,a=e),n[r]=t.floor(u),n[i]=t.ceil(a),n}function Ji(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:kc}function Gi(n,t,e,r){var i=[],u=[],a=0,o=Math.min(n.length,t.length)-1;for(n[o]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++a<=o;)i.push(e(n[a-1],n[a])),u.push(r(t[a-1],t[a]));return function(t){var e=ya.bisect(n,t,1,o)-1;return u[e](i[e](t))}}function Ki(n,t,e,r){function i(){var i=Math.min(n.length,t.length)>2?Gi:$i,c=r?Wr:$r;return a=i(n,t,c,e),o=i(t,n,c,Sr),u}function u(n){return a(n)}var a,o;return u.invert=function(n){return o(n)},u.domain=function(t){return arguments.length?(n=t.map(Number),i()):n},u.range=function(n){return arguments.length?(t=n,i()):t},u.rangeRound=function(n){return u.range(n).interpolate(Ur)},u.clamp=function(n){return arguments.length?(r=n,i()):r},u.interpolate=function(n){return arguments.length?(e=n,i()):e},u.ticks=function(t){return ru(n,t)},u.tickFormat=function(t,e){return iu(n,t,e)},u.nice=function(t){return nu(n,t),i()},u.copy=function(){return Ki(n,t,e,r)},i()}function Qi(n,t){return ya.rebind(n,t,"range","rangeRound","interpolate","clamp")}function nu(n,t){return Wi(n,Ji(t?eu(n,t)[2]:tu(n)))}function tu(n){var t=Zi(n),e=t[1]-t[0];return Math.pow(10,Math.round(Math.log(e)/Math.LN10)-1)}function eu(n,t){var e=Zi(n),r=e[1]-e[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),u=t/r*i;return.15>=u?i*=10:.35>=u?i*=5:.75>=u&&(i*=2),e[0]=Math.ceil(e[0]/i)*i,e[1]=Math.floor(e[1]/i)*i+.5*i,e[2]=i,e}function ru(n,t){return ya.range.apply(ya,eu(n,t))}function iu(n,t,e){var r=-Math.floor(Math.log(eu(n,t)[2])/Math.LN10+.01);return ya.format(e?e.replace(wo,function(n,t,e,i,u,a,o,c,l,s){return[t,e,i,u,a,o,c,l||"."+(r-2*("%"===s)),s].join("")}):",."+r+"f")}function uu(n,t,e,r){function i(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function u(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function a(t){return n(i(t))}return a.invert=function(t){return u(n.invert(t))},a.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(i)),a):r},a.base=function(e){return arguments.length?(t=+e,n.domain(r.map(i)),a):t},a.nice=function(){var t=Wi(r.map(i),e?Math:Nc);return n.domain(t),r=t.map(u),a},a.ticks=function(){var n=Zi(r),a=[],o=n[0],c=n[1],l=Math.floor(i(o)),s=Math.ceil(i(c)),f=t%1?2:t;if(isFinite(s-l)){if(e){for(;s>l;l++)for(var h=1;f>h;h++)a.push(u(l)*h);a.push(u(l))}else for(a.push(u(l));l++<s;)for(var h=f-1;h>0;h--)a.push(u(l)*h);for(l=0;a[l]<o;l++);for(s=a.length;a[s-1]>c;s--);a=a.slice(l,s)}return a},a.tickFormat=function(n,t){if(!arguments.length)return Ac;arguments.length<2?t=Ac:"function"!=typeof t&&(t=ya.format(t));var r,o=Math.max(.1,n/a.ticks().length),c=e?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(n){return n/u(c(i(n)+r))<=o?t(n):""}},a.copy=function(){return uu(n.copy(),t,e,r)},Qi(a,n)}function au(n,t,e){function r(t){return n(i(t))}var i=ou(t),u=ou(1/t);return r.invert=function(t){return u(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(i)),r):e},r.ticks=function(n){return ru(e,n)},r.tickFormat=function(n,t){return iu(e,n,t)},r.nice=function(n){return r.domain(nu(e,n))},r.exponent=function(a){return arguments.length?(i=ou(t=a),u=ou(1/t),n.domain(e.map(i)),r):t},r.copy=function(){return au(n.copy(),t,e)},Qi(r,n)}function ou(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function cu(n,t){function e(t){return a[((u.get(t)||u.set(t,n.push(t)))-1)%a.length]}function r(t,e){return ya.range(n.length).map(function(n){return t+e*n})}var u,a,o;return e.domain=function(r){if(!arguments.length)return n;n=[],u=new i;for(var a,o=-1,c=r.length;++o<c;)u.has(a=r[o])||u.set(a,n.push(a));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(a=n,o=0,t={t:"range",a:arguments},e):a},e.rangePoints=function(i,u){arguments.length<2&&(u=0);var c=i[0],l=i[1],s=(l-c)/(Math.max(1,n.length-1)+u);return a=r(n.length<2?(c+l)/2:c+s*u/2,s),o=0,t={t:"rangePoints",a:arguments},e},e.rangeBands=function(i,u,c){arguments.length<2&&(u=0),arguments.length<3&&(c=u);var l=i[1]<i[0],s=i[l-0],f=i[1-l],h=(f-s)/(n.length-u+2*c);return a=r(s+h*c,h),l&&a.reverse(),o=h*(1-u),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(i,u,c){arguments.length<2&&(u=0),arguments.length<3&&(c=u);var l=i[1]<i[0],s=i[l-0],f=i[1-l],h=Math.floor((f-s)/(n.length-u+2*c)),g=f-s-(n.length-u)*h;return a=r(s+Math.round(g/2),h),l&&a.reverse(),o=Math.round(h*(1-u)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return o},e.rangeExtent=function(){return Zi(t.a[0])},e.copy=function(){return cu(n,t)},e.domain(n)}function lu(n,t){function e(){var e=0,u=t.length;for(i=[];++e<u;)i[e-1]=ya.quantile(n,e/u);return r}function r(n){return isNaN(n=+n)?void 0:t[ya.bisect(i,n)]}var i;return r.domain=function(t){return arguments.length?(n=t.filter(function(n){return!isNaN(n)}).sort(ya.ascending),e()):n},r.range=function(n){return arguments.length?(t=n,e()):t},r.quantiles=function(){return i},r.invertExtent=function(e){return e=t.indexOf(e),0>e?[0/0,0/0]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},r.copy=function(){return lu(n,t)},e()}function su(n,t,e){function r(t){return e[Math.max(0,Math.min(a,Math.floor(u*(t-n))))]}function i(){return u=e.length/(t-n),a=e.length-1,r
}var u,a;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],i()):[n,t]},r.range=function(n){return arguments.length?(e=n,i()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?0/0:t/u+n,[t,t+1/u]},r.copy=function(){return su(n,t,e)},i()}function fu(n,t){function e(e){return e>=e?t[ya.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return fu(n,t)},e}function hu(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return ru(n,t)},t.tickFormat=function(t,e){return iu(n,t,e)},t.copy=function(){return hu(n)},t}function gu(n){return n.innerRadius}function pu(n){return n.outerRadius}function mu(n){return n.startAngle}function du(n){return n.endAngle}function vu(n){for(var t,e,r,i=-1,u=n.length;++i<u;)t=n[i],e=t[0],r=t[1]+Dc,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function yu(n){function t(t){function c(){m.push("M",o(n(v),f),s,l(n(d.reverse()),f),"Z")}for(var h,g,p,m=[],d=[],v=[],y=-1,M=t.length,x=pt(e),b=pt(i),_=e===r?function(){return g}:pt(r),w=i===u?function(){return p}:pt(u);++y<M;)a.call(this,h=t[y],y)?(d.push([g=+x.call(this,h,y),p=+b.call(this,h,y)]),v.push([+_.call(this,h,y),+w.call(this,h,y)])):d.length&&(c(),d=[],v=[]);return d.length&&c(),m.length?m.join(""):null}var e=Ie,r=Ie,i=0,u=Ve,a=Xt,o=Xe,c=o.key,l=o,s="L",f=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(i=u=n,t):u},t.y0=function(n){return arguments.length?(i=n,t):i},t.y1=function(n){return arguments.length?(u=n,t):u},t.defined=function(n){return arguments.length?(a=n,t):a},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?o=n:(o=sc.get(n)||Xe).key,l=o.reverse||o,s=o.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(f=n,t):f},t}function Mu(n){return n.radius}function xu(n){return[n.x,n.y]}function bu(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]+Dc;return[e*Math.cos(r),e*Math.sin(r)]}}function _u(){return 64}function wu(){return"circle"}function Su(n){var t=Math.sqrt(n/Ka);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Eu(n,t){return La(n,Yc),n.id=t,n}function ku(n,t,e,r){var i=n.id;return T(n,"function"==typeof e?function(n,u,a){n.__transition__[i].tween.set(t,r(e.call(n,n.__data__,u,a)))}:(e=r(e),function(n){n.__transition__[i].tween.set(t,e)}))}function Au(n){return null==n&&(n=""),function(){this.textContent=n}}function Nu(n,t,e,r){var u=n.__transition__||(n.__transition__={active:0,count:0}),a=u[e];if(!a){var o=r.time;a=u[e]={tween:new i,time:o,ease:r.ease,delay:r.delay,duration:r.duration},++u.count,ya.timer(function(r){function i(r){return u.active>e?l():(u.active=e,a.event&&a.event.start.call(n,s,t),a.tween.forEach(function(e,r){(r=r.call(n,s,t))&&p.push(r)}),c(r)?1:void xt(c,0,o))}function c(r){if(u.active!==e)return l();for(var i=(r-h)/g,o=f(i),c=p.length;c>0;)p[--c].call(n,o);return i>=1?(l(),a.event&&a.event.end.call(n,s,t),1):void 0}function l(){return--u.count?delete u[e]:delete n.__transition__,1}var s=n.__data__,f=a.ease,h=a.delay,g=a.duration,p=[];return r>=h?i(r):void xt(i,h,o)},0,o)}}function qu(n,t){n.attr("transform",function(n){return"translate("+t(n)+",0)"})}function Tu(n,t){n.attr("transform",function(n){return"translate(0,"+t(n)+")"})}function Cu(n,t,e){if(r=[],e&&t.length>1){for(var r,i,u,a=Zi(n.domain()),o=-1,c=t.length,l=(t[1]-t[0])/++e;++o<c;)for(i=e;--i>0;)(u=+t[o]-i*l)>=a[0]&&r.push(u);for(--o,i=0;++i<e&&(u=+t[o]+i*l)<a[1];)r.push(u)}return r}function zu(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Du(n,t,e){function r(t){var e=n(t),r=u(e,1);return r-t>t-e?e:r}function i(e){return t(e=n(new Zc(e-1)),1),e}function u(n,e){return t(n=new Zc(+n),e),n}function a(n,r,u){var a=i(n),o=[];if(u>1)for(;r>a;)e(a)%u||o.push(new Date(+a)),t(a,1);else for(;r>a;)o.push(new Date(+a)),t(a,1);return o}function o(n,t,e){try{Zc=zu;var r=new zu;return r._=n,a(r,t,e)}finally{Zc=Date}}n.floor=n,n.round=r,n.ceil=i,n.offset=u,n.range=a;var c=n.utc=ju(n);return c.floor=c,c.round=ju(r),c.ceil=ju(i),c.offset=ju(u),c.range=o,n}function ju(n){return function(t,e){try{Zc=zu;var r=new zu;return r._=t,n(r,e)._}finally{Zc=Date}}}function Lu(n,t,e,r){for(var i,u,a=0,o=t.length,c=e.length;o>a;){if(r>=c)return-1;if(i=t.charCodeAt(a++),37===i){if(u=gl[t.charAt(a++)],!u||(r=u(n,e,r))<0)return-1}else if(i!=e.charCodeAt(r++))return-1}return r}function Hu(n){return new RegExp("^(?:"+n.map(ya.requote).join("|")+")","i")}function Fu(n){for(var t=new i,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function Pu(n,t,e){var r=0>n?"-":"",i=(r?-n:n)+"",u=i.length;return r+(e>u?new Array(e-u+1).join(t)+i:i)}function Ou(n,t,e){il.lastIndex=0;var r=il.exec(t.substring(e));return r?(n.w=ul.get(r[0].toLowerCase()),e+r[0].length):-1}function Yu(n,t,e){el.lastIndex=0;var r=el.exec(t.substring(e));return r?(n.w=rl.get(r[0].toLowerCase()),e+r[0].length):-1}function Ru(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function Uu(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e));return r?(n.U=+r[0],e+r[0].length):-1}function Iu(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e));return r?(n.W=+r[0],e+r[0].length):-1}function Vu(n,t,e){cl.lastIndex=0;var r=cl.exec(t.substring(e));return r?(n.m=ll.get(r[0].toLowerCase()),e+r[0].length):-1}function Xu(n,t,e){al.lastIndex=0;var r=al.exec(t.substring(e));return r?(n.m=ol.get(r[0].toLowerCase()),e+r[0].length):-1}function Zu(n,t,e){return Lu(n,hl.c.toString(),t,e)}function Bu(n,t,e){return Lu(n,hl.x.toString(),t,e)}function $u(n,t,e){return Lu(n,hl.X.toString(),t,e)}function Wu(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Ju(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+2));return r?(n.y=Gu(+r[0]),e+r[0].length):-1}function Gu(n){return n+(n>68?1900:2e3)}function Ku(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function Qu(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function na(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function ta(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function ea(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function ra(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function ia(n,t,e){pl.lastIndex=0;var r=pl.exec(t.substring(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function ua(n,t,e){var r=ml.get(t.substring(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}function aa(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=~~(Math.abs(t)/60),i=Math.abs(t)%60;return e+Pu(r,"0",2)+Pu(i,"0",2)}function oa(n,t,e){sl.lastIndex=0;var r=sl.exec(t.substring(e,e+1));return r?e+r[0].length:-1}function ca(n){return n.toISOString()}function la(n,t,e){function r(t){return n(t)}return r.invert=function(t){return sa(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(sa)},r.nice=function(n){return r.domain(Wi(r.domain(),n))},r.ticks=function(e,i){var u=Zi(r.domain());if("function"!=typeof e){var a=u[1]-u[0],o=a/e,c=ya.bisect(vl,o);if(c==vl.length)return t.year(u,e);if(!c)return n.ticks(e).map(sa);o/vl[c-1]<vl[c]/o&&--c,e=t[c],i=e[1],e=e[0].range}return e(u[0],new Date(+u[1]+1),i)},r.tickFormat=function(){return e},r.copy=function(){return la(n.copy(),t,e)},Qi(r,n)}function sa(n){return new Date(n)}function fa(n){return function(t){for(var e=n.length-1,r=n[e];!r[1](t);)r=n[--e];return r[0](t)}}function ha(n){var t=new Date(n,0,1);return t.setFullYear(n),t}function ga(n){var t=n.getFullYear(),e=ha(t),r=ha(t+1);return t+(n-e)/(r-e)}function pa(n){var t=new Date(Date.UTC(n,0,1));return t.setUTCFullYear(n),t}function ma(n){var t=n.getUTCFullYear(),e=pa(t),r=pa(t+1);return t+(n-e)/(r-e)}function da(n){return JSON.parse(n.responseText)}function va(n){var t=Ma.createRange();return t.selectNode(Ma.body),t.createContextualFragment(n.responseText)}var ya={version:"3.2.8"};Date.now||(Date.now=function(){return+new Date});var Ma=document,xa=Ma.documentElement,ba=window;try{Ma.createElement("div").style.setProperty("opacity",0,"")}catch(_a){var wa=ba.Element.prototype,Sa=wa.setAttribute,Ea=wa.setAttributeNS,ka=ba.CSSStyleDeclaration.prototype,Aa=ka.setProperty;wa.setAttribute=function(n,t){Sa.call(this,n,t+"")},wa.setAttributeNS=function(n,t,e){Ea.call(this,n,t,e+"")},ka.setProperty=function(n,t,e){Aa.call(this,n,t+"",e)}}ya.ascending=function(n,t){return t>n?-1:n>t?1:n>=t?0:0/0},ya.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},ya.min=function(n,t){var e,r,i=-1,u=n.length;if(1===arguments.length){for(;++i<u&&!(null!=(e=n[i])&&e>=e);)e=void 0;for(;++i<u;)null!=(r=n[i])&&e>r&&(e=r)}else{for(;++i<u&&!(null!=(e=t.call(n,n[i],i))&&e>=e);)e=void 0;for(;++i<u;)null!=(r=t.call(n,n[i],i))&&e>r&&(e=r)}return e},ya.max=function(n,t){var e,r,i=-1,u=n.length;if(1===arguments.length){for(;++i<u&&!(null!=(e=n[i])&&e>=e);)e=void 0;for(;++i<u;)null!=(r=n[i])&&r>e&&(e=r)}else{for(;++i<u&&!(null!=(e=t.call(n,n[i],i))&&e>=e);)e=void 0;for(;++i<u;)null!=(r=t.call(n,n[i],i))&&r>e&&(e=r)}return e},ya.extent=function(n,t){var e,r,i,u=-1,a=n.length;if(1===arguments.length){for(;++u<a&&!(null!=(e=i=n[u])&&e>=e);)e=i=void 0;for(;++u<a;)null!=(r=n[u])&&(e>r&&(e=r),r>i&&(i=r))}else{for(;++u<a&&!(null!=(e=i=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<a;)null!=(r=t.call(n,n[u],u))&&(e>r&&(e=r),r>i&&(i=r))}return[e,i]},ya.sum=function(n,t){var e,r=0,i=n.length,u=-1;if(1===arguments.length)for(;++u<i;)isNaN(e=+n[u])||(r+=e);else for(;++u<i;)isNaN(e=+t.call(n,n[u],u))||(r+=e);return r},ya.mean=function(t,e){var r,i=t.length,u=0,a=-1,o=0;if(1===arguments.length)for(;++a<i;)n(r=t[a])&&(u+=(r-u)/++o);else for(;++a<i;)n(r=e.call(t,t[a],a))&&(u+=(r-u)/++o);return o?u:void 0},ya.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),i=+n[r-1],u=e-r;return u?i+u*(n[r]-i):i},ya.median=function(t,e){return arguments.length>1&&(t=t.map(e)),t=t.filter(n),t.length?ya.quantile(t.sort(ya.ascending),.5):void 0},ya.bisector=function(n){return{left:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var u=r+i>>>1;n.call(t,t[u],u)<e?r=u+1:i=u}return r},right:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var u=r+i>>>1;e<n.call(t,t[u],u)?i=u:r=u+1}return r}}};var Na=ya.bisector(function(n){return n});ya.bisectLeft=Na.left,ya.bisect=ya.bisectRight=Na.right,ya.shuffle=function(n){for(var t,e,r=n.length;r;)e=0|Math.random()*r--,t=n[r],n[r]=n[e],n[e]=t;return n},ya.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},ya.zip=function(){if(!(i=arguments.length))return[];for(var n=-1,e=ya.min(arguments,t),r=new Array(e);++n<e;)for(var i,u=-1,a=r[n]=new Array(i);++u<i;)a[u]=arguments[u][n];return r},ya.transpose=function(n){return ya.zip.apply(ya,n)},ya.keys=function(n){var t=[];for(var e in n)t.push(e);return t},ya.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},ya.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},ya.merge=function(n){return Array.prototype.concat.apply([],n)},ya.range=function(n,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=n,n=0)),1/0===(t-n)/r)throw new Error("infinite range");var i,u=[],a=e(Math.abs(r)),o=-1;if(n*=a,t*=a,r*=a,0>r)for(;(i=n+r*++o)>t;)u.push(i/a);else for(;(i=n+r*++o)<t;)u.push(i/a);return u},ya.map=function(n){var t=new i;if(n instanceof i)n.forEach(function(n,e){t.set(n,e)});else for(var e in n)t.set(e,n[e]);return t},r(i,{has:function(n){return qa+n in this},get:function(n){return this[qa+n]},set:function(n,t){return this[qa+n]=t},remove:function(n){return n=qa+n,n in this&&delete this[n]},keys:function(){var n=[];return this.forEach(function(t){n.push(t)}),n},values:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n},entries:function(){var n=[];return this.forEach(function(t,e){n.push({key:t,value:e})}),n},forEach:function(n){for(var t in this)t.charCodeAt(0)===Ta&&n.call(this,t.substring(1),this[t])}});var qa="\x00",Ta=qa.charCodeAt(0);ya.nest=function(){function n(t,o,c){if(c>=a.length)return r?r.call(u,o):e?o.sort(e):o;for(var l,s,f,h,g=-1,p=o.length,m=a[c++],d=new i;++g<p;)(h=d.get(l=m(s=o[g])))?h.push(s):d.set(l,[s]);return t?(s=t(),f=function(e,r){s.set(e,n(t,r,c))}):(s={},f=function(e,r){s[e]=n(t,r,c)}),d.forEach(f),s}function t(n,e){if(e>=a.length)return n;var r=[],i=o[e++];return n.forEach(function(n,i){r.push({key:n,values:t(i,e)})}),i?r.sort(function(n,t){return i(n.key,t.key)}):r}var e,r,u={},a=[],o=[];return u.map=function(t,e){return n(e,t,0)},u.entries=function(e){return t(n(ya.map,e,0),0)},u.key=function(n){return a.push(n),u},u.sortKeys=function(n){return o[a.length-1]=n,u},u.sortValues=function(n){return e=n,u},u.rollup=function(n){return r=n,u},u},ya.set=function(n){var t=new u;if(n)for(var e=0,r=n.length;r>e;++e)t.add(n[e]);return t},r(u,{has:function(n){return qa+n in this},add:function(n){return this[qa+n]=!0,n},remove:function(n){return n=qa+n,n in this&&delete this[n]},values:function(){var n=[];return this.forEach(function(t){n.push(t)}),n},forEach:function(n){for(var t in this)t.charCodeAt(0)===Ta&&n.call(this,t.substring(1))}}),ya.behavior={},ya.rebind=function(n,t){for(var e,r=1,i=arguments.length;++r<i;)n[e=arguments[r]]=a(n,t,t[e]);return n};var Ca=["webkit","ms","moz","Moz","o","O"],za=l;try{za(xa.childNodes)[0].nodeType}catch(Da){za=c}ya.dispatch=function(){for(var n=new f,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=h(n);return n},f.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.substring(e+1),n=n.substring(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},ya.event=null,ya.requote=function(n){return n.replace(ja,"\\$&")};var ja=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,La={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},Ha=function(n,t){return t.querySelector(n)},Fa=function(n,t){return t.querySelectorAll(n)},Pa=xa[o(xa,"matchesSelector")],Oa=function(n,t){return Pa.call(n,t)};"function"==typeof Sizzle&&(Ha=function(n,t){return Sizzle(n,t)[0]||null},Fa=function(n,t){return Sizzle.uniqueSort(Sizzle(n,t))},Oa=Sizzle.matchesSelector),ya.selection=function(){return Ia};var Ya=ya.selection.prototype=[];Ya.select=function(n){var t,e,r,i,u=[];n=v(n);for(var a=-1,o=this.length;++a<o;){u.push(t=[]),t.parentNode=(r=this[a]).parentNode;for(var c=-1,l=r.length;++c<l;)(i=r[c])?(t.push(e=n.call(i,i.__data__,c,a)),e&&"__data__"in i&&(e.__data__=i.__data__)):t.push(null)}return d(u)},Ya.selectAll=function(n){var t,e,r=[];n=y(n);for(var i=-1,u=this.length;++i<u;)for(var a=this[i],o=-1,c=a.length;++o<c;)(e=a[o])&&(r.push(t=za(n.call(e,e.__data__,o,i))),t.parentNode=e);return d(r)};var Ra={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ya.ns={prefix:Ra,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&(e=n.substring(0,t),n=n.substring(t+1)),Ra.hasOwnProperty(e)?{space:Ra[e],local:n}:n}},Ya.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=ya.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(M(t,n[t]));return this}return this.each(M(n,t))},Ya.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=n.trim().split(/^|\s+/g)).length,i=-1;if(t=e.classList){for(;++i<r;)if(!t.contains(n[i]))return!1}else for(t=e.getAttribute("class");++i<r;)if(!b(n[i]).test(t))return!1;return!0}for(t in n)this.each(_(t,n[t]));return this}return this.each(_(n,t))},Ya.style=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t="");for(e in n)this.each(S(e,n[e],t));return this}if(2>r)return ba.getComputedStyle(this.node(),null).getPropertyValue(n);e=""}return this.each(S(n,t,e))},Ya.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(E(t,n[t]));return this}return this.each(E(n,t))},Ya.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},Ya.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},Ya.append=function(n){return n=k(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},Ya.insert=function(n,t){return n=k(n),t=v(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments))})},Ya.remove=function(){return this.each(function(){var n=this.parentNode;n&&n.removeChild(this)})},Ya.data=function(n,t){function e(n,e){var r,u,a,o=n.length,f=e.length,h=Math.min(o,f),g=new Array(f),p=new Array(f),m=new Array(o);if(t){var d,v=new i,y=new i,M=[];for(r=-1;++r<o;)d=t.call(u=n[r],u.__data__,r),v.has(d)?m[r]=u:v.set(d,u),M.push(d);for(r=-1;++r<f;)d=t.call(e,a=e[r],r),(u=v.get(d))?(g[r]=u,u.__data__=a):y.has(d)||(p[r]=A(a)),y.set(d,a),v.remove(d);for(r=-1;++r<o;)v.has(M[r])&&(m[r]=n[r])}else{for(r=-1;++r<h;)u=n[r],a=e[r],u?(u.__data__=a,g[r]=u):p[r]=A(a);for(;f>r;++r)p[r]=A(e[r]);for(;o>r;++r)m[r]=n[r]}p.update=g,p.parentNode=g.parentNode=m.parentNode=n.parentNode,c.push(p),l.push(g),s.push(m)}var r,u,a=-1,o=this.length;if(!arguments.length){for(n=new Array(o=(r=this[0]).length);++a<o;)(u=r[a])&&(n[a]=u.__data__);return n}var c=C([]),l=d([]),s=d([]);if("function"==typeof n)for(;++a<o;)e(r=this[a],n.call(r,r.parentNode.__data__,a));else for(;++a<o;)e(r=this[a],n);return l.enter=function(){return c},l.exit=function(){return s},l},Ya.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},Ya.filter=function(n){var t,e,r,i=[];"function"!=typeof n&&(n=N(n));for(var u=0,a=this.length;a>u;u++){i.push(t=[]),t.parentNode=(e=this[u]).parentNode;for(var o=0,c=e.length;c>o;o++)(r=e[o])&&n.call(r,r.__data__,o)&&t.push(r)}return d(i)},Ya.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],i=r.length-1,u=r[i];--i>=0;)(e=r[i])&&(u&&u!==e.nextSibling&&u.parentNode.insertBefore(e,u),u=e);return this},Ya.sort=function(n){n=q.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},Ya.each=function(n){return T(this,function(t,e,r){n.call(t,t.__data__,e,r)})},Ya.call=function(n){var t=za(arguments);return n.apply(t[0]=this,t),this},Ya.empty=function(){return!this.node()},Ya.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,i=e.length;i>r;r++){var u=e[r];if(u)return u}return null},Ya.size=function(){var n=0;return this.each(function(){++n}),n};var Ua=[];ya.selection.enter=C,ya.selection.enter.prototype=Ua,Ua.append=Ya.append,Ua.empty=Ya.empty,Ua.node=Ya.node,Ua.call=Ya.call,Ua.size=Ya.size,Ua.select=function(n){for(var t,e,r,i,u,a=[],o=-1,c=this.length;++o<c;){r=(i=this[o]).update,a.push(t=[]),t.parentNode=i.parentNode;for(var l=-1,s=i.length;++l<s;)(u=i[l])?(t.push(r[l]=e=n.call(i.parentNode,u.__data__,l,o)),e.__data__=u.__data__):t.push(null)}return d(a)},Ua.insert=function(n,t){return arguments.length<2&&(t=z(this)),Ya.insert.call(this,n,t)},Ya.transition=function(){for(var n,t,e=Hc||++Rc,r=[],i=Fc||{time:Date.now(),ease:Cr,delay:0,duration:250},u=-1,a=this.length;++u<a;){r.push(n=[]);for(var o=this[u],c=-1,l=o.length;++c<l;)(t=o[c])&&Nu(t,c,e,i),n.push(t)}return Eu(r,e)},ya.select=function(n){var t=["string"==typeof n?Ha(n,Ma):n];return t.parentNode=xa,d([t])},ya.selectAll=function(n){var t=za("string"==typeof n?Fa(n,Ma):n);return t.parentNode=xa,d([t])};var Ia=ya.select(xa);Ya.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(D(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(D(n,t,e))};var Va=ya.map({mouseenter:"mouseover",mouseleave:"mouseout"});Va.forEach(function(n){"on"+n in Ma&&Va.remove(n)});var Xa=o(xa.style,"userSelect"),Za=0;ya.mouse=function(n){return F(n,p())};var Ba=/WebKit/.test(ba.navigator.userAgent)?-1:0;ya.touches=function(n,t){return arguments.length<2&&(t=p().touches),t?za(t).map(function(t){var e=F(n,t);return e.identifier=t.identifier,e}):[]},ya.behavior.drag=function(){function n(){this.on("mousedown.drag",a).on("touchstart.drag",o)}function t(){return ya.event.changedTouches[0].identifier}function e(n,t){return ya.touches(n).filter(function(n){return n.identifier===t})[0]}function r(n,t,e,r){return function(){function a(){if(!s)return o();var n=t(s,g),e=n[0]-m[0],r=n[1]-m[1];d|=e|r,m=n,f({type:"drag",x:n[0]+c[0],y:n[1]+c[1],dx:e,dy:r})}function o(){v.on(e+"."+p,null).on(r+"."+p,null),y(d&&ya.event.target===h),f({type:"dragend"})}var c,l=this,s=l.parentNode,f=i.of(l,arguments),h=ya.event.target,g=n(),p=null==g?"drag":"drag-"+g,m=t(s,g),d=0,v=ya.select(ba).on(e+"."+p,a).on(r+"."+p,o),y=H();u?(c=u.apply(l,arguments),c=[c.x-m[0],c.y-m[1]]):c=[0,0],f({type:"dragstart"})}}var i=m(n,"drag","dragstart","dragend"),u=null,a=r(s,ya.mouse,"mousemove","mouseup"),o=r(t,e,"touchmove","touchend");return n.origin=function(t){return arguments.length?(u=t,n):u},ya.rebind(n,i,"on")},ya.behavior.zoom=function(){function n(){this.on(w,o).on(Ja+".zoom",l).on(S,s).on("dblclick.zoom",f).on(k,c)}function t(n){return[(n[0]-x[0])/b,(n[1]-x[1])/b]}function e(n){return[n[0]*b+x[0],n[1]*b+x[1]]}function r(n){b=Math.max(_[0],Math.min(_[1],n))}function i(n,t){t=e(t),x[0]+=n[0]-t[0],x[1]+=n[1]-t[1]}function u(){v&&v.domain(d.range().map(function(n){return(n-x[0])/b}).map(d.invert)),M&&M.domain(y.range().map(function(n){return(n-x[1])/b}).map(y.invert))}function a(n){u(),n({type:"zoom",scale:b,translate:x})}function o(){function n(){c=1,i(ya.mouse(r),f),a(u)}function e(){l.on(S,ba===r?s:null).on(E,null),h(c&&ya.event.target===o)}var r=this,u=q.of(r,arguments),o=ya.event.target,c=0,l=ya.select(ba).on(S,n).on(E,e),f=t(ya.mouse(r)),h=H()}function c(){function n(){var n=ya.touches(h);return f=b,s={},n.forEach(function(n){s[n.identifier]=t(n)}),n}function e(){var t=Date.now(),e=n();if(1===e.length){if(500>t-p){var u=e[0],o=s[u.identifier];r(2*b),i(u,o),g(),a(m)}p=t}else if(e.length>1){var u=e[0],c=e[1],l=u[0]-c[0],f=u[1]-c[1];d=l*l+f*f}}function u(){var n=ya.touches(h),t=n[0],e=s[t.identifier];if(u=n[1]){var u,o=s[u.identifier],c=ya.event.scale;if(null==c){var l=(l=u[0]-t[0])*l+(l=u[1]-t[1])*l;c=d&&Math.sqrt(l/d)}t=[(t[0]+u[0])/2,(t[1]+u[1])/2],e=[(e[0]+o[0])/2,(e[1]+o[1])/2],r(c*f)}p=null,i(t,e),a(m)}function l(){ya.event.touches.length?n():(v.on(A,null).on(N,null),y.on(w,o).on(k,c),M())}var s,f,h=this,m=q.of(h,arguments),d=0,v=ya.select(ba).on(A,u).on(N,l),y=ya.select(h).on(w,null).on(k,e),M=H();e()}function l(){g(),h||(h=t(ya.mouse(this))),r(Math.pow(2,.002*$a())*b),i(ya.mouse(this),h),a(q.of(this,arguments))}function s(){h=null}function f(){var n=ya.mouse(this),e=t(n),u=Math.log(b)/Math.LN2;r(Math.pow(2,ya.event.shiftKey?Math.ceil(u)-1:Math.floor(u)+1)),i(n,e),a(q.of(this,arguments))}var h,p,d,v,y,M,x=[0,0],b=1,_=Wa,w="mousedown.zoom",S="mousemove.zoom",E="mouseup.zoom",k="touchstart.zoom",A="touchmove.zoom",N="touchend.zoom",q=m(n,"zoom");return n.translate=function(t){return arguments.length?(x=t.map(Number),u(),n):x},n.scale=function(t){return arguments.length?(b=+t,u(),n):b},n.scaleExtent=function(t){return arguments.length?(_=null==t?Wa:t.map(Number),n):_},n.x=function(t){return arguments.length?(v=t,d=t.copy(),x=[0,0],b=1,n):v},n.y=function(t){return arguments.length?(M=t,y=t.copy(),x=[0,0],b=1,n):M},ya.rebind(n,q,"on")};var $a,Wa=[0,1/0],Ja="onwheel"in Ma?($a=function(){return-ya.event.deltaY*(ya.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Ma?($a=function(){return ya.event.wheelDelta},"mousewheel"):($a=function(){return-ya.event.detail},"MozMousePixelScroll");P.prototype.toString=function(){return this.rgb()+""},ya.hsl=function(n,t,e){return 1===arguments.length?n instanceof Y?O(n.h,n.s,n.l):lt(""+n,st,O):O(+n,+t,+e)};var Ga=Y.prototype=new P;Ga.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),O(this.h,this.s,this.l/n)},Ga.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),O(this.h,this.s,n*this.l)},Ga.rgb=function(){return R(this.h,this.s,this.l)};var Ka=Math.PI,Qa=1e-6,no=Qa*Qa,to=Ka/180,eo=180/Ka;ya.hcl=function(n,t,e){return 1===arguments.length?n instanceof W?$(n.h,n.c,n.l):n instanceof K?nt(n.l,n.a,n.b):nt((n=ft((n=ya.rgb(n)).r,n.g,n.b)).l,n.a,n.b):$(+n,+t,+e)};var ro=W.prototype=new P;ro.brighter=function(n){return $(this.h,this.c,Math.min(100,this.l+io*(arguments.length?n:1)))},ro.darker=function(n){return $(this.h,this.c,Math.max(0,this.l-io*(arguments.length?n:1)))},ro.rgb=function(){return J(this.h,this.c,this.l).rgb()},ya.lab=function(n,t,e){return 1===arguments.length?n instanceof K?G(n.l,n.a,n.b):n instanceof W?J(n.l,n.c,n.h):ft((n=ya.rgb(n)).r,n.g,n.b):G(+n,+t,+e)};var io=18,uo=.95047,ao=1,oo=1.08883,co=K.prototype=new P;co.brighter=function(n){return G(Math.min(100,this.l+io*(arguments.length?n:1)),this.a,this.b)},co.darker=function(n){return G(Math.max(0,this.l-io*(arguments.length?n:1)),this.a,this.b)},co.rgb=function(){return Q(this.l,this.a,this.b)},ya.rgb=function(n,t,e){return 1===arguments.length?n instanceof ot?at(n.r,n.g,n.b):lt(""+n,at,R):at(~~n,~~t,~~e)};var lo=ot.prototype=new P;lo.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,i=30;return t||e||r?(t&&i>t&&(t=i),e&&i>e&&(e=i),r&&i>r&&(r=i),at(Math.min(255,~~(t/n)),Math.min(255,~~(e/n)),Math.min(255,~~(r/n)))):at(i,i,i)},lo.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),at(~~(n*this.r),~~(n*this.g),~~(n*this.b))},lo.hsl=function(){return st(this.r,this.g,this.b)},lo.toString=function(){return"#"+ct(this.r)+ct(this.g)+ct(this.b)};var so=ya.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});so.forEach(function(n,t){so.set(n,it(t))}),ya.functor=pt,ya.xhr=dt(mt),ya.dsv=function(n,t){function e(n,e,u){arguments.length<3&&(u=e,e=null);var a=ya.xhr(n,t,u);return a.row=function(n){return arguments.length?a.response(null==(e=n)?r:i(n)):e},a.row(e)}function r(n){return e.parse(n.responseText)}function i(n){return function(t){return e.parse(t.responseText,n)}}function a(t){return t.map(o).join(n)}function o(n){return c.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var c=new RegExp('["'+n+"\n]"),l=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var i=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(i(n),e)}:i})},e.parseRows=function(n,t){function e(){if(s>=c)return a;if(i)return i=!1,u;var t=s;if(34===n.charCodeAt(t)){for(var e=t;e++<c;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}s=e+2;var r=n.charCodeAt(e+1);return 13===r?(i=!0,10===n.charCodeAt(e+2)&&++s):10===r&&(i=!0),n.substring(t+1,e).replace(/""/g,'"')}for(;c>s;){var r=n.charCodeAt(s++),o=1;if(10===r)i=!0;else if(13===r)i=!0,10===n.charCodeAt(s)&&(++s,++o);else if(r!==l)continue;return n.substring(t,s-o)}return n.substring(t)}for(var r,i,u={},a={},o=[],c=n.length,s=0,f=0;(r=e())!==a;){for(var h=[];r!==u&&r!==a;)h.push(r),r=e();(!t||(h=t(h,f++)))&&o.push(h)}return o},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new u,i=[];return t.forEach(function(n){for(var t in n)r.has(t)||i.push(r.add(t))}),[i.map(o).join(n)].concat(t.map(function(t){return i.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(a).join("\n")},e},ya.csv=ya.dsv(",","text/csv"),ya.tsv=ya.dsv("  ","text/tab-separated-values");var fo,ho,go,po,mo,vo=ba[o(ba,"requestAnimationFrame")]||function(n){setTimeout(n,17)};ya.timer=function(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());var i=e+t,u={callback:n,time:i,next:null};ho?ho.next=u:fo=u,ho=u,go||(po=clearTimeout(po),go=1,vo(Mt))},ya.timer.flush=function(){bt(),_t()};var yo=".",Mo=",",xo=[3,3],bo="$",_o=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"].map(wt);ya.formatPrefix=function(n,t){var e=0;return n&&(0>n&&(n*=-1),t&&(n=ya.round(n,St(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((0>=e?e+1:e-1)/3)))),_o[8+e/3]},ya.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)},ya.format=function(n){var t=wo.exec(n),e=t[1]||" ",r=t[2]||">",i=t[3]||"",u=t[4]||"",a=t[5],o=+t[6],c=t[7],l=t[8],s=t[9],f=1,h="",g=!1;switch(l&&(l=+l.substring(1)),(a||"0"===e&&"="===r)&&(a=e="0",r="=",c&&(o-=Math.floor((o-1)/4))),s){case"n":c=!0,s="g";break;case"%":f=100,h="%",s="f";break;case"p":f=100,h="%",s="r";break;case"b":case"o":case"x":case"X":"#"===u&&(u="0"+s.toLowerCase());case"c":case"d":g=!0,l=0;break;case"s":f=-1,s="r"}"#"===u?u="":"$"===u&&(u=bo),"r"!=s||l||(s="g"),null!=l&&("g"==s?l=Math.max(1,Math.min(21,l)):("e"==s||"f"==s)&&(l=Math.max(0,Math.min(20,l)))),s=So.get(s)||Et;var p=a&&c;return function(n){if(g&&n%1)return"";var t=0>n||0===n&&0>1/n?(n=-n,"-"):i;if(0>f){var m=ya.formatPrefix(n,l);n=m.scale(n),h=m.symbol}else n*=f;n=s(n,l);var d=n.lastIndexOf("."),v=0>d?n:n.substring(0,d),y=0>d?"":yo+n.substring(d+1);!a&&c&&(v=Eo(v));var M=u.length+v.length+y.length+(p?0:t.length),x=o>M?new Array(M=o-M+1).join(e):"";
return p&&(v=Eo(x+v)),t+=u,n=v+y,("<"===r?t+n+x:">"===r?x+t+n:"^"===r?x.substring(0,M>>=1)+t+n+x.substring(M):t+(p?n:x+n))+h}};var wo=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,So=ya.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=ya.round(n,St(n,t))).toFixed(Math.max(0,Math.min(20,St(n*(1+1e-15),t))))}}),Eo=mt;if(xo){var ko=xo.length;Eo=function(n){for(var t=n.length,e=[],r=0,i=xo[0];t>0&&i>0;)e.push(n.substring(t-=i,t+i)),i=xo[r=(r+1)%ko];return e.reverse().join(Mo)}}ya.geo={},kt.prototype={s:0,t:0,add:function(n){At(n,this.t,Ao),At(Ao.s,this.s,this),this.s?this.t+=Ao.t:this.s=Ao.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var Ao=new kt;ya.geo.stream=function(n,t){n&&No.hasOwnProperty(n.type)?No[n.type](n,t):Nt(n,t)};var No={Feature:function(n,t){Nt(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,i=e.length;++r<i;)Nt(e[r].geometry,t)}},qo={Sphere:function(n,t){t.sphere()},Point:function(n,t){var e=n.coordinates;t.point(e[0],e[1])},MultiPoint:function(n,t){for(var e,r=n.coordinates,i=-1,u=r.length;++i<u;)e=r[i],t.point(e[0],e[1])},LineString:function(n,t){qt(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)qt(e[r],t,0)},Polygon:function(n,t){Tt(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)Tt(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,i=e.length;++r<i;)Nt(e[r],t)}};ya.geo.area=function(n){return To=0,ya.geo.stream(n,zo),To};var To,Co=new kt,zo={sphere:function(){To+=4*Ka},point:s,lineStart:s,lineEnd:s,polygonStart:function(){Co.reset(),zo.lineStart=Ct},polygonEnd:function(){var n=2*Co;To+=0>n?4*Ka+n:n,zo.lineStart=zo.lineEnd=zo.point=s}};ya.geo.bounds=function(){function n(n,t){M.push(x=[s=n,h=n]),f>t&&(f=t),t>g&&(g=t)}function t(t,e){var r=zt([t*to,e*to]);if(v){var i=jt(v,r),u=[i[1],-i[0],0],a=jt(u,i);Ft(a),a=Pt(a);var c=t-p,l=c>0?1:-1,m=a[0]*eo*l,d=Math.abs(c)>180;if(d^(m>l*p&&l*t>m)){var y=a[1]*eo;y>g&&(g=y)}else if(m=(m+360)%360-180,d^(m>l*p&&l*t>m)){var y=-a[1]*eo;f>y&&(f=y)}else f>e&&(f=e),e>g&&(g=e);d?p>t?o(s,t)>o(s,h)&&(h=t):o(t,h)>o(s,h)&&(s=t):h>=s?(s>t&&(s=t),t>h&&(h=t)):t>p?o(s,t)>o(s,h)&&(h=t):o(t,h)>o(s,h)&&(s=t)}else n(t,e);v=r,p=t}function e(){b.point=t}function r(){x[0]=s,x[1]=h,b.point=n,v=null}function i(n,e){if(v){var r=n-p;y+=Math.abs(r)>180?r+(r>0?360:-360):r}else m=n,d=e;zo.point(n,e),t(n,e)}function u(){zo.lineStart()}function a(){i(m,d),zo.lineEnd(),Math.abs(y)>Qa&&(s=-(h=180)),x[0]=s,x[1]=h,v=null}function o(n,t){return(t-=n)<0?t+360:t}function c(n,t){return n[0]-t[0]}function l(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var s,f,h,g,p,m,d,v,y,M,x,b={point:n,lineStart:e,lineEnd:r,polygonStart:function(){b.point=i,b.lineStart=u,b.lineEnd=a,y=0,zo.polygonStart()},polygonEnd:function(){zo.polygonEnd(),b.point=n,b.lineStart=e,b.lineEnd=r,0>Co?(s=-(h=180),f=-(g=90)):y>Qa?g=90:-Qa>y&&(f=-90),x[0]=s,x[1]=h}};return function(n){g=h=-(s=f=1/0),M=[],ya.geo.stream(n,b);var t=M.length;if(t){M.sort(c);for(var e,r=1,i=M[0],u=[i];t>r;++r)e=M[r],l(e[0],i)||l(e[1],i)?(o(i[0],e[1])>o(i[0],i[1])&&(i[1]=e[1]),o(e[0],i[1])>o(i[0],i[1])&&(i[0]=e[0])):u.push(i=e);for(var a,e,p=-1/0,t=u.length-1,r=0,i=u[t];t>=r;i=e,++r)e=u[r],(a=o(i[1],e[0]))>p&&(p=a,s=e[0],h=i[1])}return M=x=null,1/0===s||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[s,f],[h,g]]}}(),ya.geo.centroid=function(n){Do=jo=Lo=Ho=Fo=Po=Oo=Yo=Ro=Uo=Io=0,ya.geo.stream(n,Vo);var t=Ro,e=Uo,r=Io,i=t*t+e*e+r*r;return no>i&&(t=Po,e=Oo,r=Yo,Qa>jo&&(t=Lo,e=Ho,r=Fo),i=t*t+e*e+r*r,no>i)?[0/0,0/0]:[Math.atan2(e,t)*eo,V(r/Math.sqrt(i))*eo]};var Do,jo,Lo,Ho,Fo,Po,Oo,Yo,Ro,Uo,Io,Vo={sphere:s,point:Yt,lineStart:Ut,lineEnd:It,polygonStart:function(){Vo.lineStart=Vt},polygonEnd:function(){Vo.lineStart=Ut}},Xo=$t(Xt,Qt,te,ee),Zo=[-Ka,0],Bo=1e9;(ya.geo.conicEqualArea=function(){return oe(ce)}).raw=ce,ya.geo.albers=function(){return ya.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ya.geo.albersUsa=function(){function n(n){var u=n[0],a=n[1];return t=null,e(u,a),t||(r(u,a),t)||i(u,a),t}var t,e,r,i,u=ya.geo.albers(),a=ya.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o=ya.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=u.scale(),e=u.translate(),r=(n[0]-e[0])/t,i=(n[1]-e[1])/t;return(i>=.12&&.234>i&&r>=-.425&&-.214>r?a:i>=.166&&.234>i&&r>=-.214&&-.115>r?o:u).invert(n)},n.stream=function(n){var t=u.stream(n),e=a.stream(n),r=o.stream(n);return{point:function(n,i){t.point(n,i),e.point(n,i),r.point(n,i)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(u.precision(t),a.precision(t),o.precision(t),n):u.precision()},n.scale=function(t){return arguments.length?(u.scale(t),a.scale(.35*t),o.scale(t),n.translate(u.translate())):u.scale()},n.translate=function(t){if(!arguments.length)return u.translate();var l=u.scale(),s=+t[0],f=+t[1];return e=u.translate(t).clipExtent([[s-.455*l,f-.238*l],[s+.455*l,f+.238*l]]).stream(c).point,r=a.translate([s-.307*l,f+.201*l]).clipExtent([[s-.425*l+Qa,f+.12*l+Qa],[s-.214*l-Qa,f+.234*l-Qa]]).stream(c).point,i=o.translate([s-.205*l,f+.212*l]).clipExtent([[s-.214*l+Qa,f+.166*l+Qa],[s-.115*l-Qa,f+.234*l-Qa]]).stream(c).point,n},n.scale(1070)};var $o,Wo,Jo,Go,Ko,Qo,nc={point:s,lineStart:s,lineEnd:s,polygonStart:function(){Wo=0,nc.lineStart=le},polygonEnd:function(){nc.lineStart=nc.lineEnd=nc.point=s,$o+=Math.abs(Wo/2)}},tc={point:se,lineStart:s,lineEnd:s,polygonStart:s,polygonEnd:s},ec={point:ge,lineStart:pe,lineEnd:me,polygonStart:function(){ec.lineStart=de},polygonEnd:function(){ec.point=ge,ec.lineStart=pe,ec.lineEnd=me}};ya.geo.path=function(){function n(n){return n&&("function"==typeof o&&u.pointRadius(+o.apply(this,arguments)),a&&a.valid||(a=i(u)),ya.geo.stream(n,a)),u.result()}function t(){return a=null,n}var e,r,i,u,a,o=4.5;return n.area=function(n){return $o=0,ya.geo.stream(n,i(nc)),$o},n.centroid=function(n){return Lo=Ho=Fo=Po=Oo=Yo=Ro=Uo=Io=0,ya.geo.stream(n,i(ec)),Io?[Ro/Io,Uo/Io]:Yo?[Po/Yo,Oo/Yo]:Fo?[Lo/Fo,Ho/Fo]:[0/0,0/0]},n.bounds=function(n){return Ko=Qo=-(Jo=Go=1/0),ya.geo.stream(n,i(tc)),[[Jo,Go],[Ko,Qo]]},n.projection=function(n){return arguments.length?(i=(e=n)?n.stream||Me(n):mt,t()):e},n.context=function(n){return arguments.length?(u=null==(r=n)?new fe:new ve(n),"function"!=typeof o&&u.pointRadius(o),t()):r},n.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(u.pointRadius(+t),+t),n):o},n.projection(ya.geo.albersUsa()).context(null)},ya.geo.projection=xe,ya.geo.projectionMutator=be,(ya.geo.equirectangular=function(){return xe(we)}).raw=we.invert=we,ya.geo.rotation=function(n){function t(t){return t=n(t[0]*to,t[1]*to),t[0]*=eo,t[1]*=eo,t}return n=Se(n[0]%360*to,n[1]*to,n.length>2?n[2]*to:0),t.invert=function(t){return t=n.invert(t[0]*to,t[1]*to),t[0]*=eo,t[1]*=eo,t},t},ya.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=Se(-n[0]*to,-n[1]*to,0).invert,i=[];return e(null,null,1,{point:function(n,e){i.push(n=t(n,e)),n[0]*=eo,n[1]*=eo}}),{type:"Polygon",coordinates:[i]}}var t,e,r=[0,0],i=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=Ne((t=+r)*to,i*to),n):t},n.precision=function(r){return arguments.length?(e=Ne(t*to,(i=+r)*to),n):i},n.angle(90)},ya.geo.distance=function(n,t){var e,r=(t[0]-n[0])*to,i=n[1]*to,u=t[1]*to,a=Math.sin(r),o=Math.cos(r),c=Math.sin(i),l=Math.cos(i),s=Math.sin(u),f=Math.cos(u);return Math.atan2(Math.sqrt((e=f*a)*e+(e=l*s-c*f*o)*e),c*s+l*f*o)},ya.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return ya.range(Math.ceil(u/d)*d,i,d).map(h).concat(ya.range(Math.ceil(l/v)*v,c,v).map(g)).concat(ya.range(Math.ceil(r/p)*p,e,p).filter(function(n){return Math.abs(n%d)>Qa}).map(s)).concat(ya.range(Math.ceil(o/m)*m,a,m).filter(function(n){return Math.abs(n%v)>Qa}).map(f))}var e,r,i,u,a,o,c,l,s,f,h,g,p=10,m=p,d=90,v=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(u).concat(g(c).slice(1),h(i).reverse().slice(1),g(l).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(u=+t[0][0],i=+t[1][0],l=+t[0][1],c=+t[1][1],u>i&&(t=u,u=i,i=t),l>c&&(t=l,l=c,c=t),n.precision(y)):[[u,l],[i,c]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],o=+t[0][1],a=+t[1][1],r>e&&(t=r,r=e,e=t),o>a&&(t=o,o=a,a=t),n.precision(y)):[[r,o],[e,a]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],v=+t[1],n):[d,v]},n.minorStep=function(t){return arguments.length?(p=+t[0],m=+t[1],n):[p,m]},n.precision=function(t){return arguments.length?(y=+t,s=Te(o,a,90),f=Ce(r,e,y),h=Te(l,c,90),g=Ce(u,i,y),n):y},n.majorExtent([[-180,-90+Qa],[180,90-Qa]]).minorExtent([[-180,-80-Qa],[180,80+Qa]])},ya.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||i.apply(this,arguments)]}}var t,e,r=ze,i=De;return n.distance=function(){return ya.geo.distance(t||r.apply(this,arguments),e||i.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(i=t,e="function"==typeof t?null:t,n):i},n.precision=function(){return arguments.length?n:0},n},ya.geo.interpolate=function(n,t){return je(n[0]*to,n[1]*to,t[0]*to,t[1]*to)},ya.geo.length=function(n){return rc=0,ya.geo.stream(n,ic),rc};var rc,ic={sphere:s,point:s,lineStart:Le,lineEnd:s,polygonStart:s,polygonEnd:s},uc=He(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(ya.geo.azimuthalEqualArea=function(){return xe(uc)}).raw=uc;var ac=He(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},mt);(ya.geo.azimuthalEquidistant=function(){return xe(ac)}).raw=ac,(ya.geo.conicConformal=function(){return oe(Fe)}).raw=Fe,(ya.geo.conicEquidistant=function(){return oe(Pe)}).raw=Pe;var oc=He(function(n){return 1/n},Math.atan);(ya.geo.gnomonic=function(){return xe(oc)}).raw=oc,Oe.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Ka/2]},(ya.geo.mercator=function(){return Ye(Oe)}).raw=Oe;var cc=He(function(){return 1},Math.asin);(ya.geo.orthographic=function(){return xe(cc)}).raw=cc;var lc=He(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(ya.geo.stereographic=function(){return xe(lc)}).raw=lc,Re.invert=function(n,t){return[Math.atan2(X(n),Math.cos(t)),V(Math.sin(t)/Z(n))]},(ya.geo.transverseMercator=function(){return Ye(Re)}).raw=Re,ya.geom={},ya.svg={},ya.svg.line=function(){return Ue(mt)};var sc=ya.map({linear:Xe,"linear-closed":Ze,step:Be,"step-before":$e,"step-after":We,basis:tr,"basis-open":er,"basis-closed":rr,bundle:ir,cardinal:Ke,"cardinal-open":Je,"cardinal-closed":Ge,monotone:sr});sc.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var fc=[0,2/3,1/3,0],hc=[0,1/3,2/3,0],gc=[0,1/6,2/3,1/6];ya.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,i,u,a,o,c,l,s,f,h,g,p,m=pt(e),d=pt(r),v=n.length,y=v-1,M=[],x=[],b=0;if(m===Ie&&r===Ve)t=n;else for(u=0,t=[];v>u;++u)t.push([+m.call(this,i=n[u],u),+d.call(this,i,u)]);for(u=1;v>u;++u)(t[u][1]<t[b][1]||t[u][1]==t[b][1]&&t[u][0]<t[b][0])&&(b=u);for(u=0;v>u;++u)u!==b&&(c=t[u][1]-t[b][1],o=t[u][0]-t[b][0],M.push({angle:Math.atan2(c,o),index:u}));for(M.sort(function(n,t){return n.angle-t.angle}),g=M[0].angle,h=M[0].index,f=0,u=1;y>u;++u){if(a=M[u].index,g==M[u].angle){if(o=t[h][0]-t[b][0],c=t[h][1]-t[b][1],l=t[a][0]-t[b][0],s=t[a][1]-t[b][1],o*o+c*c>=l*l+s*s){M[u].index=-1;continue}M[f].index=-1}g=M[u].angle,f=u,h=a}for(x.push(b),u=0,a=0;2>u;++a)M[a].index>-1&&(x.push(M[a].index),u++);for(p=x.length;y>a;++a)if(!(M[a].index<0)){for(;!fr(x[p-2],x[p-1],M[a].index,t);)--p;x[p++]=M[a].index}var _=[];for(u=p-1;u>=0;--u)_.push(n[x[u]]);return _}var e=Ie,r=Ve;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},ya.geom.polygon=function(n){return La(n,pc),n};var pc=ya.geom.polygon.prototype=[];pc.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],i=0;++t<e;)n=r,r=this[t],i+=n[1]*r[0]-n[0]*r[1];return.5*i},pc.centroid=function(n){var t,e,r=-1,i=this.length,u=0,a=0,o=this[i-1];for(arguments.length||(n=-1/(6*this.area()));++r<i;)t=o,o=this[r],e=t[0]*o[1]-o[0]*t[1],u+=(t[0]+o[0])*e,a+=(t[1]+o[1])*e;return[u*n,a*n]},pc.clip=function(n){for(var t,e,r,i,u,a,o=pr(n),c=-1,l=this.length-pr(this),s=this[l-1];++c<l;){for(t=n.slice(),n.length=0,i=this[c],u=t[(r=t.length-o)-1],e=-1;++e<r;)a=t[e],hr(a,s,i)?(hr(u,s,i)||n.push(gr(u,a,s,i)),n.push(a)):hr(u,s,i)&&n.push(gr(u,a,s,i)),u=a;o&&n.push(n[0]),s=i}return n},ya.geom.delaunay=function(n){var t=n.map(function(){return[]}),e=[];return mr(n,function(e){t[e.region.l.index].push(n[e.region.r.index])}),t.forEach(function(t,r){var i=n[r],u=i[0],a=i[1];t.forEach(function(n){n.angle=Math.atan2(n[0]-u,n[1]-a)}),t.sort(function(n,t){return n.angle-t.angle});for(var o=0,c=t.length-1;c>o;o++)e.push([i,t[o],t[o+1]])}),e},ya.geom.voronoi=function(n){function t(n){var t,u,a,o=n.map(function(){return[]}),c=pt(e),l=pt(r),s=n.length,f=1e6;if(c===Ie&&l===Ve)t=n;else for(t=new Array(s),a=0;s>a;++a)t[a]=[+c.call(this,u=n[a],a),+l.call(this,u,a)];if(mr(t,function(n){var t,e,r,i,u,a;1===n.a&&n.b>=0?(t=n.ep.r,e=n.ep.l):(t=n.ep.l,e=n.ep.r),1===n.a?(u=t?t.y:-f,r=n.c-n.b*u,a=e?e.y:f,i=n.c-n.b*a):(r=t?t.x:-f,u=n.c-n.a*r,i=e?e.x:f,a=n.c-n.a*i);var c=[r,u],l=[i,a];o[n.region.l.index].push(c,l),o[n.region.r.index].push(c,l)}),o=o.map(function(n,e){var r=t[e][0],i=t[e][1],u=n.map(function(n){return Math.atan2(n[0]-r,n[1]-i)}),a=ya.range(n.length).sort(function(n,t){return u[n]-u[t]});return a.filter(function(n,t){return!t||u[n]-u[a[t-1]]>Qa}).map(function(t){return n[t]})}),o.forEach(function(n,e){var r=n.length;if(!r)return n.push([-f,-f],[-f,f],[f,f],[f,-f]);if(!(r>2)){var i=t[e],u=n[0],a=n[1],o=i[0],c=i[1],l=u[0],s=u[1],h=a[0],g=a[1],p=Math.abs(h-l),m=g-s;if(Math.abs(m)<Qa){var d=s>c?-f:f;n.push([-f,d],[f,d])}else if(Qa>p){var v=l>o?-f:f;n.push([v,-f],[v,f])}else{var d=(l-o)*(g-s)>(h-l)*(s-c)?f:-f,y=Math.abs(m)-p;Math.abs(y)<Qa?n.push([0>m?d:-d,d]):(y>0&&(d*=-1),n.push([-f,d],[f,d]))}}}),i)for(a=0;s>a;++a)i.clip(o[a]);for(a=0;s>a;++a)o[a].point=n[a];return o}var e=Ie,r=Ve,i=null;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.clipExtent=function(n){if(!arguments.length)return i&&[i[0],i[2]];if(null==n)i=null;else{var e=+n[0][0],r=+n[0][1],u=+n[1][0],a=+n[1][1];i=ya.geom.polygon([[e,r],[e,a],[u,a],[u,r]])}return t},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):i&&i[2]},t.links=function(n){var t,i,u,a=n.map(function(){return[]}),o=[],c=pt(e),l=pt(r),s=n.length;if(c===Ie&&l===Ve)t=n;else for(t=new Array(s),u=0;s>u;++u)t[u]=[+c.call(this,i=n[u],u),+l.call(this,i,u)];return mr(t,function(t){var e=t.region.l.index,r=t.region.r.index;a[e][r]||(a[e][r]=a[r][e]=!0,o.push({source:n[e],target:n[r]}))}),o},t.triangles=function(n){if(e===Ie&&r===Ve)return ya.geom.delaunay(n);for(var t,i=new Array(c),u=pt(e),a=pt(r),o=-1,c=n.length;++o<c;)(i[o]=[+u.call(this,t=n[o],o),+a.call(this,t,o)]).data=t;return ya.geom.delaunay(i).map(function(n){return n.map(function(n){return n.data})})},t)};var mc={l:"r",r:"l"};ya.geom.quadtree=function(n,t,e,r,i){function u(n){function u(n,t,e,r,i,u,a,o){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var c=n.x,s=n.y;if(null!=c)if(Math.abs(c-e)+Math.abs(s-r)<.01)l(n,t,e,r,i,u,a,o);else{var f=n.point;n.x=n.y=n.point=null,l(n,f,c,s,i,u,a,o),l(n,t,e,r,i,u,a,o)}else n.x=e,n.y=r,n.point=t}else l(n,t,e,r,i,u,a,o)}function l(n,t,e,r,i,a,o,c){var l=.5*(i+o),s=.5*(a+c),f=e>=l,h=r>=s,g=(h<<1)+f;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=yr()),f?i=l:o=l,h?a=s:c=s,u(n,t,e,r,i,a,o,c)}var s,f,h,g,p,m,d,v,y,M=pt(o),x=pt(c);if(null!=t)m=t,d=e,v=r,y=i;else if(v=y=-(m=d=1/0),f=[],h=[],p=n.length,a)for(g=0;p>g;++g)s=n[g],s.x<m&&(m=s.x),s.y<d&&(d=s.y),s.x>v&&(v=s.x),s.y>y&&(y=s.y),f.push(s.x),h.push(s.y);else for(g=0;p>g;++g){var b=+M(s=n[g],g),_=+x(s,g);m>b&&(m=b),d>_&&(d=_),b>v&&(v=b),_>y&&(y=_),f.push(b),h.push(_)}var w=v-m,S=y-d;w>S?y=d+w:v=m+S;var E=yr();if(E.add=function(n){u(E,n,+M(n,++g),+x(n,g),m,d,v,y)},E.visit=function(n){Mr(n,E,m,d,v,y)},g=-1,null==t){for(;++g<p;)u(E,n[g],f[g],h[g],m,d,v,y);--g}else n.forEach(E.add);return f=h=n=s=null,E}var a,o=Ie,c=Ve;return(a=arguments.length)?(o=dr,c=vr,3===a&&(i=e,r=t,e=t=0),u(n)):(u.x=function(n){return arguments.length?(o=n,u):o},u.y=function(n){return arguments.length?(c=n,u):c},u.extent=function(n){return arguments.length?(null==n?t=e=r=i=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],i=+n[1][1]),u):null==t?null:[[t,e],[r,i]]},u.size=function(n){return arguments.length?(null==n?t=e=r=i=null:(t=e=0,r=+n[0],i=+n[1]),u):null==t?null:[r-t,i-e]},u)},ya.interpolateRgb=xr,ya.interpolateObject=br,ya.interpolateNumber=_r,ya.interpolateString=wr;var dc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;ya.interpolate=Sr,ya.interpolators=[function(n,t){var e=typeof t;return("string"===e?so.has(t)||/^(#|rgb\(|hsl\()/.test(t)?xr:wr:t instanceof P?xr:"object"===e?Array.isArray(t)?Er:br:_r)(n,t)}],ya.interpolateArray=Er;var vc=function(){return mt},yc=ya.map({linear:vc,poly:zr,quad:function(){return qr},cubic:function(){return Tr},sin:function(){return Dr},exp:function(){return jr},circle:function(){return Lr},elastic:Hr,back:Fr,bounce:function(){return Pr}}),Mc=ya.map({"in":mt,out:Ar,"in-out":Nr,"out-in":function(n){return Nr(Ar(n))}});ya.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.substring(0,t):n,r=t>=0?n.substring(t+1):"in";return e=yc.get(e)||vc,r=Mc.get(r)||mt,kr(r(e.apply(null,Array.prototype.slice.call(arguments,1))))},ya.interpolateHcl=Or,ya.interpolateHsl=Yr,ya.interpolateLab=Rr,ya.interpolateRound=Ur,ya.transform=function(n){var t=Ma.createElementNS(ya.ns.prefix.svg,"g");return(ya.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new Ir(e?e.matrix:xc)})(n)},Ir.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var xc={a:1,b:0,c:0,d:1,e:0,f:0};ya.interpolateTransform=Br,ya.layout={},ya.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Jr(n[e]));return t}},ya.layout.chord=function(){function n(){var n,l,f,h,g,p={},m=[],d=ya.range(u),v=[];for(e=[],r=[],n=0,h=-1;++h<u;){for(l=0,g=-1;++g<u;)l+=i[h][g];m.push(l),v.push(ya.range(u)),n+=l}for(a&&d.sort(function(n,t){return a(m[n],m[t])}),o&&v.forEach(function(n,t){n.sort(function(n,e){return o(i[t][n],i[t][e])})}),n=(2*Ka-s*u)/n,l=0,h=-1;++h<u;){for(f=l,g=-1;++g<u;){var y=d[h],M=v[y][g],x=i[y][M],b=l,_=l+=x*n;p[y+"-"+M]={index:y,subindex:M,startAngle:b,endAngle:_,value:x}}r[y]={index:y,startAngle:f,endAngle:l,value:(l-f)/n},l+=s}for(h=-1;++h<u;)for(g=h-1;++g<u;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){e.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,i,u,a,o,c,l={},s=0;return l.matrix=function(n){return arguments.length?(u=(i=n)&&i.length,e=r=null,l):i},l.padding=function(n){return arguments.length?(s=n,e=r=null,l):s},l.sortGroups=function(n){return arguments.length?(a=n,e=r=null,l):a},l.sortSubgroups=function(n){return arguments.length?(o=n,e=null,l):o},l.sortChords=function(n){return arguments.length?(c=n,e&&t(),l):c},l.chords=function(){return e||n(),e},l.groups=function(){return r||n(),r},l},ya.layout.force=function(){function n(n){return function(t,e,r,i){if(t.point!==n){var u=t.cx-n.x,a=t.cy-n.y,o=1/Math.sqrt(u*u+a*a);if(m>(i-e)*o){var c=t.charge*o*o;return n.px-=u*c,n.py-=a*c,!0}if(t.point&&isFinite(o)){var c=t.pointCharge*o*o;n.px-=u*c,n.py-=a*c}}return!t.charge}}function t(n){n.px=ya.event.x,n.py=ya.event.y,o.resume()}var e,r,i,u,a,o={},c=ya.dispatch("start","tick","end"),l=[1,1],s=.9,f=bc,h=_c,g=-30,p=.1,m=.8,d=[],v=[];return o.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,e,o,f,h,m,y,M,x,b=d.length,_=v.length;for(e=0;_>e;++e)o=v[e],f=o.source,h=o.target,M=h.x-f.x,x=h.y-f.y,(m=M*M+x*x)&&(m=r*u[e]*((m=Math.sqrt(m))-i[e])/m,M*=m,x*=m,h.x-=M*(y=f.weight/(h.weight+f.weight)),h.y-=x*y,f.x+=M*(y=1-y),f.y+=x*y);if((y=r*p)&&(M=l[0]/2,x=l[1]/2,e=-1,y))for(;++e<b;)o=d[e],o.x+=(M-o.x)*y,o.y+=(x-o.y)*y;if(g)for(ri(t=ya.geom.quadtree(d),r,a),e=-1;++e<b;)(o=d[e]).fixed||t.visit(n(o));for(e=-1;++e<b;)o=d[e],o.fixed?(o.x=o.px,o.y=o.py):(o.x-=(o.px-(o.px=o.x))*s,o.y-=(o.py-(o.py=o.y))*s);c.tick({type:"tick",alpha:r})},o.nodes=function(n){return arguments.length?(d=n,o):d},o.links=function(n){return arguments.length?(v=n,o):v},o.size=function(n){return arguments.length?(l=n,o):l},o.linkDistance=function(n){return arguments.length?(f="function"==typeof n?n:+n,o):f},o.distance=o.linkDistance,o.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,o):h},o.friction=function(n){return arguments.length?(s=+n,o):s},o.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,o):g},o.gravity=function(n){return arguments.length?(p=+n,o):p},o.theta=function(n){return arguments.length?(m=+n,o):m},o.alpha=function(n){return arguments.length?(n=+n,r?r=n>0?n:0:n>0&&(c.start({type:"start",alpha:r=n}),ya.timer(o.tick)),o):r},o.start=function(){function n(n,r){for(var i,u=t(e),a=-1,o=u.length;++a<o;)if(!isNaN(i=u[a][n]))return i;return Math.random()*r}function t(){if(!c){for(c=[],r=0;p>r;++r)c[r]=[];for(r=0;m>r;++r){var n=v[r];c[n.source.index].push(n.target),c[n.target.index].push(n.source)}}return c[e]}var e,r,c,s,p=d.length,m=v.length,y=l[0],M=l[1];for(e=0;p>e;++e)(s=d[e]).index=e,s.weight=0;for(e=0;m>e;++e)s=v[e],"number"==typeof s.source&&(s.source=d[s.source]),"number"==typeof s.target&&(s.target=d[s.target]),++s.source.weight,++s.target.weight;for(e=0;p>e;++e)s=d[e],isNaN(s.x)&&(s.x=n("x",y)),isNaN(s.y)&&(s.y=n("y",M)),isNaN(s.px)&&(s.px=s.x),isNaN(s.py)&&(s.py=s.y);if(i=[],"function"==typeof f)for(e=0;m>e;++e)i[e]=+f.call(this,v[e],e);else for(e=0;m>e;++e)i[e]=f;if(u=[],"function"==typeof h)for(e=0;m>e;++e)u[e]=+h.call(this,v[e],e);else for(e=0;m>e;++e)u[e]=h;if(a=[],"function"==typeof g)for(e=0;p>e;++e)a[e]=+g.call(this,d[e],e);else for(e=0;p>e;++e)a[e]=g;return o.resume()},o.resume=function(){return o.alpha(.1)},o.stop=function(){return o.alpha(0)},o.drag=function(){return e||(e=ya.behavior.drag().origin(mt).on("dragstart.force",Qr).on("drag.force",t).on("dragend.force",ni)),arguments.length?void this.on("mouseover.force",ti).on("mouseout.force",ei).call(e):e},ya.rebind(o,c,"on")};var bc=20,_c=1;ya.layout.hierarchy=function(){function n(t,a,o){var c=i.call(e,t,a);if(t.depth=a,o.push(t),c&&(l=c.length)){for(var l,s,f=-1,h=t.children=[],g=0,p=a+1;++f<l;)s=n(c[f],p,o),s.parent=t,h.push(s),g+=s.value;r&&h.sort(r),u&&(t.value=g)}else u&&(t.value=+u.call(e,t,a)||0);return t}function t(n,r){var i=n.children,a=0;if(i&&(o=i.length))for(var o,c=-1,l=r+1;++c<o;)a+=t(i[c],l);else u&&(a=+u.call(e,n,r)||0);return u&&(n.value=a),a}function e(t){var e=[];return n(t,0,e),e}var r=oi,i=ui,u=ai;return e.sort=function(n){return arguments.length?(r=n,e):r},e.children=function(n){return arguments.length?(i=n,e):i},e.value=function(n){return arguments.length?(u=n,e):u},e.revalue=function(n){return t(n,0),n},e},ya.layout.partition=function(){function n(t,e,r,i){var u=t.children;if(t.x=e,t.y=t.depth*i,t.dx=r,t.dy=i,u&&(a=u.length)){var a,o,c,l=-1;for(r=t.value?r/t.value:0;++l<a;)n(o=u[l],e,c=o.value*r,i),e+=c}}function t(n){var e=n.children,r=0;if(e&&(i=e.length))for(var i,u=-1;++u<i;)r=Math.max(r,t(e[u]));return 1+r}function e(e,u){var a=r.call(this,e,u);return n(a[0],0,i[0],i[1]/t(a[0])),a}var r=ya.layout.hierarchy(),i=[1,1];return e.size=function(n){return arguments.length?(i=n,e):i},ii(e,r)},ya.layout.pie=function(){function n(u){var a=u.map(function(e,r){return+t.call(n,e,r)}),o=+("function"==typeof r?r.apply(this,arguments):r),c=(("function"==typeof i?i.apply(this,arguments):i)-o)/ya.sum(a),l=ya.range(u.length);null!=e&&l.sort(e===wc?function(n,t){return a[t]-a[n]}:function(n,t){return e(u[n],u[t])});var s=[];return l.forEach(function(n){var t;s[n]={data:u[n],value:t=a[n],startAngle:o,endAngle:o+=t*c}}),s}var t=Number,e=wc,r=0,i=2*Ka;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(i=t,n):i},n};var wc={};ya.layout.stack=function(){function n(o,c){var l=o.map(function(e,r){return t.call(n,e,r)}),s=l.map(function(t){return t.map(function(t,e){return[u.call(n,t,e),a.call(n,t,e)]})}),f=e.call(n,s,c);l=ya.permute(l,f),s=ya.permute(s,f);var h,g,p,m=r.call(n,s,c),d=l.length,v=l[0].length;for(g=0;v>g;++g)for(i.call(n,l[0][g],p=m[g],s[0][g][1]),h=1;d>h;++h)i.call(n,l[h][g],p+=s[h-1][g][1],s[h][g][1]);return o}var t=mt,e=hi,r=gi,i=fi,u=li,a=si;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:Sc.get(t)||hi,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:Ec.get(t)||gi,n):r},n.x=function(t){return arguments.length?(u=t,n):u},n.y=function(t){return arguments.length?(a=t,n):a},n.out=function(t){return arguments.length?(i=t,n):i},n};var Sc=ya.map({"inside-out":function(n){var t,e,r=n.length,i=n.map(pi),u=n.map(mi),a=ya.range(r).sort(function(n,t){return i[n]-i[t]}),o=0,c=0,l=[],s=[];for(t=0;r>t;++t)e=a[t],c>o?(o+=u[e],l.push(e)):(c+=u[e],s.push(e));return s.reverse().concat(l)},reverse:function(n){return ya.range(n.length).reverse()},"default":hi}),Ec=ya.map({silhouette:function(n){var t,e,r,i=n.length,u=n[0].length,a=[],o=0,c=[];for(e=0;u>e;++e){for(t=0,r=0;i>t;t++)r+=n[t][e][1];r>o&&(o=r),a.push(r)}for(e=0;u>e;++e)c[e]=(o-a[e])/2;return c},wiggle:function(n){var t,e,r,i,u,a,o,c,l,s=n.length,f=n[0],h=f.length,g=[];for(g[0]=c=l=0,e=1;h>e;++e){for(t=0,i=0;s>t;++t)i+=n[t][e][1];for(t=0,u=0,o=f[e][0]-f[e-1][0];s>t;++t){for(r=0,a=(n[t][e][1]-n[t][e-1][1])/(2*o);t>r;++r)a+=(n[r][e][1]-n[r][e-1][1])/o;u+=a*n[t][e][1]}g[e]=c-=i?u/i*o:0,l>c&&(l=c)}for(e=0;h>e;++e)g[e]-=l;return g},expand:function(n){var t,e,r,i=n.length,u=n[0].length,a=1/i,o=[];for(e=0;u>e;++e){for(t=0,r=0;i>t;t++)r+=n[t][e][1];if(r)for(t=0;i>t;t++)n[t][e][1]/=r;else for(t=0;i>t;t++)n[t][e][1]=a}for(e=0;u>e;++e)o[e]=0;return o},zero:gi});ya.layout.histogram=function(){function n(n,u){for(var a,o,c=[],l=n.map(e,this),s=r.call(this,l,u),f=i.call(this,s,l,u),u=-1,h=l.length,g=f.length-1,p=t?1:1/h;++u<g;)a=c[u]=[],a.dx=f[u+1]-(a.x=f[u]),a.y=0;if(g>0)for(u=-1;++u<h;)o=l[u],o>=s[0]&&o<=s[1]&&(a=c[ya.bisect(f,o,1,g)-1],a.y+=p,a.push(n[u]));return c}var t=!0,e=Number,r=Mi,i=vi;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=pt(t),n):r},n.bins=function(t){return arguments.length?(i="number"==typeof t?function(n){return yi(n,t)}:pt(t),n):i},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},ya.layout.tree=function(){function n(n,u){function a(n,t){var r=n.children,i=n._tree;if(r&&(u=r.length)){for(var u,o,l,s=r[0],f=s,h=-1;++h<u;)l=r[h],a(l,o),f=c(l,o,f),o=l;Ni(n);var g=.5*(s._tree.prelim+l._tree.prelim);t?(i.prelim=t._tree.prelim+e(n,t),i.mod=i.prelim-g):i.prelim=g}else t&&(i.prelim=t._tree.prelim+e(n,t))}function o(n,t){n.x=n._tree.prelim+t;var e=n.children;if(e&&(r=e.length)){var r,i=-1;for(t+=n._tree.mod;++i<r;)o(e[i],t)}}function c(n,t,r){if(t){for(var i,u=n,a=n,o=t,c=n.parent.children[0],l=u._tree.mod,s=a._tree.mod,f=o._tree.mod,h=c._tree.mod;o=_i(o),u=bi(u),o&&u;)c=bi(c),a=_i(a),a._tree.ancestor=n,i=o._tree.prelim+f-u._tree.prelim-l+e(o,u),i>0&&(qi(Ti(o,n,r),n,i),l+=i,s+=i),f+=o._tree.mod,l+=u._tree.mod,h+=c._tree.mod,s+=a._tree.mod;o&&!_i(a)&&(a._tree.thread=o,a._tree.mod+=f-s),u&&!bi(c)&&(c._tree.thread=u,c._tree.mod+=l-h,r=n)}return r}var l=t.call(this,n,u),s=l[0];Ai(s,function(n,t){n._tree={ancestor:n,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),a(s),o(s,-s._tree.prelim);var f=wi(s,Ei),h=wi(s,Si),g=wi(s,ki),p=f.x-e(f,h)/2,m=h.x+e(h,f)/2,d=g.depth||1;return Ai(s,i?function(n){n.x*=r[0],n.y=n.depth*r[1],delete n._tree}:function(n){n.x=(n.x-p)/(m-p)*r[0],n.y=n.depth/d*r[1],delete n._tree}),l}var t=ya.layout.hierarchy().sort(null).value(null),e=xi,r=[1,1],i=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(i=null==(r=t),n):i?null:r},n.nodeSize=function(t){return arguments.length?(i=null!=(r=t),n):i?r:null},ii(n,t)},ya.layout.pack=function(){function n(n,u){var a=e.call(this,n,u),o=a[0],c=i[0],l=i[1],s=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(o.x=o.y=0,Ai(o,function(n){n.r=+s(n.value)}),Ai(o,Li),r){var f=r*(t?1:Math.max(2*o.r/c,2*o.r/l))/2;Ai(o,function(n){n.r+=f}),Ai(o,Li),Ai(o,function(n){n.r-=f})}return Pi(o,c/2,l/2,t?1:1/Math.max(2*o.r/c,2*o.r/l)),a}var t,e=ya.layout.hierarchy().sort(Ci),r=0,i=[1,1];return n.size=function(t){return arguments.length?(i=t,n):i},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},ii(n,e)},ya.layout.cluster=function(){function n(n,u){var a,o=t.call(this,n,u),c=o[0],l=0;Ai(c,function(n){var t=n.children;t&&t.length?(n.x=Ri(t),n.y=Yi(t)):(n.x=a?l+=e(n,a):0,n.y=0,a=n)});var s=Ui(c),f=Ii(c),h=s.x-e(s,f)/2,g=f.x+e(f,s)/2;return Ai(c,i?function(n){n.x=(n.x-c.x)*r[0],n.y=(c.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(g-h)*r[0],n.y=(1-(c.y?n.y/c.y:1))*r[1]}),o}var t=ya.layout.hierarchy().sort(null).value(null),e=xi,r=[1,1],i=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(i=null==(r=t),n):i?null:r},n.nodeSize=function(t){return arguments.length?(i=null!=(r=t),n):i?r:null},ii(n,t)},ya.layout.treemap=function(){function n(n,t){for(var e,r,i=-1,u=n.length;++i<u;)r=(e=n[i]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var u=e.children;if(u&&u.length){var a,o,c,l=f(e),s=[],h=u.slice(),p=1/0,m="slice"===g?l.dx:"dice"===g?l.dy:"slice-dice"===g?1&e.depth?l.dy:l.dx:Math.min(l.dx,l.dy);for(n(h,l.dx*l.dy/e.value),s.area=0;(c=h.length)>0;)s.push(a=h[c-1]),s.area+=a.area,"squarify"!==g||(o=r(s,m))<=p?(h.pop(),p=o):(s.area-=s.pop().area,i(s,m,l,!1),m=Math.min(l.dx,l.dy),s.length=s.area=0,p=1/0);s.length&&(i(s,m,l,!0),s.length=s.area=0),u.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var u,a=f(t),o=r.slice(),c=[];for(n(o,a.dx*a.dy/t.value),c.area=0;u=o.pop();)c.push(u),c.area+=u.area,null!=u.z&&(i(c,u.z?a.dx:a.dy,a,!o.length),c.length=c.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,i=0,u=1/0,a=-1,o=n.length;++a<o;)(e=n[a].area)&&(u>e&&(u=e),e>i&&(i=e));return r*=r,t*=t,r?Math.max(t*i*p/r,r/(t*u*p)):1/0}function i(n,t,e,r){var i,u=-1,a=n.length,o=e.x,l=e.y,s=t?c(n.area/t):0;if(t==e.dx){for((r||s>e.dy)&&(s=e.dy);++u<a;)i=n[u],i.x=o,i.y=l,i.dy=s,o+=i.dx=Math.min(e.x+e.dx-o,s?c(i.area/s):0);i.z=!0,i.dx+=e.x+e.dx-o,e.y+=s,e.dy-=s}else{for((r||s>e.dx)&&(s=e.dx);++u<a;)i=n[u],i.x=o,i.y=l,i.dx=s,l+=i.dy=Math.min(e.y+e.dy-l,s?c(i.area/s):0);i.z=!1,i.dy+=e.y+e.dy-l,e.x+=s,e.dx-=s}}function u(r){var i=a||o(r),u=i[0];return u.x=0,u.y=0,u.dx=l[0],u.dy=l[1],a&&o.revalue(u),n([u],u.dx*u.dy/u.value),(a?e:t)(u),h&&(a=i),i}var a,o=ya.layout.hierarchy(),c=Math.round,l=[1,1],s=null,f=Vi,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));return u.size=function(n){return arguments.length?(l=n,u):l},u.padding=function(n){function t(t){var e=n.call(u,t,t.depth);return null==e?Vi(t):Xi(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Xi(t,n)}if(!arguments.length)return s;
var r;return f=null==(s=n)?Vi:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,u},u.round=function(n){return arguments.length?(c=n?Math.round:Number,u):c!=Number},u.sticky=function(n){return arguments.length?(h=n,a=null,u):h},u.ratio=function(n){return arguments.length?(p=n,u):p},u.mode=function(n){return arguments.length?(g=n+"",u):g},ii(u,o)},ya.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,i;do e=2*Math.random()-1,r=2*Math.random()-1,i=e*e+r*r;while(!i||i>1);return n+t*e*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var n=ya.random.normal.apply(ya,arguments);return function(){return Math.exp(n())}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t/n}}},ya.scale={};var kc={floor:mt,ceil:mt};ya.scale.linear=function(){return Ki([0,1],[0,1],Sr,!1)},ya.scale.log=function(){return uu(ya.scale.linear().domain([0,1]),10,!0,[1,10])};var Ac=ya.format(".0e"),Nc={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};ya.scale.pow=function(){return au(ya.scale.linear(),1,[0,1])},ya.scale.sqrt=function(){return ya.scale.pow().exponent(.5)},ya.scale.ordinal=function(){return cu([],{t:"range",a:[[]]})},ya.scale.category10=function(){return ya.scale.ordinal().range(qc)},ya.scale.category20=function(){return ya.scale.ordinal().range(Tc)},ya.scale.category20b=function(){return ya.scale.ordinal().range(Cc)},ya.scale.category20c=function(){return ya.scale.ordinal().range(zc)};var qc=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(ut),Tc=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(ut),Cc=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(ut),zc=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(ut);ya.scale.quantile=function(){return lu([],[])},ya.scale.quantize=function(){return su(0,1,[0,1])},ya.scale.threshold=function(){return fu([.5],[0,1])},ya.scale.identity=function(){return hu([0,1])},ya.svg.arc=function(){function n(){var n=t.apply(this,arguments),u=e.apply(this,arguments),a=r.apply(this,arguments)+Dc,o=i.apply(this,arguments)+Dc,c=(a>o&&(c=a,a=o,o=c),o-a),l=Ka>c?"0":"1",s=Math.cos(a),f=Math.sin(a),h=Math.cos(o),g=Math.sin(o);return c>=jc?n?"M0,"+u+"A"+u+","+u+" 0 1,1 0,"+-u+"A"+u+","+u+" 0 1,1 0,"+u+"M0,"+n+"A"+n+","+n+" 0 1,0 0,"+-n+"A"+n+","+n+" 0 1,0 0,"+n+"Z":"M0,"+u+"A"+u+","+u+" 0 1,1 0,"+-u+"A"+u+","+u+" 0 1,1 0,"+u+"Z":n?"M"+u*s+","+u*f+"A"+u+","+u+" 0 "+l+",1 "+u*h+","+u*g+"L"+n*h+","+n*g+"A"+n+","+n+" 0 "+l+",0 "+n*s+","+n*f+"Z":"M"+u*s+","+u*f+"A"+u+","+u+" 0 "+l+",1 "+u*h+","+u*g+"L0,0Z"}var t=gu,e=pu,r=mu,i=du;return n.innerRadius=function(e){return arguments.length?(t=pt(e),n):t},n.outerRadius=function(t){return arguments.length?(e=pt(t),n):e},n.startAngle=function(t){return arguments.length?(r=pt(t),n):r},n.endAngle=function(t){return arguments.length?(i=pt(t),n):i},n.centroid=function(){var n=(t.apply(this,arguments)+e.apply(this,arguments))/2,u=(r.apply(this,arguments)+i.apply(this,arguments))/2+Dc;return[Math.cos(u)*n,Math.sin(u)*n]},n};var Dc=-Ka/2,jc=2*Ka-1e-6;ya.svg.line.radial=function(){var n=Ue(vu);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},$e.reverse=We,We.reverse=$e,ya.svg.area=function(){return yu(mt)},ya.svg.area.radial=function(){var n=yu(vu);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},ya.svg.chord=function(){function n(n,o){var c=t(this,u,n,o),l=t(this,a,n,o);return"M"+c.p0+r(c.r,c.p1,c.a1-c.a0)+(e(c,l)?i(c.r,c.p1,c.r,c.p0):i(c.r,c.p1,l.r,l.p0)+r(l.r,l.p1,l.a1-l.a0)+i(l.r,l.p1,c.r,c.p0))+"Z"}function t(n,t,e,r){var i=t.call(n,e,r),u=o.call(n,i,r),a=c.call(n,i,r)+Dc,s=l.call(n,i,r)+Dc;return{r:u,a0:a,a1:s,p0:[u*Math.cos(a),u*Math.sin(a)],p1:[u*Math.cos(s),u*Math.sin(s)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>Ka)+",1 "+t}function i(n,t,e,r){return"Q 0,0 "+r}var u=ze,a=De,o=Mu,c=mu,l=du;return n.radius=function(t){return arguments.length?(o=pt(t),n):o},n.source=function(t){return arguments.length?(u=pt(t),n):u},n.target=function(t){return arguments.length?(a=pt(t),n):a},n.startAngle=function(t){return arguments.length?(c=pt(t),n):c},n.endAngle=function(t){return arguments.length?(l=pt(t),n):l},n},ya.svg.diagonal=function(){function n(n,i){var u=t.call(this,n,i),a=e.call(this,n,i),o=(u.y+a.y)/2,c=[u,{x:u.x,y:o},{x:a.x,y:o},a];return c=c.map(r),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=ze,e=De,r=xu;return n.source=function(e){return arguments.length?(t=pt(e),n):t},n.target=function(t){return arguments.length?(e=pt(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},ya.svg.diagonal.radial=function(){var n=ya.svg.diagonal(),t=xu,e=n.projection;return n.projection=function(n){return arguments.length?e(bu(t=n)):t},n},ya.svg.symbol=function(){function n(n,r){return(Lc.get(t.call(this,n,r))||Su)(e.call(this,n,r))}var t=wu,e=_u;return n.type=function(e){return arguments.length?(t=pt(e),n):t},n.size=function(t){return arguments.length?(e=pt(t),n):e},n};var Lc=ya.map({circle:Su,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*Oc)),e=t*Oc;return"M0,"+-t+"L"+e+",0 0,"+t+" "+-e+",0Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/Pc),e=t*Pc/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/Pc),e=t*Pc/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});ya.svg.symbolTypes=Lc.keys();var Hc,Fc,Pc=Math.sqrt(3),Oc=Math.tan(30*to),Yc=[],Rc=0;Yc.call=Ya.call,Yc.empty=Ya.empty,Yc.node=Ya.node,Yc.size=Ya.size,ya.transition=function(n){return arguments.length?Hc?n.transition():n:Ia.transition()},ya.transition.prototype=Yc,Yc.select=function(n){var t,e,r,i=this.id,u=[];n=v(n);for(var a=-1,o=this.length;++a<o;){u.push(t=[]);for(var c=this[a],l=-1,s=c.length;++l<s;)(r=c[l])&&(e=n.call(r,r.__data__,l,a))?("__data__"in r&&(e.__data__=r.__data__),Nu(e,l,i,r.__transition__[i]),t.push(e)):t.push(null)}return Eu(u,i)},Yc.selectAll=function(n){var t,e,r,i,u,a=this.id,o=[];n=y(n);for(var c=-1,l=this.length;++c<l;)for(var s=this[c],f=-1,h=s.length;++f<h;)if(r=s[f]){u=r.__transition__[a],e=n.call(r,r.__data__,f,c),o.push(t=[]);for(var g=-1,p=e.length;++g<p;)(i=e[g])&&Nu(i,g,a,u),t.push(i)}return Eu(o,a)},Yc.filter=function(n){var t,e,r,i=[];"function"!=typeof n&&(n=N(n));for(var u=0,a=this.length;a>u;u++){i.push(t=[]);for(var e=this[u],o=0,c=e.length;c>o;o++)(r=e[o])&&n.call(r,r.__data__,o)&&t.push(r)}return Eu(i,this.id)},Yc.tween=function(n,t){var e=this.id;return arguments.length<2?this.node().__transition__[e].tween.get(n):T(this,null==t?function(t){t.__transition__[e].tween.remove(n)}:function(r){r.__transition__[e].tween.set(n,t)})},Yc.attr=function(n,t){function e(){this.removeAttribute(o)}function r(){this.removeAttributeNS(o.space,o.local)}function i(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(o);return e!==n&&(t=a(e,n),function(n){this.setAttribute(o,t(n))})})}function u(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(o.space,o.local);return e!==n&&(t=a(e,n),function(n){this.setAttributeNS(o.space,o.local,t(n))})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var a="transform"==n?Br:Sr,o=ya.ns.qualify(n);return ku(this,"attr."+n,t,o.local?u:i)},Yc.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(i));return r&&function(n){this.setAttribute(i,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(i.space,i.local));return r&&function(n){this.setAttributeNS(i.space,i.local,r(n))}}var i=ya.ns.qualify(n);return this.tween("attr."+n,i.local?r:e)},Yc.style=function(n,t,e){function r(){this.style.removeProperty(n)}function i(t){return null==t?r:(t+="",function(){var r,i=ba.getComputedStyle(this,null).getPropertyValue(n);return i!==t&&(r=Sr(i,t),function(t){this.style.setProperty(n,r(t),e)})})}var u=arguments.length;if(3>u){if("string"!=typeof n){2>u&&(t="");for(e in n)this.style(e,n[e],t);return this}e=""}return ku(this,"style."+n,t,i)},Yc.styleTween=function(n,t,e){function r(r,i){var u=t.call(this,r,i,ba.getComputedStyle(this,null).getPropertyValue(n));return u&&function(t){this.style.setProperty(n,u(t),e)}}return arguments.length<3&&(e=""),this.tween("style."+n,r)},Yc.text=function(n){return ku(this,"text",n,Au)},Yc.remove=function(){return this.each("end.transition",function(){var n;!this.__transition__&&(n=this.parentNode)&&n.removeChild(this)})},Yc.ease=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof n&&(n=ya.ease.apply(ya,arguments)),T(this,function(e){e.__transition__[t].ease=n}))},Yc.delay=function(n){var t=this.id;return T(this,"function"==typeof n?function(e,r,i){e.__transition__[t].delay=0|n.call(e,e.__data__,r,i)}:(n|=0,function(e){e.__transition__[t].delay=n}))},Yc.duration=function(n){var t=this.id;return T(this,"function"==typeof n?function(e,r,i){e.__transition__[t].duration=Math.max(1,0|n.call(e,e.__data__,r,i))}:(n=Math.max(1,0|n),function(e){e.__transition__[t].duration=n}))},Yc.each=function(n,t){var e=this.id;if(arguments.length<2){var r=Fc,i=Hc;Hc=e,T(this,function(t,r,i){Fc=t.__transition__[e],n.call(t,t.__data__,r,i)}),Fc=r,Hc=i}else T(this,function(r){var i=r.__transition__[e];(i.event||(i.event=ya.dispatch("start","end"))).on(n,t)});return this},Yc.transition=function(){for(var n,t,e,r,i=this.id,u=++Rc,a=[],o=0,c=this.length;c>o;o++){a.push(n=[]);for(var t=this[o],l=0,s=t.length;s>l;l++)(e=t[l])&&(r=Object.create(e.__transition__[i]),r.delay+=r.duration,Nu(e,l,u,r)),n.push(e)}return Eu(a,u)},ya.svg.axis=function(){function n(n){n.each(function(){var n,f=ya.select(this),h=null==l?e.ticks?e.ticks.apply(e,c):e.domain():l,g=null==t?e.tickFormat?e.tickFormat.apply(e,c):String:t,p=Cu(e,h,s),m=f.selectAll(".tick.minor").data(p,String),d=m.enter().insert("line",".tick").attr("class","tick minor").style("opacity",1e-6),v=ya.transition(m.exit()).style("opacity",1e-6).remove(),y=ya.transition(m).style("opacity",1),M=f.selectAll(".tick.major").data(h,String),x=M.enter().insert("g",".domain").attr("class","tick major").style("opacity",1e-6),b=ya.transition(M.exit()).style("opacity",1e-6).remove(),_=ya.transition(M).style("opacity",1),w=Bi(e),S=f.selectAll(".domain").data([0]),E=(S.enter().append("path").attr("class","domain"),ya.transition(S)),k=e.copy(),A=this.__chart__||k;this.__chart__=k,x.append("line"),x.append("text");var N=x.select("line"),q=_.select("line"),T=M.select("text").text(g),C=x.select("text"),z=_.select("text");switch(r){case"bottom":n=qu,d.attr("y2",u),y.attr("x2",0).attr("y2",u),N.attr("y2",i),C.attr("y",Math.max(i,0)+o),q.attr("x2",0).attr("y2",i),z.attr("x",0).attr("y",Math.max(i,0)+o),T.attr("dy",".71em").style("text-anchor","middle"),E.attr("d","M"+w[0]+","+a+"V0H"+w[1]+"V"+a);break;case"top":n=qu,d.attr("y2",-u),y.attr("x2",0).attr("y2",-u),N.attr("y2",-i),C.attr("y",-(Math.max(i,0)+o)),q.attr("x2",0).attr("y2",-i),z.attr("x",0).attr("y",-(Math.max(i,0)+o)),T.attr("dy","0em").style("text-anchor","middle"),E.attr("d","M"+w[0]+","+-a+"V0H"+w[1]+"V"+-a);break;case"left":n=Tu,d.attr("x2",-u),y.attr("x2",-u).attr("y2",0),N.attr("x2",-i),C.attr("x",-(Math.max(i,0)+o)),q.attr("x2",-i).attr("y2",0),z.attr("x",-(Math.max(i,0)+o)).attr("y",0),T.attr("dy",".32em").style("text-anchor","end"),E.attr("d","M"+-a+","+w[0]+"H0V"+w[1]+"H"+-a);break;case"right":n=Tu,d.attr("x2",u),y.attr("x2",u).attr("y2",0),N.attr("x2",i),C.attr("x",Math.max(i,0)+o),q.attr("x2",i).attr("y2",0),z.attr("x",Math.max(i,0)+o).attr("y",0),T.attr("dy",".32em").style("text-anchor","start"),E.attr("d","M"+a+","+w[0]+"H0V"+w[1]+"H"+a)}if(e.rangeBand){var D=k.rangeBand()/2,j=function(n){return k(n)+D};x.call(n,j),_.call(n,j)}else x.call(n,A),_.call(n,k),b.call(n,k),d.call(n,A),y.call(n,k),v.call(n,k)})}var t,e=ya.scale.linear(),r=Uc,i=6,u=6,a=6,o=3,c=[10],l=null,s=0;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Ic?t+"":Uc,n):r},n.ticks=function(){return arguments.length?(c=arguments,n):c},n.tickValues=function(t){return arguments.length?(l=t,n):l},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t,e){if(!arguments.length)return i;var r=arguments.length-1;return i=+t,u=r>1?+e:i,a=r>0?+arguments[r]:i,n},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(t){return arguments.length?(s=+t,n):s},n};var Uc="bottom",Ic={top:1,right:1,bottom:1,left:1};ya.svg.brush=function(){function n(u){u.each(function(){var u,a=ya.select(this),s=a.selectAll(".background").data([0]),f=a.selectAll(".extent").data([0]),h=a.selectAll(".resize").data(l,String);a.style("pointer-events","all").on("mousedown.brush",i).on("touchstart.brush",i),s.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),f.enter().append("rect").attr("class","extent").style("cursor","move"),h.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return Vc[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),h.style("display",n.empty()?"none":null),h.exit().remove(),o&&(u=Bi(o),s.attr("x",u[0]).attr("width",u[1]-u[0]),e(a)),c&&(u=Bi(c),s.attr("y",u[0]).attr("height",u[1]-u[0]),r(a)),t(a)})}function t(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+s[+/e$/.test(n)][0]+","+s[+/^s/.test(n)][1]+")"})}function e(n){n.select(".extent").attr("x",s[0][0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",s[1][0]-s[0][0])}function r(n){n.select(".extent").attr("y",s[0][1]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",s[1][1]-s[0][1])}function i(){function i(){var n=ya.event.changedTouches;return n?ya.touches(M,n)[0]:ya.mouse(M)}function l(){32==ya.event.keyCode&&(k||(v=null,N[0]-=s[1][0],N[1]-=s[1][1],k=2),g())}function h(){32==ya.event.keyCode&&2==k&&(N[0]+=s[1][0],N[1]+=s[1][1],k=0,g())}function p(){var n=i(),u=!1;y&&(n[0]+=y[0],n[1]+=y[1]),k||(ya.event.altKey?(v||(v=[(s[0][0]+s[1][0])/2,(s[0][1]+s[1][1])/2]),N[0]=s[+(n[0]<v[0])][0],N[1]=s[+(n[1]<v[1])][1]):v=null),S&&m(n,o,0)&&(e(_),u=!0),E&&m(n,c,1)&&(r(_),u=!0),u&&(t(_),b({type:"brush",mode:k?"move":"resize"}))}function m(n,t,e){var r,i,a=Bi(t),o=a[0],c=a[1],l=N[e],h=s[1][e]-s[0][e];return k&&(o-=l,c-=h+l),r=f[e]?Math.max(o,Math.min(c,n[e])):n[e],k?i=(r+=l)+h:(v&&(l=Math.max(o,Math.min(c,2*v[e]-r))),r>l?(i=r,r=l):i=l),s[0][e]!==r||s[1][e]!==i?(u=null,s[0][e]=r,s[1][e]=i,!0):void 0}function d(){p(),_.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),ya.select("body").style("cursor",null),q.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),A(),b({type:"brushend"})}var v,y,M=this,x=ya.select(ya.event.target),b=a.of(M,arguments),_=ya.select(M),w=x.datum(),S=!/^(n|s)$/.test(w)&&o,E=!/^(e|w)$/.test(w)&&c,k=x.classed("extent"),A=H(),N=i(),q=ya.select(ba).on("keydown.brush",l).on("keyup.brush",h);if(ya.event.changedTouches?q.on("touchmove.brush",p).on("touchend.brush",d):q.on("mousemove.brush",p).on("mouseup.brush",d),k)N[0]=s[0][0]-N[0],N[1]=s[0][1]-N[1];else if(w){var T=+/w$/.test(w),C=+/^n/.test(w);y=[s[1-T][0]-N[0],s[1-C][1]-N[1]],N[0]=s[T][0],N[1]=s[C][1]}else ya.event.altKey&&(v=N.slice());_.style("pointer-events","none").selectAll(".resize").style("display",null),ya.select("body").style("cursor",x.style("cursor")),b({type:"brushstart"}),p()}var u,a=m(n,"brushstart","brush","brushend"),o=null,c=null,l=Xc[0],s=[[0,0],[0,0]],f=[!0,!0];return n.x=function(t){return arguments.length?(o=t,l=Xc[!o<<1|!c],n):o},n.y=function(t){return arguments.length?(c=t,l=Xc[!o<<1|!c],n):c},n.clamp=function(t){return arguments.length?(o&&c?f=[!!t[0],!!t[1]]:(o||c)&&(f[+!o]=!!t),n):o&&c?f:o||c?f[+!o]:null},n.extent=function(t){var e,r,i,a,l;return arguments.length?(u=[[0,0],[0,0]],o&&(e=t[0],r=t[1],c&&(e=e[0],r=r[0]),u[0][0]=e,u[1][0]=r,o.invert&&(e=o(e),r=o(r)),e>r&&(l=e,e=r,r=l),s[0][0]=0|e,s[1][0]=0|r),c&&(i=t[0],a=t[1],o&&(i=i[1],a=a[1]),u[0][1]=i,u[1][1]=a,c.invert&&(i=c(i),a=c(a)),i>a&&(l=i,i=a,a=l),s[0][1]=0|i,s[1][1]=0|a),n):(t=u||s,o&&(e=t[0][0],r=t[1][0],u||(e=s[0][0],r=s[1][0],o.invert&&(e=o.invert(e),r=o.invert(r)),e>r&&(l=e,e=r,r=l))),c&&(i=t[0][1],a=t[1][1],u||(i=s[0][1],a=s[1][1],c.invert&&(i=c.invert(i),a=c.invert(a)),i>a&&(l=i,i=a,a=l))),o&&c?[[e,i],[r,a]]:o?[e,r]:c&&[i,a])},n.clear=function(){return u=null,s[0][0]=s[0][1]=s[1][0]=s[1][1]=0,n},n.empty=function(){return o&&s[0][0]===s[1][0]||c&&s[0][1]===s[1][1]},ya.rebind(n,a,"on")};var Vc={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Xc=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];ya.time={};var Zc=Date,Bc=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];zu.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){$c.setUTCDate.apply(this._,arguments)},setDay:function(){$c.setUTCDay.apply(this._,arguments)},setFullYear:function(){$c.setUTCFullYear.apply(this._,arguments)},setHours:function(){$c.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){$c.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){$c.setUTCMinutes.apply(this._,arguments)},setMonth:function(){$c.setUTCMonth.apply(this._,arguments)},setSeconds:function(){$c.setUTCSeconds.apply(this._,arguments)},setTime:function(){$c.setTime.apply(this._,arguments)}};var $c=Date.prototype,Wc="%a %b %e %X %Y",Jc="%m/%d/%Y",Gc="%H:%M:%S",Kc=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Qc=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],nl=["January","February","March","April","May","June","July","August","September","October","November","December"],tl=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];ya.time.year=Du(function(n){return n=ya.time.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),ya.time.years=ya.time.year.range,ya.time.years.utc=ya.time.year.utc.range,ya.time.day=Du(function(n){var t=new Zc(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),ya.time.days=ya.time.day.range,ya.time.days.utc=ya.time.day.utc.range,ya.time.dayOfYear=function(n){var t=ya.time.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},Bc.forEach(function(n,t){n=n.toLowerCase(),t=7-t;var e=ya.time[n]=Du(function(n){return(n=ya.time.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=ya.time.year(n).getDay();return Math.floor((ya.time.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});ya.time[n+"s"]=e.range,ya.time[n+"s"].utc=e.utc.range,ya.time[n+"OfYear"]=function(n){var e=ya.time.year(n).getDay();return Math.floor((ya.time.dayOfYear(n)+(e+t)%7)/7)}}),ya.time.week=ya.time.sunday,ya.time.weeks=ya.time.sunday.range,ya.time.weeks.utc=ya.time.sunday.utc.range,ya.time.weekOfYear=ya.time.sundayOfYear,ya.time.format=function(n){function t(t){for(var r,i,u,a=[],o=-1,c=0;++o<e;)37===n.charCodeAt(o)&&(a.push(n.substring(c,o)),null!=(i=fl[r=n.charAt(++o)])&&(r=n.charAt(++o)),(u=hl[r])&&(r=u(t,null==i?"e"===r?" ":"0":i)),a.push(r),c=o+1);return a.push(n.substring(c,o)),a.join("")}var e=n.length;return t.parse=function(t){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},r=Lu(e,n,t,0);if(r!=t.length)return null;"p"in e&&(e.H=e.H%12+12*e.p);var i=new Zc;return"j"in e?i.setFullYear(e.y,0,e.j):"w"in e&&("W"in e||"U"in e)?(i.setFullYear(e.y,0,1),i.setFullYear(e.y,0,"W"in e?(e.w+6)%7+7*e.W-(i.getDay()+5)%7:e.w+7*e.U-(i.getDay()+6)%7)):i.setFullYear(e.y,e.m,e.d),i.setHours(e.H,e.M,e.S,e.L),i},t.toString=function(){return n},t};var el=Hu(Kc),rl=Fu(Kc),il=Hu(Qc),ul=Fu(Qc),al=Hu(nl),ol=Fu(nl),cl=Hu(tl),ll=Fu(tl),sl=/^%/,fl={"-":"",_:" ",0:"0"},hl={a:function(n){return Qc[n.getDay()]},A:function(n){return Kc[n.getDay()]},b:function(n){return tl[n.getMonth()]},B:function(n){return nl[n.getMonth()]},c:ya.time.format(Wc),d:function(n,t){return Pu(n.getDate(),t,2)},e:function(n,t){return Pu(n.getDate(),t,2)},H:function(n,t){return Pu(n.getHours(),t,2)},I:function(n,t){return Pu(n.getHours()%12||12,t,2)},j:function(n,t){return Pu(1+ya.time.dayOfYear(n),t,3)},L:function(n,t){return Pu(n.getMilliseconds(),t,3)},m:function(n,t){return Pu(n.getMonth()+1,t,2)},M:function(n,t){return Pu(n.getMinutes(),t,2)},p:function(n){return n.getHours()>=12?"PM":"AM"},S:function(n,t){return Pu(n.getSeconds(),t,2)},U:function(n,t){return Pu(ya.time.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Pu(ya.time.mondayOfYear(n),t,2)},x:ya.time.format(Jc),X:ya.time.format(Gc),y:function(n,t){return Pu(n.getFullYear()%100,t,2)},Y:function(n,t){return Pu(n.getFullYear()%1e4,t,4)},Z:aa,"%":function(){return"%"}},gl={a:Ou,A:Yu,b:Vu,B:Xu,c:Zu,d:Qu,e:Qu,H:ta,I:ta,j:na,L:ia,m:Ku,M:ea,p:ua,S:ra,U:Uu,w:Ru,W:Iu,x:Bu,X:$u,y:Ju,Y:Wu,"%":oa},pl=/^\s*\d+/,ml=ya.map({am:0,pm:1});ya.time.format.utc=function(n){function t(n){try{Zc=zu;var t=new Zc;return t._=n,e(t)}finally{Zc=Date}}var e=ya.time.format(n);return t.parse=function(n){try{Zc=zu;var t=e.parse(n);return t&&t._}finally{Zc=Date}},t.toString=e.toString,t};var dl=ya.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");ya.time.format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?ca:dl,ca.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},ca.toString=dl.toString,ya.time.second=Du(function(n){return new Zc(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),ya.time.seconds=ya.time.second.range,ya.time.seconds.utc=ya.time.second.utc.range,ya.time.minute=Du(function(n){return new Zc(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),ya.time.minutes=ya.time.minute.range,ya.time.minutes.utc=ya.time.minute.utc.range,ya.time.hour=Du(function(n){var t=n.getTimezoneOffset()/60;return new Zc(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),ya.time.hours=ya.time.hour.range,ya.time.hours.utc=ya.time.hour.utc.range,ya.time.month=Du(function(n){return n=ya.time.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),ya.time.months=ya.time.month.range,ya.time.months.utc=ya.time.month.utc.range;var vl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],yl=[[ya.time.second,1],[ya.time.second,5],[ya.time.second,15],[ya.time.second,30],[ya.time.minute,1],[ya.time.minute,5],[ya.time.minute,15],[ya.time.minute,30],[ya.time.hour,1],[ya.time.hour,3],[ya.time.hour,6],[ya.time.hour,12],[ya.time.day,1],[ya.time.day,2],[ya.time.week,1],[ya.time.month,1],[ya.time.month,3],[ya.time.year,1]],Ml=[[ya.time.format("%Y"),Xt],[ya.time.format("%B"),function(n){return n.getMonth()}],[ya.time.format("%b %d"),function(n){return 1!=n.getDate()}],[ya.time.format("%a %d"),function(n){return n.getDay()&&1!=n.getDate()}],[ya.time.format("%I %p"),function(n){return n.getHours()}],[ya.time.format("%I:%M"),function(n){return n.getMinutes()}],[ya.time.format(":%S"),function(n){return n.getSeconds()}],[ya.time.format(".%L"),function(n){return n.getMilliseconds()}]],xl=ya.scale.linear(),bl=fa(Ml);yl.year=function(n,t){return xl.domain(n.map(ga)).ticks(t).map(ha)},ya.time.scale=function(){return la(ya.scale.linear(),yl,bl)};var _l=yl.map(function(n){return[n[0].utc,n[1]]}),wl=[[ya.time.format.utc("%Y"),Xt],[ya.time.format.utc("%B"),function(n){return n.getUTCMonth()}],[ya.time.format.utc("%b %d"),function(n){return 1!=n.getUTCDate()}],[ya.time.format.utc("%a %d"),function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],[ya.time.format.utc("%I %p"),function(n){return n.getUTCHours()}],[ya.time.format.utc("%I:%M"),function(n){return n.getUTCMinutes()}],[ya.time.format.utc(":%S"),function(n){return n.getUTCSeconds()}],[ya.time.format.utc(".%L"),function(n){return n.getUTCMilliseconds()}]],Sl=fa(wl);return _l.year=function(n,t){return xl.domain(n.map(ma)).ticks(t).map(pa)},ya.time.scale.utc=function(){return la(ya.scale.linear(),_l,Sl)},ya.text=dt(function(n){return n.responseText}),ya.json=function(n,t){return vt(n,"application/json",da,t)},ya.html=function(n,t){return vt(n,"text/html",va,t)},ya.xml=dt(function(n){return n.responseXML}),ya}(),// -- kriskowal Kris Kowal Copyright (C) 2009-2011 MIT License
// -- tlrobinson Tom Robinson Copyright (C) 2009-2010 MIT License (Narwhal Project)
// -- dantman Daniel Friesen Copyright (C) 2010 XXX TODO License or CLA
// -- fschaefer Florian Schfer Copyright (C) 2010 MIT License
// -- Gozala Irakli Gozalishvili Copyright (C) 2010 MIT License
// -- kitcambridge Kit Cambridge Copyright (C) 2011 MIT License
// -- killdream Quildreen Motta Copyright (C) 2011 MIT Licence
// -- michaelficarra Michael Ficarra Copyright (C) 2011 3-clause BSD License
// -- sharkbrainguy Gerard Paapu Copyright (C) 2011 MIT License
// -- rwldrn Rick Waldron Copyright (C) 2011 MIT License
/*!
    Copyright (c) 2009, 280 North Inc. http://280north.com/
    MIT License. http://github.com/280north/narwhal/blob/master/README.md
*/
function(definition){"function"==typeof define?define(definition):definition()}(function(){function doesDefinePropertyWork(object){try{return Object.defineProperty(object,"sentinel",{}),"sentinel"in object}catch(exception){}}Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw new TypeError;var args=slice.call(arguments,1),bound=function(){if(this instanceof bound){var F=function(){};F.prototype=target.prototype;var self=new F,result=target.apply(self,args.concat(slice.call(arguments)));return null!==result&&Object(result)===result?result:self}return target.apply(that,args.concat(slice.call(arguments)))};return bound});var defineGetter,defineSetter,lookupGetter,lookupSetter,supportsAccessors,call=Function.prototype.call,prototypeOfArray=Array.prototype,prototypeOfObject=Object.prototype,slice=prototypeOfArray.slice,toString=call.bind(prototypeOfObject.toString),owns=call.bind(prototypeOfObject.hasOwnProperty);if((supportsAccessors=owns(prototypeOfObject,"__defineGetter__"))&&(defineGetter=call.bind(prototypeOfObject.__defineGetter__),defineSetter=call.bind(prototypeOfObject.__defineSetter__),lookupGetter=call.bind(prototypeOfObject.__lookupGetter__),lookupSetter=call.bind(prototypeOfObject.__lookupSetter__)),Array.isArray||(Array.isArray=function(obj){return"[object Array]"==toString(obj)}),Array.prototype.forEach||(Array.prototype.forEach=function(fun){var self=toObject(this),thisp=arguments[1],i=0,length=self.length>>>0;if("[object Function]"!=toString(fun))throw new TypeError;for(;length>i;)i in self&&fun.call(thisp,self[i],i,self),i++}),Array.prototype.map||(Array.prototype.map=function(fun){var self=toObject(this),length=self.length>>>0,result=Array(length),thisp=arguments[1];if("[object Function]"!=toString(fun))throw new TypeError;for(var i=0;length>i;i++)i in self&&(result[i]=fun.call(thisp,self[i],i,self));return result}),Array.prototype.filter||(Array.prototype.filter=function(fun){var self=toObject(this),length=self.length>>>0,result=[],thisp=arguments[1];if("[object Function]"!=toString(fun))throw new TypeError;for(var i=0;length>i;i++)i in self&&fun.call(thisp,self[i],i,self)&&result.push(self[i]);return result}),Array.prototype.every||(Array.prototype.every=function(fun){var self=toObject(this),length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=toString(fun))throw new TypeError;for(var i=0;length>i;i++)if(i in self&&!fun.call(thisp,self[i],i,self))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(fun){var self=toObject(this),length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=toString(fun))throw new TypeError;for(var i=0;length>i;i++)if(i in self&&fun.call(thisp,self[i],i,self))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(fun){var self=toObject(this),length=self.length>>>0;if("[object Function]"!=toString(fun))throw new TypeError;if(!length&&1==arguments.length)throw new TypeError;var result,i=0;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i++];break}if(++i>=length)throw new TypeError}for(;length>i;i++)i in self&&(result=fun.call(void 0,result,self[i],i,self));return result}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(fun){var self=toObject(this),length=self.length>>>0;if("[object Function]"!=toString(fun))throw new TypeError;if(!length&&1==arguments.length)throw new TypeError;var result,i=length-1;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i--];break}if(--i<0)throw new TypeError}do i in this&&(result=fun.call(void 0,result,self[i],i,self));while(i--);return result}),Array.prototype.indexOf||(Array.prototype.indexOf=function(sought){var self=toObject(this),length=self.length>>>0;if(!length)return-1;var i=0;for(arguments.length>1&&(i=toInteger(arguments[1])),i=i>=0?i:length-Math.abs(i);length>i;i++)if(i in self&&self[i]===sought)return i;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(sought){var self=toObject(this),length=self.length>>>0;if(!length)return-1;var i=length-1;for(arguments.length>1&&(i=toInteger(arguments[1])),i=i>=0?i:length-Math.abs(i);i>=0;i--)if(i in self&&sought===self[i])return i;return-1}),Object.getPrototypeOf||(Object.getPrototypeOf=function(object){return object.__proto__||(object.constructor?object.constructor.prototype:prototypeOfObject)}),!Object.getOwnPropertyDescriptor){var ERR_NON_OBJECT="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(object,property){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT+object);if(owns(object,property)){var descriptor,getter,setter;if(descriptor={enumerable:!0,configurable:!0},supportsAccessors){var prototype=object.__proto__;object.__proto__=prototypeOfObject;var getter=lookupGetter(object,property),setter=lookupSetter(object,property);if(object.__proto__=prototype,getter||setter)return getter&&(descriptor.get=getter),setter&&(descriptor.set=setter),descriptor}return descriptor.value=object[property],descriptor}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(object){return Object.keys(object)}),Object.create||(Object.create=function(prototype,properties){var object;if(null===prototype)object={__proto__:null};else{if("object"!=typeof prototype)throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'");var Type=function(){};Type.prototype=prototype,object=new Type,object.__proto__=prototype}return void 0!==properties&&Object.defineProperties(object,properties),object}),Object.defineProperty){var definePropertyWorksOnObject=doesDefinePropertyWork({}),definePropertyWorksOnDom="undefined"==typeof document||doesDefinePropertyWork(document.createElement("div"));if(!definePropertyWorksOnObject||!definePropertyWorksOnDom)var definePropertyFallback=Object.defineProperty}if(!Object.defineProperty||definePropertyFallback){var ERR_NON_OBJECT_DESCRIPTOR="Property description must be an object: ",ERR_NON_OBJECT_TARGET="Object.defineProperty called on non-object: ",ERR_ACCESSORS_NOT_SUPPORTED="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(object,property,descriptor){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT_TARGET+object);if("object"!=typeof descriptor&&"function"!=typeof descriptor||null===descriptor)throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR+descriptor);if(definePropertyFallback)try{return definePropertyFallback.call(Object,object,property,descriptor)}catch(exception){}if(owns(descriptor,"value"))if(supportsAccessors&&(lookupGetter(object,property)||lookupSetter(object,property))){var prototype=object.__proto__;object.__proto__=prototypeOfObject,delete object[property],object[property]=descriptor.value,object.__proto__=prototype}else object[property]=descriptor.value;else{if(!supportsAccessors)throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);owns(descriptor,"get")&&defineGetter(object,property,descriptor.get),owns(descriptor,"set")&&defineSetter(object,property,descriptor.set)}return object}}Object.defineProperties||(Object.defineProperties=function(object,properties){for(var property in properties)owns(properties,property)&&Object.defineProperty(object,property,properties[property]);return object}),Object.seal||(Object.seal=function(object){return object}),Object.freeze||(Object.freeze=function(object){return object});try{Object.freeze(function(){})}catch(exception){Object.freeze=function(freezeObject){return function(object){return"function"==typeof object?object:freezeObject(object)}}(Object.freeze)}if(Object.preventExtensions||(Object.preventExtensions=function(object){return object}),Object.isSealed||(Object.isSealed=function(){return!1}),Object.isFrozen||(Object.isFrozen=function(){return!1}),Object.isExtensible||(Object.isExtensible=function(object){if(Object(object)===object)throw new TypeError;for(var name="";owns(object,name);)name+="?";object[name]=!0;var returnValue=owns(object,name);return delete object[name],returnValue}),!Object.keys){var hasDontEnumBug=!0,dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;for(var key in{toString:null})hasDontEnumBug=!1;Object.keys=function keys(object){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError("Object.keys called on a non-object");var keys=[];for(var name in object)owns(object,name)&&keys.push(name);if(hasDontEnumBug)for(var i=0,ii=dontEnumsLength;ii>i;i++){var dontEnum=dontEnums[i];owns(object,dontEnum)&&keys.push(dontEnum)}return keys}}Date.prototype.toISOString||(Date.prototype.toISOString=function(){var result,length,value;if(!isFinite(this))throw new RangeError;for(result=[this.getUTCFullYear(),this.getUTCMonth()+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],length=result.length;length--;)value=result[length],10>value&&(result[length]="0"+value);return result.slice(0,3).join("-")+"T"+result.slice(3).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"}),Date.now||(Date.now=function(){return(new Date).getTime()}),Date.prototype.toJSON||(Date.prototype.toJSON=function(){if("function"!=typeof this.toISOString)throw new TypeError;return this.toISOString()}),isNaN(Date.parse("2011-06-15T21:40:05+06:00"))&&(Date=function(NativeDate){var Date=function Date(Y,M,D,h,m,s,ms){var length=arguments.length;if(this instanceof NativeDate){var date=1==length&&String(Y)===Y?new NativeDate(Date.parse(Y)):length>=7?new NativeDate(Y,M,D,h,m,s,ms):length>=6?new NativeDate(Y,M,D,h,m,s):length>=5?new NativeDate(Y,M,D,h,m):length>=4?new NativeDate(Y,M,D,h):length>=3?new NativeDate(Y,M,D):length>=2?new NativeDate(Y,M):length>=1?new NativeDate(Y):new NativeDate;return date.constructor=Date,date}return NativeDate.apply(this,arguments)},isoDateExpression=new RegExp("^(\\d{4})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$");for(var key in NativeDate)Date[key]=NativeDate[key];return Date.now=NativeDate.now,Date.UTC=NativeDate.UTC,Date.prototype=NativeDate.prototype,Date.prototype.constructor=Date,Date.parse=function(string){var match=isoDateExpression.exec(string);if(match){match.shift();for(var i=1;7>i;i++)match[i]=+(match[i]||(3>i?1:0)),1==i&&match[i]--;var minuteOffset=+match.pop(),hourOffset=+match.pop(),sign=match.pop(),offset=0;if(sign){if(hourOffset>23||minuteOffset>59)return 0/0;offset=6e4*(60*hourOffset+minuteOffset)*("+"==sign?-1:1)}return NativeDate.UTC.apply(this,match)+offset}return NativeDate.parse.apply(this,arguments)},Date}(Date));var ws="	\n\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff";if(!String.prototype.trim||ws.trim()){ws="["+ws+"]";var trimBeginRegexp=new RegExp("^"+ws+ws+"*"),trimEndRegexp=new RegExp(ws+ws+"*$");String.prototype.trim=function(){return String(this).replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}var toInteger=function(n){return n=+n,n!==n?n=-1:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n))),n},prepareString="a"!="a"[0],toObject=function(o){if(null==o)throw new TypeError;return prepareString&&"string"==typeof o&&o?o.split(""):Object(o)}}),function(){var lastEvents,source,widgets,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Batman.config.pathPrefix="/",Batman.config.pathToHTML="/dashing/widgets/",Batman.Filters.prettyNumber=function(num){return isNaN(num)?void 0:num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Batman.Filters.dashize=function(str){var dashes_rx1,dashes_rx2;return dashes_rx1=/([A-Z]+)([A-Z][a-z])/g,dashes_rx2=/([a-z\d])([A-Z])/g,str.replace(dashes_rx1,"$1_$2").replace(dashes_rx2,"$1_$2").replace(/_/g,"-").toLowerCase()},Batman.Filters.shortenedNumber=function(num){return isNaN(num)?num:num>=1e9?(num/1e9).toFixed(1)+"B":num>=1e6?(num/1e6).toFixed(1)+"M":num>=1e3?(num/1e3).toFixed(1)+"K":num},window.Dashing=function(_super){function Dashing(){return Dashing.__super__.constructor.apply(this,arguments)}return __extends(Dashing,_super),Dashing.root(function(){}),Dashing}(Batman.App),Dashing.params=Batman.URI.paramsFromQuery(window.location.search.slice(1)),Dashing.Widget=function(_super){function Widget(){this.onData=__bind(this.onData,this),this.receiveData=__bind(this.receiveData,this),this.constructor.prototype.source=Batman.Filters.underscore(this.constructor.name),Widget.__super__.constructor.apply(this,arguments),this.observe("node",function(newValue,oldValue){var type,_base,_name;return oldValue||this._registeredAtDashing?void 0:(this._registeredAtDashing=!0,this.mixin($(this.node).data()),(_base=Dashing.widgets)[_name=this.id]||(_base[_name]=[]),Dashing.widgets[this.id].push(this),this.mixin(Dashing.lastEvents[this.id]),type=Batman.Filters.dashize(this.constructor.name),$(this.node).addClass("widget widget-"+type+" "+this.id))})}return __extends(Widget,_super),Widget.accessor("updatedAtMessage",function(){var hours,minutes,timestamp,updatedAt;return(updatedAt=this.get("updatedAt"))?(timestamp=new Date(1e3*updatedAt),hours=timestamp.getHours(),minutes=("0"+timestamp.getMinutes()).slice(-2),"Last updated at "+hours+":"+minutes):void 0}),Widget.prototype.on("ready",function(){return Dashing.Widget.fire("ready")}),Widget.prototype.receiveData=function(data){return this.mixin(data),this.onData(data)},Widget.prototype.onData=function(){},Widget}(Batman.View),Dashing.AnimatedValue={get:Batman.Property.defaultAccessor.get,set:function(k,to){var num,num_interval,timer,up;return null==to||isNaN(to)?this[k]=to:(timer="interval_"+k,num=isNaN(this[k])||null==this[k]?0:this[k],this[timer]||num===to||(to=parseFloat(to),num=parseFloat(num),up=to>num,num_interval=Math.abs(num-to)/90,this[timer]=setInterval(function(_this){return function(){return num=up?Math.ceil(num+num_interval):Math.floor(num-num_interval),(up&&num>to||!up&&to>num)&&(num=to,clearInterval(_this[timer]),_this[timer]=null,delete _this[timer]),_this[k]=num,_this.set(k,to)}}(this),10)),this[k]=num)}},Dashing.widgets=widgets={},Dashing.lastEvents=lastEvents={},Dashing.debugMode=!1,source=new EventSource("/dashing/events"),source.addEventListener("open",function(e){return console.log("Connection opened",e)}),source.addEventListener("error",function(e){return console.log("Connection error",e),e.currentTarget.readyState===EventSource.CLOSED?(console.log("Connection closed"),setTimeout(function(){return window.location.reload()},3e5)):void 0}),source.addEventListener("message",function(){return function(e){var data,widget,_i,_len,_ref,_ref1,_ref2,_results;if(data=JSON.parse(e.data),(null!=(_ref=lastEvents[data.id])?_ref.updatedAt:void 0)!==data.updatedAt&&(Dashing.debugMode&&console.log("Received data for "+data.id,data),lastEvents[data.id]=data,(null!=(_ref1=widgets[data.id])?_ref1.length:void 0)>0)){for(_ref2=widgets[data.id],_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)widget=_ref2[_i],_results.push(widget.receiveData(data));return _results}}}(this)),$(document).ready(function(){return Dashing.run()})}.call(this),function(){console.log("Yeah! The dashboard has started!"),Dashing.on("ready",function(){var contentWidth;return Dashing.widget_margins||(Dashing.widget_margins=[5,5]),Dashing.widget_base_dimensions||(Dashing.widget_base_dimensions=[300,360]),Dashing.numColumns||(Dashing.numColumns=4),contentWidth=(Dashing.widget_base_dimensions[0]+2*Dashing.widget_margins[0])*Dashing.numColumns,Batman.setImmediate(function(){return $(".gridster").width(contentWidth),$(".gridster ul:first").gridster({widget_margins:Dashing.widget_margins,widget_base_dimensions:Dashing.widget_base_dimensions,avoid_overlapped_widgets:!Dashing.customGridsterLayout,draggable:{stop:Dashing.showGridsterInstructions,start:function(){return Dashing.currentWidgetPositions=Dashing.getWidgetPositions()}}})})})}.call(this),function(){Dashing.gridsterLayout=function(positions){var index,widget,widgets,_i,_len,_results;for(Dashing.customGridsterLayout=!0,positions=positions.replace(/^"|"$/g,""),positions=$.parseJSON(positions),widgets=$("[data-row^=]"),_results=[],index=_i=0,_len=widgets.length;_len>_i;index=++_i)widget=widgets[index],$(widget).attr("data-row",positions[index].row),_results.push($(widget).attr("data-col",positions[index].col));return _results},Dashing.getWidgetPositions=function(){return $(".gridster ul:first").gridster().data("gridster").serialize()},Dashing.showGridsterInstructions=function(){var newWidgetPositions;return newWidgetPositions=Dashing.getWidgetPositions(),JSON.stringify(newWidgetPositions)!==JSON.stringify(Dashing.currentWidgetPositions)?(Dashing.currentWidgetPositions=newWidgetPositions,$("#save-gridster").slideDown(),$("#gridster-code").text("<script type='text/javascript'>\n $(function() {\n   Dashing.gridsterLayout('"+JSON.stringify(Dashing.currentWidgetPositions)+"')\n });\n </script>")):void 0},$(function(){return $("#save-gridster").leanModal(),$("#save-gridster").click(function(){return $("#save-gridster").slideUp()})})}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Clock=function(_super){function Clock(){return this.startTime=__bind(this.startTime,this),Clock.__super__.constructor.apply(this,arguments)}return __extends(Clock,_super),Clock.prototype.ready=function(){return setInterval(this.startTime,500)},Clock.prototype.startTime=function(){var h,m,s,today;return today=new Date,h=today.getHours(),m=today.getMinutes(),s=today.getSeconds(),m=this.formatTime(m),s=this.formatTime(s),this.set("time",h+":"+m+":"+s),this.set("date",today.toDateString())},Clock.prototype.formatTime=function(i){return 10>i?"0"+i:i},Clock}(Dashing.Widget)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Comments=function(_super){function Comments(){return this.nextComment=__bind(this.nextComment,this),Comments.__super__.constructor.apply(this,arguments)}return __extends(Comments,_super),Comments.accessor("quote",function(){var _ref;return"\u201c"+(null!=(_ref=this.get("current_comment"))?_ref.body:void 0)+"\u201d"}),Comments.prototype.ready=function(){return this.currentIndex=0,this.commentElem=$(this.node).find(".comment-container"),this.nextComment(),this.startCarousel()},Comments.prototype.onData=function(){return this.currentIndex=0},Comments.prototype.startCarousel=function(){return setInterval(this.nextComment,8e3)},Comments.prototype.nextComment=function(){var comments;return comments=this.get("comments"),comments?this.commentElem.fadeOut(function(_this){return function(){return _this.currentIndex=(_this.currentIndex+1)%comments.length,_this.set("current_comment",comments[_this.currentIndex]),_this.commentElem.fadeIn()}}(this)):void 0},Comments}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Graph=function(_super){function Graph(){return Graph.__super__.constructor.apply(this,arguments)}return __extends(Graph,_super),Graph.accessor("current",function(){var points;return this.get("displayedValue")?this.get("displayedValue"):(points=this.get("points"),points?points[points.length-1].y:void 0)}),Graph.prototype.loadNode=function(_node){var container,height,node,width,x_axis,y_axis;return node=Graph.__super__.loadNode.call(this,_node),container=$(node).parent(),width=Dashing.widget_base_dimensions[0]*container.data("sizex")+2*Dashing.widget_margins[0]*(container.data("sizex")-1),height=Dashing.widget_base_dimensions[1]*container.data("sizey"),this.graph=new Rickshaw.Graph({element:node,width:width,height:height,renderer:this.get("graphtype"),series:[{color:"#fff",data:[{x:0,y:0}]}]}),this.get("points")&&(this.graph.series[0].data=this.get("points")),x_axis=new Rickshaw.Graph.Axis.Time({graph:this.graph}),y_axis=new Rickshaw.Graph.Axis.Y({graph:this.graph,tickFormat:Rickshaw.Fixtures.Number.formatKMBT}),this.graph.render(),node},Graph.prototype.onData=function(data){return this.graph?(this.graph.series[0].data=data.points,this.graph.render()):void 0},Graph}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Iframe=function(_super){function Iframe(){return Iframe.__super__.constructor.apply(this,arguments)}return __extends(Iframe,_super),Iframe.prototype.ready=function(){},Iframe.prototype.onData=function(){},Iframe}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Image=function(_super){function Image(){return Image.__super__.constructor.apply(this,arguments)}return __extends(Image,_super),Image.prototype.ready=function(){},Image.prototype.onData=function(){},Image}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.List=function(_super){function List(){return List.__super__.constructor.apply(this,arguments)}return __extends(List,_super),List.prototype.ready=function(){return this.get("unordered")?$(this.node).find("ol").remove():$(this.node).find("ul").remove()},List}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Meter=function(_super){function Meter(){Meter.__super__.constructor.apply(this,arguments),this.observe("value",function(value){return $(this.node).find(".meter").val(value).trigger("change")})}return __extends(Meter,_super),Meter.accessor("value",Dashing.AnimatedValue),Meter.prototype.ready=function(){var meter;return meter=$(this.node).find(".meter"),meter.attr("data-bgcolor",meter.css("background-color")),meter.attr("data-fgcolor",meter.css("color")),meter.knob()},Meter}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Number=function(_super){function Number(){return Number.__super__.constructor.apply(this,arguments)}return __extends(Number,_super),Number.accessor("current",Dashing.AnimatedValue),Number.accessor("difference",function(){var current,diff,last;return this.get("last")?(last=parseInt(this.get("last")),current=parseInt(this.get("current")),0!==last?(diff=Math.abs(Math.round((current-last)/last*100)),""+diff+"%"):void 0):""}),Number.accessor("arrow",function(){return this.get("last")?parseInt(this.get("current"))>parseInt(this.get("last"))?"fa fa-arrow-up":"fa fa-arrow-down":void 0}),Number.prototype.onData=function(data){return data.status?($(this.get("node")).attr("class",function(i,c){return c.replace(/\bstatus-\S+/g,"")}),$(this.get("node")).addClass("status-"+data.status)):void 0},Number}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Text=function(_super){function Text(){return Text.__super__.constructor.apply(this,arguments)}return __extends(Text,_super),Text}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Add=function(_super){function Add(){return Add.__super__.constructor.apply(this,arguments)}return __extends(Add,_super),Add.prototype.ready=function(){},Add.prototype.onData=function(){},Add}(Dashing.Widget)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Clock=function(_super){function Clock(){return this.startTime=__bind(this.startTime,this),Clock.__super__.constructor.apply(this,arguments)}return __extends(Clock,_super),Clock.prototype.ready=function(){return setInterval(this.startTime,500)},Clock.prototype.startTime=function(){var h,m,s,today;return today=new Date,h=today.getHours(),m=today.getMinutes(),s=today.getSeconds(),m=this.formatTime(m),s=this.formatTime(s),this.set("time",h+":"+m+":"+s),this.set("date",today.toDateString())},Clock.prototype.formatTime=function(i){return 10>i?"0"+i:i},Clock.prototype.truth=function(){return!0},Clock}(Dashing.Widget)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Comments=function(_super){function Comments(){return this.nextComment=__bind(this.nextComment,this),Comments.__super__.constructor.apply(this,arguments)}return __extends(Comments,_super),Comments.accessor("quote",function(){var _ref;return"\xe2\u20ac\u0153"+(null!=(_ref=this.get("current_comment"))?_ref.body:void 0)+"\xe2\u20ac\x9d"}),Comments.prototype.ready=function(){return this.currentIndex=0,this.commentElem=$(this.node).find(".comment-container"),this.nextComment(),this.startCarousel()},Comments.prototype.onData=function(){return this.currentIndex=0},Comments.prototype.startCarousel=function(){return setInterval(this.nextComment,8e3)},Comments.prototype.nextComment=function(){var comments;return comments=this.get("comments"),comments?this.commentElem.fadeOut(function(_this){return function(){return _this.currentIndex=(_this.currentIndex+1)%comments.length,_this.set("current_comment",comments[_this.currentIndex]),_this.commentElem.fadeIn()}}(this)):void 0},Comments}(Dashing.Widget)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Countdown=function(_super){function Countdown(){return this.startCountdown=__bind(this.startCountdown,this),Countdown.__super__.constructor.apply(this,arguments)}return __extends(Countdown,_super),Countdown.prototype.ready=function(){return setInterval(this.startCountdown,500)},Countdown.prototype.startCountdown=function(){var current_timestamp,d,dayname,end_timestamp,h,i,m,s,seconds_until_end,_i,_results;if(current_timestamp=Math.round((new Date).getTime()/1e3),end_timestamp=Math.round(Date.parse($(this.node).find(".more-info").html())/1e3),seconds_until_end=end_timestamp-current_timestamp,0>seconds_until_end){for(this.set("timeleft","TIME UP!"),_results=[],i=_i=0;100>=_i;i=_i+=1)_results.push($(this.node).fadeTo("slow",.5).fadeTo("slow",1));return _results}return d=Math.floor(seconds_until_end/86400),h=Math.floor((seconds_until_end-86400*d)/3600),m=Math.floor((seconds_until_end-86400*d-3600*h)/60),s=seconds_until_end-86400*d-3600*h-60*m,d>0?(dayname="day",d>1&&(dayname="days"),this.set("timeleft",d+"d "+this.formatTime(h)+"h "+this.formatTime(m)+"m "+this.formatTime(s)+"s")):this.set("timeleft",this.formatTime(h)+":"+this.formatTime(m)+":"+this.formatTime(s))},Countdown.prototype.formatTime=function(i){return i},Countdown}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Number=function(_super){function Number(){return Number.__super__.constructor.apply(this,arguments)}return __extends(Number,_super),Number.accessor("current",Dashing.AnimatedValue),Number.accessor("difference",function(){var current,diff,last;return this.get("last")?(last=parseInt(this.get("last")),current=parseInt(this.get("current")),0!==last?(diff=Math.abs(Math.round((current-last)/last*100)),""+diff+"%"):void 0):""}),Number.accessor("arrow",function(){return this.get("last")?parseInt(this.get("current"))>parseInt(this.get("last"))?"icon-arrow-up":"icon-arrow-down":void 0}),Number.prototype.onData=function(data){return data.status?($(this.get("node")).attr("class",function(i,c){return c.replace(/\bstatus-\S+/g,"")}),$(this.get("node")).addClass("status-"+data.status)):void 0},Number}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.List=function(_super){function List(){return List.__super__.constructor.apply(this,arguments)}return __extends(List,_super),List.prototype.ready=function(){return this.get("unordered")?$(this.node).find("ol").remove():$(this.node).find("ul").remove()},List}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Project=function(_super){function Project(){return Project.__super__.constructor.apply(this,arguments)}return __extends(Project,_super),Project.accessor("value",Dashing.AnimatedValue),Project.prototype.ready=function(){var meter;return meter=$(this.node).find(".project"),meter.attr("data-bgcolor",meter.css("background-color")),meter.attr("data-fgcolor",meter.css("color")),meter.knob()},Project.prototype.onData=function(){return Project.__super__.onData.apply(this,arguments),this.observe("value",function(value){return $(this.node).find(".project").val(value).trigger("change")})},Project}(Dashing.Widget)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child
}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Text=function(_super){function Text(){return Text.__super__.constructor.apply(this,arguments)}return __extends(Text,_super),Text}(Dashing.Widget)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Dashing.Tweets=function(_super){function Tweets(){return this.nextComment=__bind(this.nextComment,this),Tweets.__super__.constructor.apply(this,arguments)}return __extends(Tweets,_super),Tweets.accessor("quote",function(){var _ref;return"\u201c"+(null!=(_ref=this.get("current_comment"))?_ref.body:void 0)+"\u201d"}),Tweets.prototype.ready=function(){return this.currentIndex=0,this.commentElem=$(this.node).find(".comment-container"),this.nextComment(),this.startCarousel()},Tweets.prototype.onData=function(){return this.currentIndex=0},Tweets.prototype.startCarousel=function(){return setInterval(this.nextComment,8e3)},Tweets.prototype.nextComment=function(){var comments;return comments=this.get("comments"),comments?this.commentElem.fadeOut(function(_this){return function(){return _this.currentIndex=(_this.currentIndex+1)%comments.length,_this.set("current_comment",comments[_this.currentIndex]),_this.commentElem.fadeIn()}}(this)):void 0},Tweets}(Dashing.Comments)}.call(this);